<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
    
    <entry>
      <title><![CDATA[Huginnè®¢é˜…å¾®ä¿¡å…¬ä¼—å·RSS]]></title>
      <url>http://dequn.github.io/2019/08/01/huginn-wechat-public-subscribe-rss/</url>
      <content type="html"><![CDATA[<p>åˆæ¥æŠ˜è…¾è¿™ä»¶äº‹ï¼Œè¦è¯´åˆ°ä¸Šä¸ªæœˆå’Œè€æ¿è¿œç¨‹å¼€è¿‡ä¼šä¹‹åï¼Œå¿˜è®°å…³é—­TVå°±çœ‹äº†å¾®ä¿¡å…¬ä¼—å·ï¼Œç„¶åè€æ¿ç§ä¿¡æˆ‘è®©æˆ‘å…³æ‰â€¦ä¸å¾—ä¸è¯´ï¼Œç°åœ¨æ‰“å¼€æ‰‹æœºæ²¡äº‹å°±çœ‹ä¸€ä¸‹å¾®ä¿¡ï¼Œ<strong>æ—¶é—´æ˜¯è¢«ç¢ç‰‡åŒ–äº†</strong>ï¼Œæ‰€ä»¥å°±åˆå›æ¥ä½¿ç”¨RSSè®¢é˜…äº†ï¼Œä¸‰å¹´å‰ä½¿ç”¨è¿‡ä¸€æ®µæ—¶é—´ï¼Œé‚£ä¸ªæ—¶å€™å¾®å¹¿åœºè¿˜åœ¨è¿è¡Œï¼Œè¿™æ¬¡å‘ç°å·²ç»åœæœäº†ï¼Œ<a href="https://docs.rsshub.app/" target="_blank" rel="noopener">RSSHub</a>ä¸Šè¾¹æœ‰å‡ ä¸ªå¾®ä¿¡å…¬ä¼—å·çš„RSSæœåŠ¡å•†ï¼Œå°è¯•åè§‰å¾—éƒ½ä¸å¥½ç”¨ï¼Œå¹¿å‘Šè¿˜ç‰¹åˆ«å¤šï¼Œæ‰€æœ‰å°±å†³å®šè‡ªå·±åŠ¨æ‰‹æ­å»ºä¸€ä¸ªã€‚</p>
<p>å…³äº<a href="https://github.com/huginn/huginn" target="_blank" rel="noopener">Huginn</a>å°±ä¸ä»‹ç»äº†ï¼Œè¿™æ¬¡åœ¨æŠ˜è…¾çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°ç½‘ä¸Šå·²æœ‰æ•™ç¨‹éƒ½å¤±æ•ˆäº†ï¼Œæœç‹—å‡çº§äº†åçˆ¬è™«é€»è¾‘ï¼Œæœ€æ–°çš„ï¼ˆ2019-08-01ï¼‰çš„ååçˆ¬æ–¹æ³•å¯ä»¥å‚è€ƒ<a href="https://zhuanlan.zhihu.com/p/62269087" target="_blank" rel="noopener">æœç‹—å¾®ä¿¡å…¬ä¼—å·æ›´æ–°åçˆ¬ï¼Œååçˆ¬æ€è·¯</a>ï¼Œå…¶å®æ–‡ä¸­æåˆ°çš„<code>SUV cookie</code>ä¸æ˜¯å¿…é¡»çš„ï¼Œè·å–å…¬ä¼—å·æ–‡ç« åˆ—è¡¨æœ€ç®€æ´çš„éœ€è¦å››ä¸ªå¿…é¡»é¡¹:</p>
<ul>
<li>æœç´¢ç»“æœçš„URLä¸­åŠ ä¸Š<code>k=&lt;k&gt;&amp;h=&lt;b&gt;</code>ï¼Œä¸Šæ–‡ä¸­æœ‰ä»£ç å¯ä»¥å‚è€ƒ</li>
<li>Cookieéœ€è¦<code>SNUID</code></li>
<li>éœ€è¦Referer, å°±æ˜¯ <strong>æœç´¢url</strong></li>
<li>User-Agent</li>
</ul>
<p>æ¯”å¦‚æˆ‘è¦çˆ¬çš„æ˜¯åˆ©å™¨å…¬ä¼—å·ï¼Œå„æ­¥éª¤å¦‚ä¸‹<br><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># 1. æœç´¢å…¬ä¼—å·ï¼Œæ‰¾åˆ°å“åº”å¤´ä¸­çš„SNUID cookie, æ¯”å¦‚SNUID=561D77724842C842B2EDA025480F1841</span></span><br><span class="line">curl -I <span class="string">"https://weixin.sogou.com/weixin?type=1&amp;query=liqiio&amp;ie=utf8&amp;s_from=input&amp;_sug_=n&amp;_sug_type_="</span> \</span><br><span class="line">     -H <span class="string">"User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.142 Safari/537.36"</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 2 .å†è¯·æ±‚ä¸€æ¬¡ï¼Œè¿™æ¬¡è¦å†…å®¹ï¼Œæ‰¾åˆ°æ–‡ç« åˆ—è¡¨çš„è¿æ¥</span></span><br><span class="line">curl <span class="string">"https://weixin.sogou.com/weixin?type=1&amp;query=liqiio&amp;ie=utf8&amp;s_from=input&amp;_sug_=n&amp;_sug_type_="</span> \</span><br><span class="line">     -H <span class="string">"User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.142 Safari/537.36"</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 3. é‡æ–°æ„é€ è¿æ¥ï¼Œæ¯”å¦‚æŠ“åˆ°çš„é“¾æ¥æ˜¯ </span></span><br><span class="line"><span class="meta">#    "https://weixin.sogou.com/link?url=dn9a_-gY295K0Rci_xozVXfdMkSQTLW6EzDJysI4ql5MPrOUp16838dGRMI7NnPqYjgTZJTvyIe0v47eKKaovwwvDqyjOWdznRm5urIxFAe1fUoYJ9nyUAdrQXl_05eaVpD2RJskiB3QPjBPE_rT5n5vjKqGbCyDk8ML1vrm9Qpav4blJrSbroDBwqIvthprh6n2T3AixuKv-px0u4VvZGRTpLLTNgHY&amp;type=1&amp;query=liqiio"</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#    æ„é€ åå¯èƒ½æ˜¯ï¼ˆä¸ä¸€å®šï¼Œé‡Œè¾¹æœ‰éšæœºæ•°é€»è¾‘)</span></span><br><span class="line"><span class="meta">#    "https://weixin.sogou.com/link?url=dn9a_-gY295K0Rci_xozVXfdMkSQTLW6EzDJysI4ql5MPrOUp16838dGRMI7NnPqYjgTZJTvyIe0v47eKKaovwwvDqyjOWdznRm5urIxFAe1fUoYJ9nyUAdrQXl_05eaVpD2RJskiB3QPjBPE_rT5n5vjKqGbCyDk8ML1vrm9Qpav4blJrSbroDBwqIvthprh6n2T3AixuKv-px0u4VvZGRTpLLTNgHY&amp;type=1&amp;query=liqiio&amp;k=55&amp;h=v"</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 4. è¯·æ±‚è·å¾—ä¸­é—´è¦è¦è·³è½¬çš„URL</span></span><br><span class="line">curl <span class="string">"https://weixin.sogou.com/link?url=dn9a_-gY295K0Rci_xozVXfdMkSQTLW6EzDJysI4ql5MPrOUp16838dGRMI7NnPqYjgTZJTvyIe0v47eKKaovwwvDqyjOWdznRm5urIxFAe1fUoYJ9nyUAdrQXl_05eaVpD2RJskiB3QPjBPE_rT5n5vjKqGbCyDk8ML1vrm9Qpav4blJrSbroDBwqIvthprh6n2T3AixuKv-px0u4VvZGRTpLLTNgHY&amp;type=1&amp;query=liqiio&amp;k=55&amp;h=v"</span> \</span><br><span class="line">     -H <span class="string">"Cookie: SNUID=561D77724842C842B2EDA025480F1841"</span> \ </span><br><span class="line">     -H <span class="string">"Referer: https://weixin.sogou.com/weixin?type=1&amp;query=liqiio&amp;ie=utf8&amp;s_from=input&amp;_sug_=n&amp;_sug_type_="</span> \</span><br><span class="line">     -H <span class="string">"User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.142 Safari/537.36"</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># è¯·æ±‚ç»“æœæ˜¯</span></span><br><span class="line">&lt;meta content=<span class="string">"always"</span> name=<span class="string">"referrer"</span>&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="keyword">var</span> url = <span class="string">''</span>;</span><br><span class="line">    url += <span class="string">'http://mp.w'</span>;</span><br><span class="line">    url += <span class="string">'eixin.qq.co'</span>;</span><br><span class="line">    url += <span class="string">'m/profile?s'</span>;</span><br><span class="line">    url += <span class="string">'rc=3&amp;timest'</span>;</span><br><span class="line">    url += <span class="string">'amp=1564659'</span>;</span><br><span class="line">    url += <span class="string">'518&amp;ver=1&amp;s'</span>;</span><br><span class="line">    url += <span class="string">'ignature=09'</span>;</span><br><span class="line">    url += <span class="string">'1ydch1Etmv2'</span>;</span><br><span class="line">    url += <span class="string">'cTRl3quzz8a'</span>;</span><br><span class="line">    url += <span class="string">'MuPSr2pdCSo'</span>;</span><br><span class="line">    url += <span class="string">'QecoCjYJ4vZxdW1USUwcMcy62HAs5lWA4jDFW8FWVVfdafVXL7g=='</span>;</span><br><span class="line">    url.replace(<span class="string">"@"</span>, <span class="string">""</span>);</span><br><span class="line">    window.location.replace(url)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta"># 5. æŠŠä¸Šè¾¹çš„ç»“æœæ‹¼ä¸€ä¸‹è®¿é—®å°±è¡Œäº†,æ³¨æ„è¿™ä¸ªç½‘é¡µåˆ—è¡¨æ˜¯JSä¿®æ”¹DOMå‡ºæ¥çš„å†…å®¹ï¼Œå¯ä»¥ç”¨æ— å¤´æµè§ˆå™¨æŠ“å–è§£æåçš„HTML</span></span><br><span class="line">curl <span class="string">"http://mp.weixin.qq.com/profile?src=3&amp;timestamp=1564659518&amp;ver=1&amp;signature=091ydch1Etmv2cTRl3quzz8aMuPSr2pdCSoQecoCjYJ4vZxdW1USUwcMcy62HAs5lWA4jDFW8FWVVfdafVXL7g=="</span></span><br></pre></td></tr></table></figure></p>
<p>æ ¹æ®ä¸Šè¾¹çš„æ­¥éª¤ï¼Œæˆ‘åœ¨Huginnå†™äº†ä¸€ä¸ªScenarioï¼Œç”¨æ¥æŠ“å–å¾®ä¿¡å…¬ä¼—å·æ–‡ç« å¹¶çƒ§å½•RSSï¼Œ<a href="https://gist.github.com/dequn/674b0401c1f31f7919b112ad64640552" target="_blank" rel="noopener">ç‚¹å‡»ä¸‹è½½</a>ï¼Œä¸è¦é—®æˆ‘ä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨<code>PhantomJSCloudAgent</code>çœå»ä¸­é—´è·³è½¬URLçš„è§£æè¿‡ç¨‹ï¼Œæˆ‘ä¸ä¼šå‘Šè¯‰ä½ æ˜¯å› ä¸ºæˆ‘é…ç½®Refererå’Œcookiesè´¹è€å¤§åŠ²éƒ½æ²¡æˆåŠŸï¼Œæ‰€ä»¥å†³å®šè‡ªå·±æ¥ã€‚æ•´ä¸€ä¸ªçº¿æ€§æµç¨‹ï¼Œå¦‚å›¾ã€‚</p>
<p><img src="https://i.loli.net/2019/08/01/5d42d21eb7fcc45265.png" alt="å¾®ä¿¡å…¬ä¼—å·RSSè®¢é˜…"></p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ol>
<li><a href="https://zhuanlan.zhihu.com/p/62269087" target="_blank" rel="noopener">æœç‹—å¾®ä¿¡å…¬ä¼—å·æ›´æ–°åçˆ¬ï¼Œååçˆ¬æ€è·¯</a></li>
<li><a href="https://blog.wangjiegulu.com/2018/04/03/huginn_douban_high_score_movies_and_slack/" target="_blank" rel="noopener">Huginnå®ç°è‡ªåŠ¨é€šè¿‡slackæ¨é€è±†ç“£é«˜åˆ†ç”µå½±</a></li>
<li><a href="https://huginnio.herokuapp.com/scenarios" target="_blank" rel="noopener">https://huginnio.herokuapp.com/scenarios</a></li>
<li><a href="https://gist.github.com/cdpath/fcf4c59e933275e5db2758920a9c1fd8" target="_blank" rel="noopener">https://gist.github.com/cdpath/fcf4c59e933275e5db2758920a9c1fd8</a></li>
<li><a href="https://www.pmvincent.com/2017/02/12/%E4%BD%BF%E7%94%A8Huginn+RSS%E6%9E%84%E5%BB%BA%E4%B8%AA%E4%BA%BA%E4%BF%A1%E6%81%AF%E4%B8%AD%E5%BF%83/" target="_blank" rel="noopener">ä½¿ç”¨Huginn+RSSæ„å»ºä¸ªäººä¿¡æ¯ä¸­å¿ƒ</a></li>
</ol>
]]></content>
      
        
        <tags>
            
            <tag> Huginn </tag>
            
            <tag> RSS </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[å¾®ä¿¡æµè§ˆå™¨ï¼Œç”¨æˆ·çœŸå®çš„IPåœ°å€]]></title>
      <url>http://dequn.github.io/2019/06/26/get-weixin-browser-client-ip-md/</url>
      <content type="html"><![CDATA[<p>æ¥ä¸Šç¯‡<a href="/2019/06/22/docker-web-get-real-client-ip/" title="Dockerå†…webæœåŠ¡è·å–çœŸå®å®¢æˆ·ç«¯IP">Dockerå†…webæœåŠ¡è·å–çœŸå®å®¢æˆ·ç«¯IP</a>ï¼Œåœ¨è®¾ç½®å¥½<code>REMOTE_ADDR</code>åï¼Œé€šè¿‡è§£æIPå‘ç°ç”¨æˆ·çš„ä½ç½®ç«Ÿç„¶æ˜¯åˆ«çš„åœ°åŒºï¼Œå°ä¼™ä¼´ç¬¬ä¸€æ¬¡å‘Šè¯‰æˆ‘çš„æ—¶å€™æˆ‘ä»¥ä¸ºæ˜¯IPåœ°å€åº“ä¸æ˜¯å¾ˆå‡†ç¡®ï¼Œå¹¶æ²¡æœ‰åœ¨æ„ï¼Œåæ¥è‡ªå·±å†ä¸€æ¬¡æµ‹è¯•çš„æ—¶å€™ï¼Œå‘ç°IPç¡®å®ä¸æ˜¯æˆ‘çœŸå®çš„å¯¹å¤–IPã€‚</p>
<p>çœ‹æ—¥å¿—å‘ç°åœ¨Androidå¾®ä¿¡(v7.0.4)æµè§ˆå™¨ä¸‹ï¼Œæ‰€æœ‰çš„AJAXè¯·æ±‚éƒ½è¢«<strong>å¾®ä¿¡é»˜è®¤ä»£ç†</strong>äº†ï¼ï¼ä½†æ˜¯å¾®ä¿¡ä»£ç†<strong>ä¸ä»£ç†csså’Œå›¾ç‰‡ç­‰é™æ€èµ„æºå’ŒWebSocket</strong>ã€‚iPhoneä¸‹ä¹Ÿä¸å­˜åœ¨ä»£ç†è¡Œä¸ºï¼Œè¿™å°¼ç›å‘çˆ¹ã€‚</p>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé€ä¼ è¿‡æ¥çš„<code>X-Real-IP</code>å°±å·²ç»æ˜¯å¾®ä¿¡æœåŠ¡å™¨çš„IPäº†ï¼ˆé‡åˆ°ä¸¤ä¸ªï¼Œä¸€ä¸ªä¸Šæµ·ä¸€ä¸ªå¤©æ´¥)ï¼Œè¿˜å¥½å¾®ä¿¡ä»£ç†å¹¶æ²¡æœ‰æŠ¹å»<code>X-Forwarded-For</code>ä¸­çš„ä¿¡æ¯ï¼Œè¿™æ—¶å€™å¦‚æœæƒ³è·å–çœŸå®çš„å®¢æˆ·ç«¯IPï¼Œå°±åªèƒ½ä»è¿™ä¸ªé‡Œé¢è§£æäº†ã€‚</p>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># Django</span></span><br><span class="line"><span class="meta"># ...</span></span><br><span class="line">client_ip = request.META.<span class="keyword">get</span>(<span class="string">'HTTP_X_FORWARDED_FOR'</span>, request.META.<span class="keyword">get</span>(<span class="string">'REMOTE_ADDR'</span>)).split(<span class="string">','</span>)[<span class="number">0</span>].strip()</span><br><span class="line"><span class="meta"># ...</span></span><br></pre></td></tr></table></figure>
<p>å¯ä»¥å‚è€ƒ<br>[1].<a href="https://www.v2ex.com/t/417471" target="_blank" rel="noopener">å¾®ä¿¡å®‰å“ X5 æµè§ˆå™¨ä¸€ä¸ªè®©äººæ— è¯­çš„è®¾å®š</a><br>[2].<a href="https://1991421.cn/2017/09/03/e3f47c50/" target="_blank" rel="noopener">å¾®ä¿¡æµè§ˆå™¨ä¸­çš„ç½‘ç»œä»£ç†</a></p>
]]></content>
      
        
        <tags>
            
            <tag> å¾®ä¿¡ </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Dockerå†…webæœåŠ¡è·å–çœŸå®å®¢æˆ·ç«¯IP]]></title>
      <url>http://dequn.github.io/2019/06/22/docker-web-get-real-client-ip/</url>
      <content type="html"><![CDATA[<p>ç³»ç»Ÿéœ€æ±‚è¦åœ¨ç”¨æˆ·æ³¨å†Œçš„æ—¶å€™ï¼Œè‡ªåŠ¨è·å–ç”¨æˆ·æ‰€åœ¨çš„åŒºåŸŸï¼Œæœ€ç®€å•çš„ï¼Œä¸é€šè¿‡æµè§ˆå™¨æˆ–å¾®ä¿¡è·å–ä½ç½®æƒé™çš„æ–¹å¼ï¼Œå°±æ˜¯é€šè¿‡è§£æIPå½’å±åœ°ã€‚IPå½’å±åœ°æŸ¥è¯¢å¾ˆç®€å•ï¼Œé€šè¿‡<a href="https://lbs.amap.com/api/webservice/guide/api/ipconfig" target="_blank" rel="noopener">é«˜å¾·IPå®šä½</a>æˆ–è€…å…¶ä»–æœåŠ¡å•†æä¾›çš„APIå°±å¯ä»¥å®ç°ï¼Œä½†æ˜¯åœ¨å®æ–½è¿‡ç¨‹ä¸­ï¼Œå‘ç°Dockerå†…éƒ¨çš„Webç¨‹åºï¼Œè·å–çš„IPéƒ½æ˜¯Dockerå®¹å™¨çš„IPğŸ¤¦â€â™‚ï¸.</p>
<p>è¿™æ˜¯åœ¨ä½¿ç”¨Docker Composeåè€…Docker Swarm çš„æ—¶å€™çš„ä¸€ä¸ªBugï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯ä¸€ä¸ªDocker network çš„å¯é¢„æœŸè¡Œä¸ºï¼Œä¸€ä¸ªContainerå°±æ˜¯ç›¸å½“äºä¸€å°æœºå™¨ï¼Œæˆ‘ä»¬æ˜¯ä»¥Docker networkçš„èº«ä»½ï¼ˆIPï¼‰å»è®¿é—®æœåŠ¡ï¼Œå…¶<code>remote_addr</code>ä¹Ÿå°±æ˜¯Dockerå†…çš„IPäº†ã€‚å¯ä»¥å‚è€ƒ<a href="https://github.com/jwilder/nginx-proxy/issues/130" target="_blank" rel="noopener">Real remote IP adress</a>ã€‚</p>
<p>é‚£ä¹ˆè¦å¦‚ä½•æ‰èƒ½è·å¾—å®¢æˆ·ç«¯çš„çœŸå®IPå‘¢ï¼Œæ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œé‚£å°±æ˜¯ä½¿ç”¨ä¸€ä¸ªå¤šä¸€å±‚çš„proxyï¼ˆå¦‚æœæ˜¯ç›´æ¥è®¿é—®Docker webæœåŠ¡å™¨çš„æƒ…å†µä¸‹ï¼‰ï¼Œå¦‚æœå·²ç»æ˜¯ç”±å…¶ä»–WebæœåŠ¡å™¨è½¬å‘è¿‡æ¥çš„ï¼Œå°±æ›´ç®€å•äº†ã€‚</p>
<p>ä¸€èˆ¬çš„ï¼Œåœ¨ä»£ç†æœåŠ¡å™¨ä¸­æœ‰è®¾ç½®ï¼ˆä»¥Nginxä¸ºä¾‹ï¼‰:</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line"><span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆåœ¨æˆ‘ä»¬å®¹å™¨å†…éƒ¨ï¼Œè¿™ä¸ª<code>X-Real-IP</code> headeræ˜¯æ­£ç¡®çš„IPï¼Œè¿™æ˜¯å¯é¢„æœŸçš„ï¼Œé‚£ä¹ˆè¯¥å¦‚ä½•è·å¾—çœŸå®IPå‘¢ï¼Œè¿™é‡Œæˆ‘æ˜¯é€šè¿‡<a href="https://cookiecutter-django.readthedocs.io/en/latest/index.html" target="_blank" rel="noopener">Cookiecutter Django</a>å»ºç«‹çš„å·¥ç¨‹ï¼Œä½¿ç”¨çš„æ˜¯Caddyä½œä¸ºWebæœåŠ¡å™¨ï¼Œåœ¨è½¬å‘ç»™Djangoå®¹å™¨ä¹‹å‰ï¼Œè®¾ç½®Caddyfileæœ‰</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">header_upstream X-<span class="built_in">Real</span>-IP &#123;&gt;X-<span class="built_in">Real</span>-IP&#125;</span><br><span class="line">header_upstream X-Forwarded-<span class="keyword">For</span> &#123;&gt;X-Forwarded-<span class="keyword">For</span>&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬åœ¨Djangoä¸­å°±å¯ä»¥é€šè¿‡<code>X-Real-IP</code>æˆ–è€…æ˜¯<code>X-Forwarded-For</code>æ‹¿åˆ°æ­£ç¡®çš„IPäº†ï¼Œæ³¨æ„è¿™ä¸ªæ—¶å€™åœ¨webåº”ç”¨ç¨‹åºä¸­ï¼Œrequest.META[â€˜REMOTE_ADDRâ€™]æ˜¯Caddyå®¹å™¨çš„å†…éƒ¨IPï¼Œ<code>X-Real-IP</code>å’Œ<code>X-Forwarded-For</code>æ˜¯å¦‚æœæƒ³é€šè¿‡é»˜è®¤çš„<code>request.META[&#39;REMOTE_ADDR&#39;]</code>ï¼Œå¯ä»¥æ·»åŠ ä¸€ä¸ªMiddlewareï¼Œæ”¾åœ¨<code>settings.MIDDLEWARE</code>çš„ç¬¬ä¸€ä¸ªä½ç½®å³å¯ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RestoreRemoteAddrMiddleware</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Docker cover X-Forwarded-For header user internal ip, so use X-Real-IP to set META['REMOTE_ADDR']</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, get_response)</span>:</span></span><br><span class="line">        self.get_response = get_response</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        remote_addr = request.META.get(<span class="string">'HTTP_X_REAL_IP'</span>, <span class="keyword">None</span>)</span><br><span class="line">        <span class="keyword">if</span> remote_addr: </span><br><span class="line">            request.META[<span class="string">'REMOTE_ADDR'</span>] = remote_addr</span><br><span class="line">        <span class="keyword">return</span> self.get_response(request)</span><br></pre></td></tr></table></figure>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MIDDLEWARE = [</span><br><span class="line">    'your.module.RestoreRemoteAddrMiddleware',</span><br><span class="line">    <span class="comment"># other middlewarees</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> Docker </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Django </tag>
            
            <tag> Docker </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[æˆ‘åˆ äº†ä¸€ä¸ªæ•°æ®åº“]]></title>
      <url>http://dequn.github.io/2019/02/20/i-deleted-a-db/</url>
      <content type="html"><![CDATA[<p>2019å¹´2æœˆ18æ—¥ï¼Œæˆ‘åˆ äº†ä¸€ä¸ªæ•°æ®åº“ã€‚</p>
<p>å¯¹çš„ï¼Œç½‘ä¸Šæ®µå­é‡Œçš„äº‹æ•…ï¼ŒçœŸå®çš„å‘ç”Ÿåœ¨æˆ‘èº«ä¸Šäº†ã€‚æˆ‘åˆ çš„ä¸å•å•æ˜¯æ•°æ®ï¼Œæ˜¯æ•´ä¸ªæ•°æ®åº“æ–‡ä»¶å¤¹ã€‚</p>
<p><strong>æé†’ä¸€ä¸‹æœ‰å¹¸çœ‹åˆ°çš„æœ‹å‹ï¼ŒXFSæ–‡ä»¶ç³»ç»Ÿï¼Œè¯¯åˆ äº†ç†è®ºä¸Šå°±ä¸å­˜åœ¨æ‰¾å›çš„å¯èƒ½æ€§ï¼Œå¦‚æœæ²¡æœ‰å¤‡ä»½çš„è¯ã€‚</strong></p>
<p>å¦‚æœæœ‰æœ‹å‹ä¹Ÿæ‰‹è´±äº†ï¼Œåˆ«æ¿€åŠ¨ï¼ŒæŠ½æ ¹çƒŸå†·é™åœ°æƒ³ä¸€æƒ³ç¦»èŒä¹¦æ€ä¹ˆå†™ï¼Œæ¯•ç«Ÿåˆ åº“å’Œè·‘è·¯æ˜¯åˆ†ä¸å¼€çš„ã€‚</p>
<p>å¥½äº†ï¼Œåˆ«çš„ä¸è¯´äº†ï¼Œæ€»ç»“ä¸€ä¸‹æ•™è®­ã€‚</p>
<h2 id="è‡ªå·±çš„è´£ä»»ä¸ç”©é”…"><a href="#è‡ªå·±çš„è´£ä»»ä¸ç”©é”…" class="headerlink" title="è‡ªå·±çš„è´£ä»»ä¸ç”©é”…"></a>è‡ªå·±çš„è´£ä»»ä¸ç”©é”…</h2><p>ä½ ä¸ºå•¥ä¼šåˆ æ•°æ®åº“ï¼Œä¸ºä»€ä¹ˆåˆ«äººéƒ½æ²¡è¯¯åˆ é™¤è¿‡ï¼Ÿåˆ ä¹‹å‰ä¸ºä½•ä¸è€ƒè™‘æ¸…æ¥šï¼ŸçŠ¶æ€ä¸å¥½ï¼Ÿä¸å¥½çš„æ—¶å€™å°±ä¸è¦æ‰§è¡Œè¿™äº›å±é™©æ“ä½œï¼Œå»ä¼‘æ¯ä¸€ä¼šå„¿ï¼Œæ¸…é†’äº†å†æ¥ã€‚<strong>è¦æ€€ç€æœåœ£çš„å¿ƒï¼Œå»è¿ç»´ã€‚</strong></p>
<h2 id="è¯¯åˆ é™¤åé¿å…æŸå¤±"><a href="#è¯¯åˆ é™¤åé¿å…æŸå¤±" class="headerlink" title="è¯¯åˆ é™¤åé¿å…æŸå¤±"></a>è¯¯åˆ é™¤åé¿å…æŸå¤±</h2><p>å¦‚æœä½ ä¸æ¸…æ¥šæ–‡ä»¶ç³»ç»Ÿæ ¼å¼ï¼Œé‚£ä¹ˆæœ€å¥½çš„åŠæ³•å°±æ˜¯èµ¶ç´§å¸è½½åˆ†åŒºï¼Œæˆ–æ”¹æˆåªè¯»æ¨¡å¼ï¼ŒExt(2,3,4)ã€FATéƒ½æ˜¯æ”¯æŒè¯¯åˆ æ¢å¤çš„ï¼Œåœ¨ç¡¬ç›˜æ²¡æœ‰è¢«é‡å†™ä¹‹å‰ï¼Œ<strong>ä¿æŠ¤å¥½ç£ç›˜ç°åœº</strong>ã€‚</p>
<h2 id="ç”Ÿäº§ç³»ç»Ÿå’Œå¼€å‘ç³»ç»Ÿçš„åˆ†ç¦»"><a href="#ç”Ÿäº§ç³»ç»Ÿå’Œå¼€å‘ç³»ç»Ÿçš„åˆ†ç¦»" class="headerlink" title="ç”Ÿäº§ç³»ç»Ÿå’Œå¼€å‘ç³»ç»Ÿçš„åˆ†ç¦»"></a>ç”Ÿäº§ç³»ç»Ÿå’Œå¼€å‘ç³»ç»Ÿçš„åˆ†ç¦»</h2><p>å› ä¸ºå…¬å¸èµ„æºæœ‰é™ï¼Œæœ‰ä¸€ä¸ªå°çš„ç”Ÿäº§ç³»ç»Ÿå’Œå¼€å‘ç³»ç»Ÿåœ¨åŒä¸€ä¸ªæœºå™¨ä¸Šï¼Œè¿™æ¬¡è¯¯åˆ çš„èƒŒæ™¯å°±æ˜¯è¿™æ ·ã€‚åšåˆ°äº†<strong>ç³»ç»Ÿåˆ†ç¦»</strong>ï¼Œä¹Ÿå°±ä¸ä¼šæœ‰è¿™æ ·çš„å¹ºè›¾å­äº†ã€‚</p>
<h2 id="æƒé™æ§åˆ¶ä¸å¤‡ä»½"><a href="#æƒé™æ§åˆ¶ä¸å¤‡ä»½" class="headerlink" title="æƒé™æ§åˆ¶ä¸å¤‡ä»½"></a>æƒé™æ§åˆ¶ä¸å¤‡ä»½</h2><p>å°å…¬å¸é‡è›®å‘å±•ï¼Œä¸æ³¨é‡æƒé™æ§åˆ¶ï¼Œæ²¡æœ‰ä¸“äººè´Ÿè´£OPï¼Œç¼ºä¹å®‰å…¨æ„è¯†ã€åˆ¶åº¦ï¼Œçƒ­å¤‡å’Œå†·å¤‡ä¸å¯ç¼ºå°‘ï¼Œä¸è¦æ‹…å¿ƒè¿™ä¸€ç‚¹æŠ•å…¥ï¼Œ<strong>å‡ºäº†äº‹æƒ…ï¼ŒæŸå¤±è¿œæ¯”æˆæœ¬å¤§çš„å¤š</strong>ã€‚è¯¥ä½¿ç”¨äº‘æœåŠ¡çš„ä½¿ç”¨äº‘æœåŠ¡ï¼Œè¿™æ ·å°±å¯ä»¥å…å»å¾ˆå¤§ä¸€éƒ¨åˆ†è‡ªè¿ç»´ã€‚</p>
<h2 id="è·‘è·¯ï¼Ÿ"><a href="#è·‘è·¯ï¼Ÿ" class="headerlink" title="è·‘è·¯ï¼Ÿ"></a>è·‘è·¯ï¼Ÿ</h2><p>è·‘è·¯é‚£æ˜¯ä¸å­˜åœ¨çš„ï¼Œ<strong>æ­£ç¡®é¢å¯¹æ¥å—äº‹æ•…åŠæŸå¤±</strong>ï¼Œè¯¥è´Ÿè´£è´Ÿè´£ï¼Œè¯¥é•¿å¿ƒé•¿å¿ƒï¼Œè¿™æ˜¯ä¸€ç¬”è´¢å¯Œã€‚</p>
]]></content>
      
        
        <tags>
            
            <tag> åˆ åº“ </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[DRF DateTimeè½¬æ¢ä¸ºæ—¶é—´æˆ³]]></title>
      <url>http://dequn.github.io/2019/01/17/drf-datetime-timestamp-serializer/</url>
      <content type="html"><![CDATA[<p>å°†æ—¶é—´è½¬åŒ–ä¸ºæ—¶é—´æˆ³è¾“å‡ºç»™å‰ç«¯ï¼Œå¯ä»¥å‡å°‘å‰ç«¯å·¥ä½œé‡ï¼Œæ¯•ç«Ÿä»æ—¶é—´æˆ³è½¬æ¢ä¸ºæœ¬åœ°æ—¶é—´å¾ˆç®€å•ï¼Œä¹Ÿå‡å°‘äº†æ—¶åŒºè½¬æ¢çš„éº»çƒ¦ã€‚ä½†æ˜¯DRFæœ¬èº«æ˜¯æ²¡æœ‰æä¾›æ—¶é—´æˆ³è¾“å‡ºé€‰é¡¹çš„ï¼Œå‡†ç¡®çš„æ˜¯pythonçš„<code>strftime</code>å¹¶æ²¡æœ‰æä¾›æ ‡å‡†çš„æ—¶é—´æˆ³è¾“å‡ºæ ¼å¼ï¼Œä½†æ˜¯<code>%s</code>ä½œä¸ºGNU æ‰©å±•çš„æ—¶é—´è¾“å‡ºæ ¼å¼ï¼Œå› æ­¤DRFçš„<a href="https://stackoverflow.com/questions/26083583/serialize-a-datetime-as-an-integer-timestamp" target="_blank" rel="noopener"><code>DATETIME_FORMAT</code>å¯ä»¥è®¾ç½®ä¸ºâ€™%sâ€™</a>ï¼Œèƒ½å¤Ÿè¾“å‡ºæ—¶é—´æˆ³å­—ç¬¦ä¸²ï¼ˆæ³¨æ„ï¼Œä¸æ˜¯æ•°å­—ï¼Œæ˜¯å­—ç¬¦ä¸²)ï¼Œä½†æ˜¯ä¸è¦é«˜å…´çš„å¤ªæ—©ï¼Œå¦‚æœä¸æ˜¯UTCæ—¶é—´ï¼Œé‚£ä¹ˆè¿™æ ·è®¾ç½®æ˜¯æœ‰é—®é¢˜çš„ã€‚</p>
<p>åœ¨æœ€å¼€å§‹å¹¶æ²¡æœ‰æ³¨æ„è¾“å‡ºçš„æ—¶é—´æˆ³å€¼æœ‰ä»€ä¹ˆä¸å¯¹ï¼Œç›´åˆ°å‰ç«¯çš„å°ä¼™ä¼´è·Ÿæˆ‘ååº”æˆ‘ä¼ ç»™ä»–çš„æ—¶é—´æˆ³ä¸ä»–POSTç»™æˆ‘çš„ä¸ä¸€æ ·å•Šï¼Œå·®äº†8ä¸ªå°æ—¶ï¼Œè¿˜ä¸æ˜¯æ¯”æœ¬åœ°æ—¶é—´å°‘äº†8ä¸ªå°æ—¶ï¼Œè€Œæ˜¯å¤šå‡ºäº†8ä¸ªå°æ—¶ï¼Œè¿™å°±å¾ˆå¥‡æ€ªäº†ï¼Œèµ¶ç´§ä¸Šæ•°æ®åº“é‡Œè¾¹ç…ä¸€çœ¼ï¼Œå‘ç°æ—¶é—´ä»¥åŠæ—¶åŒºéƒ½æ˜¯æ­£ç¡®çš„ï¼ˆDjangoæ‰˜ç®¡çš„Postgresql åªå­˜å‚¨UTCæ—¶é—´ï¼Œè¯»å‡ºæ¥çš„æ—¶å€™ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºæœ¬åœ°æ—¶é—´ï¼‰ï¼Œé‚£ä¹ˆè‚¯å®šå°±æ˜¯â€™%sâ€™è¿™ä¸ªæ—¶é—´æ ¼å¼åŒ–å‡ºçš„å¹ºè›¾å­äº†ã€‚</p>
<p>æŸ¥çœ‹DRFçš„<code>DateTimeField</code>çš„æºç ï¼Œå‘ç°å…¶<code>to_representaton</code>å‡½æ•°å¹¶æ²¡æœ‰åšç‰¹æ®Šå¤„ç†ï¼Œæ‰€ä»¥é—®é¢˜æ‰€åœ¨åº”è¯¥æ˜¯pythonçš„datetimeçš„strftimeæ–¹æ³•äº†ã€‚<br><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">def to_representation(self, <span class="built_in">value</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">value</span>:</span><br><span class="line">        <span class="literal">return</span> None</span><br><span class="line"></span><br><span class="line">    output_format = getattr(self, <span class="string">'format'</span>, api_settings.DATETIME_FORMAT)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> output_format is None <span class="keyword">or</span> isinstance(<span class="built_in">value</span>, <span class="literal">six</span>.string_types):</span><br><span class="line">        <span class="literal">return</span> <span class="built_in">value</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">value</span> = self.enforce_timezone(<span class="built_in">value</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> output_format.<span class="built_in">lower</span>() == ISO_8601:</span><br><span class="line">        <span class="built_in">value</span> = <span class="built_in">value</span>.isoformat()</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">value</span>.endswith(<span class="string">'+00:00'</span>):</span><br><span class="line">            <span class="built_in">value</span> = <span class="built_in">value</span>[:<span class="number">-6</span>] + <span class="string">'Z'</span></span><br><span class="line">        <span class="literal">return</span> <span class="built_in">value</span></span><br><span class="line">    <span class="literal">return</span> <span class="built_in">value</span>.strftime(output_format)</span><br></pre></td></tr></table></figure></p>
<p>ç»§ç»­è·Ÿè¸ªå‘ç°ï¼Œdatetimeçš„strftimeä¼ å…¥çš„å‚æ•°æ˜¯timetupleï¼Œé—®é¢˜ä¹Ÿå°±åœ¨è¿™é‡Œï¼Œæ ¹æ®Pythonå®˜æ–¹æ–‡æ¡£è¯´æ˜ï¼Œtimetuple()è¿”å›çš„æ˜¯æœ¬åœ°æ—¶é—´å…ƒç»„ï¼Œä¸¢å¤±äº†æ—¶åŒºä¿¡æ¯çš„ï¼Œçœ‹ä¸‹é¢çš„ä¾‹å­ã€‚</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">strftime</span><span class="params">(<span class="keyword">self</span>, fmt)</span></span><span class="symbol">:</span></span><br><span class="line">    <span class="string">"Format using strftime()."</span></span><br><span class="line">    <span class="keyword">return</span> _wrap_strftime(<span class="keyword">self</span>, fmt, <span class="keyword">self</span>.timetuple())</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>date.timetuple()</strong><br> Return a time.struct_time such as returned by time.localtime().</p>
</blockquote>
<p>åœ¨Django shell ä¸­æµ‹è¯•ï¼Œå¯ä»¥çœ‹åˆ° <code>lt == t</code>ï¼Œæ˜¯åŒä¸€æ—¶é—´ï¼Œä½†ä»–ä»¬çš„<code>timetuple()</code>ä¸ç­‰ï¼Œæ˜¯å„è‡ªçš„æœ¬åœ°æ—¶é—´ï¼Œâ€™%sâ€™æ ¼å¼åŒ–è¾“å‡ºåä¹Ÿæ˜¯ä¸ç­‰çš„ï¼ŒCSTæ—¶é—´è¦æ¯”UTCæ—¶é—´æ—©8ä¸ªå°æ—¶ï¼Œæ—¶é—´æˆ³ä¹Ÿå°±å¤§å‡º8ä¸ªå°æ—¶çš„ç§’æ•°ï¼Œä½†å¦‚æœç›´æ¥è°ƒç”¨ä»–ä»¬ä½†timestamp()æ–¹æ³•ï¼Œåˆ™ä¼šå‘ç°å…¶ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œå³åŒä¸€æ—¶åˆ»ï¼Œå„ä¸ªæ—¶åŒºçš„æ—¶é—´æˆ³éƒ½æ˜¯ä¸€æ ·çš„ã€‚ datetimeè¿˜æœ‰ä¸€ä¸ª<code>utctimetuple()</code>æ–¹æ³•ï¼Œä»åå­—å¯ä»¥çœ‹å‡ºå…¶è¿”å›çš„æ˜¯UTC timetupleï¼Œå¯ä»¥è‚¯å®šï¼Œ<code>t</code>å’Œ<code>lt</code>çš„è¯¥æ–¹æ³•è°ƒç”¨ç»“æœæ˜¯ä¸€æ ·çš„ã€‚</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">201</span>]: t</span><br><span class="line">Out[<span class="number">201</span>]: datetime.datetime(<span class="number">2019</span>, <span class="number">1</span>, <span class="number">17</span>, <span class="number">1</span>, <span class="number">43</span>, <span class="number">19</span>, <span class="number">300000</span>, <span class="attr">tzinfo=&lt;UTC&gt;)</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">202</span>]: <span class="attr">lt</span> = timezone.localtime(t)</span><br><span class="line"></span><br><span class="line">In [<span class="number">203</span>]: <span class="attr">lt</span> == t</span><br><span class="line">Out[<span class="number">203</span>]: True</span><br><span class="line"></span><br><span class="line">In [<span class="number">204</span>]: t.timetuple()</span><br><span class="line">Out[<span class="number">204</span>]: time.struct_time(<span class="attr">tm_year=2019,</span> <span class="attr">tm_mon=1,</span> <span class="attr">tm_mday=17,</span> <span class="attr">tm_hour=1,</span> <span class="attr">tm_min=43,</span> <span class="attr">tm_sec=19,</span> <span class="attr">tm_wday=3,</span> <span class="attr">tm_yday=17,</span> <span class="attr">tm_isdst=0)</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">205</span>]: lt.timetuple()</span><br><span class="line">Out[<span class="number">205</span>]: time.struct_time(<span class="attr">tm_year=2019,</span> <span class="attr">tm_mon=1,</span> <span class="attr">tm_mday=17,</span> <span class="attr">tm_hour=9,</span> <span class="attr">tm_min=43,</span> <span class="attr">tm_sec=19,</span> <span class="attr">tm_wday=3,</span> <span class="attr">tm_yday=17,</span> <span class="attr">tm_isdst=0)</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">206</span>]: t.strftime('%s')</span><br><span class="line">Out[<span class="number">206</span>]: '<span class="number">1547689399</span>'</span><br><span class="line"></span><br><span class="line">In [<span class="number">207</span>]: lt.strftime('%s')</span><br><span class="line">Out[<span class="number">207</span>]: '<span class="number">1547718199</span>'</span><br><span class="line"></span><br><span class="line">In [<span class="number">208</span>]: t.timestamp()</span><br><span class="line">Out[<span class="number">208</span>]: <span class="number">1547689399.3</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">209</span>]: lt.timestamp()</span><br><span class="line">Out[<span class="number">209</span>]: <span class="number">1547689399.3</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">211</span>]: t.utctimetuple()</span><br><span class="line">Out[<span class="number">211</span>]: time.struct_time(<span class="attr">tm_year=2019,</span> <span class="attr">tm_mon=1,</span> <span class="attr">tm_mday=17,</span> <span class="attr">tm_hour=1,</span> <span class="attr">tm_min=43,</span> <span class="attr">tm_sec=19,</span> <span class="attr">tm_wday=3,</span> <span class="attr">tm_yday=17,</span> <span class="attr">tm_isdst=0)</span></span><br><span class="line"></span><br><span class="line">In [<span class="number">212</span>]: lt.utctimetuple()</span><br><span class="line">Out[<span class="number">212</span>]: time.struct_time(<span class="attr">tm_year=2019,</span> <span class="attr">tm_mon=1,</span> <span class="attr">tm_mday=17,</span> <span class="attr">tm_hour=1,</span> <span class="attr">tm_min=43,</span> <span class="attr">tm_sec=19,</span> <span class="attr">tm_wday=3,</span> <span class="attr">tm_yday=17,</span> <span class="attr">tm_isdst=0)</span></span><br></pre></td></tr></table></figure>
<p>åœ¨Python çš„æ–‡æ¡£ä¸­ä¹Ÿè¯´æ˜äº†ï¼ŒPythonç»™å‡ºçš„æ ¼å¼åŒ–å­—ç¬¦éƒ½æ˜¯æ ‡å‡†Cè¦†ç›–çš„ï¼Œå„ç³»ç»Ÿå¹³å°éƒ½å¯æ— å·®å¼‚è¿è¡Œï¼Œä½†æ˜¯å…¶ä»–Cå¹³å°æ‰©å±•çš„ä¹Ÿå¯ä»¥è¿è¡Œï¼Œèƒ½å¦æ”¯æŒå°±çœ‹Pythonçš„åº•å±‚ç¯å¢ƒäº†ã€‚</p>
<blockquote>
<p>The full set of format codes supported varies across platforms, because Python calls the platform C libraryâ€™s strftime() function, and platform variations are common. To see the full set of format codes supported on your platform, consult the strftime(3) documentation.</p>
</blockquote>
<blockquote>
<p>The following is a list of all the format codes that the C standard (1989 version) requires, and these work on all platforms with a standard C implementation. Note that the 1999 version of the C standard added additional format codes.</p>
</blockquote>
<p>æ‰¾åˆ°äº†åŸå› ï¼Œä¹Ÿè¦ç»™å‡ºè§£å†³æ–¹æ¡ˆï¼Œæ—¢ç„¶â€œæ ‡å‡†â€çš„æ ¼å¼ä¸èƒ½ç›´æ¥è¾“å‡ºæ—¶é—´æˆ³ï¼Œé‚£ä¹ˆå°±è‡ªå®šä¹‰ä¸€ä¸ªDateTimeFieldå¥½äº†ï¼Œåœ¨Serializerä¸­ä½¿ç”¨è‡ªå®šä¹‰çš„DateTimeFieldæ¥ä»£æ›¿é»˜è®¤çš„DRFçš„DateTimeFieldå³å¯å¾—åˆ°æ—¶é—´æˆ³ï¼Œå½“ç„¶ï¼Œå¦‚æœæœ‰å¤šä¸ªModeléƒ½æœ‰æ—¶é—´å­—æ®µï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ç»§æ‰¿è‡ªModelSerializerï¼Œä¿®æ”¹ä»–çš„<code>serializer_field_mapping</code>ï¼Œå°†æ—¶é—´ç±»å‹çš„åºåˆ—åŒ–å­—æ®µç±»å‹ä¿®æ”¹ä¸ºæˆ‘ä»¬è‡ªå®šä¹‰çš„å­—æ®µå³å¯ï¼Œä»£ç å¦‚ä¸‹ã€‚<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DateTimeField</span><span class="params">(serializers.DateTimeField)</span>:</span></span><br><span class="line">    <span class="comment"># custom field</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">to_representation</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> int(value.timestamp())</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ModelSerializer</span><span class="params">(serializers.ModelSerializer)</span>:</span></span><br><span class="line">    <span class="comment"># modify default serializer_field_mapping</span></span><br><span class="line">    serializer_field_mapping = serializers.ModelSerializer.serializer_field_mapping</span><br><span class="line">    serializer_field_mapping[models.DateTimeField] = DateTimeField</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SampleModelSerializer</span><span class="params">(ModelSerializer)</span>:</span> <span class="comment"># our own ModelSerializer, not drf's serialiers.ModelSerializer</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">    <span class="comment"># ...</span></span><br></pre></td></tr></table></figure></p>
]]></content>
      
        
        <tags>
            
            <tag> Django </tag>
            
            <tag> DRF </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Charleså’Œ Shadowsocks å…±å­˜è®¾ç½®è¯´æ˜]]></title>
      <url>http://dequn.github.io/2019/01/13/how-to-resolve-confilcts-between-charles-and-shadowsocks/</url>
      <content type="html"><![CDATA[<p>è¯¥æ–‡çš„è¯´æ˜è§£é‡Šå¯èƒ½éœ€è¦å¦‚ä¸‹çš„è½¯ä»¶åŠç¯å¢ƒï¼š<br><em><br>Chrome v71.0.3578.98<br>macOS v10.13.6<br>Charles v4.2.7<br>ShadowsocksX-NG v1.8.2 (1)
</em></p>
<hr>
<p>Charlesä½œä¸ºä¸€æ¬¾HTTP(S)æŠ“åŒ…å·¥å…·éå¸¸å¥½ç”¨ï¼Œä¸è¿‡å›½å†…çš„ç”¨æˆ·åŸºæœ¬ä¸Šè¿˜éƒ½æŒ‚Shadowsocksç¿»å¢™äº†ï¼Œç³»ç»Ÿä»£ç†åªèƒ½æœ‰ä¸€ä¸ªï¼ˆæ³¨æ„æ˜¯ç³»ç»Ÿä»£ç†ï¼Œä¸€èˆ¬è½¯ä»¶ä¹Ÿéƒ½å¯ä»¥é…ç½®è‡ªå·±çš„ä»£ç†æœåŠ¡ï¼‰ï¼Œåœ¨macOSä¸Šï¼ŒChromeé»˜è®¤ä½¿ç”¨çš„å°±æ˜¯ç³»ç»Ÿä»£ç†(å•ç‹¬è®¾ç½®ä»£ç†è¯·å‚è€ƒ<a href="https://my.oschina.net/u/147181/blog/164872" target="_blank" rel="noopener">ä¸ºè°·æ­Œchromeæµè§ˆå™¨è®¾ç½®ç‹¬ç«‹ä»£ç†æœåŠ¡å™¨</a>)ï¼Œæ‰€ä»¥å¦‚æœæƒ³è¦ä¸¤è€…åŒæ—¶å·¥ä½œä¸å†²çªï¼Œè¿˜éœ€è¦ä¸€äº›ç‰¹åˆ«çš„è®¾ç½®ã€‚</p>
<p><a href="https://www.jianshu.com/p/ff114bdf0f8f" target="_blank" rel="noopener">charlesä¸shadowsockså…±å­˜</a>è¯´æ˜äº†å¦‚æœé€šè¿‡è®©æ‰€æœ‰HTTP(S)æµé‡éƒ½èµ°Charlesï¼Œç„¶åCharles å†è®¾ç½®å¤–éƒ¨ä»£ç†ï¼ˆExternal Proxy)ä¸ºShadowsocksçš„æœ¬åœ°ä»£ç†å³å¯ï¼Œè¿™æ ·æµé‡ä¾æ¬¡ç»è¿‡ä¸¤ä¸ªä»£ç†ï¼Œæ—¢èƒ½æŠ“åŒ…ï¼Œåˆèƒ½ç¿»å¢™ã€‚</p>
<p>ä¸è¿‡è¿™ç§æ–¹æ³•éœ€è¦ä¸€ç›´å¼€ç€Charlesï¼Œä¸ç„¶ç¿»ä¸äº†å¢™ï¼ˆå› ä¸ºCharleså·²ç»å–ä»£Shadowsocksæˆä¸ºç³»ç»Ÿä»£ç†ï¼‰ã€‚é™¤äº†PACæ¨¡å¼ï¼Œä¸¤æ¬¾è½¯ä»¶åå¯åŠ¨æˆ–è€…åˆ‡æ¢æ¨¡å¼(Shadowsocksçš„PAC, Global, Manual)çš„é‚£ä¸€æ–¹ä¼šæ¸…é™¤æ‰å…¶ä»–ä»£ç†è®¾ç½®ï¼Œæ”¹ä¸ºç›®æ ‡è®¾ç½®ã€‚</p>
<p>ä¸€èˆ¬æƒ…å†µä¸‹éƒ½ä¼šè®¾ç½®Shadowsockséšç³»ç»Ÿå¯åŠ¨ï¼Œæˆ‘ä»¬å¤šæ•°åˆéƒ½æ˜¯ä½¿ç”¨PACæ¨¡å¼ï¼Œè¿™æ ·å›½å†…çš„ç½‘ç«™å°±ä¸èµ°æ¢¯å­äº†ï¼Œé€Ÿåº¦å¿«ã€‚æ‰€ä»¥æ‰“å¼€Charlesåï¼Œéœ€è¦å°†Shadowsocksåˆ‡æ¢è‡³Manualæ¨¡å¼(å³ä¸è®¾ç½®ç³»ç»Ÿä»£ç†ï¼Œå„è½¯ä»¶è‡ªå·±é…ç½®ä»£ç†)ï¼Œä¸ç„¶æµé‡ä¼˜å…ˆé€šè¿‡PACï¼ŒCharlesçš„HTTP(S)ä»£ç†å°±ä¸èµ·ä½œç”¨äº†ï¼Œå½“å…³é—­Charlesåï¼Œå†å°†Shadowsocksåˆ‡æ¢è‡³PACæˆ–è€…Globalï¼Œä¹Ÿå¯ä»¥ä¿æŒManualæ¨¡å¼ï¼Œå„ä¸ªè½¯ä»¶è‡ªå·±é…ç½®ä»£ç†ã€‚</p>
<p>è®©æµé‡å…ˆé€šè¿‡Charlesç„¶åå†é€šè¿‡Shadowsocksï¼Œæ³¨æ„è¿™ç§æ¨¡å¼å·²ç»ä¸æ˜¯Shadowsocksæä¾›çš„PACäº†ï¼Œåªèƒ½æ˜¯Shadowsocksçš„HTTP(S)æˆ–è€…SOCKS5äº†ï¼ˆæ ¹æ®Charlesçš„Extenal Proxyé…ç½®è€Œå®šï¼‰ï¼Œå¦‚æœæ˜¯æœ¬åœ°ç½‘ç«™å¼€å‘è°ƒè¯•ï¼Œéœ€è¦æŠŠæµ‹è¯•ç”¨çš„åŸŸåè¯¸å¦‚localhost, 127.0.0.1æˆ–è€…æ˜¯ä¿®æ”¹çš„hostsæ–‡ä»¶ä¸­çš„åŸŸåå¡«å…¥<strong>Charles External Proxyè®¾ç½®ä¸­çš„Bypass, æ³¨æ„ä¸æ˜¯Charles Proxy Settingçš„Bypassï¼Œä¹Ÿä¸æ˜¯ç³»ç»ŸWIFIè®¾ç½®ä»£ç†çš„Bypassï¼Œåä¸¤è€…æ˜¯ä¸èµ°Charlesä»£ç†ã€‚</strong>ç”±äºèµ°äº†æ¢¯å­ï¼Œå‰ç«¯çš„å…¶ä»–èµ„æºå¦‚CDNç­‰æŸäº›èµ„æºå¯èƒ½åŠ è½½å¤±è´¥æˆ–è€…æ˜¯åŠ è½½è¶…æ—¶ï¼Œéœ€è¦å½“å¿ƒã€‚</p>
<p>è¿™ç§æ–¹æ³•æ—¢éœ€è¦ä¸€ç›´å¼€ç€Charles/ä¸æ–­çš„åˆ‡æ¢Shadowsocksæ¨¡å¼ï¼Œåˆå¯¹å›½å†…ç½‘ç«™æŠ“åŒ…è¿˜ä¸å‹å¥½ï¼Œæ‰€ä»¥è¿˜æ˜¯æ¯”è¾ƒé¸¡è‚‹çš„ï¼Œä»·å€¼ä¸å¤§ï¼Œç®€å•çš„æ–¹å¼æ˜¯ï¼šå¦‚æœè¦æŠ“åŒ…çš„è½¯ä»¶å¯ä»¥å•ç‹¬è®¾ç½®ä»£ç†ï¼Œé‚£ä¹ˆä¸è¦è®©Charlesè®¾ç½®ç³»ç»Ÿä»£ç†ï¼Œé…ç½®å„ä¸ªè½¯ä»¶çš„ä»£ç†å¥½äº†ï¼›å¦‚æœä¸èƒ½ï¼Œæš‚æ—¶æ€§çš„æŠ“åŒ…å¯ä»¥ä¸ç¿»å¢™ï¼Œæˆ–è€…å°±å¿å—ä¸€ä¸‹è¿™ç§é¸¡è‚‹çš„è®¾ç½®å§!</p>
<p>[1]. <a href="https://www.jianshu.com/p/ff114bdf0f8f" target="_blank" rel="noopener">charlesä¸shadowsockså…±å­˜</a><br>[2]. <a href="https://www.charlesproxy.com/documentation/configuration/external-proxies/" target="_blank" rel="noopener">Charles</a><br>[3]. <a href="https://my.oschina.net/u/147181/blog/164872" target="_blank" rel="noopener">ä¸ºè°·æ­Œchromeæµè§ˆå™¨è®¾ç½®ç‹¬ç«‹ä»£ç†æœåŠ¡å™¨</a></p>
]]></content>
      
        
        <tags>
            
            <tag> Charles </tag>
            
            <tag> Shadowsocks </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Django å›½é™…åŒ–å’Œæœ¬åœ°åŒ–]]></title>
      <url>http://dequn.github.io/2019/01/07/django-i18n-l10n/</url>
      <content type="html"><![CDATA[<h2 id="1-é…ç½®"><a href="#1-é…ç½®" class="headerlink" title="1. é…ç½®"></a>1. é…ç½®</h2><p>å¾ˆå¤šä¸é è°±çš„æ–‡ç« ä¸Šæ¥ç¬¬ä¸€æ­¥å°±æ˜¯è®¾ç½®<code>LANGUAGE_CODE = &#39;zh-CN&#39;</code>ï¼Œè¿™æ˜æ˜¾æ˜¯æ²¡çœ‹æ‡‚é…ç½®é¡¹çš„æ„æ€ï¼Œä»<a href="https://docs.djangoproject.com/en/2.1/topics/i18n/translation/#how-django-discovers-language-preference" target="_blank" rel="noopener">Djangoæ–‡æ¡£</a>å¯ä»¥çœ‹å‡ºï¼Œ <strong> <code>LANGUAGE_CODE</code>åªæ˜¯æœ€åçš„å…œåº•è®¾ç½® </strong>ï¼Œæ‰€ä»¥è¿™ä¸€æ­¥çš„è®¾ç½®å®Œå…¨æ²¡æœ‰å¿…è¦ï¼Œå½“ç„¶ï¼Œå¦‚æœç«™ç‚¹ç¡®å®šåªæä¾›ä¸€ç§è¯­è¨€çš„æœåŠ¡ï¼Œåˆ™éœ€è¦è®¾ç½®å¹¶ä¸”ä¸æä¾›å…¶ä»–è¯­è¨€çš„ç¿»è¯‘ã€‚</p>
<p>ç„¶åå°±æ˜¯<code>USE_I18N</code>å’Œ<code>LocaleMiddleware</code>çš„é…ç½®äº†ï¼Œ <strong> å¦‚æœè¦æä¾›ä¸¤ç§è¯­è¨€ä»¥ä¸Šçš„æœåŠ¡ï¼Œé‚£ä¹ˆå¿…é¡»è®¾ç½®<code>USE_I18N=True</code>å¹¶ä¸”é…ç½®<code>LocaleMiddleware</code> </strong>ï¼Œ<code>LocaleMiddleware</code>å°½å¯èƒ½åœ¨å…¶ä»–ä¸­é—´ä»¶ä¹‹å‰ä½†å¿…é¡»åœ¨<code>SessionMiddleware</code>å’Œ<code>CacheMiddleware</code>ä¹‹åï¼Œå¯èƒ½æ˜¯è¿™æ ·çš„<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">MIDDLEWARE</span> = [</span><br><span class="line">   <span class="string">'django.contrib.sessions.middleware.SessionMiddleware'</span>,</span><br><span class="line">   <span class="string">'django.middleware.locale.LocaleMiddleware'</span>,</span><br><span class="line">   <span class="string">'django.middleware.common.CommonMiddleware'</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure></p>
<p><strong> <code>USE_L10N</code>æ˜¯æŒ‡ç”¨æ¥é…ç½®è¯¸å¦‚æ—¶é—´æ ¼å¼ã€æ•°å­—æ ¼å¼ï¼ˆæœ‰æ²¡æœ‰åƒåˆ†ä½ç¬¦å·ï¼‰ç­‰ï¼Œè·Ÿå¤šè¯­è¨€æ˜¯æ²¡æœ‰ç›´æ¥å…³ç³»çš„</strong> ï¼Œä¸»è¦è®¾ç½®é¡¹å¯ä»¥å‚è€ƒæ–‡æ¡£æˆ–è€…æºä»£ç django.utils.formats.FORMAT_SETTINGSä¸­çš„keyå€¼ã€‚</p>
<p>å¦å¤–ï¼Œå¦‚æœç¿»è¯‘çš„æ–‡ä»¶ä¸æ˜¯åœ¨<code>INSTALLED_APPS</code>ä¸­çš„appçš„localeç›®å½•ä¸‹ï¼Œé‚£ä¹ˆéœ€è¦ä¿®æ”¹<code>LOCALE_PATHS</code>é…ç½®ï¼Œè®©Djangoèƒ½å¤Ÿæ‰¾åˆ°.moæ–‡ä»¶ã€‚</p>
<h2 id="2-Djangoå¦‚ä½•ç¡®å®šä½¿ç”¨é‚£ç§è¯­è¨€"><a href="#2-Djangoå¦‚ä½•ç¡®å®šä½¿ç”¨é‚£ç§è¯­è¨€" class="headerlink" title="2. Djangoå¦‚ä½•ç¡®å®šä½¿ç”¨é‚£ç§è¯­è¨€"></a>2. Djangoå¦‚ä½•ç¡®å®šä½¿ç”¨é‚£ç§è¯­è¨€</h2><p><a href="https://docs.djangoproject.com/en/2.1/topics/i18n/translation/#how-django-discovers-language-preference" target="_blank" rel="noopener">how-django-discovers-language-preference</a>å·²ç»ä»‹ç»çš„å¾ˆè¯¦ç»†äº†ï¼Œå„ç§æ–¹å¼æœ‰ä¸åŒçš„ä¼˜å…ˆçº§ï¼Œæ ¹æ®éœ€è¦é€‰æ‹©å°±å¥½äº†ã€‚</p>
<blockquote>
<p>é¦–å…ˆï¼Œåœ¨å½“å‰ç”¨æˆ·çš„ session çš„ä¸­æŸ¥æ‰¾django_languageé”®ï¼›<br>    å¦‚æœªæ‰¾åˆ°ï¼Œå®ƒä¼šæ‰¾å¯»ä¸€ä¸ªcookie<br>    è¿˜æ‰¾ä¸åˆ°çš„è¯ï¼Œå®ƒä¼šåœ¨ HTTP è¯·æ±‚å¤´éƒ¨é‡ŒæŸ¥æ‰¾Accept-Languageï¼Œ è¯¥å¤´éƒ¨æ˜¯ä½ çš„æµè§ˆå™¨å‘é€çš„ï¼Œå¹¶ä¸”æŒ‰ä¼˜å…ˆé¡ºåºå‘Šè¯‰æœåŠ¡å™¨ä½ çš„è¯­è¨€åå¥½ã€‚ Djangoä¼šå°è¯•å¤´éƒ¨ä¸­çš„æ¯ä¸€ä¸ªè¯­ç§ç›´åˆ°å®ƒå‘ç°ä¸€ä¸ªå¯ç”¨çš„ç¿»è¯‘ã€‚<br>    ä»¥ä¸Šéƒ½å¤±è´¥äº†çš„è¯, å°±ä½¿ç”¨å…¨å±€çš„ LANGUAGE_CODE è®¾å®šå€¼ã€‚</p>
</blockquote>
<h2 id="3-æ±‰åŒ–åˆ°åº•æ˜¯zh-Hansè¿˜æ˜¯zh-CN-Django-v2-0-9"><a href="#3-æ±‰åŒ–åˆ°åº•æ˜¯zh-Hansè¿˜æ˜¯zh-CN-Django-v2-0-9" class="headerlink" title="3. æ±‰åŒ–åˆ°åº•æ˜¯zh_Hansè¿˜æ˜¯zh_CN (Django v2.0.9)"></a>3. æ±‰åŒ–åˆ°åº•æ˜¯zh_Hansè¿˜æ˜¯zh_CN (Django v2.0.9)</h2><p>æˆ‘çœ‹ç½‘ä¸Šå¾ˆå¤šæ•™ç¨‹éƒ½æ˜¯<code>makemessags -l zh_CN</code>ï¼Œåœ¨Django (v2.0.9)ä¸­å¦‚æ­¤æ“ä½œï¼Œå‘ç°å®Œå…¨æ²¡æœ‰ç”Ÿæ•ˆï¼Œè¿™é‡Œåˆæ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿ</p>
<p>ä»<code>django/middle/locale.py</code>æˆ‘ä»¬å¯ä»¥çœ‹å‡ºåœ¨å¤„ç†è¯·æ±‚æ—¶ï¼ŒDjangoä¼šé¦–å…ˆæ ¹æ®ã€<a href="#Djangoå¦‚ä½•ç¡®å®šä½¿ç”¨é‚£ç§è¯­è¨€">æ­¥éª¤2</a>ã€‘ä¸­çš„æµç¨‹æ¥åˆ¤æ–­å®¢æˆ·ç«¯è¯­è¨€ï¼Œå…¶é»˜è®¤é…ç½®æ–‡ä»¶åœ¨<code>django/conf/locale/__init__.py</code>ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ<code>zh_Hans</code>æ˜¯<code>zh-cn</code>ä»¥åŠå…¶ä»–ç®€ä½“ä¸­æ–‡çš„<em>fallback</em>é¡¹ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœå®¢æˆ·ç«¯è¯·æ±‚äº†<code>zh-cn</code>è¯­è¨€ï¼ŒæœåŠ¡å™¨æ˜¯æŒ‰ç…§<code>zh-Hans</code>è¯­è¨€è¿”å›çš„ï¼Œä¹Ÿå°±æ˜¯æ ¹æ®è¿™ä¸ªå€¼â€”â€”<code>zh-Hans</code>å»<code>LOCALE_PAHTS</code>åŠ è½½.moæ–‡ä»¶å®Œæˆå¤šè¯­è¨€çš„ã€‚è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆ<code>makemessages -l zh_CN</code>ä¸ç”Ÿæ•ˆçš„åŸå› ã€‚</p>
<p>é‚£ä¹ˆå¦‚ä½•è®©åœ¨<em>zh_CN</em>ç›®å½•ä¸‹çš„ç¿»è¯‘ç”Ÿæ•ˆå‘¢ï¼Œå¾ˆç®€å•ï¼Œé…ç½®<code>LANGUAGES</code>ï¼Œæ·»åŠ <em>zh-cn</em>å³å¯ï¼Œè¿™æ ·Djangoå°±å¯ä»¥ç›´æ¥æ ¹æ®zh-cnæ¥åŠ è½½zh_CNç›®å½•ä¸‹çš„.moäº†ï¼Œä¸è¿‡å¤šæ•°æƒ…å†µä¸‹å¹¶æ²¡æœ‰è¿™ç§å¿…è¦ï¼Œé™¤éåŒæ—¶æä¾›äº†å¤šç§ç®€ä½“ä¸­æ–‡è¯­è¨€ï¼Œå¹¶ä¸”å„åœ°åŒºæœ‰å·®åˆ«ã€‚</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">LANGUAGES</span> += [</span><br><span class="line">    (<span class="string">'zh-cn'</span>, gettext_noop(<span class="string">'Simplified Chinese'</span>)),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>å‚è€ƒ</p>
<ol>
<li><a href="http://djangobook.py3k.cn/2.0/chapter19/" target="_blank" rel="noopener">ç¬¬åä¹ç« ï¼š å›½é™…åŒ–</a></li>
<li><a href="https://docs.djangoproject.com/en/2.1/topics/i18n/translation/#how-django-discovers-language-preference" target="_blank" rel="noopener">How Django discovers language preference</a></li>
<li><a href="https://www.ibm.com/developerworks/cn/web/1101_jinjh_djangoi18n/index.html" target="_blank" rel="noopener">https://docs.djangoproject.com/en/2.1/topics/i18n/translation/#how-django-discovers-language-preference</a></li>
</ol>
]]></content>
      
        
        <tags>
            
            <tag> Django </tag>
            
            <tag> I18N </tag>
            
            <tag> L10N </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[DRF serializerä¸­å¤–é”®postä½¿ç”¨idï¼Œgetè·å–è¯¦ç»†ä¿¡æ¯]]></title>
      <url>http://dequn.github.io/2018/12/23/drf-serializer-foreignkey-post-id-get-full-content/</url>
      <content type="html"><![CDATA[<p>åœ¨ä½¿ç”¨Django REST framework Serializerçš„æ—¶å€™ï¼Œå¹¶ä¸ä¸€å®šå•ä¸€çš„SerializerFieldå°±å¯ä»¥æ»¡è¶³è¦æ±‚ï¼Œæ¯”å¦‚é‡åˆ°Model ä¸­å«æœ‰å¤–é”®ï¼Œå¦‚æœ<a href="https://www.django-rest-framework.org/api-guide/serializers/#writable-nested-representations" target="_blank" rel="noopener">Writable nested representations</a>ï¼Œåˆ™å‚è€ƒå®˜æ–¹çš„ä¾‹å­é‡å†™<code>create</code>æˆ–è€…<code>update</code>æ–¹æ³•å°±è¡Œï¼Œä½†å¦‚æœè¦æ˜¯æƒ³åœ¨<code>deserializering</code>çš„æ—¶å€™ä½¿ç”¨å¤–é”®é”®å€¼â€”â€”object_id, <code>serializering</code>çš„æ—¶å€™è¡¨è¾¾å‡ºä¸€äº›å¿…è¦çš„ä¿¡æ¯ï¼Œé‚£ä¹ˆå°±éœ€è¦å¯¹Serializerçš„å­—æ®µè¿›è¡Œä¸€äº›ç‰¹å®šçš„è®¾ç½®äº†ã€‚</p>
<p>æ ¹æ®Django ä¸­å¯¹ ForeignKeyçš„è§£é‡Šä»¥åŠå¦‚ä½•å¯¹ForeignKeyæŸ¥è¯¢å¯¹ä»‹ç»</p>
<blockquote>
<h2 id="Database-Representation"><a href="#Database-Representation" class="headerlink" title="Database Representation"></a>Database Representation</h2><p>Behind the scenes, Django appends â€œ_idâ€ to the field name to create its database column name. In the above example, the database table for the Car model will have a manufacturer_id column.</p>
</blockquote>
<blockquote>
<p>The field specified in a lookup has to be the name of a model field. Thereâ€™s one exception though, in case of a ForeignKey you can specify the field name suffixed with _id. In this case, the value parameter is expected to contain the raw value of the foreign modelâ€™s primary key.<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Entry<span class="selector-class">.objects</span><span class="selector-class">.filter</span>(blog_id=<span class="number">4</span>)</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>æ‰€ä»¥åœ¨ä½¿ç”¨<code>ModelSerializer</code>çš„æ—¶å€™ï¼Œå¾ˆç®€å•å°±å¯ä»¥å®ç°ï¼Œå‡å¦‚æˆ‘ä»¬Bar modelä¸­æœ‰ä¸€ä¸ªå¤–é”®å­—æ®µ<code>foo</code>ï¼Œé‚£ä¹ˆBarSerializerå¯ä»¥æœ‰å¦‚ä¸‹çš„å®šä¹‰ï¼š<br><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="type">BarSerializer</span>(<span class="title">serializers</span>.<span class="type">ModelSerializer</span>):</span></span><br><span class="line"><span class="class">    foo_id = serializers.<span class="type">IntegerField</span>(<span class="title">write_only</span>=<span class="type">True</span>)</span></span><br><span class="line"><span class="class">    foo = <span class="type">FooSerializer</span>(<span class="title">read_only</span>=<span class="type">True</span>)</span></span><br></pre></td></tr></table></figure></p>
<p>åœ¨POSTè¯·æ±‚ä¸­ï¼Œä¼ å…¥çš„å­—æ®µåç§°ä¸ºfoo_idå³å¯ã€‚è€ŒGETçš„æ—¶å€™ï¼Œä¼šä½¿ç”¨FooSerializerå¯¹fooè¿›è¡Œåºåˆ—åŒ–ï¼Œå¾—åˆ°å®Œæ•´å¯¹å¤–é”®å†…å®¹ã€‚</p>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ol>
<li><a href="https://stackoverflow.com/questions/36189303/django-rest-framework-receive-primary-key-value-in-post-and-return-model-object/53827209#53827209" target="_blank" rel="noopener">https://stackoverflow.com/questions/36189303/django-rest-framework-receive-primary-key-value-in-post-and-return-model-object/53827209#53827209</a></li>
</ol>
]]></content>
      
        <categories>
            
            <category> Django </category>
            
        </categories>
        
        
        <tags>
            
            <tag> DRF </tag>
            
            <tag> foreign key </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[ä¸€æ¬¡å¯æ€•çš„è¯¯æ“ä½œ-æš¨IDEçš„é‡è¦æ€§]]></title>
      <url>http://dequn.github.io/2018/11/03/yi-ci-ke-pa-de-wu-cao-zuo/</url>
      <content type="html"><![CDATA[<p>å¾ˆæ—©ä¹‹å‰å–œæ¬¢ç”¨VIM æ•²ä»£ç ï¼Œä¹Ÿè·Ÿç€<a href="https://github.com/yangyangwithgnu/use_vim_as_ide" target="_blank" rel="noopener">yangyangwithgnu</a>çš„æ–‡æ¡£æŠ˜è…¾è¿‡ä¸€æ®µæ—¶é—´ï¼Œä¸è¿‡éšç€å‡ æ¬¡æ¢ç”µè„‘ã€é‡è£…ç­‰ï¼ˆè™½ç„¶é…ç½®ä¹Ÿåšäº†å¤‡ä»½ï¼‰ï¼Œçƒ­æƒ…é€æ¸é€€å´ï¼Œåœ¨é¡¹ç›®å¼€å‘ä¸­è¿˜æ˜¯æ¢å›äº†IDEï¼Œå¹³å¸¸å†™ä¸€äº›ç®€å•çš„è„šæœ¬æ‰ä¼šç”¨VIMï¼Œä¹Ÿæ˜¯ç¬¬ä¸€ååº”ï¼Œæ¯•ç«Ÿä¸ºäº†å†™ä¸¤ä¸‰ä¸ªæ–‡ä»¶çš„ä»£ç æ˜¯ä¸éœ€è¦ç”¨IDEçš„ã€‚ä¹Ÿå¹¸äºç”¨äº†PyCharmï¼Œæ‰å…å»äº†ä¸€æ¬¡è¯´å¤§ä¸å¤§è¯´å°ä¸å°çš„æŸå¤±ã€‚</p>
<p>æ‰‹å¤´çš„é¡¹ç›®è¿›å…¥åˆ°å®è´¨å¼€å‘é˜¶æ®µï¼Œä¹‹å‰æ›´åƒDemoçš„ç³»ç»Ÿæ— è®ºä»ä»£ç è´¨é‡è¿˜æ˜¯æ•°æ®åº“è®¾è®¡ã€æ¡†æ¶æ–¹é¢ï¼Œéƒ½é¿å…ä¸äº†è¦é‡æ„ä¸€æ¬¡ï¼Œå•å…ƒæµ‹è¯•ç­‰è¯¥å®ç°ä¹Ÿè¦å®ç°ï¼Œè¯´åŠ¨æ‰‹å°±åŠ¨æ‰‹ï¼Œè¾›è‹¦äº†ä¸¤å¤©åŸºæœ¬å®Œæˆäº†åˆæœŸçš„é‡æ„ï¼Œäº¤ä»£ä¸€ä¸‹ï¼Œç”±äºæœ¬äººæ²¡æœ‰åœ¨IDEä¸­é…ç½®DockeråŠå…¶ç¯å¢ƒï¼Œæ‰€ä»¥æ¯æ¬¡è¿è¡Œå•å…ƒæµ‹è¯•éƒ½æ˜¯åœ¨ç»ˆç«¯<code>docker-compose run ... test ...</code>çš„ã€‚</p>
<p>ä¹Ÿä¸å¾—ä¸è¯´<code>Ctrl + R</code> æå¤§æ–¹ä¾¿äº†é‡å¤æ‰§è¡Œå‘½ä»¤ï¼ˆPSï¼šä¸ªäººå¾ˆå°‘èƒ½æƒ³èµ·æ¥ç›´æ¥ <code>Ctrl + P</code> æ‰§è¡Œä¸Šä¸€æ¡å‘½ä»¤ï¼Œå†µä¸”ä¹Ÿä¸æ˜¯æ‰€æœ‰çš„å‘½ä»¤éƒ½æ˜¯æ‰§è¡Œä¸Šä¸€æ¬¡ï¼‰ï¼Œåœ¨æœ‰ä¸€æ¬¡é‡å¯ä¸€ä¸ªcontainer çš„æ—¶å€™ï¼Œæœç´¢ <em>res</em>(tart)ï¼Œçœ‹ä¹Ÿæ²¡çœ‹å°±æ•²å›è½¦è¿è¡Œï¼Œä¸è¿‡çœ‹åˆ°è¾“å‡ºå°±å´©æºƒäº†ï¼Œ<code>HEAD is now at ff156e1 ...</code>ï¼ŒåŸæ¥æ‰¾åˆ°çš„å†å²å‘½ä»¤æ˜¯<code>git reset --hard HEAD</code>ï¼Œå¯è¿™äº›é‡æ„éƒ½æ˜¯<code>unstaged</code>çš„çŠ¶æ€å•Šï¼Œä¸‡èƒ½çš„gitä¹Ÿæ‰¾ä¸å›æ¥è¿™äº›è¢«<strong>reset</strong>çš„ä¿®æ”¹äº†ï¼</p>
<p>ä¸‡èˆ¬æ— å¥ˆï¼Œä¸¤å¤©çš„å·¥ä½œï¼ˆè™½ç„¶ä¸€å¤©ä¹Ÿå†™ä¸äº†å¤šå°‘ï¼‰é‡åšä¼šå¾ˆå¿«ï¼Œä½†å¿ƒæƒ…æ›´é‡è¦å•Šï¼Œç¬é—´å°±æƒ³ä¸‹ç­é™ä¸€é™äº†ï¼Œå“ˆå“ˆå“ˆå“ˆã€‚</p>
<p>æ­£åœ¨å‡†å¤‡å‡ºå»æºœè¾¾ä¸€åœˆæ¢æ¢è„‘å­çš„æ—¶å€™ï¼Œçµå…‰ä¸€ç°ï¼Œå’±å¯æ˜¯ç”¨äº†PyCharmçš„äººå•Šï¼Œæˆ‘è®°å¾—å¥¹ï¼ˆæ³¨æ„ç”¨å­—ï¼Œè¿™å°±æ˜¯è®©æˆ‘é‡ç”Ÿçš„ä¸Šå¸å•Šï¼‰æœ‰ä¸€ä¸ª<strong>Local History</strong> çš„åŠŸèƒ½ï¼Œè¿™ä¸ª<strong> Local History</strong>ä¹Ÿæ˜¯ä¸Git ç‹¬ç«‹çš„ï¼Œå”¯ä¸€çš„å¸Œæœ›å°±æ˜¯å¥¹äº†ï¼Œå‘½æ‚¬ä¸€çº¿ã€‚</p>
<p>æˆ˜æˆ˜å…¢å…¢çš„åœ¨é¡¹ç›®ç›®å½•ä¸Šç‚¹å‡»<em> Local History -&gt; Show History </em>ï¼Œè°¢å¤©è°¢åœ°å•Šï¼Œå·¦ä¾§å†å²åˆ—è¡¨å¾ˆå¸…æ°”ã€å‡†ç¡®ã€æ•‘ä¸–ä¸»ä¸€æ ·çš„æ˜¾ç¤ºå‡ºäº†æ¯ä¸€æ¬¡æ–‡ä»¶æ”¹åŠ¨çš„è®°å½•ï¼Œæ‰¾åˆ°è¢«resetåˆ°è®°å½•ï¼Œä¹Ÿæ˜¾ç¤ºå‡ºäº†ä¿®æ”¹æ¥æºâ€”â€”<strong>External change</strong>ï¼Œ æ£€æŸ¥æ— è¯¯æ¢å¤æˆåŠŸï¼Œæ‚¬ç€çš„å¿ƒç»ˆäºæ”¾ä¸‹äº†ã€‚</p>
<p>ä¸å¾—ä¸è¯´ï¼Œå¯¹JetBrainå¥½æ„Ÿå€å¢ï¼èµ¶ç´§èŠ±é’±å»ä¹°ä¸€ä¸ªæ­£ç‰ˆå¯¹æˆæƒå§ï¼Œè¿˜æ˜¯é‚£å¥è¯ï¼Œå¿ƒæƒ…å¾ˆé‡è¦ï¼</p>
]]></content>
      
        
        <tags>
            
            <tag> VIM </tag>
            
            <tag> IDE </tag>
            
            <tag> PyCharm </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Djangoæ·»åŠ ç”¨æˆ·Celeryä»»åŠ¡]]></title>
      <url>http://dequn.github.io/2018/10/14/django-add-user-celery-task/</url>
      <content type="html"><![CDATA[<p>ç³»ç»Ÿå¼€å‘éœ€è¦æ·»åŠ ç”¨æˆ·è‡ªå·±è®¾å®šçš„å®šæ—¶ä»»åŠ¡ï¼Œå½“ç„¶è¿™ç§ä»»åŠ¡ä¸æ˜¯ç”¨æˆ·è‡ªå·±ç¼–ç¨‹é‚£ç§ï¼Œè€Œæ˜¯å†™å¥½çš„é€»è¾‘ï¼Œç”¨æˆ·è®¾å®šå‚æ•°æ‰§è¡Œå³å¯ã€‚</p>
<p>ä¸Šç¯‡<a href="/2018/06/02/django-celery/" title="Django2ç»“åˆCeleryæ·»åŠ å®šæ—¶ä»»åŠ¡">Django2ç»“åˆCeleryæ·»åŠ å®šæ—¶ä»»åŠ¡</a>è¯´æ˜äº†å¦‚ä½•åˆ©ç”¨Celeryè®¾å®šå®šæ—¶ä»»åŠ¡ï¼Œè¿™æ¬¡éœ€è¦ç”¨æˆ·æ·»åŠ è‡ªå·±çš„å®šæ—¶ä»»åŠ¡ï¼Œæ€»å…±åˆ†ä¸ºæ­¥ï¼š</p>
<ol>
<li>å†™å®šæ—¶ä»»åŠ¡çš„ä»£ç ï¼Œç•™å‡ºéœ€è¦å¸¦å…¥çš„å‚æ•°ï¼›</li>
<li>è®¾è®¡Modelï¼Œé€šè¿‡ç”¨æˆ·è¡¨å•è·å–åˆ°å®šæ—¶ä»»åŠ¡çš„å‚æ•°ï¼Œæ¯”å¦‚æ‰§è¡Œæ—¶é—´ã€å…¶ä»–å‚æ•°ç­‰ï¼›</li>
<li>æ³¨å†ŒModel çš„<code>post_save</code> æˆ–è€… <code>pre_save</code> signalï¼Œæ·»åŠ æˆ–è€…åˆ é™¤<code>django_celery_beat.model.PeriodicTask</code> è®°å½•;</li>
<li>å¦‚æœä¸æƒ³è®©ç”¨æˆ·çš„å®šæ—¶ä»»åŠ¡ä¸ç³»ç»Ÿçš„å®šæ—¶ä»»åŠ¡éƒ½å­˜åœ¨ä¸€å¼ æ•°æ®è¡¨ä¸­ï¼Œå¯ä»¥æ–°å»ºç»§æ‰¿è‡ª<code>django_celery_beat.model.PeriodicTask</code>çš„ç±»ï¼Œå½“ç„¶è¿™æ ·ä¹Ÿå°±éœ€è¦æ–°å»ºç»§æ‰¿è‡ª<code>django_celery_beat.schedulers.DatabaseScheduler</code>ç±»ï¼Œä»æ–°å»ºçš„Taskç±»ä¸­åˆ†å‘ä»»åŠ¡ã€‚</li>
</ol>
]]></content>
      
        <categories>
            
            <category> Django </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Django </tag>
            
            <tag> Celery </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Twisted æœåŠ¡é—´é€šä¿¡]]></title>
      <url>http://dequn.github.io/2018/08/22/communication-between-twisted-services/</url>
      <content type="html"><![CDATA[<p>ã€<a href="/2018/06/19/django-channels-websocket-iot-remote-control/" title="åŸºäºDjango & Channels & WebSocket & Twistedçš„ç‰©è”ç½‘è¿œç¨‹æ§åˆ¶">åŸºäºDjango & Channels & WebSocket & Twistedçš„ç‰©è”ç½‘è¿œç¨‹æ§åˆ¶</a>ã€‘å†™åˆ°ï¼Œä¸‹ä½æœºæ¯éš”ä¸€æ®µæ—¶é—´è¿æ¥ä¸Šä½æœºä¼ é€æ•°æ®å’Œè¿›è¡Œä»»åŠ¡ä¸‹å‘ï¼Œç°åœ¨é¢†å¯¼æ”¹éœ€æ±‚äº†ï¼Œè¦æ±‚ä½¿ç”¨é•¿é“¾æ¥ï¼Œä½¿å¾—ä¸Šä½æœºçš„ä»»åŠ¡å¯ä»¥éšæ—¶ä¸‹å‘ï¼Œæ–¹ä¾¿ç”¨æˆ·ã€‚å°ç±³çš„æ™ºèƒ½å®¶ç”µé‡‡å–çš„åº”è¯¥ä¹Ÿéƒ½æ˜¯é•¿é“¾æ¥çš„æ–¹å¼ï¼Œç”±äºå°ç±³å®¶ç”µæœ¬èº«æ˜¯å¸‚ç”µä¾›åº”ï¼Œå®¶é‡Œä¹Ÿéƒ½æ˜¯wifiä¸Šç½‘ï¼Œæ‰€ä»¥é™¤äº†ä¼šå¤šæ¶ˆè€—æœåŠ¡å™¨èµ„æºå¤–ï¼Œè¿™ç§å³æ—¶çš„æ§åˆ¶è¿˜æ˜¯è›®ä¸é”™çš„ã€‚ä½†æ˜¯çœŸæ­£ç”¨äºé‡å¤–çš„ç‰©è”ç½‘ç»ˆç«¯ï¼Œè¿˜æ˜¯è¦å¹³è¡¡å¥½ç”µé‡ã€æµé‡çš„é—®é¢˜æ‰è¡Œã€‚</p>
<p>ä¹‹å‰ä¹Ÿæåˆ°ï¼Œwebç½‘é¡µç”¨æˆ·æ“ä½œï¼Œwebåå°ç”Ÿæˆå¹¶å‘å¸ƒåˆ°redisè®¢é˜…ï¼ŒTwisted é‡‡ç”¨rediså®¢æˆ·ç«¯ç›‘å¬ï¼Œå¹¶åœ¨ä¸‹ä½æœºè¿æ¥çš„æ—¶å€™ä¸‹å‘ä»»åŠ¡ï¼Œè¿™é‡Œæˆ‘ç”¨çš„ç›¸å½“äºæ˜¯ä¸€ä¸ªå…¨å±€å˜é‡å­˜ä¸‹æ¥å“ªäº›è®¾å¤‡æœ‰ä»»åŠ¡ï¼Œå¦‚æœè¦æ”¹æˆé•¿é“¾æ¥å®æ—¶æ§åˆ¶ï¼Œè¿™ç§æ–¹æ³•å°±ä¸å¤ªåˆé€‚äº†ã€‚</p>
<p>ä¸Šä½æœºæ˜¯ä¸€ä¸ªå•ç‹¬çš„serviceï¼Œredisç›‘å¬æ˜¯ä¸€ä¸ªå•ç‹¬çš„serviceï¼Œè¿™å°±è¦æ±‚ä¸¤ä¸ªserviceèƒ½å¤Ÿé€šä¿¡â€”â€”rediså®¢æˆ·serviceå‘Šè¯‰ä¸Šä½æœºæœåŠ¡serivceï¼Œæœ‰æ–°ä»»åŠ¡å•¦ï¼Œèµ¶ç´§ä¸‹å‘ï¼</p>
<p>è§£å†³è¿™ä¸ªé—®é¢˜è¿‡ç¨‹ä¸­ï¼Œä¹ŸåŠ æ·±äº†å¯¹Twistedçš„ç†è§£ï¼Œé‡è¦çš„æœ‰ä¸‰ç‚¹ï¼Œå‚è€ƒ<a href="https://stackoverflow.com/questions/21344343/how-to-communicate-between-services" target="_blank" rel="noopener">[1]</a>ã€‚</p>
<ul>
<li>serviceä¸æ¥æ”¶ä¹Ÿä¸å‘é€æ•°æ®ï¼Œåªè´Ÿè´£å¯åŠ¨å’Œåœæ­¢factory</li>
<li>factoryä¹Ÿä¸æ¥æ”¶å’Œå‘é€æ•°æ®ï¼Œè´Ÿè´£ç”Ÿæˆå’Œé”€æ¯protocolå®ä¾‹ï¼Œprotocolå®ä¾‹å¤„ç†é“¾æ¥å’Œæ”¶å‘æ•°æ®</li>
<li>factoryæ˜¯é•¿ç”Ÿå‘½å‘¨æœŸçš„ï¼Œprotocolå®ä¾‹æ˜¯ç”¨å®Œå°±é”€æ¯çš„</li>
</ul>
<p>æœ‰äº†ä»¥ä¸Šä¸‰ç‚¹ï¼Œäº‹æƒ…å°±ç®€å•å¤šäº†ã€‚</p>
<ul>
<li>åˆ›å»ºredis client factoryçš„æ—¶å€™ï¼Œä¼ å…¥ä¸Šä½æœºæœåŠ¡factory</li>
<li>è®©ä¸Šä½æœºæœåŠ¡factory ç»´æŠ¤ä¸€ä¸ªprotocolå®ä¾‹çš„é›†åˆï¼Œprotocolå®ä¾‹åˆ›å»ºæ—¶æ·»åŠ ï¼Œé”€æ¯æ˜¯åˆ é™¤</li>
<li>é€šè¿‡ redis_facotry.up_service_factory.protocol_set è·å–ä¸Šä½æœºæœåŠ¡protocolå®ä¾‹ï¼Œæ‰§è¡Œç›¸åº”ä»»åŠ¡ï¼ˆé•¿é“¾æ¥protocolå®ä¾‹ä¸ä¼šè¢«é”€æ¯ï¼‰</li>
</ul>
<p>ç›´æ¥çœ‹ä»£ç :</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FisheryProtocol</span>(<span class="title">protocol</span>.<span class="title">Protocol</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">connectionMade</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">self</span>.factory.protocol_set.add(<span class="keyword">self</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">connectionLost</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">self</span>.factory.protocol_set.pop(<span class="keyword">self</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RedisProtocol</span>(<span class="title">redis</span>.<span class="title">SubscriberProtocol</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">messageReceived</span><span class="params">(<span class="keyword">self</span>, pattern, channel, message)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">self</span>.factory.fishery_factory.protocol_set <span class="comment"># get a specified protocol from protocol_set  </span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RedisFactory</span>(<span class="title">redis</span>.<span class="title">SubscriberFactory</span>):</span></span><br><span class="line">    <span class="comment"># ... other code</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(<span class="keyword">self</span>, fishery_factory)</span></span><span class="symbol">:</span></span><br><span class="line">        <span class="keyword">super</span>().__init_<span class="number">_</span>()</span><br><span class="line">        <span class="keyword">self</span>.fishery_factory = fishery_factory</span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> Twisted </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Twisted </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[è®°ä¸€æ¬¡Confluenceè¿ç§»æ•°æ®åº“å’ŒDocker networkç½‘ç»œä¿®æ”¹]]></title>
      <url>http://dequn.github.io/2018/06/30/docker-network/</url>
      <content type="html"><![CDATA[<p>å…¬å¸çš„Confluenceè¶Šæ¥è¶Šæ…¢ï¼ŒæŸ¥çœ‹äº†ä¸€ä¸‹æ—¥å¿—ï¼Œå¥½å¤šæ•°æ®åº“è¿æ¥è¶…è¿‡æœ€å¤§æ•°é”™è¯¯ï¼Œå¦å¤–ç”±äºæ•°æ®åº“æœ‰å¾ˆå¤šå®šæ—¶ä»»åŠ¡ï¼Œç£ç›˜è¯»å†™é¢‘ç¹ï¼Œæ‰€ä»¥é€‰æ‹©åœ¨å¦ä¸€å°æœºå™¨ä¸Šé‡å»ºä¸€ä¸ªæ•°æ®åº“ã€‚</p>
<p>ç”±äºConfluenceæ˜¯ç ´è§£çš„ï¼Œå¦‚æœæ¯æ¬¡åˆ›å»ºæ–°å®¹å™¨åºåˆ—å·ä¼šå˜ï¼Œæ‰€ä»¥åŸæœ‰çš„Confluenceå®¹å™¨ä¸èƒ½åˆ é™¤ã€‚</p>
<p>ç”±äºåŒä¸€å°æœºå™¨å¯èƒ½æœ‰å¤šä¸ªæ•°æ®åº“å®ä¾‹æœåŠ¡äºä¸åŒçš„åº”ç”¨ï¼Œæ‰€ä»¥ä¸èƒ½å°†æ•°æ®åº“ç«¯å£æ˜ å°„åˆ°ä¸»æœºä¸Šï¼Œé‚£ä¹ˆåœ¨confluenceä¸­å¦‚ä½•å¡«å†™æ•°æ®åº“è¿æ¥å‘¢ï¼Ÿ</p>
<p>Dockerä¼šé»˜è®¤å°†å®¹å™¨æ·»åŠ åˆ°<code>bridge</code>ä¸­ï¼Œä½†æ˜¯<code>bridge</code>ç½‘ç»œå†…çš„å®¹å™¨ä¸èƒ½é€šè¿‡å®¹å™¨åè®¿é—®ï¼Œæ‰€ä»¥éœ€è¦æ–°å»ºnetworkå¹¶å°†å·²æœ‰çš„Confluenceå®¹å™¨å’Œæ–°å»ºçš„æ•°æ®åº“å®¹å™¨æ·»åŠ è¿›æ¥ã€‚å¦‚æœä¸€å¼€å§‹å°±å†³å®šæ˜¯ç»„åˆåº”ç”¨çš„è¯ï¼Œä½¿ç”¨docker-composeæœ€æ–¹ä¾¿ï¼Œæ­¤æ¬¡æƒ…å†µæ˜¯ä½œä¿®æ”¹ã€‚</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker<span class="built_in"> network </span>create confluence-network # æ–°å»ºä¸€ä¸ªnetwork</span><br><span class="line">docker<span class="built_in"> network </span>connect confluence-network herisk-confluence # æŠŠå®¹å™¨herisk-confluenceæ·»åŠ åˆ°confluence-network ä¸­</span><br><span class="line">docker <span class="builtin-name">run</span> --name confluence-postgres -v confluence-postgres-db:/var/lib/postgresql/data -e <span class="attribute">POSTGRES_PASSWORD</span>=postgres <span class="attribute">--network</span>=confluence-network -d postgres #åˆ›å»ºæ•°æ®åº“å®¹å™¨å¹¶æ·»åŠ åˆ°confluence-networkä¸­</span><br></pre></td></tr></table></figure>
<p>å¤‡ä»½å’Œæ¢å¤æ•°æ®åº“ä½¿ç”¨<code>pg_dump å’Œ pg_restore</code>æ¯”è¾ƒç®€å•ï¼Œå°±ä¸åœ¨èµ˜è¿°äº†ã€‚</p>
<p>ä¿®æ”¹Confluence çš„é…ç½®æ–‡ä»¶<code>confluence.cfg.xml</code>ï¼Œæ•°æ®åº“è¿æ¥çš„ä¸»æœºéƒ¨åˆ†å¡«å†™æ•°æ®åº“å®¹å™¨åå³å¯ï¼Œæœ¬ä¾‹ä¸­ä¸º<code>jdbc://confluence-postgres-db:5432/confluence</code>ã€‚</p>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p>[1]. <a href="https://docs-cn.docker.octowhale.com/engine/userguide/networking/container-networking.html" target="_blank" rel="noopener">Docker container networking</a><br>[2]. <a href="https://help.aliyun.com/document_detail/26157.html" target="_blank" rel="noopener">ä½¿ç”¨ psql å‘½ä»¤è¿ç§» PostgreSQL æ•°æ®</a></p>
]]></content>
      
        <categories>
            
            <category> Docker </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Docker </tag>
            
            <tag> network </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[docker-compose å­ç›®å½•ç¼–è¯‘ã€è¿è¡Œ]]></title>
      <url>http://dequn.github.io/2018/06/23/docker-compose-subdirectory-dockerfile/</url>
      <content type="html"><![CDATA[<p>å…¬å¸å¼€å‘ç‰©è”ç½‘ä¸šåŠ¡ï¼Œä½¿ç”¨Twisted åŸºäºTCPåè®®å¼€å‘çš„ä¸Šä½æœºæœåŠ¡ï¼Œä½¿ç”¨Djangoå¼€å‘çš„Webåç«¯ï¼Œè™½ç„¶æ˜¯åˆ†åˆ«å¼€å‘çš„ï¼Œä½†ä¸¤ä¸ªæœåŠ¡ä¹‹é—´æœ‰ä¸€å®šçš„è€¦åˆï¼Œæ¯”å¦‚ä¸Šç¯‡ã€<a href="/2018/06/19/django-channels-websocket-iot-remote-control/" title="åŸºäºDjango & Channels & WebSocket & Twistedçš„ç‰©è”ç½‘è¿œç¨‹æ§åˆ¶">åŸºäºDjango & Channels & WebSocket & Twistedçš„ç‰©è”ç½‘è¿œç¨‹æ§åˆ¶</a>ã€‘å°±éœ€è¦Webåç«¯å’ŒTwistedå…±åŒå®Œæˆï¼Œè€ŒTwistedä¸Šä½æœºæ¥æ”¶åˆ°ä¸‹ä½æœºä½†ä¸Šä¼ æ•°æ®åï¼Œæ˜¯å¼‚æ­¥è°ƒç”¨äº†Webåç«¯è¿›è¡Œæ•°æ®å…¥åº“çš„ï¼Œæ‰€ä»¥ä¸¤ä¸ªæœåŠ¡è¿˜æ˜¯ä¸€å—å¯åŠ¨çš„ï¼Œå†åŠ ä¸ŠRedis, Postgresqlæ•°æ®åº“æœåŠ¡ç­‰ï¼Œæœ€ç»ˆé€‰æ‹©ä½¿ç”¨Docker Compose ä¸€å—å‘å¸ƒç®¡ç†ã€‚</p>
<p>ä¸¤ä¸ªæœåŠ¡æ˜¯åˆ†å¼€å¼€å‘çš„ï¼Œä¹Ÿå°±è¦æ”¾åœ¨ä¸åŒçš„ç›®å½•ä¸­ã€‚</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">iot</span><br><span class="line">â”œâ”€â”€ docker-compose.yml</span><br><span class="line">â”œâ”€â”€ tcp</span><br><span class="line">â”‚Â Â  â””â”€â”€ Dockerfile</span><br><span class="line">â””â”€â”€ web</span><br><span class="line">    â””â”€â”€ Dockerfile</span><br></pre></td></tr></table></figure>
<p>docker-compose.ymlæ–‡ä»¶å†…å®¹</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">version</span>: <span class="string">'3'</span></span><br><span class="line"><span class="attribute">services</span>:</span><br><span class="line">    <span class="attribute">web</span>:</span><br><span class="line">        <span class="attribute">build</span>: ./web</span><br><span class="line">        <span class="attribute">image</span>: <span class="attribute">web</span>:backend</span><br><span class="line">        <span class="attribute">command</span>: [<span class="string">"sh"</span>, <span class="string">"-c"</span>, <span class="string">"python3 manage.py runserver 0.0.0.0:8000"</span>]</span><br><span class="line">        <span class="attribute">ports</span>:</span><br><span class="line">            - <span class="string">"8000:8000"</span></span><br><span class="line">        <span class="attribute">depends_on</span>:</span><br><span class="line">            - pgdb</span><br><span class="line">            - redis</span><br><span class="line">        <span class="attribute">volumes</span>:</span><br><span class="line">            - ./<span class="attribute">web</span>:/code</span><br><span class="line"></span><br><span class="line">    <span class="attribute">twisted</span>:</span><br><span class="line">        <span class="attribute">build</span>: ./tcp</span><br><span class="line">        <span class="attribute">ports</span>:</span><br><span class="line">            - <span class="string">"21188:21188"</span></span><br><span class="line">        <span class="attribute">command</span>: [<span class="string">"sh"</span>, <span class="string">"-c"</span>, <span class="string">"twistd -ny service.tac"</span>]</span><br><span class="line">        <span class="attribute">depends_on</span>:</span><br><span class="line">            - redis</span><br><span class="line">        <span class="attribute">volumes</span>:</span><br><span class="line">            - ./<span class="attribute">tcp</span>:/code</span><br><span class="line"></span><br><span class="line">    <span class="attribute">redis</span>:</span><br><span class="line">        <span class="attribute">image</span>: redis</span><br><span class="line"></span><br><span class="line">    <span class="attribute">pgdb</span>:</span><br><span class="line">        <span class="attribute">image</span>: postgres</span><br><span class="line">        <span class="attribute">environment</span>:</span><br><span class="line">            <span class="attribute">POSTGRES_PASSWORD</span>: postgres</span><br><span class="line">        <span class="attribute">volumes</span>:</span><br><span class="line">            - <span class="attribute">pg-vol</span>:/var/lib/postgresql/data</span><br><span class="line"></span><br><span class="line"><span class="attribute">volumes</span>:</span><br><span class="line">    <span class="attribute">pg-vol</span>:</span><br></pre></td></tr></table></figure>
<p><code>tcp/Dockerfile</code> å’Œ <code>web/Dockerfile</code>çš„å†…å®¹éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä¸åŒçš„å°±æ˜¯å„è‡ªç›®å½•ä¸‹çš„ä»£ç ã€‚<br><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> python:<span class="number">3.6</span></span><br><span class="line"><span class="keyword">ENV</span> PYTHONUNBUFFERED <span class="number">1</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> mkdir /code</span></span><br><span class="line"><span class="bash">WORKDIR /code</span></span><br><span class="line"><span class="bash">ADD requirements.txt /code/</span></span><br><span class="line"><span class="bash">RUN pip install -i http://mirrors.aliyun.com/pypi/simple/ --trusted-host mirrors.aliyun.com -r requirements.txt</span></span><br><span class="line"><span class="bash">ADD . /code/</span></span><br></pre></td></tr></table></figure></p>
<p>è¿™é‡Œè®²ä¸€ä¸‹éœ€è¦æ³¨æ„çš„ä¸¤ä¸ªåœ°æ–¹ï¼š</p>
<ul>
<li>docker-compose.ymlä¸­buildåè¦åŠ ä¸Šç›®å½•ï¼Œä¹Ÿå¯ä»¥ç”¨<code>context</code>å‚æ•°æŒ‡å®š</li>
<li>ç‰¹åˆ«éœ€è¦æ³¨æ„çš„ï¼Œå„ä¸ªæœåŠ¡éœ€è¦æ·»åŠ è‡ªå·±çš„volumesï¼Œä¹Ÿå°±æ˜¯ç¤ºä¾‹ä¸­çš„<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">volumes:</span></span><br><span class="line">    - .<span class="regexp">/web:/</span>code</span><br><span class="line"><span class="string">volumes:</span></span><br><span class="line">    - .<span class="regexp">/tcp:/</span>code</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>ä¸ç„¶è™½ç„¶èƒ½æ­£å¸¸ç”Ÿæˆcontainerï¼Œä½†è¿è¡Œçš„æ—¶å€™<code>/code</code>ä¸‹å†…å®¹è¶‹åŠ¿<code>iot</code>ç›®å½•ï¼Œä¸æ˜¯å•ä¸ªæœåŠ¡ä¸‹ä½†ç›®å½•ä»£ç ï¼Œå¯¼è‡´ä¸èƒ½æ­£å¸¸è¿è¡Œã€‚</p>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p>[1]. <a href="https://nickjanetakis.com/blog/docker-tip-10-project-structure-with-multiple-dockerfiles-and-docker-compose" target="_blank" rel="noopener">Docker Tip #10: Project Structure With Multiple Dockerfiles and Docker Compose</a></p>
]]></content>
      
        
        <tags>
            
            <tag> Docker </tag>
            
            <tag> Docker Compose </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[ShadowsocksX-NG kcptunåŠ é€Ÿé…ç½®é‡Šç–‘]]></title>
      <url>http://dequn.github.io/2018/06/21/ShadowsocksX-NG-kcptun-settings/</url>
      <content type="html"><![CDATA[<p>æ–°ç‰ˆ<a href="https://github.com/shadowsocks/ShadowsocksX-NG" target="_blank" rel="noopener">ShadowsocksX-NG</a> å·²ç»è‡ªå¸¦äº†kcptun å®¢æˆ·ç«¯ï¼Œè¿™æ ·å°±ä¸ç”¨è‡ªå·±å•ç‹¬å¯åŠ¨kcptunè¿›ç¨‹äº†ã€‚ä½†æ˜¯<a href="https://github.com/shadowsocks" target="_blank" rel="noopener">shadowsockså›¢é˜Ÿ</a>å¹¶æ²¡æœ‰ç»™å‡ºé…ç½®ç¤ºä¾‹ï¼Œå¯¼è‡´å¾ˆå¤šç½‘å‹å¯¹è®¾ç½®å«å«ç³Šç³Šï¼Œä»Google æœç´¢çš„ç¬¬ä¸€é¡µç»“æœå°±å¯ä»¥çœ‹å‡ºæ¥ã€‚</p>
<p><img src="https://i.loli.net/2019/07/25/5d395c8d98c2714067.png" alt="æœç´¢ShadowsocksX-NGçš„ç»“æœ"></p>
<p>å»ºç«‹å¥½kcptunæœåŠ¡å™¨ç«¯åï¼Œè¿è¡Œ<code>kcptun.sh show</code>æ‰“å°å‡ºæœåŠ¡å™¨ä¿¡æ¯ï¼Œå¦‚ä¸‹ã€‚</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">å¯ä½¿ç”¨çš„å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶ä¸º:</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"localaddr"</span>: <span class="string">":443"</span>,</span><br><span class="line">  <span class="string">"remoteaddr"</span>: <span class="string">"xxx.xxx.xxx.xxx:29900"</span>,</span><br><span class="line">  <span class="string">"key"</span>: <span class="string">"very fast"</span>,</span><br><span class="line">  <span class="string">"crypt"</span>: <span class="string">"aes-128"</span>,</span><br><span class="line">  <span class="string">"mode"</span>: <span class="string">"fast2"</span>,</span><br><span class="line">  <span class="string">"mtu"</span>: <span class="number">1350</span>,</span><br><span class="line">  <span class="string">"sndwnd"</span>: <span class="number">512</span>,</span><br><span class="line">  <span class="string">"rcvwnd"</span>: <span class="number">512</span>,</span><br><span class="line">  <span class="string">"datashard"</span>: <span class="number">10</span>,</span><br><span class="line">  <span class="string">"parityshard"</span>: <span class="number">3</span>,</span><br><span class="line">  <span class="string">"dscp"</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="string">"nocomp"</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="string">"quiet"</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å®¢æˆ·ç«¯é…ç½®å¦‚ä¸‹å›¾ã€‚</p>
<p><img src="https://i.loli.net/2019/07/25/5d39600d8afb932999.jpg" alt="ShadowsocksX-NG kcptunè®¾ç½®"></p>
<p>è¿™é‡Œè¯´ä¸€ä¸‹ç»å¸¸é…ç½®é”™çš„åœ°æ–¹ï¼š</p>
<ul>
<li>kcptun Portå¡«å†™çš„æ˜¯æœåŠ¡å™¨ç«¯æ‰“å°å‡ºæ¥çš„é‚£ä¸ªç«¯å£ï¼Œè¿™ä¸ªæ—¶å€™ä¸Šè¾¹çš„ç«¯å£ä¹Ÿä¼šå˜ï¼Œä¸è¦ç´§ã€‚</li>
<li><strong>ç”»æ¡†å¤„çš„Passwordï¼Œä¸æ˜¯ShadowsocksæœåŠ¡ç«¯çš„å¯†ç ï¼Œæ˜¯KcptunæœåŠ¡ç«¯æ‰“å‡ºæ¥çš„key</strong>ï¼Œåœ¨æœ¬æ–‡ä¸­å°±æ˜¯â€very fastâ€ï¼Œè¿™é‡Œæ˜¯æœ€å®¹æ˜“ææ··çš„åœ°æ–¹</li>
<li>å…¶ä»–é€‰é¡¹å¯¹åº”å¡«å†™å°±è¡Œï¼Œå¦‚æœæœ‰å…¶ä»–å‚æ•°ä¸ä¸€æ ·ï¼Œå¯ä»¥åœ¨Argumentsä¸­å¡«å†™ï¼Œæ¯”å¦‚é»˜è®¤æˆ‘kcp_client.logä¸­æ‰“å°å‡ºæ¥çš„sndwndæ˜¯128ï¼Œè¿™é‡Œæ”¹æˆ512</li>
<li>æœ‰é—®é¢˜å…ˆçœ‹<code>~/Library/kcptun_client.log</code> è‡ªä¸»åˆ†æï¼Œå¯¹ç…§å„ä¸ªå‚æ•°</li>
<li>å…¶ä»–è®¾ç½®ä¸éœ€è¦æ”¹å°±å¯ä»¥è¿è¡Œ</li>
</ul>
]]></content>
      
        
        <tags>
            
            <tag> ShadowsocksX-NG </tag>
            
            <tag> kcptun </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[åŸºäºDjango & Channels & WebSocket & Twistedçš„ç‰©è”ç½‘è¿œç¨‹æ§åˆ¶]]></title>
      <url>http://dequn.github.io/2018/06/19/django-channels-websocket-iot-remote-control/</url>
      <content type="html"><![CDATA[<p>å…¬å¸ä¸šåŠ¡éœ€è¦å¼€å‘IOTä»ç¡¬ä»¶åˆ°è½¯ä»¶çš„å…¨éƒ¨å·¥ä½œï¼Œç”±äºä¸€å¼€å§‹æ¥çš„ç¡¬ä»¶å·¥ç¨‹å¸ˆé€‰æ‹©äº†åŸºäºTCPç›´æ¥è¿›è¡Œç»ˆç«¯ä¸æ§åˆ¶ä¸­å¿ƒäº¤äº’ï¼Œè‡ªå·±è®¾è®¡æŠ¥æ–‡å†…å®¹ä¸æ ¼å¼ï¼Œæ‰€ä»¥è¿œç¨‹æ§åˆ¶ä¹Ÿéœ€è¦è‡ªå·±å®ç°ã€‚è¿˜æ˜¯è‡ªå·±å¤ªå¹´è½»ï¼Œæ”¾ç€å¥½å¥½çš„ç°æˆçš„MQTTåè®®ä¸ç”¨ï¼Œè‡ªå·±çæŠ˜è…¾ã€‚</p>
<p>ç¡¬ä»¶ç»ˆç«¯ä¸æœåŠ¡å™¨çš„é€šè®¯æ¨¡å—é‡‡ç”¨çš„æ˜¯æ™®é€šçš„2Gå¡ï¼Œè¿™æ ·æ‰èƒ½ä¸è‡ªå·±çš„æœåŠ¡å™¨ç›´æ¥é€šä¿¡ï¼ˆç”µä¿¡çš„ç‰©è”ç½‘å¡åªèƒ½è¿æ¥åä¸ºäº‘ï¼Œç§»åŠ¨çš„ç‰©è”ç½‘å¡åªèƒ½è¿æ¥Oneconnectäº‘å¹³å°ï¼Œç„¶åå†å¯¹æ¥è‡ªå·±çš„ä¸šåŠ¡ç³»ç»Ÿï¼‰ã€‚ä¸ºäº†èŠ‚çœç»ˆç«¯ç”µæ± ç”µé‡ï¼Œç»ˆç«¯5åˆ†é’Ÿå”¤é†’ä¸€æ¬¡è¿æ¥æœåŠ¡å™¨ä¸ŠæŠ¥æ•°æ®ï¼Œä¹Ÿå°±æ˜¯åœ¨è¿™ä¸ªæ—¶å€™ï¼Œéœ€è¦æœåŠ¡å™¨æŸ¥è¯¢æ§åˆ¶ä»»åŠ¡é˜Ÿåˆ—ï¼Œä¸‹å‘ç»™ä¸‹ä½æœºã€‚æ‰€ä»¥ï¼Œè¿™é‡Œæœ‰ä¸‹é¢å‡ ä¸ªå·¥ä½œéœ€è¦å®Œæˆï¼š</p>
<ul>
<li>å‰ç«¯ç”¨æˆ·ç•Œé¢æ“ä½œï¼Œå‘é€ä»»åŠ¡ç»™åç«¯æœåŠ¡å™¨ï¼ˆReact + Django)ï¼Œéšåç­‰å¾…å¾—åˆ°æ§åˆ¶ç»“æœçŠ¶æ€</li>
<li>åç«¯åˆ›å»ºä»»åŠ¡ï¼ˆå†™Redis)</li>
<li>ä¸‹ä½æœºæ¯5åˆ†é’Ÿè¿æ¥ä¸€æ¬¡ä¸Šä½æœºï¼Œä¸Šä½æœºï¼ˆTwistedï¼‰æŸ¥è¯¢ä»»åŠ¡é˜Ÿåˆ—ï¼ˆRedisï¼‰ï¼Œå°†å¯¹åº”çš„ä»»åŠ¡ä¸‹å‘ç»™ä¸‹ä½æœºï¼Œä¸‹ä½æœºè·å–æ§åˆ¶æŠ¥æ‰§è¡Œç›¸åº”æ“ä½œåï¼Œè¿”å›æ§åˆ¶ç»“æœç»™ä¸Šä½æœº</li>
<li>ä¸Šä½æœºè¿”å›æ§åˆ¶ç»“æœç»™webåç«¯(Redis å‘å¸ƒ)ï¼Œåç«¯ç›‘å¬æœåŠ¡ï¼ˆè®¢é˜… Redisï¼‰è¿”å›ç»™å‰ç«¯ï¼ˆWebSocketï¼‰</li>
<li>å‰ç«¯æ‹¿åˆ°ç»“æœï¼ŒUIåé¦ˆç»™ç”¨æˆ·</li>
</ul>
<p>å…¶ä¸­ï¼Œä¸æ˜¯å¿…é¡»é€šè¿‡Webåç«¯æ‰å¯ä»¥ç»™ç¡¬ä»¶çš„ä¸Šä½æœºå‘é€ä»»åŠ¡ï¼ˆè¿™é‡Œæ˜¯Twistedè¿›ç¨‹ï¼‰ï¼Œæ¯”å¦‚æœ¬èº«å°±å¯ä»¥ä½¿ç”¨<a href="https://github.com/crossbario/autobahn-python" target="_blank" rel="noopener">autobahn-python</a>ç›´æ¥æ­å»ºä¸€ä¸ªWAMPï¼Œå…¶è¿è¡Œåœ¨Twistedä¸Šï¼Œå°±å¯ä»¥çœå»ä¸€æ­¥äº¤äº’äº†ã€‚ç”±äºåœ¨è¿™ä¸ªé¡¹ç›®ä¸­æ¶‰åŠåˆ°æƒé™éªŒè¯ã€å¼€å…³æŠ½è±¡ï¼ˆä¸€ä¸ªä¸‹ä½æœºæœ‰å¤šä¸ªå¼€å…³ï¼‰ç­‰å·¥ä½œï¼Œæ‰€ä»¥è¿˜æŠŠè¿™å±‚æ”¾åœ¨Djangoä¸­ï¼Œåè€Œçœå»å¾ˆå¤šå¼€å‘ã€‚</p>
<p>å¦å¤–éœ€è¦è¯´æ˜ä¸€ä¸‹ä¸ºä»€ä¹ˆwebå‰åç«¯ä¹‹é—´ç”¨WebSocketï¼Œå› ä¸ºè¿™é‡Œçš„ä»»åŠ¡ç›¸å½“äº<strong>å¼‚æ­¥ä»»åŠ¡</strong>ï¼Œå‰åç«¯éƒ½ä¸çŸ¥é“ä¸‹ä½æœºæ‰§è¡Œä»»åŠ¡çš„å‡†ç¡®æ—¶é—´ï¼Œé™¤äº†å‰ç«¯è½®è¯¢çš„è§£å†³æ–¹æ¡ˆï¼Œæœ€å¥½çš„å°±æ˜¯å»ºç«‹ä¸€ä¸ªåŒå·¥é•¿è¿æ¥ï¼Œè¿™æ ·å½“webåç«¯ä¸€æ—¦çŸ¥é“ä»»åŠ¡ç»“æœï¼Œå°±å¯ä»¥ä¸»åŠ¨å‘é€ç»™å‰ç«¯ï¼Œå› æ­¤WebSocketæ˜¯æœ€åˆé€‚çš„æ–¹æ¡ˆã€‚å½“ç„¶ï¼ŒDjangoæœ¬èº«ä¸æ”¯æŒé•¿è¿æ¥ï¼Œå¹¸å¾—æœ‰å¤§ç‰›å¼€å‘äº†<a href="https://github.com/django/channels" target="_blank" rel="noopener">channels</a>ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥åŸºäºDjangoå¼€å‘WebSocetæœåŠ¡ï¼Œå¹¶ä¸”è¿˜æ”¯æŒå¼‚æ­¥ï¼</p>
<p>ä»¥ä¸Šçš„è¿‡ç¨‹ç”»æˆå›¾æ˜¯è¿™æ ·çš„!</p>
<p><img src="https://i.loli.net/2019/07/25/5d39600d6034294145.png" alt="iot-remote-control-sequence"></p>
<p>è¡¥å……ï¼š</p>
<ul>
<li>ä»»åŠ¡é˜Ÿåˆ—æ˜¯å†™Redis</li>
<li>æ³¨æ„ä»»åŠ¡é˜Ÿåˆ—æ¶ˆè´¹è¿‡åï¼Œè¦åˆ é™¤ï¼ˆå³æ­¤æ¬¡ä»»åŠ¡å·²æ‰§è¡Œï¼Œä¸è®ºç»“æœæˆåŠŸä¸å¦ï¼‰</li>
<li>Django Channelséœ€è¦å»ºç«‹ä¸€ä¸ªåå°ç›‘å¬æœåŠ¡ï¼ˆ<a href="https://channels.readthedocs.io/en/latest/topics/channel_layers.html#using-outside-of-consumers" target="_blank" rel="noopener">Channel layers using outside of consumer</a>ï¼‰ï¼Œç¬¬ä¸€æ—¶é—´é€šçŸ¥ç»™webå‰ç«¯</li>
</ul>
]]></content>
      
        
        <tags>
            
            <tag> Django </tag>
            
            <tag> Channels </tag>
            
            <tag> WebSocket </tag>
            
            <tag> IOT </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[django-allauthé…ç½®å¾®ä¿¡ç™»é™†]]></title>
      <url>http://dequn.github.io/2018/06/12/django-allauth-weixin-login/</url>
      <content type="html"><![CDATA[<p><a href="https://django-allauth.readthedocs.io/en/latest/index.html" target="_blank" rel="noopener">django-allauth</a>å¾ˆæ–¹ä¾¿åœ°ç»§æ‰¿äº†ç¬¬ä¸‰æ–¹ç™»é™†çš„åŠŸèƒ½ï¼Œä½†å…¶è¯´æ˜æ–‡æ¡£å¹¶ä¸æ˜¯å¾ˆè¯¦ç»†ï¼Œé…ç½®ä¸€ä¸ªdemoéƒ½æ‰æ‘¸äº†å¥½é•¿æ—¶é—´ï¼Œè¿™é‡Œå°±ä»¥å¾®ä¿¡è®¢é˜…å·ç™»é™†ä¸ºä¾‹ï¼Œè¯¦ç»†åœ°è¯´æ˜ä¸€ä¸‹é…ç½®è¿‡ç¨‹ï¼Œä»¥ä¾›å…¶ä»–æ–°ä¸Šæ‰‹åœ°å°ä¼™ä¼´å‚è€ƒã€‚</p>
<h1 id="è·å–å¾®ä¿¡è®¢é˜…å·å¼€å‘appid"><a href="#è·å–å¾®ä¿¡è®¢é˜…å·å¼€å‘appid" class="headerlink" title="è·å–å¾®ä¿¡è®¢é˜…å·å¼€å‘appid"></a>è·å–å¾®ä¿¡è®¢é˜…å·å¼€å‘appid</h1><p>å¾®ä¿¡å…¬ä¼—å¹³å°æä¾›äº†ä¸€ä¸ªæµ‹è¯•å·æ–¹ä¾¿å¼€å‘ï¼Œç™»é™†<a href="https://mp.weixin.qq.com/debug/cgi-bin/sandboxinfo?action=showinfo&amp;t=sandbox/index" target="_blank" rel="noopener">https://mp.weixin.qq.com/debug/cgi-bin/sandboxinfo?action=showinfo&amp;t=sandbox/index</a>å³å¯è·å¾—ä¸€ä¸ªappIDå’Œappsecretï¼Œè¿™é‡Œä½†URLå’ŒTokenéƒ½å…ˆå¯ä»¥ç•™ç©ºï¼Œæ‰¾åˆ°ä¸‹è¾¹çš„<strong>ç½‘é¡µæˆæƒè·å–ç”¨æˆ·åŸºæœ¬ä¿¡æ¯</strong>ï¼Œç‚¹å‡»å³ä¾§çš„ä¿®æ”¹ï¼Œæµ‹è¯•å·å¯ä»¥å¡«å†™ipåœ°å€ï¼Œè¿™é‡Œä¸ºå¡«å†™çš„æ˜¯æœ¬åœ°å¼€å‘æ—¶å€™çš„æœ¬æœºip:port, <strong>æ³¨æ„ï¼šè¿™ä¸ªåœ°å€æ˜¯è¦ä¼šå‡ºç°åœ¨å›æ‰åœ°å€redirect_urlä¸­çš„ï¼Œä¸ä¸€è‡´å°†ä¸èƒ½æ­£ç¡®æˆæƒ</strong>ã€‚ã€å‚è€ƒï¼š<a href="https://www.cnblogs.com/0201zcr/p/5131602.html" target="_blank" rel="noopener">å¾®ä¿¡å…¬ä¼—å¹³å°å¼€å‘â€”â€”å¾®ä¿¡æˆæƒç™»å½•ï¼ˆOAuth2.0ï¼‰</a>ã€‘</p>
<p><img src="https://i.loli.net/2019/07/25/5d3961875465f47428.png" alt="å¾®ä¿¡å…¬ä¼—å¹³å°æµ‹è¯•å·"></p>
<p><img src="https://i.loli.net/2019/07/25/5d39618764f5962011.png" alt="æ‰¾åˆ°ç½‘é¡µè·å–ç”¨æˆ·åŸºæœ¬ä¿¡æ¯"></p>
<p><img src="https://i.loli.net/2019/07/25/5d39618723b7d43295.png" alt="å¡«å†™åŸŸå"></p>
<h1 id="å®‰è£…é…ç½®django-allauth"><a href="#å®‰è£…é…ç½®django-allauth" class="headerlink" title="å®‰è£…é…ç½®django-allauth"></a>å®‰è£…é…ç½®django-allauth</h1><p>django-allauth çš„Docå·²ç»æŠŠ<a href="https://django-allauth.readthedocs.io/en/latest/installation.html" target="_blank" rel="noopener">å®‰è£…è¿‡ç¨‹</a>è§£é‡Šçš„å¾ˆè¯¦ç»†äº†ï¼Œå°±ä¸å†é‡å¤ï¼Œåªè¯´æ˜ä¸€ä¸‹æ¯”è¾ƒå®¹æ˜“å‡ºé”™çš„åœ°æ–¹ã€‚</p>
<h2 id="siteè®¾ç½®"><a href="#siteè®¾ç½®" class="headerlink" title="siteè®¾ç½®"></a>siteè®¾ç½®</h2><p>django-allauthè¦æ±‚è®¾ç½®ç«™ç‚¹å·ï¼Œå¦‚æœå·²ç»è·Ÿç€å®‰è£…è¿‡ç¨‹è¿›è¡Œåˆ°è¿™ä¸€æ­¥çš„è¯ï¼Œéœ€è¦æ‰“å¼€djangoçš„åå°ç®¡ç†ç¨‹åºï¼Œä¼šæœ‰ä¸€ä¸ªè®¾ç½®å¥½çš„site(example.com)ã€‚</p>
<h2 id="django-allauth-Social-applicationsè®¾ç½®"><a href="#django-allauth-Social-applicationsè®¾ç½®" class="headerlink" title="django-allauth Social applicationsè®¾ç½®"></a>django-allauth Social applicationsè®¾ç½®</h2><p>åœ¨åå°ç®¡ç†æ‰¾åˆ°Social applicationsï¼Œç‚¹å‡»æ·»åŠ ï¼ŒæŠŠç¬¬ä¸€æ­¥åœ¨å¾®ä¿¡å…¬ä¼—å¹³å°è·å–çš„appidå’Œappsecretå¡«è¿›å»ï¼Œå¹¶é€‰æ‹©åˆšåˆšè®¾ç½®çš„ç«™ç‚¹ï¼Œä¿å­˜ï¼Œç«™ç‚¹åç§°ä¸ä¸€å®šéœ€è¦ä¸å¾®ä¿¡å…¬ä¼—å¹³å°å¡«å†™çš„ä¸€è‡´ï¼Œè¿™é‡Œåˆšå¼€å§‹ç†è§£é”™äº†ã€‚ã€å‚è€ƒ: <a href="http://www.marinamele.com/user-authentication-with-google-using-django-allauth" target="_blank" rel="noopener">Part VIII â€“ User Authentication with a Google Account using Django Allauth</a>ã€‘</p>
<p><img src="https://i.loli.net/2019/07/25/5d3961874b09312343.png" alt="æ·»åŠ social application"></p>
<h1 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h1><p>ä¸‹è½½ä¸€ä¸ª<a href="https://mp.weixin.qq.com/wiki?action=doc&amp;id=mp1455784140" target="_blank" rel="noopener">å¾®ä¿¡webå¼€å‘è€…å·¥å…·</a>ï¼Œè¾“å…¥å¾®ä¿¡ç™»é™†çš„åœ°å€<a href="http://10.0.0.8:8000/accounts/weixin/login/" target="_blank" rel="noopener">http://10.0.0.8:8000/accounts/weixin/login/</a> ï¼Œä¼šæç¤ºæˆæƒã€ç™»é™†ï¼ˆ<code>/accounts/weixin/</code>è·¯å¾„æ˜¯åœ¨django.settingsæ–‡ä»¶ä¸­é…ç½®çš„ï¼‰ï¼Œè‡³æ­¤é…ç½®ç»“æŸï¼Œåœ¨djangoåå°ä¸­ï¼Œå¯ä»¥çœ‹åˆ°Social accountså’ŒUsersä¸¤ä¸ªè¡¨æ–°å¢åˆšåˆšç™»é™†çš„å¾®ä¿¡ç”¨æˆ·ï¼ˆallauthé»˜è®¤è®¾ç½®ï¼Œå‚è€ƒ<a href="https://django-allauth.readthedocs.io/en/latest/configuration.html" target="_blank" rel="noopener">Configuration</a>ï¼‰ï¼Œæµ‹è¯•å®Œæˆï¼</p>
<h1 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h1><ul>
<li><p>å¾®ä¿¡å…¬ä¼—å¹³å°ä¸­è®¾ç½®çš„åŸŸåï¼Œè¦å’Œè¯·æ±‚æˆæƒurlä¸­çš„å›æ‰å‚æ•°redirect_uriçš„åŸŸåæ˜¯ä¸€æ¨¡ä¸€æ ·çš„ã€‚å¦‚æœå¾®ä¿¡å…¬ä¼—å¹³å°ä¸Šçš„æ˜¯çº¿ä¸ŠåŸŸåï¼Œæœ¬åœ°æµ‹è¯•å¯ä»¥ä¿®æ”¹hostsæ–‡ä»¶ã€‚</p>
</li>
<li><p>å¦‚æœä½¿ç”¨allauth.weixinçš„ç™»é™†urlï¼Œä¹Ÿå°±æ˜¯<code>accounts/weixin/login</code>(è·Ÿç€allauthçš„æ–‡æ¡£ç¤ºä¾‹ä¼šé…ç½®æˆè¿™æ ·çš„ï¼‰ï¼Œé‚£ä¹ˆdjangoçš„åŸŸåä¸€å®šè¦ä¸å¾®ä¿¡å…¬ä¼—å¹³å°ä¸Šè®¾ç½®çš„ä¸€è‡´ï¼Œå¦åˆ™é»˜è®¤çš„å›æ‰åœ°å€æ˜¯<code>django-domain/accounts/weixin/login/callback</code>ï¼Œå¾®ä¿¡æˆæƒé¡µé¢ä¸èƒ½æ­£å¸¸åŠ è½½ã€‚</p>
</li>
<li><p>django-allauthçš„å¾®ä¿¡é…ç½®ï¼ˆæˆ‘è¿™é‡Œé…ç½®çš„æ˜¯å…¬ä¼—å·å†…ç½‘é¡µæˆæƒï¼Œä¸æ˜¯pcç«¯æ‰«æäºŒç»´ç æˆæƒï¼‰ã€‚</p>
</li>
</ul>
<figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SOCIALACCOUNT_PROVIDERS = &#123;</span><br><span class="line">    <span class="string">'weixin'</span>: &#123;</span><br><span class="line">        <span class="string">'AUTHORIZE_URL'</span>: <span class="string">'https://open.weixin.qq.com/connect/oauth2/authorize'</span>,</span><br><span class="line">        <span class="string">'SCOPE'</span>: [<span class="string">'snsapi_userinfo'</span>],</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="å‚è€ƒï¼š"><a href="#å‚è€ƒï¼š" class="headerlink" title="å‚è€ƒï¼š"></a>å‚è€ƒï¼š</h1><p>[1]. <a href="https://django-allauth.readthedocs.io/en/latest/index.html" target="_blank" rel="noopener">django-allauth</a><br>[2]. <a href="https://www.cnblogs.com/0201zcr/p/5131602.html" target="_blank" rel="noopener">å¾®ä¿¡å…¬ä¼—å¹³å°å¼€å‘â€”â€”å¾®ä¿¡æˆæƒç™»å½•ï¼ˆOAuth2.0ï¼‰</a><br>[3]. <a href="http://www.marinamele.com/user-authentication-with-google-using-django-allauth" target="_blank" rel="noopener">Part VIII â€“ User Authentication with a Google Account using Django Allauth</a><br>[4]. <a href="https://django-allauth.readthedocs.io/en/latest/configuration.html" target="_blank" rel="noopener">Configuration</a><br>[5]. <a href="https://mp.weixin.qq.com/wiki?action=doc&amp;id=mp1455784140" target="_blank" rel="noopener">å¾®ä¿¡webå¼€å‘è€…å·¥å…·</a><br>[6]. <a href="https://open.weixin.qq.com/cgi-bin/showdocument?action=dir_list&amp;t=resource/res_list&amp;verify=1&amp;id=open1419316505&amp;token=&amp;lang=zh_CN" target="_blank" rel="noopener">ç½‘ç«™åº”ç”¨å¾®ä¿¡ç™»å½•å¼€å‘æŒ‡å—</a></p>
]]></content>
      
        
        <tags>
            
            <tag> Django </tag>
            
            <tag> allauth </tag>
            
            <tag> å¾®ä¿¡ </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Django2ç»“åˆCeleryæ·»åŠ å®šæ—¶ä»»åŠ¡]]></title>
      <url>http://dequn.github.io/2018/06/02/django-celery/</url>
      <content type="html"><![CDATA[<p>é¡¹ç›®éœ€è¦å¯¹ä¸€äº›è§‚æµ‹æ•°å€¼åšç›‘æ§é¢„è­¦ï¼Œæ²¡æœ‰æ‰¾åˆ°ç‰¹åˆ«åˆé€‚çš„ä¸“é—¨çš„å¼€æºé¡¹ç›®ï¼Œå› æ­¤å†³å®šé‡‡ç”¨Celeryå®ç°ä»»åŠ¡è°ƒåº¦ï¼Œå½“ç„¶ï¼Œé™¤äº†Cerleryï¼Œè¿˜æœ‰å°±æ˜¯å¯ä»¥é‡‡ç”¨APSchedulerå®ç°ï¼Œä¹Ÿæœ‰<a href="https://github.com/jarekwg/django-apscheduler" target="_blank" rel="noopener">django-apscheduler</a>çš„å¼€æºé¡¹ç›®åˆ©ç”¨Djangoçš„ORMå­˜å‚¨APSchedulerçš„ä»»åŠ¡å’Œè°ƒåº¦ä¿¡æ¯ï¼Œä½†æ˜¯APSchedulerå¹¶æ²¡æœ‰é‚£ä¹ˆçµæ´»ï¼Œæ¯”å¦‚è¦æƒ³ä¿®æ”¹ä¾‹è¡Œä¿¡æ¯ï¼Œæ˜¯éœ€è¦ä¿®æ”¹æºä»£ç å¹¶ä¸”é‡å¯Djangoè¿›ç¨‹æ‰å¯ä»¥ï¼Œä¹Ÿæ­£æ˜¯å‚è€ƒäº†è¿™ä¸ª<a href="https://stackoverflow.com/questions/11654353/how-to-setup-apscheduler-in-a-django-project/15929907" target="_blank" rel="noopener">Stackoverflowé—®é¢˜</a>ï¼Œæ‰å†³å®šé€‰ç”¨Celeryæ¥è°ƒåº¦ä»»åŠ¡ã€‚</p>
<p>å…³äºCeleryçš„å®šä¹‰ï¼Œæˆ‘æƒ³å…¶é¡¹ç›®ç½‘ç«™ä¸»é¡µçš„æ ‡é¢˜æœ€ä¸ºç²¾ç¡®ä¸è¿‡äº†â€”â€”<strong>Distributed Task Queue</strong>ï¼Œè¿™é‡Œåªç®€å•çš„ä»‹ç»ä¸€ä¸‹Celeryçš„å·¥ä½œæ¨¡å¼ï¼Œå…¶ä»–çš„ä½¿ç”¨ç»†èŠ‚å¯ä»¥å‚çœ‹ç½‘ä¸Šçš„å¤§é‡æ–‡ç« ï¼Œä¸è¿‡å»ºè®®ä»¥é¡¹ç›®æœ¬èº«çš„æ–‡æ¡£ä¸ºä¸»ï¼Œæœ€ä¸ºæƒå¨ï¼Œå°¤å…¶æ˜¯åœ¨ç°åœ¨ç½‘ç»œæ–‡ç« äº’ç›¸æŠ„æ¥æŠ„å»ï¼Œè´¨é‡æä½ï¼</p>
<p>Celeryæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—ï¼Œé‚£ä¹ˆå°±éœ€è¦ä¸€ä¸ªBrokerä¹Ÿå°±æ˜¯ç»çºªäººï¼ˆæˆ‘çœ‹å¥½å¤šäººç¿»è¯‘æˆä¸­é—´äººï¼Œè§‰å¾—å¥½lowå•Šï¼‰æ¥å­˜å‚¨å’Œåˆ†å‘ä»»åŠ¡æ¶ˆæ¯ï¼ŒWorkeræ˜¯å®é™…æ‰§è¡Œä»»åŠ¡çš„è§’è‰²ï¼ŒWorkerè¿›ç¨‹å¯åŠ¨åï¼Œä»ç»çºªäººé‚£é‡Œè¯»å–å¹¶æ‰§è¡Œç›¸åº”ä»»åŠ¡ï¼Œä»»åŠ¡æ˜¯ä¸€æ—©å®šä¹‰å¥½çš„ï¼Œå¯ä»¥æ‰‹åŠ¨è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥ç”¨CelerBeatå®ç°ä¾‹è¡Œã€‚å¦‚æœäº†è§£ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹çš„è¯ï¼ŒWorkerå¯¹åº”æ¶ˆè´¹è€…ï¼ŒCeleryBeatå¯¹åº”ç”Ÿäº§è€…ã€‚</p>
<p>ä¹Ÿå·²ç»æœ‰å¼€æºé¡¹ç›®<a href="https://github.com/celery/django-celery" target="_blank" rel="noopener">django-celery</a>ï¼Œä½¿å¾—å¯ä»¥å¾ˆæ–¹ä¾¿çš„åœ¨Djangoä¸­æ·»åŠ Celeryä»»åŠ¡ï¼Œä½†æ˜¯è¿™ä¸ªé¡¹ç›®ç›®å‰ä¸æ”¯æŒDjango 2åŠä»¥ä¸Šï¼ŒåŸå› æ˜¯Celeryè°ƒç”¨çš„kombuåº“ä¼šæŠ›å‡ºä¸€ä¸ª<code>missing 1 required positional argument: on_delete</code>çš„é”™è¯¯ï¼Œè€Œæ°æ˜¯åœ¨Django 2çš„æ—¶å€™ï¼Œ<code>on_delete</code>æ”¹æˆäº†å¿…é¡»å­—æ®µï¼Œç”±äºæ˜¯Dockeré…ç½®çš„å¼€å‘ç¯å¢ƒï¼Œä¹Ÿæ‡’å¾—å»ä¿®æ”¹é•œåƒï¼Œå› ä¸ºCelery æœ¬èº«å°±æœ‰å¯¹Djangoçš„æ”¯æŒï¼Œæ‰€ä»¥å°±è‡ªå·±åŠ¨æ‰‹ï¼Œå¹¶ä¸å¤æ‚ã€‚</p>
<p>å…·ä½“çš„è¿‡ç¨‹å¯ä»¥å‚è€ƒ<a href="https://medium.com/@markgituma/using-django-2-with-celery-and-redis-21343284827c" target="_blank" rel="noopener">Using Django 2 with Celery and Redis</a> å’Œ å®˜æ–¹æ–‡æ¡£<a href="http://docs.celeryproject.org/en/latest/django/first-steps-with-django.html" target="_blank" rel="noopener">Using Celery with Django</a>ï¼Œå¾ˆç®€å•å°±ä¸ä¸Šä»£ç äº†ï¼Œ<strong>è¿™é‡Œæœ‰ä¸€ä¸ªå¾ˆæ·±çš„å‘</strong>ï¼Œcelery.pyä¸­é…ç½®äº†ä»»åŠ¡è‡ªåŠ¨å‘ç°<code>app.autodiscover_tasks()</code>ï¼Œä½†<strong>åœ¨å„ä¸ªappä¸­å®šä¹‰ä»»åŠ¡çš„æ¨¡å—åä¸€å®šè¦æ˜¯tasksï¼Œä¹Ÿå°±æ˜¯ç¤ºä¾‹ä»£ç ä¸­å®šä¹‰äº†ä»»åŠ¡çš„æ–‡ä»¶åä¸€å®šè¦æ˜¯tasks.pyï¼Œè€Œä¸èƒ½æ˜¯å…¶ä»–çš„ä»»ä½•åç§°</strong>ï¼Œå› ä¸ºè‡ªå·±å°è¯•çš„æ—¶å€™æ‰‹æ®‹æ•²é”™äº†ï¼Œè°ƒè¯•äº†å¾ˆä¹…æ‰å‘ç°ï¼</p>
<figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-<span class="ruby"> app1/</span></span><br><span class="line"><span class="ruby">    - tasks.py</span></span><br><span class="line"><span class="ruby">    - models.py</span></span><br><span class="line"><span class="ruby">- app2/</span></span><br><span class="line"><span class="ruby">    - tasks.py</span></span><br><span class="line"><span class="ruby">    - models.py</span></span><br></pre></td></tr></table></figure>
<p>å¦å¤–è¿˜æœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„é—®é¢˜å°±æ˜¯è°ƒç”¨ä»»åŠ¡æ—¶<strong>ä»»åŠ¡çš„name</strong>è¯¥å¦‚ä½•å†™ï¼Œä»å“ªä¸€å±‚æ¨¡å—å¼€å§‹ä¹Ÿè‡³å…³é‡è¦ï¼Œ<a href="http://docs.celeryproject.org/en/latest/userguide/tasks.html#task-naming-relative-imports" target="_blank" rel="noopener">task-naming-relative-imports</a>è§£é‡Šäº†why and howï¼Œè¿™ä¸€ç‚¹å¾ˆå¤šå…¶ä»–æ–‡ç« éƒ½æ²¡æåŠï¼Œä¹Ÿæ˜¯å®¹æ˜“å‡ºç°çš„ä¸€ä¸ªå‘ã€‚å…·ä½“æ”¾åœ¨Djangoä¸­ï¼Œä»¥app1ä¸­ä»»åŠ¡ä¸ºä¾‹ï¼Œä¹Ÿå°±æ˜¯åœ¨<code>INSTALLED_APPS</code>ä¸­æ·»åŠ çš„æ˜¯app1ï¼Œé‚£ä¹ˆè°ƒç”¨çš„æ—¶å€™è¦ç”¨åˆ°çš„ä»»åŠ¡åç§°å°±æ˜¯<code>app1.tasks.task1</code>ï¼Œä¹Ÿå¯ä»¥æ˜¯åµŒå¥—çš„ç±»å¦‚<code>app1.app2.tasks.task1</code>ã€‚</p>
<p>å†™äº†ä¸€ä¸ªç®€å•çš„<a href="https://github.com/dequn/django2-celery-demo" target="_blank" rel="noopener">django2-celery-demo</a>ï¼Œä»¥ä¾›å‚è€ƒã€‚</p>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p>[1]. <a href="https://stackoverflow.com/questions/11654353/how-to-setup-apscheduler-in-a-django-project/15929907" target="_blank" rel="noopener">Stackoverflow: How to setup APScheduler in a Django project?</a><br>[2]. <a href="https://github.com/celery/django-celery" target="_blank" rel="noopener">django-celery</a><br>[3]. <a href="https://github.com/jarekwg/django-apscheduler" target="_blank" rel="noopener">django-apscheduler</a><br>[4]. <a href="https://medium.com/@markgituma/using-django-2-with-celery-and-redis-21343284827c" target="_blank" rel="noopener">Using Django 2 with Celery and Redis</a><br>[5]. <a href="http://docs.celeryproject.org/en/latest/django/first-steps-with-django.html" target="_blank" rel="noopener">Using Celery with Django</a><br>[6]. <a href="http://docs.celeryproject.org/en/latest/userguide/tasks.html#task-naming-relative-imports" target="_blank" rel="noopener">task-naming-relative-imports</a></p>
]]></content>
      
        
        <tags>
            
            <tag> Django </tag>
            
            <tag> Celery </tag>
            
            <tag> APScheduler </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[python3è°ƒç”¨Twisted web requestçš„å‘]]></title>
      <url>http://dequn.github.io/2018/05/31/python3-twisted-web-client/</url>
      <content type="html"><![CDATA[<p>ç¡¬ä»¶ç»ˆç«¯å‘é€æ•°æ®ç»™æœåŠ¡å™¨é‡‡ç”¨çš„æ˜¯TCPç›´æ¥ä¼ è¾“ï¼Œè‡ªå·±å®šä¹‰äº†äºŒè¿›åˆ¶æ•°æ®æµæ ¼å¼ï¼Œé€‰æ¥é€‰å»é‡‡ç”¨äº†Twistedå¼€å‘TCPæœåŠ¡å™¨ã€‚åœ¨æ•°æ®å¤–éœ²çš„æ—¶å€™ï¼Œé‡‡ç”¨Djangoå¼€å‘äº†ä¸€ä¸ªç½‘ç«™ï¼Œå› ä¸ºåœ¨Djangoä¸­å·²ç»å®šä¹‰äº†æ•°æ®æ¨¡å‹ï¼Œä¸èƒ½ä¹Ÿä¸æƒ³å®šä¹‰ä¸¤æ¬¡æ•°æ®æ¨¡å‹ï¼Œæ‰€ä»¥Twistedæ¥æ”¶åˆ°æ•°æ®æ—¶ï¼Œè°ƒç”¨Djangoçš„RESTæ¥å£ä¿å­˜æ•°æ®åˆ°æ•°æ®åº“ï¼Œè¿™å°±éœ€è¦ç”¨åˆ°Twisted web client å‘é€æ•°æ®ã€‚<a href="https://stackoverflow.com/questions/5051408/sharing-a-database-between-twisted-and-django" target="_blank" rel="noopener">è¯¥å›ç­”</a> åˆ†æäº†åœ¨Twistedå’ŒDjangoä¸­â€œå…±äº«æ•°æ®åº“â€çš„å‡ ç§æ–¹æ³•ã€‚</p>
<p>æ³¨ï¼šTwistedåˆ°æœ€å¤§ä¼˜åŠ¿åœ¨äºå¼‚æ­¥éé˜»å¡ï¼Œè€ŒDjangoé‡‡ç”¨çš„æ˜¯åŒæ­¥å¤„ç†ï¼Œå¦‚æœç›´æ¥å¼•å…¥Djangoçš„æ•°æ®æ¨¡å‹ï¼Œè¿™ç§åŒæ­¥å¤„ç†æ”¾åœ¨Twistedçš„deferredé‡Œä¼šè®©Twistedçš„ä¼˜åŠ¿ä¸§å¤±ï¼Œæ‰€ä»¥é‡‡ç”¨äº†å¼‚æ­¥è°ƒç”¨å…¶ä»–æœåŠ¡çš„æ–¹å¼ã€‚ä¹‹æ‰€ä»¥ç°åœ¨é‡‡ç”¨Djangoè¿›è¡Œç½‘ç«™å¼€å‘ï¼Œæ˜¯å› ä¸ºç°åœ¨æ˜¯é¡¹ç›®åˆæœŸï¼Œèƒ½å¤Ÿå¿«é€Ÿå¼€å‘è½åœ°æ˜¯ç¬¬ä¸€éœ€æ±‚ï¼Œä½†åŒæ—¶ä¹Ÿå…¼é¡¾åˆ°ä»¥åæ€§èƒ½å‡çº§ï¼Œæ‰€ä»¥ä¿è¯å„ä¸ªæ¨¡å—çš„ä½è€¦åˆã€‚</p>
<p>ç¯å¢ƒä¿¡æ¯ï¼š</p>
<ul>
<li>Python 3.6.5</li>
<li>Twisted 18.4.0</li>
<li>Django 2.0.5</li>
</ul>
<p>å…³äºTwisted web client<a href="https://twistedmatrix.com/documents/14.0.1/web/howto/client.html" target="_blank" rel="noopener">å®˜ç½‘</a>ç»™å‡ºäº†å¾ˆè¯¦ç»†çš„ç¤ºä¾‹ï¼Œä½†è·Ÿç€å®éªŒä¸‹æ¥çš„æƒ…å†µç«Ÿç„¶æ˜¯æ²¡æœ‰ååº”ï¼ŒæœåŠ¡å™¨æ ¹æœ¬éƒ½æ²¡æ¥åˆ°ä»»ä½•è¯·æ±‚ï¼</p>
<p>ç¨‹åºï¼ˆå‚è€ƒå®˜æ–¹ç¤ºä¾‹ï¼‰æŠ¥çš„ç¬¬ä¸€ä¸ªé”™è¯¯æ˜¯<code>TypeError: url must be bytes, not unicode</code>ï¼Œæ²¡åœ¨æ„ç›´æ¥åœ¨urlçš„å­—é¢é‡å‰åŠ äº†ä¸€ä¸ª<code>b</code>ï¼Œå…¶å®è¿™ç»™åæ¥çš„debugå¸¦æ¥äº†æå¤§çš„å›°éš¾ï¼Œå› ä¸ºä¸€åˆ‡éƒ½æ˜¯æŒ‰ç…§ç¤ºä¾‹å†™çš„ï¼Œè€Œæ ¹æœ¬çœ‹ä¸åˆ°å‘é€è¯·æ±‚ï¼Œæ²¡æœ‰ç‰ˆæœ¬åªèƒ½å†å»ç¿»çœ‹Twisted çš„<a href="https://twistedmatrix.com/documents/14.0.1/api/twisted.web.iweb.IAgent.html#request" target="_blank" rel="noopener">API DOC</a>äº†ï¼Œè¿™æ‰å‘ç°ï¼ŒåŸæ¥åœ¨Python3ä¸­ï¼Œrequestçš„ç»å¤§å¤šæ•°å‚æ•°è¦æ±‚æ˜¯<code>bytes</code>ç±»å‹ï¼Œè€Œç¤ºä¾‹å…¶å®æ˜¯Python2çš„ä»£ç ï¼ŒæŠŠæ‰€æœ‰å­—ç¬¦ä¸²éƒ½è½¬æ¢æˆ<code>bytes</code>ï¼Œé—®é¢˜è§£å†³ã€‚</p>
<p>è¿˜æœ‰ä¸€ç‚¹éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œrequestè¯·æ±‚çš„urlå¿…é¡»å¸¦ä¸Š<code>http://</code>åè®®å‰ç¼€ï¼Œä¸ç„¶æœåŠ¡å™¨ç«¯ä¹Ÿæ˜¯æ¥æ”¶ä¸åˆ°è¯·æ±‚çš„ï¼</p>
<p>æœ€åï¼Œåˆšå¼€å§‹å†™Python3çš„ä»£ç ï¼Œè¿˜çœŸæ˜¯æœ‰äº›ä¸é€‚åº”ï¼Œä¸€äº›ç»†èŠ‚éœ€è¦ç‰¹åˆ«æ³¨æ„ã€‚</p>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p>[1]. <a href="https://twistedmatrix.com/documents/14.0.1/api/twisted.web.iweb.IAgent.html#request" target="_blank" rel="noopener">https://twistedmatrix.com/documents/14.0.1/api/twisted.web.iweb.IAgent.html#request</a><br>[2]. <a href="https://stackoverflow.com/questions/5051408/sharing-a-database-between-twisted-and-django" target="_blank" rel="noopener">Sharing a database between Twisted and Django</a><br>[3]. <a href="https://twistedmatrix.com/documents/14.0.1/web/howto/client.html" target="_blank" rel="noopener">Using the Twisted Web Client</a></p>
]]></content>
      
        
        <tags>
            
            <tag> Twisted </tag>
            
            <tag> Django </tag>
            
            <tag> Python3 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Dockerçš„OS imageæ˜¯åšä»€ä¹ˆç”¨çš„]]></title>
      <url>http://dequn.github.io/2018/04/01/why-docker-has-OS-image/</url>
      <content type="html"><![CDATA[<p>è¿™ä¸¤å¤©é—²æ¥æ— äº‹ï¼Œç®€å•å…¥é—¨äº†ä¸€ä¸‹Dockerã€‚ä¸»è¦å‚è€ƒçš„æœ‰é˜®ä¸€å³°è€å¸ˆçš„ä¸¤ç¯‡æ–‡ç« â€”â€”<a href="http://www.ruanyifeng.com/blog/2018/02/docker-tutorial.html" target="_blank" rel="noopener">Docker å…¥é—¨æ•™ç¨‹</a>ã€<a href="http://www.ruanyifeng.com/blog/2018/02/docker-wordpress-tutorial.html" target="_blank" rel="noopener">Docker å¾®æœåŠ¡æ•™ç¨‹</a>å’Œ yeasyçš„å¼€æºé¡¹ç›®<a href="https://yeasy.gitbooks.io/docker_practice/content/" target="_blank" rel="noopener">Docker â€” ä»å…¥é—¨åˆ°å®è·µ</a>ï¼Œç…§è‘«èŠ¦ç”»ç“¢ç®€å•å…¥é—¨ï¼Œä¸è¿‡ç¦»çœŸæ­£ç†è§£è®¤æ¸…æ¥šå®¹å™¨çš„ç‰¹ç‚¹ã€å¿…è¦æ€§ï¼Œå¦‚ä½•å®è·µåœ¨æŒç»­äº¤ä»˜å’Œéƒ¨ç½²ä»¥åŠå®¹å™¨äº‘ç­‰å®é™…çš„è¿ç»´åº”ç”¨è¿˜æœ‰å¾ˆé•¿çš„è·¯è¦èµ°ã€‚å½“æˆ‘çœ‹åˆ°Docker çš„OS imageä¾‹å¦‚CentOS/Fedoraã€Busyboxã€Alphineç­‰é•œåƒçš„æ—¶å€™ï¼Œä¸ç¦æ€€ç–‘ï¼Œæ—¢ç„¶æˆ‘å¯ä»¥docker pullä¸€ä¸ªå¾ˆç®€å•å‘½ä»¤å°±å¯ä»¥å®ç°å¦‚Nginx, mysqlç­‰å¾®æœåŠ¡çš„å¯åŠ¨å’Œéƒ¨ç½²ï¼Œé‚£ä¸ºä»€ä¹ˆè¿˜ä¼šå­˜åœ¨è¿™äº›OS image, è¿™äº›OS image çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>åœ¨è§£å†³è¿™ä¸ªé—®é¢˜ä¹‹å‰ï¼Œé¦–å…ˆéœ€è¦æ˜ç™½å‡ ä¸ªå’Œå®¹å™¨ä»¥åŠOSç›¸å…³çš„å®šä¹‰ï¼Œè‹±æ–‡æ¯”è¾ƒç®€å•ï¼Œç›´æ¥ä»<a href="http://www.floydhilton.com/docker/2017/03/31/Docker-ContainerHost-vs-ContainerOS-Linux-Windows.html" target="_blank" rel="noopener">Understanding Docker â€œContainer Hostâ€ vs. â€œContainer OSâ€ for Linux and Windows Containers</a>ç²˜è¿‡æ¥äº†ï¼Œä¹Ÿå¼ºçƒˆå»ºè®®çœ‹çœ‹è¿™ç¯‡æ–‡ç« ï¼Œå¯¹äºç†è§£â€OSâ€å¾ˆæœ‰å¸®åŠ©ã€‚</p>
<blockquote>
<p><strong>Container Host</strong>: Also called the Host OS. The Host OS is the operating system on which the Docker client and Docker daemon run. In the case of Linux and non-Hyper-V containers, the Host OS shares its kernel with running Docker containers. For Hyper-V each container has its own Hyper-V kernel.<br> <strong>Container OS</strong>: Also called the Base OS. The base OS refers to an image that contains an operating system such as Ubuntu, CentOS, or windowsservercore. Typically, you would build your own image on top of a Base OS image so that you can take utilize parts of the OS. Note that windows containers require a Base OS, while Linux containers do not.<br> <strong>Operating System Kernel</strong>: The Kernel manages lower level functions such as memory management, file system, network and process scheduling.</p>
</blockquote>
<h2 id="èœé¸Ÿå›ç­”"><a href="#èœé¸Ÿå›ç­”" class="headerlink" title="èœé¸Ÿå›ç­”"></a>èœé¸Ÿå›ç­”</h2><p>åŸºäºä»¥ä¸Šä¿¡æ¯ï¼Œå·²ç»å¯ä»¥ç»™å‡ºæˆ‘è¿™ç§èœé¸Ÿå›ç­”äº†ï¼šDockerçš„æ¯ä¸€ä¸ªé•œåƒéƒ½å¿…é¡»æœ‰ä¸€ä¸ªBase OS, è¿™ä¸ªBase OS å¯ä»¥æ˜¯ Linux çš„å‘è¡Œç‰ˆï¼Œä¹Ÿå¯ä»¥æ˜¯windowsçš„ï¼Œä¸Šè¾¹å·²ç»æåˆ°ï¼Œè¿™ä¸ªBase OS åœ¨Host OS æ˜¯Linuxçš„æ—¶å€™å¯ä»¥â€œä¸å¿…è¦â€ï¼Œå…¶å®ï¼Œæ˜¯ä¸€ç§ç‰¹æ®Šçš„Base OS å«åš<a href="https://hub.docker.com/r/library/scratch/" target="_blank" rel="noopener">scratch</a>ï¼Œæ–‡ç« <a href="https://docs.docker.com/develop/develop-images/baseimages/" target="_blank" rel="noopener">Create a base image</a>ç»™å‡ºäº†å¦‚ä½•åŸºäºscratchåˆ›å»ºä¸€ä¸ªBase Imageï¼ˆBase image å’Œ Base OS image ä¸æ˜¯ä¸€æ ·çš„æ¦‚å¿µ!ï¼‰ã€‚</p>
<p>æˆ‘ä»¬æ‰€ä½¿ç”¨çš„å¸¸è§çš„imageï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯ä»¥ä¸€ä¸ªHost OS imageä¸ºbaseçš„ï¼Œ æš¨Dockerfileä¸­éƒ½ä¼šæœ‰ç±»ä¼¼<code>FROM debian:stretch-slim</code>çš„åŸºäºOS imageçš„è¯­å¥ã€‚ä»¥nginx ä¸ºä¾‹ï¼Œnginxæ—¢æœ‰åŸºäºdebianä¹Ÿæœ‰åŸºäºalpineçš„é•œåƒï¼Œtagåˆ†åˆ«æ˜¯nginx:versionå’Œnginx:version-alpineï¼ŒæŸ¥çœ‹å…¶Dockerfileå¯ä»¥çœ‹å‡ºï¼Œæœ€å¤§çš„ä¸åŒç‚¹åœ¨äºä¸€ä¸ªæ˜¯<code>FROM debian:stretch-slim</code>å’Œ<code>FROM alpine:3.7</code>ã€‚ä¸‹è½½é•œåƒï¼Œå¯ä»¥çœ‹å‡ºå…¶å¤§å°çš„åŒºåˆ«ï¼Œä¸å¾—ä¸è¯´ï¼ŒåŸºäºalpineçš„å’ŒåŸºäºdebiançš„é•œåƒå¤§å°ç¡®å®ä¸æ˜¯ä¸€ä¸ªé‡çº§çš„ã€‚æ–‡ç« <a href="https://www.brianchristner.io/docker-image-base-os-size-comparison/" target="_blank" rel="noopener">Docker Base Image OS Size Comparison</a>å¯¹ä¸åŒçš„Base OS imageå¤§å°åšäº†ä¸€ä¸ªå¯¹æ¯”ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥çœ‹ä¸€çœ‹ã€‚</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">nginx               <span class="number">1.13</span><span class="number">.10</span>-alpine      <span class="number">91</span>ce6206f9d8        <span class="number">10</span> days ago         <span class="number">18</span>MB</span><br><span class="line">nginx               <span class="number">1.13</span><span class="number">.10</span>             <span class="number">7</span>f70b30f2cc6        <span class="number">10</span> days ago         <span class="number">109</span>MB</span><br></pre></td></tr></table></figure>
<h2 id="å†è¿›ä¸€æ­¥"><a href="#å†è¿›ä¸€æ­¥" class="headerlink" title="å†è¿›ä¸€æ­¥"></a>å†è¿›ä¸€æ­¥</h2><p>æ–‡ç« <a href="https://blog.risingstack.com/operating-system-containers-vs-application-containers/" target="_blank" rel="noopener">Operating System Containers vs. Application Containers</a>è®²è¿°äº†è™šæ‹Ÿæœºå’Œå®¹å™¨çš„å®ç°ä¸Šçš„åŒºåˆ«ï¼Œå¯ä»¥å¾ˆæ˜ç™½åœ°çœ‹åˆ°ï¼Œå®¹å™¨æ˜¯ç›´æ¥åŸºäºHost OS kernelçš„ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆåœ¨Macå’ŒWindowsä¸Šçš„Docker Clientæ˜¯åŸºäºLinux VMçš„<a href="https://docs.docker.com/develop/develop-images/baseimages/" target="_blank" rel="noopener">[5]</a>ã€‚åœ¨æ–‡ç« <a href="http://www.floydhilton.com/docker/2017/03/31/Docker-ContainerHost-vs-ContainerOS-Linux-Windows.html" target="_blank" rel="noopener">[4]</a>ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœæ˜¯Windowsç±»å‹çš„å®¹å™¨ï¼Œæ˜¯å¿…é¡»å»ºç«‹åœ¨Winndows typeçš„Base imageä¸Šï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªå®Œæ•´çš„â€œè™šæ‹Ÿæœºå®¹å™¨â€ã€‚</p>
<p><img src="https://i.loli.net/2019/07/25/5d39600d6ee4452528.jpg" alt="os-virtualization.jpg"></p>
<p><a href="https://serverfault.com/questions/659557/os-docker-container-what-is-the-difference-with-a-vm-then" target="_blank" rel="noopener">Stackoverflow</a> ä¸Šæœ‰ä¸€ä¸ªå›ç­”æŒºä¸é”™çš„ï¼Œè§£é‡Šäº†ä¸ºä»€ä¹ˆä¼šæœ‰Base imageï¼ŒåŒæ ·è´´å‡ºåŸæ–‡ï¼Œå¯ä»¥å¾ˆæ˜ç™½çš„çœ‹åˆ°ï¼ŒBase image æä¾›çš„æ­£å¼å®¹å™¨è¿è¡Œéœ€è¦çš„<strong> root filesystem</strong>ã€‚</p>
<blockquote>
<p>Now you should wonder how is it possible to get a process runing inside a linux base image different from the linux distribution your host is running with. For an OS to run you basically need : </p>
<ul>
<li>A boot filesystem : contains the bootloader and the kernel that will reside in memory once loaded. We donâ€™t care about this in the case of Docker containers because the kernel is shared with the host and is the common part between all linux distributions.</li>
<li>A root filesystem : contains the filesystem structure. It may be different from one linux distribution to another. Itâ€™s read-only until the boot sequence has finished.</li>
</ul>
</blockquote>
<p>å¦‚æœä»Dockerçš„åˆ†å±‚æ¶æ„ä¸Šæ¥çœ‹<a href="https://blog.risingstack.com/operating-system-containers-vs-application-containers/" target="_blank" rel="noopener">[8]</a>ï¼Œä¸ºä»€ä¹ˆéœ€è¦Base imageä¹Ÿä¼šæ˜æœ—è®¸å¤šã€‚ åœ¨å¦ä¸€ä¸ª <a href="https://serverfault.com/questions/755607/why-do-we-use-a-os-base-image-with-docker-if-containers-have-no-guest-os" target="_blank" rel="noopener">Stackoverflow</a>ä¸ŠåŒæ ·æœ‰ä¸€ä¸ªä¸é”™çš„å›ç­”ï¼Œè¿™ä¸ªå›ç­”ä¸­è¯´çš„æ˜¯<strong>userland</strong>ï¼Œæ„Ÿå…´è¶£çš„ä¹Ÿå¯ä»¥çœ‹ä¸€ä¸‹ã€‚</p>
<p><a href="https://i.loli.net/2019/07/25/5d395c8d3f82033561.png" target="_blank" rel="noopener"><img src="https://i.loli.net/2019/07/25/5d395c8d3f82033561.png" alt="docker-la&lt;x&gt;yers.png"></a></p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ol>
<li><a href="http://www.ruanyifeng.com/blog/2018/02/docker-tutorial.html" target="_blank" rel="noopener">Docker å…¥é—¨æ•™ç¨‹</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2018/02/docker-wordpress-tutorial.html" target="_blank" rel="noopener">Docker å¾®æœåŠ¡æ•™ç¨‹</a></li>
<li><a href="https://yeasy.gitbooks.io/docker_practice/content/" target="_blank" rel="noopener">Docker â€” ä»å…¥é—¨åˆ°å®è·µ</a></li>
<li><a href="http://www.floydhilton.com/docker/2017/03/31/Docker-ContainerHost-vs-ContainerOS-Linux-Windows.html" target="_blank" rel="noopener">Understanding Docker â€œContainer Hostâ€ vs. â€œContainer OSâ€ for Linux and Windows Containers</a></li>
<li><a href="https://docs.docker.com/develop/develop-images/baseimages/" target="_blank" rel="noopener">Create a base image</a> </li>
<li><a href="https://www.brianchristner.io/docker-image-base-os-size-comparison/" target="_blank" rel="noopener">Docker Base Image OS Size Comparison</a></li>
<li><a href="https://blog.risingstack.com/operating-system-containers-vs-application-containers/" target="_blank" rel="noopener">Operating System Containers vs. Application Containers</a></li>
<li><a href="https://serverfault.com/questions/659557/os-docker-container-what-is-the-difference-with-a-vm-then" target="_blank" rel="noopener">OS docker container: what is the difference with a VM then?</a></li>
<li><a href="https://serverfault.com/questions/755607/why-do-we-use-a-os-base-image-with-docker-if-containers-have-no-guest-os" target="_blank" rel="noopener">Why do we use a OS Base Image with Docker if containers have no Guest OS?</a></li>
</ol>
]]></content>
      
        <categories>
            
            <category> Docker </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[ç†è§£python withè¯­å¥]]></title>
      <url>http://dequn.github.io/2017/12/02/%E7%90%86%E8%A7%A3python-with%E8%AF%AD%E5%8F%A5/</url>
      <content type="html"><![CDATA[<p>Pythonä¸­çš„withè¯­å¥å¯è°“æ˜¯ç›¸å½“çš„å¥½ç”¨äº†ï¼Œçœå»äº†<code>try...finally...</code>çš„å¤æ‚å†™æ³•ï¼Œ<a href="https://www.ibm.com/developerworks/cn/opensource/os-cn-pythonwith/index.html" target="_blank" rel="noopener">æµ…è°ˆ Python çš„ with è¯­å¥</a> ä¸€æ–‡å†™çš„å·²ç»éå¸¸è¯¦ç»†é‡Œï¼Œè§£å†³äº†ä½¿ç”¨è¿‡ç¨‹ä¸­çš„ä¸¤ç‚¹ç–‘é—®ã€‚æ–‡ä¸­çš„ä»£ç æ¸…å•ä¹Ÿä¸»è¦æ‘˜è‡ªè¿™ç¯‡æ–‡ç« ã€‚</p>
<p>æ¸…å•1: withè¯­å¥æ‰§è¡Œè¿‡ç¨‹<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">context_manager = context_expression</span><br><span class="line"><span class="keyword">exit</span> = type(context_manager).__exit__  </span><br><span class="line">value = type(context_manager).__enter__(context_manager)</span><br><span class="line">exc = True   <span class="comment"># True è¡¨ç¤ºæ­£å¸¸æ‰§è¡Œï¼Œå³ä¾¿æœ‰å¼‚å¸¸ä¹Ÿå¿½ç•¥ï¼›False è¡¨ç¤ºé‡æ–°æŠ›å‡ºå¼‚å¸¸ï¼Œéœ€è¦å¯¹å¼‚å¸¸è¿›è¡Œå¤„ç†</span></span><br><span class="line">try:</span><br><span class="line">    try:</span><br><span class="line">        target = value  <span class="comment"># å¦‚æœä½¿ç”¨äº† as å­å¥</span></span><br><span class="line">        with-body     <span class="comment"># æ‰§è¡Œ with-body</span></span><br><span class="line">    except:</span><br><span class="line">        <span class="comment"># æ‰§è¡Œè¿‡ç¨‹ä¸­æœ‰å¼‚å¸¸å‘ç”Ÿ</span></span><br><span class="line">        exc = False</span><br><span class="line">        <span class="comment"># å¦‚æœ __exit__ è¿”å› Trueï¼Œåˆ™å¼‚å¸¸è¢«å¿½ç•¥ï¼›å¦‚æœè¿”å› Falseï¼Œåˆ™é‡æ–°æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">        <span class="comment"># ç”±å¤–å±‚ä»£ç å¯¹å¼‚å¸¸è¿›è¡Œå¤„ç†</span></span><br><span class="line">        <span class="keyword">if</span> not <span class="keyword">exit</span>(context_manager, *sys.exc_info()):</span><br><span class="line">            raise</span><br><span class="line">    finally:</span><br><span class="line">        <span class="comment"># æ­£å¸¸é€€å‡ºï¼Œæˆ–è€…é€šè¿‡ statement-body ä¸­çš„ break/continue/return è¯­å¥é€€å‡º</span></span><br><span class="line">        <span class="comment"># æˆ–è€…å¿½ç•¥å¼‚å¸¸é€€å‡º</span></span><br><span class="line">        <span class="keyword">if</span> exc:</span><br><span class="line">            <span class="keyword">exit</span>(context_manager, None, None, None) </span><br><span class="line">            <span class="comment"># ç¼ºçœè¿”å› Noneï¼ŒNone åœ¨å¸ƒå°”ä¸Šä¸‹æ–‡ä¸­çœ‹åšæ˜¯ False</span></span><br></pre></td></tr></table></figure></p>
<p>ä»ä¸Šè¾¹çš„é€»è¾‘å¯ä»¥çœ‹å‡ºï¼Œ1.å¦‚æœwithè¯­å¥å—å‘ç”Ÿå¼‚å¸¸ï¼Œé‚£ä¹ˆæ‰§è¡Œexceptä¸­çš„æµç¨‹é‡Šæ”¾èµ„æºï¼Œå¹¶æ ¹æ®<code>exit()</code>å‡½æ•°è¿”å›å€¼å†³å®šæ˜¯å¦å‘ä¸ŠæŠ›å‡ºå¼‚å¸¸ï¼›2.å¦‚æœæ‰§è¡Œè¿‡ç¨‹æ— å¼‚å¸¸ï¼Œé‚£ä¹ˆèµ°finallyä¸­çš„é€»è¾‘é‡Šæ”¾èµ„æºã€‚</p>
<h2 id="1-è¿˜ç”¨ä¸ç”¨å¤„ç†å¼‚å¸¸ï¼Ÿ"><a href="#1-è¿˜ç”¨ä¸ç”¨å¤„ç†å¼‚å¸¸ï¼Ÿ" class="headerlink" title="1. è¿˜ç”¨ä¸ç”¨å¤„ç†å¼‚å¸¸ï¼Ÿ"></a>1. è¿˜ç”¨ä¸ç”¨å¤„ç†å¼‚å¸¸ï¼Ÿ</h2><p>å¼‚å¸¸æ˜¯å¿…é¡»å¤„ç†çš„, withè¯­å¥è§£å†³çš„åªæ˜¯ä¿è¯äº†finallyä¸­çš„è¯­å¥çš„æ‰§è¡Œï¼Œåœ¨withè¯­å¥å—å†…å‘ç”Ÿäº†å¼‚å¸¸è€Œæœ‰æ²¡æœ‰å¤„ç†ï¼Œé‚£ä¹ˆä¼šç›´æ¥æ‰§è¡Œwithæ‰€ä»£æ›¿çš„finallyä¸­çš„è¯­å¥ï¼Œå¹¶æŠ›å‡ºå¼‚å¸¸ç»™å¤–å±‚ä¸Šä¸‹æ–‡ï¼Œå’Œæ­£å¸¸æƒ…å†µä¸‹çš„å¼‚å¸¸å¤„ç†æµç¨‹æ˜¯ä¸€æ ·çš„ã€‚</p>
<h2 id="2-å¦‚æœ-exit-å†…éƒ¨å¼‚å¸¸ï¼Ÿ"><a href="#2-å¦‚æœ-exit-å†…éƒ¨å¼‚å¸¸ï¼Ÿ" class="headerlink" title="2. å¦‚æœ__exit__å†…éƒ¨å¼‚å¸¸ï¼Ÿ"></a>2. å¦‚æœ<code>__exit__</code>å†…éƒ¨å¼‚å¸¸ï¼Ÿ</h2><p>å¼•ç”¨æ–‡ç« <a href="https://www.ibm.com/developerworks/cn/opensource/os-cn-pythonwith/index.html" target="_blank" rel="noopener">æµ…è°ˆ Python çš„ with è¯­å¥</a> ä¸­çš„è§£é‡Š:</p>
<blockquote>
<p>é€€å‡ºä¸ä¸Šä¸‹æ–‡ç®¡ç†å™¨ç›¸å…³çš„è¿è¡Œæ—¶ä¸Šä¸‹æ–‡ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼è¡¨ç¤ºæ˜¯å¦å¯¹å‘ç”Ÿçš„å¼‚å¸¸è¿›è¡Œå¤„ç†ã€‚å‚æ•°è¡¨ç¤ºå¼•èµ·é€€å‡ºæ“ä½œçš„å¼‚å¸¸ï¼Œå¦‚æœé€€å‡ºæ—¶æ²¡æœ‰å‘ç”Ÿå¼‚å¸¸ï¼Œåˆ™3ä¸ªå‚æ•°éƒ½ä¸ºNoneã€‚å¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œè¿”å›<br>True è¡¨ç¤ºä¸å¤„ç†å¼‚å¸¸ï¼Œå¦åˆ™ä¼šåœ¨é€€å‡ºè¯¥æ–¹æ³•åé‡æ–°æŠ›å‡ºå¼‚å¸¸ä»¥ç”± with è¯­å¥ä¹‹å¤–çš„ä»£ç é€»è¾‘è¿›è¡Œå¤„ç†ã€‚å¦‚æœè¯¥æ–¹æ³•å†…éƒ¨äº§ç”Ÿå¼‚å¸¸ï¼Œåˆ™ä¼šå–ä»£ç”± statement-body ä¸­è¯­å¥äº§ç”Ÿçš„å¼‚å¸¸ã€‚è¦å¤„ç†å¼‚å¸¸æ—¶ï¼Œä¸è¦æ˜¾ç¤ºé‡æ–°æŠ›å‡ºå¼‚å¸¸ï¼Œå³ä¸èƒ½é‡æ–°æŠ›å‡ºé€šè¿‡å‚æ•°ä¼ é€’è¿›æ¥çš„å¼‚å¸¸ï¼Œåªéœ€è¦å°†è¿”å›å€¼è®¾ç½®ä¸º False å°±å¯ä»¥äº†ã€‚ä¹‹åï¼Œä¸Šä¸‹æ–‡ç®¡ç†ä»£ç ä¼šæ£€æµ‹æ˜¯å¦ <strong>exit</strong>() å¤±è´¥æ¥å¤„ç†å¼‚å¸¸</p>
</blockquote>
<p>é€šè¿‡ä¾‹å­æ¥çœ‹ä¸€ä¸‹ï¼š</p>
<ul>
<li>withè¯­å¥å—å¼‚å¸¸ï¼Œä½†æ­£ç¡®é‡Šæ”¾èµ„æº</li>
</ul>
<p>æ¸…å•2: è‡ªå®šä¹‰æ”¯æŒ with è¯­å¥çš„å¯¹è±¡</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DummyResource</span>:</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(<span class="keyword">self</span>, tag)</span></span><span class="symbol">:</span></span><br><span class="line">    <span class="keyword">self</span>.tag = tag</span><br><span class="line">    print <span class="string">'Resource [%s]'</span> % tag</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__enter__</span><span class="params">(<span class="keyword">self</span>)</span></span><span class="symbol">:</span></span><br><span class="line">    print <span class="string">'[Enter %s]: Allocate resource.'</span> % <span class="keyword">self</span>.tag</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>   <span class="comment"># å¯ä»¥è¿”å›ä¸åŒçš„å¯¹è±¡</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__exit__</span><span class="params">(<span class="keyword">self</span>, exc_type, exc_value, exc_tb)</span></span><span class="symbol">:</span></span><br><span class="line">    print <span class="string">'[Exit %s]: Free resource.'</span> % <span class="keyword">self</span>.tag</span><br><span class="line">    <span class="keyword">if</span> exc_tb is <span class="symbol">None:</span></span><br><span class="line">        print <span class="string">'[Exit %s]: Exited without exception.'</span> % <span class="keyword">self</span>.tag</span><br><span class="line">    <span class="symbol">else:</span></span><br><span class="line">        print <span class="string">'[Exit %s]: Exited with exception raised.'</span> % <span class="keyword">self</span>.tag</span><br><span class="line">    <span class="keyword">return</span> False   <span class="comment"># å¯ä»¥çœç•¥ï¼Œç¼ºçœçš„Noneä¹Ÿæ˜¯è¢«çœ‹åšæ˜¯False</span></span><br></pre></td></tr></table></figure>
<p>æ¸…å•3: withè¯­å¥å—å¼•èµ·å¼‚å¸¸<br><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">try:</span><br><span class="line">    <span class="keyword">with</span> DummyResource(<span class="symbol">'With</span>-<span class="keyword">Exception</span>'):</span><br><span class="line">         print '[<span class="keyword">with</span>-<span class="keyword">body</span>] Run <span class="keyword">with</span> <span class="keyword">exception</span>.'</span><br><span class="line">         <span class="keyword">raise</span> <span class="keyword">Exception</span>(<span class="symbol">'with</span>-block <span class="keyword">exception</span>')</span><br><span class="line">         print '[<span class="keyword">with</span>-<span class="keyword">body</span>] Run <span class="keyword">with</span> <span class="keyword">exception</span>. Failed to finish statement-<span class="keyword">body</span>!'</span><br><span class="line">except <span class="keyword">Exception</span> as e:</span><br><span class="line">    print e</span><br></pre></td></tr></table></figure></p>
<p>æ‰§è¡Œä¸Šè¾¹çš„ä»£ç ï¼Œå¯ä»¥çœ‹åˆ°æ‰“å°çš„ä¿¡æ¯ï¼Œé‡Šæ”¾å®Œèµ„æºåï¼Œå¼‚å¸¸æŠ›å‡ºç»™withå¤–å±‚è¿›è¡Œå¤„ç†ï¼Œå¦‚æœå¤–å±‚æ²¡æœ‰<code>try</code>è¯­å¥çš„è¯ï¼Œåœ¨æœ¬ä¾‹ä¸­ä¼šç”±ç³»ç»Ÿæ‰“å°è°ƒç”¨æ ˆå¹¶é€€å‡ºã€‚<br>å¦‚æœ<code>__exit__</code>è¿”å›Trueï¼Œé‚£ä¹ˆæ‰“å°ä¿¡æ¯çš„æœ€åä¸€è¡Œ<code>with-block exception</code>å°†ä¸ä¼šè¢«æ‰“å°ï¼Œå› ä¸ºwithè¯­å¥é‡Šæ”¾å®Œèµ„æºåï¼ŒæŠŠè¿™ä¸ªå¼‚å¸¸â€œå‹â€ä¸‹æ¥äº†ã€‚<br>æ¸…å•4: æ­£å¸¸é‡Šæ”¾èµ„æºï¼ŒæŠ›å‡ºåŸæœ‰å¼‚å¸¸<br><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[Enter <span class="keyword">With</span>-<span class="keyword">Exception</span>]: Allocate resource.</span><br><span class="line">[<span class="keyword">with</span>-<span class="keyword">body</span>] Run <span class="keyword">with</span> <span class="keyword">exception</span>.</span><br><span class="line">[<span class="keyword">Exit</span> <span class="keyword">With</span>-<span class="keyword">Exception</span>]: Free resource.</span><br><span class="line">[<span class="keyword">Exit</span> <span class="keyword">With</span>-<span class="keyword">Exception</span>]: Exited <span class="keyword">with</span> <span class="keyword">exception</span> raised.</span><br><span class="line"><span class="keyword">with</span>-block <span class="keyword">exception</span></span><br></pre></td></tr></table></figure></p>
<p>ç¨å¾®å¯¹ä¸Šè¾¹çš„ä»£ç ä¿®æ”¹ä¸€ä¸‹ï¼Œåœ¨<code>__exit__</code>å‡½æ•°ä¸­é‡æ–°æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œå¦‚æ¸…å•5ï¼Œé‡æ–°æ‰§è¡Œæ¸…å•3çš„è°ƒç”¨ï¼Œå¾—åˆ°æ¸…å•6çš„ç»“æœã€‚<br>æ¸…å•5ï¼š<code>__exit__</code>æŠ›å‡ºå¼‚å¸¸<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__exit__</span><span class="params">(self, exc_type, exc_value, exc_tb)</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'[Exit %s]: Free resource.'</span> % self.tag</span><br><span class="line">    <span class="keyword">if</span> exc_tb <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">'[Exit %s]: Exited without exception.'</span> % self.tag</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">'[Exit %s]: Exited with exception raised.'</span> % self.tag</span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">'new exception in __exit__'</span>)</span><br></pre></td></tr></table></figure></p>
<p>æ¸…å•6: <code>__exit__</code>æŠ›å‡ºæ–°å¼‚å¸¸æ‰§è¡Œç»“æœ<br><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Resource [<span class="keyword">With</span>-<span class="keyword">Exception</span>]</span><br><span class="line">[Enter <span class="keyword">With</span>-<span class="keyword">Exception</span>]: Allocate resource.</span><br><span class="line">[<span class="keyword">with</span>-<span class="keyword">body</span>] Run <span class="keyword">with</span> <span class="keyword">exception</span>.</span><br><span class="line">[<span class="keyword">Exit</span> <span class="keyword">With</span>-<span class="keyword">Exception</span>]: Free resource.</span><br><span class="line">[<span class="keyword">Exit</span> <span class="keyword">With</span>-<span class="keyword">Exception</span>]: Exited <span class="keyword">with</span> <span class="keyword">exception</span> raised.</span><br><span class="line">__exit__ <span class="keyword">exception</span>.</span><br></pre></td></tr></table></figure></p>
<p>å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœ<code>__exit__</code>é‡æ–°æŠ›å‡ºäº†ä¸€ä¸ªå¼‚å¸¸ï¼Œå°±ä¼šè¦†ç›–æ‰åŸæœ‰å¼‚å¸¸ï¼Œå¦‚æœèµ„æºæ­£å¸¸é‡Šæ”¾ï¼Œåªéœ€è¦è¿”å›Falseæˆ–è€…Trueæ¥è¡¨ç¤ºæ˜¯å¦å°†withè¯­å¥çš„å¼‚å¸¸æŠ›ç»™å¤–å±‚è°ƒç”¨ã€‚</p>
<h2 id="3-å…¶ä»–ä½¿ç”¨"><a href="#3-å…¶ä»–ä½¿ç”¨" class="headerlink" title="3.å…¶ä»–ä½¿ç”¨"></a>3.å…¶ä»–ä½¿ç”¨</h2><p>ä½¿ç”¨contextmanagerè£…é¥°å™¨ã€nestedå‡½æ•°ã€closingä¸Šä¸‹æ–‡ç®¡ç†å™¨ç­‰è¯­æ³•å¯ä»¥å‚è€ƒ<br>ã€<a href="https://www.ibm.com/developerworks/cn/opensource/os-cn-pythonwith/index.html" target="_blank" rel="noopener">æµ…è°ˆ Python çš„ with è¯­å¥</a>ã€‘æˆ–è€… ã€<a href="https://docs.python.org/release/2.6.6/library/contextlib.html" target="_blank" rel="noopener">contextlib â€” Utilities for with-statement contexts</a>ã€‘ç­‰æ–‡ç« ï¼Œä¸å†èµ˜è¿°ã€‚</p>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ol>
<li><a href="https://www.ibm.com/developerworks/cn/opensource/os-cn-pythonwith/index.html" target="_blank" rel="noopener">æµ…è°ˆ Python çš„ with è¯­å¥</a></li>
<li><a href="https://docs.python.org/release/2.6.6/library/contextlib.html" target="_blank" rel="noopener">contextlib â€” Utilities for with-statement contexts</a></li>
<li><a href="https://www.python.org/dev/peps/pep-0343/" target="_blank" rel="noopener">PEP 343 â€“ The â€œwithâ€ Statement</a></li>
</ol>
]]></content>
      
        
        <tags>
            
            <tag> Python </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[å…³äºç›®å‰å·¥ä½œçš„ä¸€ç‚¹æ„Ÿæƒ³]]></title>
      <url>http://dequn.github.io/2017/11/21/%E5%85%B3%E4%BA%8E%E7%9B%AE%E5%89%8D%E5%B7%A5%E4%BD%9C%E7%9A%84%E4%B8%80%E7%82%B9%E6%84%9F%E6%83%B3/</url>
      <content type="html"><![CDATA[<p>ä»7æœˆä»½å…¥èŒä»¥æ¥ï¼Œæ—¶æ—¶æ„Ÿè§‰åˆ°ç›®å‰çš„å·¥ä½œè·Ÿæˆ‘æ‰€æœŸæœ›çš„å·®åˆ«å¾ˆå¤§ï¼Œä½†åˆä¸çŸ¥é“è¯¥å¦‚ä½•å–èˆã€‚</p>
<p>åœ¨é¢è¯•çš„æ—¶å€™ï¼Œç»ç†é—®æˆ‘æ˜¯å¦æ„¿æ„ä»äº‹ä¸€äº›äº§å“ç›¸å…³çš„å·¥ä½œï¼Œç”±äºæ˜¯å²—ä½æ˜¯æœºå™¨å­¦ä¹ ï¼Œæ‰€ä»¥æˆ‘æƒ³é‚£ä¹ˆå³ä½¿æ˜¯äº§å“ç›¸å…³ï¼Œæœ€èµ·ç ä¹Ÿæ˜¯è¦ç”¨åˆ°æœºå™¨å­¦ä¹ çš„ï¼Œä¸è®ºæ˜¯æ•°å­¦å±‚é¢ã€ç®—æ³•å±‚é¢è¿˜æ˜¯æ¶æ„å±‚é¢ï¼Œè¿™æ ·æ˜¯æ¯”è¾ƒç¬¦åˆæˆ‘çš„é¢„æœŸçš„ï¼Œæ‰€ä»¥å°±ç­¾åˆåŒå…¥èŒã€‚å¯æ˜¯å…¥èŒè¿™ä¹ˆä¹…ä»¥æ¥ï¼Œå‘ç°å½“åˆæ²¡æœ‰å¯¹å²—ä½åšæ›´å¤šçš„äº†è§£ï¼Œæ˜¯å¾ˆå¤§çš„ä¸€ä¸ªå‘ï¼Œè¿™ä¹Ÿæ˜¯æ ¡æ‹›çš„åŒå­¦æ™®éé‡åˆ°çš„ä¸€ä¸ªéš¾ç‚¹å’Œç—›ç‚¹ï¼Œé™¤éæ˜¯åœ¨å…¬å¸ä»¥åŠç»„å†…éƒ¨äº²è‡ªå®ä¹ è¿‡ã€‚</p>
<p>å€’ä¸æ˜¯è¯´è¿™å‡ ä¸ªæœˆæ¥æ²¡æœ‰æˆé•¿ï¼Œè€Œæ˜¯åœ¨æˆ‘æ‰€æœŸæœ›çš„æŠ€æœ¯ä»¥åŠèƒ½åŠ›å±‚é¢ä¸Šæ”¶æ•ˆç”šå°‘ã€‚é™¤äº†ç»´æŠ¤ä¸€äº›é—ç•™ä¸‹æ¥çš„æ—§äº§å“æ¨¡å—å„¿ï¼Œå°±åªå‰©ä¸‹ä¸€ä¸ªçƒ­è¯äº†ã€‚åœ¨å…¥èŒä»¥åï¼Œæˆ‘ä¹Ÿä¸å¾—ä¸æ‰¿è®¤è‡ªå·±ä¸ç§‘ç­å‡ºèº«çš„åŒå­¦å·®è·æ¯”è¾ƒå¤§ï¼ŒåŒæ ·çš„ä¸€ä¸ªä¸œè¥¿æˆ‘å¯èƒ½éœ€è¦å­å“§å¥½ä¹…ï¼Œä½†æ˜¯é™¤äº†ä¸€äº›ä¸šåŠ¡ä¸Šçš„ç†Ÿæ‚‰ä¹‹å¤–ï¼Œæ²¡æœ‰å¾—åˆ°æ›´å¤šæˆ‘æƒ³è¦çš„æˆé•¿äº†ï¼Œè€Œä¸šåŠ¡ä¸Šçš„ä¸œè¥¿æ˜¯å¸¦ä¸èµ°çš„ï¼Œè™½ç„¶ç†Ÿæ‚‰å…¬å¸å†…éƒ¨çš„ä¸šåŠ¡å¾ˆé‡è¦ã€‚</p>
<p>åŸæœ¬ä¹Ÿæƒ³ç€èº«å¤„ä¸€ä¸ªå›½å†…ç›¸å¯¹è¾ƒå¥½çš„æŠ€æœ¯ç¯å¢ƒå†…ï¼Œå†åŠ ä¸Šè‡ªå·±çš„å­¦ä¹ ï¼Œè‚¯å®šèƒ½è¿›æ­¥ç‰¹åˆ«å¤šã€‚ç°åœ¨çœ‹æ¥ä¹Ÿæ˜¯å¤ªå¤©çœŸäº†ï¼Œå›¢é˜ŸæŠ€æœ¯æ˜¯ä¸é”™ï¼Œæ¯ä¸¤å‘¨ä¹Ÿä¼šæœ‰åˆ†äº«ï¼Œè¿™äº›ä¹Ÿéƒ½æ˜¯æœ‰ç”¨çš„ï¼Œä½†æ˜¯æ”¶æ•ˆä¹Ÿå°‘ã€‚æœ€ä¸ºæ‹…å¿ƒçš„äº‹æƒ…æ˜¯æ ¹æœ¬å°±æ²¡æœ‰è‡ªå·±çš„äº‹ä»¶ï¼Œæ¯å¤©é†’æ¥ä¸Šç­çŸ¥é“æ™šä¸Šå›å»ï¼Œéœ€æ±‚ç‰¹åˆ«å¤šï¼Œæƒ³åœ¨è‡ªå·±çš„æ–¹å‘ä¸Šè¿›è¡Œä¸€äº›ç§¯ç´¯å°±æ˜¾å¾—æ¬²æ±‚æ— é—¨äº†ã€‚æˆ‘å±‚æ€€ç–‘å…¬å¸å†…éƒ¨éƒ½æ˜¯è¿™ä¹ˆå¿™çš„ï¼Œå’Œä¸€ä¸ªä»åˆ«çš„ç»„è½¬å²—è¿‡æ¥çš„åŒå­¦ï¼Œä»–è¯´ä»–ä»¬åŸæ¥çš„ç»„æ²¡æœ‰è¿™è¾¹äº‹æƒ…è¿™ä¹ˆå¤šï¼Œæ¯å¤©è¿˜æ˜¯æœ‰å¾ˆå¤šè‡ªå·±å­¦ä¹ ã€ç§¯ç´¯çš„æ—¶é—´ï¼Œåªæœ‰å¤§æœæ‰è¿™ä¹ˆå¿™ã€‚</p>
<p>æ€»è¯´æ—¶é—´æ˜¯æµ·ç»µé‡Œçš„æ°´ï¼Œä¸Šé«˜ä¸­æ—¶ç­ä¸»ä»»ä¹Ÿç»å¸¸è¯´æˆ‘å°±æ˜¯äººå¤ªæ‡’ï¼Œå½“æ—¶è¿˜å¾ˆä¸æœæ°”â€”â€”è‡ªè§‰è¿˜ä¸é”™ã€‚ç°åœ¨å›æƒ³èµ·æ¥ï¼Œæˆ‘çš„è‡ªåˆ¶åŠ›ç¡®å®å¾ˆå¼±ï¼Œæ¯”å¦‚ä¸‹ç­ä¹‹åæˆ‘æ˜¯çœ‹ä¸è¿›å»ä»»ä½•ä¸œè¥¿çš„ï¼ˆå°¤å…¶æ˜¯ç°åœ¨ï¼‰ï¼Œåœ¨å‘¨å…­æ—¥çš„æ—¶å€™ä¸€ä¸ªæ‡’è§‰å°±å ç”¨äº†å¾ˆå¤šæ—¶é—´ã€‚ä¹Ÿå¯èƒ½æ˜¯æˆ‘å¿˜è®°äº†ã€æ”¾å¼ƒäº†æ›¾ç»æƒ³è¦çš„ï¼ŒæŒ‰ç°åœ¨è¿™ç§çŠ¶æ€ä¸‹å»ä¹Ÿå¿…å®šåªèƒ½æ”¾å¼ƒï¼Œç‰¹åˆ«ç¾¡æ…•é‚£äº›èƒ½å¤Ÿç™½å¤©é«˜æ•ˆå·¥ä½œã€æ™šä¸Šä»èƒ½åšæŒå……ç”µçš„ç‰›äººã€‚è¿˜æœ‰å°±æ˜¯ç™½å¤©çš„æ•ˆç‡ä¹Ÿä¸é«˜ï¼Œæ€»è§‰å¾—åƒæ˜¯è¢«KPIæ¨åŠ¨çš„èµ°ï¼Œæ²¡æœ‰ä¸»åŠ¨æ€§äº†ã€‚</p>
<p>å¦‚æœè¿™æ ·ä¹…äº†ï¼Œå°±æ²¡æœ‰è·³å‡ºç°æœ‰ç”Ÿæ´»çš„åŠ¨åŠ›å’Œèƒ½åŠ›äº†ï¼›å¦‚æœç°åœ¨å°±è·³å‡ºæ¥ï¼Œä¹Ÿæ²¡æœ‰é‚£ä¸ªèƒ½åŠ›ï¼Œæ›´æ˜¯ä¸èƒ½åˆ©ç”¨å¥½ç›®å‰è¿™æ ·ä¸€ä¸ªå¹³å°ã€‚å› æ­¤ï¼Œè¿˜å¾—å¿…é¡»è‡ªåˆ¶è‡ªå¾‹ï¼Œåƒå¾—è‹¦ä¸­è‹¦ï¼Œæ–¹è§‰ä¸çŸ¥è‹¦ã€‚</p>
<p>éƒ½è¯´ä¸å¿˜åˆå¿ƒï¼Œæ–¹å¾—å§‹ç»ˆã€‚åˆå¿ƒæ˜¯ä»€ä¹ˆåƒä¸‡ä¸èƒ½å¿˜è®°ï¼Œè€Œä¸ºäº†åˆå¿ƒï¼Œä¹Ÿå®šè¦ä»˜å‡ºæ›´å¤šæ‰è¡Œï¼</p>
]]></content>
      
        <categories>
            
            <category> ä¸ªäººæ—¥è®° </category>
            
        </categories>
        
        
        <tags>
            
            <tag> å·¥ä½œä¸åˆå¿ƒ </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Pythonå­—ç¬¦ä¸²æ ¼å¼åŒ–]]></title>
      <url>http://dequn.github.io/2017/10/05/python-str-formation/</url>
      <content type="html"><![CDATA[<p>ä½¿ç”¨Pythonçš„æ—¶é—´ä¹Ÿä¸çŸ­äº†ï¼Œå¯æ˜¯å¯¹å­—ç¬¦ä¸²æ ¼å¼åŒ–çš„æ–¹å¼è¿˜æ˜¯ä¸æ€ä¹ˆäº†è§£ï¼Œå°¤å…¶æ˜¯å¯¹äºè‡ªå®šä¹‰ç±»å‹ï¼Œå¦‚ä½•å®ç°å‹å¥½çš„æ ¼å¼åŒ–è¾“å‡ºï¼Ÿ</p>
<p>printf-styleçš„å­—ç¬¦ä¸²æ ¼å¼åŒ–â€%â€å·æ“ä½œç¬¦çš„ä½¿ç”¨æ–¹æ³•å°±ä¸å†èµ˜è¿°äº†ï¼Œå¦‚æœâ€%â€åé¢ä¸æ­¢ä¸€ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆéœ€è¦ä¼ å…¥ä¸€ä¸ªtupleï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªdictã€‚</p>
<p>ç”±äºâ€%â€ä½¿ç”¨å¹¶ä¸æ˜¯é‚£ä¹ˆæ–¹ä¾¿ï¼Œåœ¨édictå‚æ•°çš„æƒ…å†µä¸‹ï¼Œtupleéœ€è¦æŒ‰ç…§é¡ºåºç»„ç»‡ï¼Œå¹¶ä¸”åŒä¸€ä¸ªå‚æ•°ä¸èƒ½å¤Ÿå¤šæ¬¡ä½¿ç”¨[<a href="https://mail.python.org/pipermail/python-3000/2006-April/000285.html" title="[Python-3000] String formating operations in python 3k" target="_blank" rel="noopener">1</a>]ã€‚äºæ˜¯å°±æå‡ºäº†ä½¿ç”¨æ¨¡æ¿è¿›è¡Œå­—ç¬¦ä¸²æ ¼å¼åŒ–çš„æ–¹æ³•[<a href="https://www.python.org/dev/peps/pep-3101/#id9" title="PEP 3101 -- Advanced String Formatting" target="_blank" rel="noopener">2</a>]ã€‚è¿™ä¸¤ç§æ–¹æ³•æœ‰åœ¨åŠŸèƒ½ä¸Šæœ‰ä¸€å®šçš„é‡å¤ï¼Œå¦‚ä½•é€‰æ‹©ä¹Ÿå…¨çœ‹ä¸ªäººå–œå¥½ã€‚</p>
<p>ç›¸å¯¹æ¥è¯´ï¼Œæ¨¡æ¿æ ¼å¼åŒ–å­—ç¬¦ä¸²åŠŸèƒ½æ›´ä¸ºå¼ºå¤§å’Œçµæ´»ï¼Œå…¶è¯­æ³•å¯ä»¥å‚è€ƒ[<a href="https://docs.python.org/3/library/string.html#formatstrings" title="string â€” Common string operations" target="_blank" rel="noopener">3</a>]ï¼Œä¸‹é¢ä¸»è¦å…³æ³¨è‡ªå®šä¹‰ç±»çš„æ ¼å¼åŒ–æ˜¾ç¤ºã€‚</p>
<ul>
<li>åœ¨ä½¿ç”¨â€%â€æ“ä½œç¬¦æ—¶ï¼Œåé¢çš„è½¬æ¢å­—ç¬¦ä»£è¡¨çš„å«ä¹‰[<a href="https://docs.python.org/3/library/stdtypes.html#string-formatting-operations" target="_blank" rel="noopener">4</a>]:<blockquote>
<p>  â€˜râ€™ String (converts any Python object using repr()).<br>  â€˜sâ€™    String (converts any Python object using str()).<br>  â€˜aâ€™    String (converts any Python object using ascii()).</p>
</blockquote>
</li>
</ul>
<p>å¯¹åº”çš„ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰è‡ªå®šä¹‰ç±»çš„<code>__repr__()</code>ã€<code>__str__()</code> æ¥å®ç°æ ¼å¼åŒ–è¾“å‡ºï¼ˆ<code>ascii()</code>åŒ<code>repr()</code>ä¸€æ ·è°ƒç”¨<code>__repr__()</code>ï¼Œä½†ä¼šå¯¹non-ASCIIå­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼Œç»“æœå½¢å¦‚\x, \u, \Uç­‰[<a href="https://docs.python.org/3/library/functions.html#ascii" title="Built-in Functions" target="_blank" rel="noopener">5</a>]ï¼‰ã€‚</p>
<ul>
<li>ä½¿ç”¨æ¨¡æ¿æ ¼å¼åŒ–æ—¶ï¼Œæˆ‘ä»¬é™¤äº†å¯ä»¥ä½¿ç”¨å†…ç½®çš„<code>!s</code>ã€<code>!r</code>ã€<code>!a</code>è½¬æ¢å®ç°ä¸ä¸Šè¾¹ç›¸åŒçš„æ•ˆæœå¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡å®šä¹‰ç±»çš„<code>__format__</code>å®ç°è‡ªå®šä¹‰æ ¼å¼åŒ–æ–¹æ³•ï¼Œè¿™æ ·å°±éå¸¸çµæ´»äº†ï¼Œçº¿é¢é€šè¿‡ä¾‹å­æ¥çœ‹ä¸€ä¸‹ã€‚</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line">class Test:</span><br><span class="line"></span><br><span class="line">    def __str__(self):</span><br><span class="line">        <span class="built_in">return</span> <span class="string">'in __str__()'</span></span><br><span class="line"></span><br><span class="line">    def __format__(self, format_spec):</span><br><span class="line">        <span class="keyword">if</span> format_spec == <span class="string">'own1'</span>:</span><br><span class="line">            <span class="built_in">return</span> <span class="string">'in __format__(), own1 method'</span></span><br><span class="line">        <span class="keyword">elif</span> format_spec == <span class="string">'s'</span>:</span><br><span class="line">            <span class="built_in">return</span> <span class="string">'in __format__(), s method'</span></span><br><span class="line">        <span class="keyword">elif</span> format_spec == <span class="string">'h'</span>:</span><br><span class="line">            <span class="built_in">return</span> <span class="string">'in __format__(), h method'</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">return</span> <span class="string">'in __format__(), default method'</span></span><br><span class="line"></span><br><span class="line">    def __repr__(self):</span><br><span class="line">        <span class="built_in">return</span> <span class="string">'in __repr__()'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line"></span><br><span class="line">    <span class="built_in">test</span> = Test()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span> <span class="string">'str(test) shows '</span> + str(<span class="built_in">test</span>)</span><br><span class="line">    <span class="built_in">print</span> <span class="string">'repr(test) shows '</span> + repr(<span class="built_in">test</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span> <span class="string">'\n-----------% format ----------'</span></span><br><span class="line">    <span class="built_in">print</span> <span class="string">'%%s shows %s'</span> % <span class="built_in">test</span></span><br><span class="line">    <span class="built_in">print</span> <span class="string">'%%r shows %r'</span> % <span class="built_in">test</span></span><br><span class="line">    <span class="comment"># print '%%h shows %h' % test # will cause  ValueError: incomplete format</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span> <span class="string">'\n---------template format --------'</span></span><br><span class="line">    <span class="built_in">print</span> <span class="string">'&#123;&#123;&#125;&#125; shows &#123;&#125;'</span>.format(<span class="built_in">test</span>)</span><br><span class="line">    <span class="built_in">print</span> <span class="string">'&#123;&#123;!r&#125;&#125; shows &#123;!r&#125;'</span>.format(<span class="built_in">test</span>)</span><br><span class="line">    <span class="built_in">print</span> <span class="string">'&#123;&#123;!s&#125;&#125; shows &#123;!s&#125;'</span>.format(<span class="built_in">test</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span> <span class="string">'\n---------template use __format__() --------'</span></span><br><span class="line">    <span class="built_in">print</span> <span class="string">'&#123;&#123;:s&#125;&#125; shows &#123;:s&#125;'</span>.format(<span class="built_in">test</span>) <span class="comment"># use __format__ s conversion</span></span><br><span class="line">    <span class="built_in">print</span> <span class="string">'&#123;&#123;:h&#125;&#125; shows &#123;:h&#125;'</span>.format(<span class="built_in">test</span>) <span class="comment"># use __format__ h conversion</span></span><br><span class="line">    <span class="built_in">print</span> <span class="string">'&#123;&#123;:own1&#125;&#125; shows &#123;:own1&#125;'</span>.format(<span class="built_in">test</span>) <span class="comment"># use __format__ own1 conversion</span></span><br><span class="line">    <span class="built_in">print</span> <span class="string">'&#123;&#123;:&#125;&#125; shows &#123;:&#125;'</span>.format(<span class="built_in">test</span>) <span class="comment"># use __format__ default conversion</span></span><br></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">str(test) shows <span class="keyword">in</span> __str__()</span><br><span class="line">repr(test) shows <span class="keyword">in</span> __repr__()</span><br><span class="line"></span><br><span class="line">-----------% format ----------</span><br><span class="line">%s shows <span class="keyword">in</span> __str__()</span><br><span class="line">%r shows <span class="keyword">in</span> __repr__()</span><br><span class="line"></span><br><span class="line">---------template format --------</span><br><span class="line">&#123;&#125; shows <span class="keyword">in</span> __format__(),<span class="built_in"> default </span>method</span><br><span class="line">&#123;!r&#125; shows <span class="keyword">in</span> __repr__()</span><br><span class="line">&#123;!s&#125; shows <span class="keyword">in</span> __str__()</span><br><span class="line"></span><br><span class="line">---------template use __format__() --------</span><br><span class="line">&#123;:s&#125; shows <span class="keyword">in</span> __format__(), s method</span><br><span class="line">&#123;:h&#125; shows <span class="keyword">in</span> __format__(), h method</span><br><span class="line">&#123;:own1&#125; shows <span class="keyword">in</span> __format__(), own1 method</span><br><span class="line">&#123;:&#125; shows <span class="keyword">in</span> __format__(),<span class="built_in"> default </span>method</span><br></pre></td></tr></table></figure>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>å¦‚æœåªæ˜¯å®ç°ç®€å•çš„æ ¼å¼åŒ–ï¼Œé‚£ä¹ˆâ€%â€å’Œæ¨¡æ¿éƒ½å¯ä»¥å®ç°ï¼Œè‡ªå®šä¹‰ç±»é€šè¿‡å®šä¹‰<code>__str__()</code>å’Œ<code>__repr__()</code>æ¥å®ç°ï¼Œä½†å¦‚æœéœ€è¦å¯¹ä¸€ä¸ªç±»å®ç°ï¼ˆå¤šç§ï¼‰è‡ªå®šä¹‰è½¬æ¢çš„æ ¼å¼åŒ–ï¼Œé‚£ä¹ˆéœ€è¦å®šä¹‰ç±»çš„<code>__format__()</code>æ–¹æ³•ï¼Œå¹¶ä¸”åªèƒ½é€šè¿‡ä½¿ç”¨æ¨¡æ¿æ¥å®ç°è‡ªå®šä¹‰è½¬æ¢çš„æ ¼å¼åŒ–ã€‚</p>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ol>
<li><a href="https://mail.python.org/pipermail/python-3000/2006-April/000285.html" title="[Python-3000] String formating operations in python 3k" target="_blank" rel="noopener">[Python-3000] String formating operations in python 3k</a></li>
<li><a href="https://www.python.org/dev/peps/pep-3101/#id9" title="PEP 3101 -- Advanced String Formatting" target="_blank" rel="noopener">PEP 3101 â€“ Advanced String Formatting</a></li>
<li><a href="https://docs.python.org/3/library/string.html#formatstrings" title="string â€” Common string operations" target="_blank" rel="noopener">string â€” Common string operations</a></li>
<li><a href="https://docs.python.org/3/library/stdtypes.html#string-formatting-operations" target="_blank" rel="noopener">https://docs.python.org/3/library/stdtypes.html#string-formatting-operations</a></li>
<li><a href="https://docs.python.org/3/library/functions.html#ascii" title="Built-in Functions" target="_blank" rel="noopener">Built-in Functions</a></li>
</ol>
]]></content>
      
        <categories>
            
            <category> Python </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Python </tag>
            
            <tag> æ ¼å¼åŒ– </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Pythonæ¨¡å—çš„ç›¸å¯¹å¯¼å…¥å’Œç»å¯¹å¯¼å…¥]]></title>
      <url>http://dequn.github.io/2017/09/17/ways-of-python-import/</url>
      <content type="html"><![CDATA[<p>åˆšå¼€å§‹ç”¨Pythonå†™ä»£ç ï¼Œå¯¹äºimportçš„æ–¹å¼ä¸æ˜¯å¾ˆç†è§£ï¼Œå°¤å…¶æ˜¯å¯¼å…¥ä¸Šå±‚åŒ…çš„æ¨¡å—æ—¶ï¼Œç»å¸¸ä¼šä½¿ç”¨<code>sys.path.append(&#39;..&#39;)</code>ï¼Œç„¶åå†importï¼Œå¾ˆä¸ä¼˜é›…ï¼Œæ‰€ä»¥èŠ±äº›æ—¶é—´å…¨éƒ¨æ¢³ç†ä¸€éã€‚</p>
<p>é¦–å…ˆéœ€è¦æ˜ç™½æ˜ç™½ä¸¤ä¸ªæ¦‚å¿µ<strong>åŒ…</strong>å’Œ<strong>æ¨¡å—</strong>ï¼Œå¾ˆå¤šäººä¹Ÿéƒ½äº†è§£ï¼Œè´´å‡º<a href="http://www.runoob.com/python/python-modules.html" title="http://www.runoob.com/python/python-modules.html" target="_blank" rel="noopener">runoob</a>ï¼ˆé¡µé¢è·ŸW3Cå¥½åƒï¼Œä»–ä»¬æœ‰ä»€ä¹ˆå…³ç³»å—ï¼Ÿï¼‰ä¸Šç»™å‡ºçš„ä¸¤ä¸ªå®šä¹‰ã€‚</p>
<ul>
<li><p>æ¨¡å—</p>
<blockquote>
<p>Python æ¨¡å—(Module)ï¼Œæ˜¯ä¸€ä¸ª Python æ–‡ä»¶ï¼Œä»¥ .py ç»“å°¾ï¼ŒåŒ…å«äº† Python å¯¹è±¡å®šä¹‰å’ŒPythonè¯­å¥ã€‚<br>æ¨¡å—è®©ä½ èƒ½å¤Ÿæœ‰é€»è¾‘åœ°ç»„ç»‡ä½ çš„ Python ä»£ç æ®µã€‚<br>æŠŠç›¸å…³çš„ä»£ç åˆ†é…åˆ°ä¸€ä¸ªæ¨¡å—é‡Œèƒ½è®©ä½ çš„ä»£ç æ›´å¥½ç”¨ï¼Œæ›´æ˜“æ‡‚ã€‚<br>æ¨¡å—èƒ½å®šä¹‰å‡½æ•°ï¼Œç±»å’Œå˜é‡ï¼Œæ¨¡å—é‡Œä¹Ÿèƒ½åŒ…å«å¯æ‰§è¡Œçš„ä»£ç ã€‚</p>
</blockquote>
</li>
<li><p>åŒ…</p>
<blockquote>
<p>åŒ…æ˜¯ä¸€ä¸ªåˆ†å±‚æ¬¡çš„æ–‡ä»¶ç›®å½•ç»“æ„ï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ªç”±æ¨¡å—åŠå­åŒ…ï¼Œå’Œå­åŒ…ä¸‹çš„å­åŒ…ç­‰ç»„æˆçš„ Python çš„åº”ç”¨ç¯å¢ƒã€‚<br>ç®€å•æ¥è¯´ï¼ŒåŒ…å°±æ˜¯æ–‡ä»¶å¤¹ï¼Œä½†è¯¥æ–‡ä»¶å¤¹ä¸‹å¿…é¡»å­˜åœ¨ <code>__init__.py</code> æ–‡ä»¶, è¯¥æ–‡ä»¶çš„å†…å®¹å¯ä»¥ä¸ºç©ºã€‚<code>__int__.py</code>ç”¨äºæ ‡è¯†å½“å‰æ–‡ä»¶å¤¹æ˜¯ä¸€ä¸ªåŒ…ã€‚</p>
</blockquote>
</li>
</ul>
<p>ä»é¡¶å±‚æ¨¡å—ï¼ˆsys.pathï¼‰æˆ–è€…å½“å‰çš„åŒ…ä¸­å¯¼å…¥æ¨¡å—ï¼Œä½¿ç”¨<code>import module</code>æˆ–è€…<code>from module import xxx</code>çš„æ–¹å¼å°±ä¸å†èµ˜è¿°ï¼Œä¸è¿‡æœ‰ä¸€ç§ä½¿ç”¨æ‹¬å·è¿›è¡Œçš„å¤šæ¨¡å—å¯¼å…¥æ–¹å¼ï¼Œå¦‚ï¼š<br><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">from</span> from <span class="type">Tkinter</span> <span class="keyword">import</span> (<span class="type">Tk</span>, <span class="type">Frame</span>, <span class="type">Button</span>, <span class="type">Entry</span>, <span class="type">Canvas</span>, <span class="type">Text</span>,</span><br><span class="line">    <span class="type">LEFT</span>, <span class="type">DISABLED</span>, <span class="type">NORMAL</span>, <span class="type">RIDGE</span>, <span class="type">END</span>)</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ ·å¯ä»¥é¿å…ä½¿ç”¨åæ–œæ ç»­è¡Œï¼Œç¨å¾®ä¼˜é›…ä¸€äº›ï¼Œå¤šè¡Œçš„å­—ç¬¦ä¸²ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€æ ·çš„æ‹¬å·è¯­æ³•å®ç°ã€‚è®°ä½ï¼Œ<code>from module import *</code>æ˜¯ç»å¯¹çš„ä¸æ¨èçš„ï¼Œä¼šæ„å¤–åœ°â€œæ±¡æŸ“â€å‘½åç©ºé—´ã€‚</p>
<p><strong>ç›¸å¯¹å¯¼å…¥å’Œç»å¯¹å¯¼å…¥</strong>æ˜¯è¿™æ¬¡è®¨è®ºçš„é‡ç‚¹ï¼Œåœ¨é¡¹ç›®ä¸­ï¼Œè‚¯å®šä¸æ„å¤–åœ°ä¼šå»ºç«‹ä¸åŒå±‚çº§å’Œç»“æ„å…³ç³»çš„åŒ…ï¼Œé‚£ä¹ˆåœ¨è¿™äº›åŒ…ä¹‹é—´ï¼Œæˆ‘ä»¬åˆåº”è¯¥å¦‚ä½•å¯¼å…¥è¦å¼•ç”¨çš„æ¨¡å—ï¼Ÿ</p>
<h1 id="ç»å¯¹å¯¼å…¥"><a href="#ç»å¯¹å¯¼å…¥" class="headerlink" title="ç»å¯¹å¯¼å…¥"></a>ç»å¯¹å¯¼å…¥</h1><p>åœ¨Python 2.4ä¹‹å‰ï¼Œå¦‚æœä½¿ç”¨äº†<code>import foo</code>ï¼Œå¦‚æœå½“å‰åŒ…å†…ä¹Ÿæœ‰ä¸€ä¸ªæ¨¡å—fooï¼Œç”±äºè§£é‡Šå™¨æ˜¯ä¸çŸ¥é“ä½ å¯¼å…¥çš„æ˜¯é¡¶å±‚æ¨¡å—è¿˜æ˜¯å½“å‰åŒ…å†…çš„æ¨¡å—ï¼Œæ ¹æ®æ¨¡å—å¯»æ‰¾åŠ è½½çš„é¡ºåº[]ï¼Œå½“å‰åŒ…å†…çš„fooæ¨¡å—å°±ä¼šè¦†ç›–æ‰é¡¶å±‚çš„fooæ¨¡å—ï¼Œè€Œå¯èƒ½å¼•èµ·ä¸å¿…è¦çš„æ­§ä¹‰ã€‚äºæ˜¯è¦æ±‚fooå¿…é¡»æ˜¯åœ¨sys.pathä¸­èƒ½å¤Ÿå¯»åˆ°çš„æ¨¡å—æˆ–åŒ…ï¼Œè¿™å°±æ˜¯ç»å¯¹å¯¼å…¥çš„å®šä¹‰ã€‚python-dev ç¤¾åŒºé€‰æ‹©å°†ç»å¯¹å¯¼å…¥ä½œä¸ºé»˜è®¤å¯¼å…¥çš„æ–¹å¼ï¼Œä¸€æ¥æ˜¯å› ä¸ºæ›´å¸¸ç”¨ï¼ŒäºŒæ˜¯å› ä¸ºç»å¯¹å¯¼å…¥å¯ä»¥æä¾›ç›¸å¯¹å¯¼å…¥çš„å…¨éƒ¨åŠŸèƒ½.</p>
<p>åœ¨Python 2.5 å’Œ 2.6ä¸­ï¼Œç»å¯¹å¯¼å…¥æ˜¯å¯é€‰çš„ï¼Œéœ€è¦åœ¨æ–‡ä»¶å¼€å¤´æ·»åŠ <code>from __future__ import absolute_import</code>æ¥å®ç°é»˜è®¤çš„ç»å¯¹å¯¼å…¥ã€‚</p>
<h1 id="ç›¸å¯¹å¯¼å…¥"><a href="#ç›¸å¯¹å¯¼å…¥" class="headerlink" title="ç›¸å¯¹å¯¼å…¥"></a>ç›¸å¯¹å¯¼å…¥</h1><p>ç›¸å¯¹å¯¼å…¥æ˜¯æ ¹æ®æ¨¡å—çš„<code>__name__</code>å±æ€§æ¥å†³å®šæ¨¡å—çš„ä½ç½®ï¼Œç„¶åè®¡ç®—ç›¸å¯¹è·¯å¾„ï¼Œåœ¨åŒä¸€ä¸ªé¡¹ç›®ç›¸é‚»å±‚çº§çš„åŒ…å’Œæ¨¡å—ä¸­æœ€ä¸ºå¸¸ç”¨ï¼Œä¹Ÿæœ€ä¸ºæ–¹ä¾¿ã€‚å…³äºç›¸å¯¹å¯¼å…¥çš„è¯­æ³•å®ç°æ¨¡å¼ï¼Œæœ‰ä¸€ä¸ªå¾ˆæœ‰è¶£ä¹Ÿå¾ˆå¹¿æ³›çš„è®¨è®ºï¼Œçœ‹ç€é‚£äº›å…ˆé©±å¼€å‘è€…çš„è®¨è®ºï¼Œæ”¶è·ä¹Ÿæ˜¯è›®å¤šçš„ï¼Œæ„Ÿå…´è¶£çš„å‚è€ƒ<a href="https://www.python.org/dev/peps/pep-0328/" title="PEP 328 -- Imports: Multi-Line and Absolute/Relative" target="_blank" rel="noopener">PEP 328 â€“ Imports: Multi-Line and Absolute/Relative</a>ã€‚æœ€åï¼ŒGuidoé‡‡ç”¨â€.â€å‰ç¼€è¡¨ç¤ºç›¸å¯¹å¯¼å…¥ï¼Œå’ŒUnixç³»ç»Ÿä¸­çš„ç›®å½•è¡¨ç¤ºå«ä¹‰ä¸€æ ·ï¼Œä¸€ä¸ªâ€.â€è¡¨ç¤ºå½“å¹´å±‚çº§ï¼Œå¤šä¸€ä¸ªå°±è¡¨ç¤ºå‘ä¸Šä¸€å±‚ã€‚ä¸‹é¢æ˜¯ä¸€äº›ä¾‹å­ï¼š<br><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> .moduleY <span class="keyword">import</span> spam</span><br><span class="line"><span class="keyword">from</span> .moduleY <span class="keyword">import</span> spam <span class="keyword">as</span> ham</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> moduleY</span><br><span class="line"><span class="keyword">from</span> ..subpackage1 <span class="keyword">import</span> moduleY</span><br><span class="line"><span class="keyword">from</span> ..subpackage2.moduleZ <span class="keyword">import</span> eggs</span><br><span class="line"><span class="keyword">from</span> ..moduleA <span class="keyword">import</span> foo</span><br><span class="line"><span class="keyword">from</span> ...package <span class="keyword">import</span> bar</span><br><span class="line"><span class="keyword">from</span> ...sys <span class="keyword">import</span> path</span><br></pre></td></tr></table></figure></p>
<h1 id="åŒºåˆ«"><a href="#åŒºåˆ«" class="headerlink" title="åŒºåˆ«"></a>åŒºåˆ«</h1><p>ç›¸å¯¹å¯¼å…¥å¿…é¡»ä½¿ç”¨ <code>from .&lt;&gt; import xxx</code>(å¹¶ä¸”è‡³å°‘å«æœ‰ä¸€ä¸ª.ç¬¦å·)çš„æ¨¡å¼ï¼Œ<code>import &lt;&gt;</code>æ€»æ˜¯ç»å¯¹å¯¼å…¥ï¼Œå½“ç„¶ï¼Œå¦‚æœ<code>from &lt;&gt; import</code>ä¸­æ²¡æœ‰å¥ç‚¹ï¼Œé‚£ä¹ˆä¹Ÿæ˜¯ç»å¯¹å¯¼å…¥ã€‚ä½†æ˜¯ç±»ä¼¼<code>import .foo</code>çš„æ–¹å¼æ˜¯éåˆæ³•è¯­å¥ï¼Œå› ä¸º<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import XXX<span class="selector-class">.YYY</span><span class="selector-class">.ZZZ</span></span><br></pre></td></tr></table></figure></p>
<p>çš„<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XXX<span class="selector-class">.YYY</span><span class="selector-class">.ZZZ</span></span><br></pre></td></tr></table></figure></p>
<p>æ˜¯å¯ç”¨çš„è¡¨è¾¾å¼ï¼Œè€Œ<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> .moduleY</span><br></pre></td></tr></table></figure></p>
<p>çš„<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">.moduleY</span></span><br></pre></td></tr></table></figure></p>
<p>ä¸æ˜¯ä¸€ä¸ªå¯ç”¨çš„è¡¨è¾¾å¼ã€‚</p>
<h1 id="å¦‚ä½•é€‰æ‹©"><a href="#å¦‚ä½•é€‰æ‹©" class="headerlink" title="å¦‚ä½•é€‰æ‹©"></a>å¦‚ä½•é€‰æ‹©</h1><p>ä½¿ç”¨ç›¸å¯¹å¯¼å…¥è¿˜æ˜¯ç»å¯¹å¯¼å…¥ï¼Œå¯ä»¥å®Œå…¨å‡­ä¸ªäººå–œå¥½ã€‚ä½†æ˜¯ä¸ºäº†ä»£ç çš„å¯é˜…è¯»æ€§ï¼Œä¸€èˆ¬çš„å…±è¯†æ˜¯ä¸è¶…è¿‡ä¸¤å±‚çš„å±‚çº§å¯ä»¥ä½¿ç”¨ç›¸å¯¹å¯¼å…¥ï¼Œè¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœæœ‰è¶…è¿‡3ä¸ªçš„â€.â€ï¼Œè¿˜èƒ½å¤Ÿæ­£ç¡®å¿«é€Ÿåœ°çŸ¥é“å‘ä¸Šåˆ°äº†å“ªä¸ªå±‚çº§å—?è¿™ä¸ªæ—¶å€™ä½¿ç”¨ç»å¯¹å¯¼å…¥ä¼šæ›´åŠ æ–¹ä¾¿ï¼Œä»£ç ä¹Ÿæ›´å¥½ç»´æŠ¤ã€‚ä¸è®ºå“ªä¸€ç§å¯¼å…¥æ–¹å¼ï¼Œä¹Ÿéƒ½ä¼šæœ‰é‡æ„æ—¶çš„éº»çƒ¦ï¼ˆå¦‚é‡å‘½åä¸€ä¸ªæ¨¡å—ï¼‰ï¼Œä½†æ˜¯æˆ‘æƒ³åœ¨IDEå¦‚æ­¤æ™®éä½¿ç”¨çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå› ç´ åº”è¯¥æ˜¯æœ€ä¸å€¼å¾—è€ƒè™‘çš„äº†ã€‚åŠ ä¸€ä¸ªTODOå§ï¼Œå‚é˜…ä¸€äº›ä¼˜ç§€çš„å¼€æºæ¡†æ¶æºç ï¼Œçœ‹çœ‹ä»–ä»¬æ˜¯å¦‚ä½•ç»„ç»‡çš„ã€‚</p>
<h1 id="åè¯"><a href="#åè¯" class="headerlink" title="åè¯"></a>åè¯</h1><p>ä½¿ç”¨äº†ç›¸å¯¹å¯¼å…¥ä»¥åï¼Œå¦‚æœç›´æ¥ä»¥<code>python script_name.py</code>çš„æ–¹å¼è¿è¡Œè„šæœ¬ï¼ŒPythonè§£é‡Šå™¨ä¼šæŠ¥<br><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#python 2</span></span><br><span class="line"><span class="symbol">ValueError:</span> Attempted relative import <span class="keyword">in</span> non-package</span><br></pre></td></tr></table></figure></p>
<p>æˆ–è€…<br><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#python 3</span></span><br><span class="line">SystemError: Parent <span class="keyword">module</span> <span class="string">''</span> <span class="keyword">not</span> loaded, cannot perform relative <span class="keyword">import</span></span><br></pre></td></tr></table></figure></p>
<p>çš„é”™è¯¯ï¼Œå¯ä»¥ä½¿ç”¨<code>python -m script_name.py</code>åŠ ä¸Š-må¼€å…³çš„æ–¹å¼è¿è¡Œï¼Œ-mç”¨äºå‘Šè¯‰è§£é‡Šå™¨ä»¥è„šæœ¬çš„æ–¹å¼è¿è¡Œæ¨¡å—ï¼Œå…·ä½“è¿™æ ·åšçš„åŸå› å°†åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­åˆ†æã€‚</p>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ol>
<li><a href="http://kuanghy.github.io/2016/07/21/python-import-relative-and-absolute" title="Python ç›¸å¯¹å¯¼å…¥ä¸ç»å¯¹å¯¼å…¥" target="_blank" rel="noopener">Python ç›¸å¯¹å¯¼å…¥ä¸ç»å¯¹å¯¼å…¥</a></li>
<li><a href="http://www.runoob.com/python/python-modules.html" title="http://www.runoob.com/python/python-modules.html" target="_blank" rel="noopener">http://www.runoob.com/python/python-modules.html</a></li>
<li><a href="https://www.python.org/dev/peps/pep-0328/" title="PEP 328 -- Imports: Multi-Line and Absolute/Relative" target="_blank" rel="noopener">PEP 328 â€“ Imports: Multi-Line and Absolute/Relative</a></li>
<li><a href="http://codingpy.com/article/python-import-101/" title="Pythonå¯¼å…¥æ¨¡å—çš„å‡ ç§å§¿åŠ¿" target="_blank" rel="noopener">Pythonå¯¼å…¥æ¨¡å—çš„å‡ ç§å§¿åŠ¿</a></li>
</ol>
]]></content>
      
        <categories>
            
            <category> Python </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Python </tag>
            
            <tag> import </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[ç»ˆç«¯é«˜æ•ˆåˆ‡æ¢ç¼–ç ]]></title>
      <url>http://dequn.github.io/2017/09/05/switch-encoding-in-terminal/</url>
      <content type="html"><![CDATA[<p>åœ¨ä»¥å‰çš„æ—¶å€™ï¼Œç»ˆç«¯ç¼–ç é€šé€šè®¾ç½®çš„éƒ½æ˜¯UTF-8ï¼Œå³ä½¿æœ‰ä¸€ä¸¤å°è¿œç¨‹æœºï¼Œå› ä¸ºæœ‰è‡ªä¸»æƒä¹Ÿéƒ½æ˜¯UTF-8ç¼–ç ï¼ŒåŒ…æ‹¬æ•°æ®åº“è¡¨æ ¼ï¼Œä¹Ÿéƒ½æ˜¯ç»Ÿä¸€UTF-8ç¼–ç ï¼Œä¸å¾—ä¸è¯´è¿™æ ·ç»Ÿä¸€ä»¥åéå¸¸æ–¹ä¾¿ï¼Œå‡ ä¹ä¹Ÿæ²¡æœ‰è€ƒè™‘è¿‡ç¼–ç ä¸åŒå¸¦æ¥çš„çƒ¦æ¼ã€‚</p>
<p>æ¥åˆ°å…¬å¸å·¥ä½œä¸€æ®µæ—¶é—´åæ‰å‘ç°ï¼Œè‡ªå·±çš„å¼€å‘æœºè¿˜å¥½è¯´ï¼Œè®¾ç½®æˆUTF-8å°±å¯ä»¥äº†ï¼Œä¿æŒåŸæœ‰æƒ¯ä¾‹ã€‚ç„¶è€Œï¼Œéœ€è¦ç»å¸¸ç™»å½•åˆ«çš„æœºå™¨çœ‹ä»»åŠ¡è·‘ä»£ç å°±ä¼šå‘ç°ä¹±ç äº†ï¼Œå¥½å§ï¼Œæ‰‹åŠ¨æŠŠç»ˆç«¯(iTerm2)è°ƒåˆ°GBKï¼Œç»“æŸä»¥åå†è°ƒå›æ¥ï¼›ç„¶åè¿‡äº†æ²¡ä¸¤å¤©ï¼Œä¼šå‘ç°å…¶ä»–æœºå™¨çš„Mysqlè¡¨æ ¼ä¹Ÿæ˜¯GBKçš„ï¼Œå¥½å§è¿˜å¾—æš‚è°ƒGBKã€‚æœ€å¤§çš„é—®é¢˜è¿˜ä¸åœ¨äºéº»çƒ¦ï¼Œæˆ‘ä¸€ä¸ªç»ˆç«¯ä¸‹è¿æ¥äº†å¤šå°æœåŠ¡å™¨å’Œæ•°æ®åº“ï¼Œç¼–ç éƒ½ä¸ç»Ÿä¸€ï¼Œè¿™å¯æ€ä¹ˆåŠï¼Ÿ</p>
<p>åœ¨ç½‘ä¸Šæ‰¾åˆ°äº†ä¸¤ç§æ–¹æ¡ˆï¼Œç¬¬ä¸€ç§æ˜¯åŸºäºiTerm2çš„ï¼Œå¯ä»¥å‚è€ƒ<a href="http://blog.chenxiaosheng.com/posts/2013-10-29/mac_osx_iterm2_utf8_gbk_switch.html" target="_blank" rel="noopener">Mac OSX iTerm2 ç»ˆç«¯UTF-8å’ŒGBKç¼–ç è‡ªç”±åˆ‡æ¢</a>ï¼Œè™½ç„¶æˆ‘æ˜¯iTerm2çš„ç”¨æˆ·ï¼Œä½†æ˜¯è§‰å¾—è¿™ç§æ–¹æ³•è¿˜æ˜¯æœ‰äº›éº»çƒ¦ï¼Œå¦‚æœæˆ‘ä¸ç”¨iTerm2è¿˜ä¸èƒ½è§£å†³äº†ï¼Ÿ</p>
<p>å½“ç„¶è¿˜æœ‰å…¶ä»–åˆ©å™¨ï¼Œé‚£å°±æ˜¯luit.</p>
<p>å‚è€ƒIBM Knowledge Centerä¸Šçš„ä»‹ç»<a href="https://www.ibm.com/support/knowledgecenter/zh/ssw_aix_61/com.ibm.aix.cmds3/luit.htm" target="_blank" rel="noopener">luit å‘½ä»¤</a></p>
<blockquote>
<p>luit å‘½ä»¤æ˜¯ä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œåœ¨ä»»æ„åº”ç”¨ç¨‹åºå’Œ UTF-8 ç»ˆç«¯ä»¿çœŸå™¨ä¹‹é—´è¿è¡Œã€‚luit å‘½ä»¤å°†åº”ç”¨ç¨‹åºè¾“å‡ºä»è¯­è¨€ç¯å¢ƒçš„ç¼–ç è½¬æ¢ä¸º UTF-8ï¼Œå¹¶å°†ç»ˆç«¯è¾“å…¥ä» UTF-8 è½¬æ¢ä¸ºè¯­è¨€ç¯å¢ƒçš„ç¼–ç ã€‚</p>
<blockquote>
<p>æ³¨ï¼š<br>å¤šè¯­è¨€åº”ç”¨ç¨‹åºå¿…é¡»è®¾ç½®ä¸ºä»…ç”Ÿæˆ UTF-8 ä»£ç ã€‚ä¸å¾—ä½¿ç”¨å‘½ä»¤ç”Ÿæˆ UTF-8 ä¹‹å¤–çš„è¾“å‡ºã€‚</p>
</blockquote>
</blockquote>
<p>luitçš„å®‰è£…ä¹Ÿéå¸¸ç®€å•ï¼Œå‚è€ƒ <a href="https://blog.jamespan.me/2015/06/12/luit-with-tmux" target="_blank" rel="noopener">Tmuxã€Luit æ‚è°ˆ</a>è¿‡ç¨‹å¦‚ä¸‹ã€‚</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget -c ftp:<span class="comment">//invisible-island.net/luit/luit.tar.gz</span></span><br><span class="line">tar -xzvf luit<span class="selector-class">.tar</span><span class="selector-class">.gz</span></span><br><span class="line">cd luit-<span class="number">20141204</span>/</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<p>å…¶ä½¿ç”¨å¯ä»¥manä¸€ä¸‹ï¼Œæˆ–è€…å‚è€ƒ<a href="https://www.ibm.com/support/knowledgecenter/zh/ssw_aix_61/com.ibm.aix.cmds3/luit.htm" target="_blank" rel="noopener">luit å‘½ä»¤</a>ï¼Œä¸‹é¢ç®€å•ç»™å‡ºä¸¤ä¸ªç¤ºä¾‹ã€‚</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">luit </span>-encoding gbk ssh relay-mechine</span><br><span class="line"><span class="comment"># è¿™æ ·ç™»å½•è¿œç¨‹æœºå™¨ç”¨çš„å°±æ˜¯GBKç¼–ç äº†</span></span><br></pre></td></tr></table></figure>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">luit </span>-encoding gbk mysql -u mysql_user -p </span><br><span class="line"><span class="comment">#è¿™æ ·è¿æ¥æ•°æ®åº“ç”¨çš„ä¹Ÿæ˜¯GBKç¼–ç </span></span><br></pre></td></tr></table></figure>
<p>æœ€åä¸å¾—ä¸åæ§½ä¸€ä¸‹æˆ‘å¸ï¼Œæ˜¯å› ä¸ºå‡ºäºå†å²åŸå› å—ï¼Œå›ºå®ˆGBKé˜µè¥ï¼Ÿ</p>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ol>
<li><a href="https://www.ibm.com/support/knowledgecenter/zh/ssw_aix_61/com.ibm.aix.cmds3/luit.htm" target="_blank" rel="noopener">luit å‘½ä»¤</a></li>
<li><a href="https://blog.jamespan.me/2015/06/12/luit-with-tmux" target="_blank" rel="noopener">Tmuxã€Luit æ‚è°ˆ</a></li>
<li><a href="http://blog.chenxiaosheng.com/posts/2013-10-29/mac_osx_iterm2_utf8_gbk_switch.html" target="_blank" rel="noopener">Mac OSX iTerm2 ç»ˆç«¯UTF-8å’ŒGBKç¼–ç è‡ªç”±åˆ‡æ¢</a></li>
</ol>
]]></content>
      
        <categories>
            
            <category> Linux </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Linux </tag>
            
            <tag> Encoding </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Pythonä¸­è§£æå‘½ä»¤è¡Œå‚æ•°]]></title>
      <url>http://dequn.github.io/2017/09/02/parse-command-line-args-in-python/</url>
      <content type="html"><![CDATA[<p>Pythonä¸­å¸¸ç”¨çš„è·å–å‘½ä»¤è¡Œå‚æ•°çš„æ–¹æ³•æœ‰ä¸‰ç§ï¼Œåˆ†åˆ«å¯é€‚ç”¨äºä¸åŒçš„åœºæ™¯ã€‚</p>
<h1 id="ç›´æ¥ä»sys-argvä¸­è·å–"><a href="#ç›´æ¥ä»sys-argvä¸­è·å–" class="headerlink" title="ç›´æ¥ä»sys.argvä¸­è·å–"></a>ç›´æ¥ä»sys.argvä¸­è·å–</h1><p>sys.agrvä¿å­˜äº†å‘½ä»¤è¡Œçš„å‚æ•°åˆ—è¡¨ï¼Œå…¶ä¸­ï¼Œ<code>sys.argv[0]</code>ä¿å­˜çš„æ˜¯è„šæœ¬çš„åç§°ï¼Œæ‰€ä»¥è¦è·å–è‡ªå·±ä¼ å…¥çš„å‚æ•°æ—¶ï¼Œéœ€è¦ä»ç¬¬äºŒä¸ªå…ƒç´ å¼€å§‹ï¼Œå‚æ•°çš„é¡ºåºä¸<code>sys.argv</code>ä¸­ä¸€è‡´ã€‚</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># m1.<span class="keyword">py</span></span><br><span class="line">import sys</span><br><span class="line"><span class="keyword">print</span> <span class="string">'The length of sys.argv is %d'</span> % <span class="built_in">len</span>(sys.<span class="built_in">argv</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">'Argument list: '</span>,str(sys.<span class="built_in">argv</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python m1.py <span class="keyword">first</span> <span class="keyword">second</span> <span class="keyword">third</span></span><br><span class="line">The <span class="built_in">length</span> <span class="keyword">of</span> sys.argv <span class="keyword">is</span> <span class="number">4</span></span><br><span class="line">Argument <span class="built_in">list</span>:  ['m1.py', '<span class="keyword">first</span>', '<span class="keyword">second</span>', '<span class="keyword">third</span>']</span><br></pre></td></tr></table></figure>
<p><strong>è·è¿™ç§æ–¹æ³•é€‚ç”¨äºå‚æ•°è¾ƒå°‘çš„æ—¶å€™ï¼Œä½¿ç”¨è€…æŒ‰ç…§å›ºå®šé¡ºåºå°†æ‰€éœ€å‚æ•°ä¼ å…¥å³å¯ï¼ŒåŒæ—¶ï¼Œå–çš„å‚æ•°éƒ½æ˜¯strç±»å‹ï¼Œéœ€è¦ç”¨æˆ·è‡ªè¡Œè½¬æ¢ä¸ºæ‰€éœ€ç±»å‹ã€‚</strong></p>
<h1 id="ä½¿ç”¨getopt-getoptè·å–å‚æ•°"><a href="#ä½¿ç”¨getopt-getoptè·å–å‚æ•°" class="headerlink" title="ä½¿ç”¨getopt.getoptè·å–å‚æ•°"></a>ä½¿ç”¨getopt.getoptè·å–å‚æ•°</h1><p>å½“å‚æ•°æ¯”è¾ƒå¤šçš„æ—¶å€™æˆ‘ä»¬å¯èƒ½éœ€è¦æ˜ç¡®æŒ‡å®šå‚æ•°åç§°ï¼Œåˆæˆ–è€…æˆ‘ä»¬å¯èƒ½éœ€è¦ä¸€äº›å¯é€‰å‚æ•°ï¼Œä½¿ç”¨ç¬¬ä¸€ç§æ–¹æ³•å°±ä¸æ˜¯é‚£ä¹ˆæ–¹ä¾¿äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨getoptæ¥è§£æå‚æ•°ï¼Œå…¶è°ƒç”¨æ–¹å¼å¦‚ä¸‹æ‰€ç¤ºã€‚<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">getopt</span><span class="selector-class">.getopt</span>(<span class="selector-tag">args</span>, <span class="selector-tag">options</span>, <span class="selector-attr">[long_options]</span>)</span><br></pre></td></tr></table></figure></p>
<ul>
<li>argsæ˜¯å°†è¢«è§£æçš„å‚æ•°åˆ—è¡¨</li>
<li>optionsæ˜¯éœ€è¦è¯†åˆ«çš„å‚æ•°ååˆ—è¡¨ï¼Œå½“ç„¶ä¸ä¸€å®šéå¾—æœ‰å‚æ•°ï¼Œæ¯”å¦‚-hç”¨æ¥è¾“å‡ºå¸®åŠ©ä¿¡æ¯ï¼Œå½“æœ‰å¯¹åº”å‚æ•°çš„æ—¶å€™ï¼Œéœ€è¦åœ¨æ ‡è¯†ç¬¦åè¾¹æ·»åŠ ä¸€ä¸ªåˆ†å·â€:â€ã€‚</li>
<li>long_optionså¯é€‰å‚æ•°æ˜¯é•¿å‚æ•°ååˆ—è¡¨ï¼Œå¦‚â€“long-nameï¼Œå½“æœ‰å‚æ•°ä¼ å…¥çš„æ—¶å€™ï¼Œéœ€è¦åœ¨å³è¾¹æ·»åŠ ç­‰å·â€=â€ã€‚</li>
</ul>
<p>å‡½æ•°è¿”å›ä¸€ä¸ªäºŒå…ƒç»„ï¼Œç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯ï¼ˆoption,value)åˆ—è¡¨ï¼Œç¬¬äºŒä¸ªå…ƒç´ æ˜¯æœªè¯†åˆ«çš„å‚æ•°åˆ—è¡¨ã€‚</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#m2.<span class="keyword">py</span></span><br><span class="line">#codin<span class="variable">g:utf</span>-<span class="number">8</span></span><br><span class="line">import sys, getopt</span><br><span class="line"></span><br><span class="line">opts, left_args = getopt.getopt(sys.<span class="built_in">argv</span>[<span class="number">1</span>:], <span class="string">'i:h'</span>, [<span class="string">'in='</span>,<span class="string">'help'</span>]) #ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è„šæœ¬åï¼Œä¸ä¼ å…¥</span><br><span class="line"><span class="keyword">for</span> <span class="keyword">opt</span>, val in <span class="keyword">opt</span><span class="variable">s:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">opt</span> == <span class="string">'-h'</span>:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">'ä¸å«å‚æ•°Help Info'</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">opt</span> == <span class="string">'--help'</span>:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">'ä¸å«å‚æ•°Help Info2'</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">opt</span> == <span class="string">'-i'</span>:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">'çŸ­å‚æ•°-i: '</span>, val</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">opt</span> == <span class="string">'--in'</span>:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">'é•¿å‚æ•°--ifile: '</span>, val</span><br><span class="line"><span class="keyword">print</span> <span class="string">'æœªè¯†åˆ«å‚æ•°ï¼š'</span>, str(left_args)</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœ<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">python m2<span class="selector-class">.py</span> -<span class="selector-tag">i</span> short_arg --<span class="keyword">in</span>=long_arg -h --help left_arg</span><br><span class="line">çŸ­å‚æ•°-<span class="selector-tag">i</span>:  short_arg</span><br><span class="line">é•¿å‚æ•°--ifile:  long_arg</span><br><span class="line">ä¸å«å‚æ•°Help Info</span><br><span class="line">ä¸å«å‚æ•°Help Info2</span><br><span class="line">æœªè¯†åˆ«å‚æ•°ï¼š [<span class="string">'left_arg'</span>]</span><br></pre></td></tr></table></figure></p>
<p>è¿™ç§æ–¹æ³•å·²ç»èƒ½å¤Ÿåº”å¯¹å¤§å¤šæ•°æƒ…å†µäº†ï¼Œä¸è¿‡è·å–çš„valä»æ˜¯strç±»å‹ã€‚</p>
<h1 id="ä½¿ç”¨argparseæ¨¡å—è§£æå‚æ•°"><a href="#ä½¿ç”¨argparseæ¨¡å—è§£æå‚æ•°" class="headerlink" title="ä½¿ç”¨argparseæ¨¡å—è§£æå‚æ•°"></a>ä½¿ç”¨argparseæ¨¡å—è§£æå‚æ•°</h1><p>argparse æ¨¡å—æœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯å¯ä»¥å»ºç«‹ç”¨æˆ·å‹å¥½çš„å‘½ä»¤è¡Œæ¥å£ï¼Œå¯ä»¥å®ç°æŒ‡å®šéœ€è¦ä¼ å…¥çš„å‚æ•°ï¼Œè‡ªåŠ¨è§£æsys.argvï¼Œè‡ªåŠ¨ç”Ÿæˆå¸®åŠ©ä¿¡æ¯ã€é”™è¯¯ä¿¡æ¯ç­‰ã€‚å¦‚æœè¦ä½¿ç”¨getoptæ¥è¾¾åˆ°åŒæ ·çš„æ•ˆæœï¼Œå°±éœ€è¦å†™å¾ˆå¤šå¾ˆå¤šçš„ä»£ç å•¦ã€‚</p>
<p>argparse é€šè¿‡ArgumentParserå¯¹è±¡å®ç°å‚æ•°çš„è§£æï¼Œå¯ä»¥å¾ˆå‹å¥½åœ°å®ç°å¸®åŠ©ä¿¡æ¯ã€å‚æ•°ä¼ å…¥å‰ç¼€ã€å‚æ•°å†²çªç­‰ç‰¹æ€§ï¼Œå…¶é€šè¿‡add_argumentæ–¹æ³•æ·»åŠ å…·ä½“çš„å‚æ•°â€”â€”åŒ…æ‹¬ä½ç½®å‚æ•°å’Œå¯é€‰å‚æ•°ç­‰ï¼ŒåŒæ—¶å¯ä»¥æŒ‡å®šè¿™äº›å‚æ•°çš„ä¸ªæ•°ã€è½¬æ¢ç±»å‹ã€é»˜è®¤å€¼ã€é™å®šæšä¸¾å€¼ã€æ˜¯å¦å¿…é¡»ä»¥åŠåˆ«åç­‰ä¿¡æ¯ã€‚argparseçš„ä½¿ç”¨ä¼šæ¯”ä¸Šè¿°ä¸¤ä¸ªå¤æ‚ä¸€äº›ï¼Œä½†æ˜¯å…¶åŠŸèƒ½æ›´å¼ºå¤§ã€ä½¿ç”¨æ›´å‹å¥½ä¸€äº›ã€‚å…·ä½“ä½¿ç”¨æ–¹æ³•å¯ä»¥å•ç‹¬å†™ä¸€ç¯‡æ–‡ç« äº†ï¼Œä½†æ˜¯å®˜æ–¹æ–‡æ¡£å·²ç»ç»™å‡ºäº†å¾ˆè¯¦ç»†çš„ç¤ºä¾‹äº†ï¼Œæ‰€ä»¥è¿™é‡Œå°±ä¸åœ¨èµ˜è¿°ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥å‚é˜…<a href="https://docs.python.org/2.7/library/argparse.html" target="_blank" rel="noopener">argparse â€” Parser for command-line options, arguments and sub-commands</a>ã€‚</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ä¸Šè¿°ä¸‰ä¸ªæ–¹æ³•ä»ç®€å•åˆ°å¤æ‚ï¼ŒåŠŸèƒ½ä»å•ä¸€åˆ°ä¸°å¯Œï¼Œå¼€å‘äººå‘˜å¯æ ¹æ®éœ€è¦é€‰æ‹©ã€‚</p>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ol>
<li><a href="https://www.tutorialspoint.com/python/python_command_line_arguments.htm" target="_blank" rel="noopener">Python Command Line Arguments</a></li>
<li><a href="https://docs.python.org/2.7/library/argparse.html" target="_blank" rel="noopener">argparse â€” Parser for command-line options, arguments and sub-commands</a></li>
</ol>
]]></content>
      
        <categories>
            
            <category> Python </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Python </tag>
            
            <tag> args </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[å­—ç¬¦é›†ã€å­—ç¬¦ç¼–ç ä»¥åŠPythonä¸­ç¼–ç çš„é‚£äº›äº‹]]></title>
      <url>http://dequn.github.io/2017/08/19/charset-encoding-and-in-python/</url>
      <content type="html"><![CDATA[<p>æ€»ä¼šé‡åˆ°ä¹±ç çš„é—®é¢˜ï¼Œä¹Ÿæ€»æ˜¯æŒ‰ç…§ç½‘ä¸Šçš„æ•™ç¨‹ä¸€æ­¥ä¸€æ­¥æ“ä½œï¼Œè§£å†³çš„è¿‡ç¨‹å°±åƒç¢°è¿æ°”ï¼Œä»æ¥æ²¡æœ‰æ€»ç»“è¿‡ï¼Œå†æ¬¡é‡åˆ°çš„æ—¶å€™è¿˜æ˜¯ä¸çŸ¥é“æ˜¯ä»€ä¹ˆé—®é¢˜ï¼Œæ‰€ä»¥ï¼ŒèŠ±ä¸€ç‚¹æ—¶é—´ï¼Œæ€»ç»“ä¸€ä¸‹ã€‚</p>
<h1 id="å­—ç¬¦é›†å’Œå­—ç¬¦ç¼–ç "><a href="#å­—ç¬¦é›†å’Œå­—ç¬¦ç¼–ç " class="headerlink" title="å­—ç¬¦é›†å’Œå­—ç¬¦ç¼–ç "></a>å­—ç¬¦é›†å’Œå­—ç¬¦ç¼–ç </h1><p><strong>å­—ç¬¦é›†</strong>æ˜¯ä¸€ä¸ªç³»ç»Ÿæ”¯æŒçš„æŠ½è±¡å­—ç¬¦çš„é›†åˆã€‚è¿™ä¸ªé›†åˆæ˜¯æœ‰é™é›†åˆï¼ŒåŒ…æ‹¬æ–‡å­—ã€æ ‡ç‚¹å’Œæ•°å­—ç­‰ï¼Œç”±äºè®¡ç®—æœºå†…éƒ¨å…¨éƒ¨éƒ½æ˜¯æ•°å­—å­˜å‚¨ï¼Œæ‰€ä»¥å­—ç¬¦é›†æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªç¬¦å·ä¸æ•°å­—ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œæ¯”å¦‚ASCIIå­—ç¬¦é›†ä¸­å¤§å†™å­—æ¯Açš„ç¼–å·æ˜¯65ã€‚å­˜å‚¨æˆ–ä¼ è¾“çš„æ—¶å€™è®¡ç®—æœºæ ¹æ®å­—ç¬¦é›†å°†äººèƒ½çœ‹æ‡‚çš„å­—ç¬¦æ¢ç®—æˆè®¡ç®—æœºèƒ½çœ‹æ‡‚çš„æ•°å­—ï¼Œè¾“å‡ºçš„æ—¶å€™å†æ¢ç®—æˆäººèƒ½çœ‹æ‡‚çš„å­—ç¬¦ã€‚</p>
<p><strong>å­—ç¬¦ç¼–ç </strong>ï¼Œè®¡ç®—æœºç³»ç»Ÿå†…éƒ¨å…¨éƒ¨é‡‡ç”¨äºŒè¿›åˆ¶ï¼Œé‚£ä¹ˆå°†æ•°å­—è½¬æ¢æˆäºŒè¿›åˆ¶çš„æ—¶å€™é‡‡ç”¨ä»€ä¹ˆè§„åˆ™å‘¢ï¼Œæ¯”å¦‚é‡‡ç”¨å‡ ä½ï¼Œé«˜ä½ä»£è¡¨ä»€ä¹ˆï¼Œä½ä½ä»£è¡¨ä»€ä¹ˆç­‰ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„ç¼–ç è§„åˆ™ã€‚</p>
<p><strong>ä¹±ç </strong>ï¼Œè®¡ç®—æœºæŒ‰ç…§æŒ‡å®šæˆ–é»˜è®¤çš„ç¼–ç è§„åˆ™å¯¹bitä½è¿›è¡Œè§£ç ï¼Œç”±äºä¸å­˜å‚¨æˆ–æ¥æ”¶æ—¶ä½¿ç”¨çš„ç¼–ç è§„åˆ™ä¸ä¸€è‡´ï¼Œå°±å¯¼è‡´äº†ç¿»è¯‘å‡ºæ¥çš„å­—ç¬¦ä¸æ˜¯åŸæ¥çš„å­—ç¬¦ï¼Œé€ æˆæ‰€è°“çš„ä¹±ç ï¼Œå³æˆ‘ä»¬äººç±»çœ‹ä¸æ‡‚ã€‚</p>
<h1 id="å¸¸ç”¨çš„å­—ç¬¦é›†å’Œå­—ç¬¦ç¼–ç "><a href="#å¸¸ç”¨çš„å­—ç¬¦é›†å’Œå­—ç¬¦ç¼–ç " class="headerlink" title="å¸¸ç”¨çš„å­—ç¬¦é›†å’Œå­—ç¬¦ç¼–ç "></a>å¸¸ç”¨çš„å­—ç¬¦é›†å’Œå­—ç¬¦ç¼–ç </h1><p>å¸¸è§çš„å­—ç¬¦é›†æœ‰ASCIIï¼Œèƒ½è¡¨ç¤º128ä¸ªå­—ç¬¦ï¼Œæ‰©å±•ASCIIèƒ½è¡¨ç¤º256ä¸ªå­—ç¬¦ï¼ŒGBXXXå­—ç¬¦é›†æ˜¯æˆ‘å›½ä¸“å®¶è®¾è®¡çš„ä¸€å¥—å­—ç¬¦é›†ï¼Œè¿˜æœ‰åŒ…æ‹¬ç¹ä½“å­—çš„æ±‰å­—å­—ç¬¦é›†BIG5ï¼Œè¿™äº›å­—ç¬¦é›†åŒæ—¶è§„å®šäº†ç¼–ç è§„åˆ™ï¼Œæ‰€ä»¥ä»–ä»¬<strong>åŒæ—¶ä¹Ÿæ˜¯å­—ç¬¦ç¼–ç </strong>ï¼Œéœ€è¦è¯´æ˜çš„æ˜¯ï¼Œä»–ä»¬éƒ½æ˜¯å…¼å®¹ASCIIç¼–ç çš„ã€‚</p>
<h1 id="Unicode-å’Œ-UTF-8"><a href="#Unicode-å’Œ-UTF-8" class="headerlink" title="Unicode å’Œ UTF-8"></a>Unicode å’Œ UTF-8</h1><p>æœ€å®¹æ˜“ææ··çš„æ˜¯Unicodeå’ŒUTF-8äº†ï¼Œå› ä¸ºåƒä¸Šé¢é‚£æ ·æ¯ä¸ªè¯­è¨€æˆ–è€…åœ°åŒºéƒ½æä¸€å¥—ï¼Œåœ¨äº’è”ç½‘ä¸­æ™®åŠéå¸¸ä¸ä¾¿ï¼Œäºæ˜¯å°±å‡ºç°äº†<strong>Unicodeå­—ç¬¦é›†</strong>ï¼Œç›®å‰å·²ç»è¶…è¿‡äº†åä¸‡å­—ç¬¦ï¼Œå¯ä»¥åŒ…æ‹¬å¤šç§æ–‡å­—ï¼Œè¿™ä¸ªå­—ç¬¦é›†è§„å®šäº†ç¬¦å·ç³»ç»Ÿåˆ°æ•°å­—çš„æ˜ å°„ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰è§„å®šç»Ÿä¸€çš„ç¼–ç è§„åˆ™ã€‚</p>
<p>UTF-8ï¼ŒUTF-16ï¼ŒUTF-32éƒ½æ˜¯Unicodeçš„ç¼–ç è§„åˆ™ï¼Œå…¶ä¸­UTF-32åŒæ„é‡‡ç”¨4ä¸ªå­—èŠ‚è¡¨ç¤ºå­—ç¬¦ï¼Œç©ºé—´æµªè´¹è¾ƒå¤§ï¼Œæ‰€ä»¥ä¸å¸¸è§ï¼ŒUTF-8æ˜¯ä¸€ç§å˜é•¿çš„ç¼–ç æ–¹å¼ï¼Œå› ä¸ºæ–‡æœ¬çš„é‡ç‚¹ä¸åœ¨äºå…³æ³¨ç¼–ç è§„åˆ™çš„ç»†èŠ‚ï¼Œæ‰€ä»¥å°±ä¸å†èµ˜è¿°ï¼Œå…·ä½“å®ç°å¯ä»¥å‚è§å…¶ä»–ä½œè€…çš„æ–‡ç« ã€‚</p>
<p><strong>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¸¸è§çš„GBXXX,ASCII,BIG5ç­‰æœ¬èº«å³æ˜¯æŒ‡ä»£å­—ç¬¦é›†ï¼Œä¹Ÿæ˜¯å­—ç¬¦ç¼–ç ï¼Œè€ŒUnicodeåªæ˜¯å­—ç¬¦é›†ï¼ŒUTF-8åªæ˜¯å­—ç¬¦ç¼–ç ã€‚</strong></p>
<h1 id="Python-ä¸­çš„ç¼–ç "><a href="#Python-ä¸­çš„ç¼–ç " class="headerlink" title="Python ä¸­çš„ç¼–ç "></a>Python ä¸­çš„ç¼–ç </h1><p>è¿™é‡Œä¸»è¦æœ‰ä¸‰ä¸ªé—®é¢˜ï¼š</p>
<ol>
<li>strå’Œunicodeç±»å‹æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</li>
<li>æºæ–‡ä»¶å¼€å¤´çš„#coding:utf-8æ˜¯åšä»€ä¹ˆç”¨çš„ï¼Œè·Ÿæºæ–‡ä»¶çš„ç¼–ç æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ</li>
<li>æºæ–‡ä»¶çš„ç¼–ç å¯¹ç¨‹åºæœ‰æ²¡æœ‰å½±å“ï¼Ÿ</li>
<li>file = open(â€˜xxxâ€™),file.read()æ˜¯æ€æ ·å¯¹æ–‡ä»¶è¿›è¡Œè§£ç çš„ï¼Ÿ</li>
</ol>
<p>é¦–å…ˆæ¥çœ‹ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œå†Python2ä¸­ï¼Œé€šè¿‡<code>s1=&#39;strå­—ç¬¦ä¸²&#39;</code>å¾—åˆ°çš„æ˜¯strå¯¹è±¡ï¼Œè€Œ<code>s2=u&#39;unicodeå­—ç¬¦ä¸²&#39;</code>å¾—åˆ°çš„æ˜¯unicodeå¯¹è±¡ï¼Œè¿™ä¸¤ç§éƒ½æ˜¯<code>basestring</code>ç±»å‹çš„å­ç±»ï¼Œä»å®˜æ–¹æ–‡æ¡£<a href="https://docs.python.org/2/howto/unicode.html" target="_blank" rel="noopener">Unicode HOWTO</a>ä¸­çš„è§£é‡Š</p>
<blockquote>
<p>Python represents Unicode strings as either 16- or 32-bit integers, depending on how the Python interpreter was compiled.</p>
</blockquote>
<p>å¯ä»¥çœ‹å‡ºï¼Œunicodeå­—ç¬¦ä¸²å¯ä»¥çœ‹åšç›´æ¥å­˜å‚¨çš„æ˜¯è¯¥å­—ç¬¦å¯¹åº”çš„Unicodeæ•°å­—ç ï¼Œåœ¨<a href="http://wklken.me/posts/2013/08/31/python-extra-coding-intro.html#str-he-unicode" target="_blank" rel="noopener">PYTHON-è¿›é˜¶-ç¼–ç å¤„ç†å°ç»“</a>ä¸€æ–‡ä¸­ï¼Œè¿˜å¯¹æ¯”äº†ç”¨<code>len()</code>æ±‚ä¸¤è€…é•¿åº¦çš„åŒºåˆ«ï¼Œå…¶ä¸­ï¼Œ<code>len(&#39;ä¸­æ–‡&#39;)</code>å¾—åˆ°çš„ç»“æœä¸º6ï¼Œè€Œ<code>len(u&#39;ä¸­æ–‡&#39;)</code>å¾—åˆ°çš„ç»“æœæ‰æ˜¯å®é™…æ„ä¹‰ä¸Šçš„2ã€‚åœ¨<a href="https://pythonhosted.org/kitchen/unicode-frustrations.html" target="_blank" rel="noopener">Overcoming frustration: Correctly using unicode in python2</a>ä¸­ä¹Ÿè§£é‡Šäº†strç±»å‹å’Œunicodeç±»å‹çš„ä¸åŒï¼Œstrç±»å‹æ˜¯å®é™…ä¸Šbytesåºåˆ—ï¼Œ<code>len(str)</code>æ‰€å¾—åˆ°çš„ä¹Ÿæ˜¯åºåˆ—çš„é•¿åº¦ï¼Œè€Œä¸æ˜¯å®é™…æ„ä¹‰ä¸Šçš„å­—ç¬¦ä¸²é•¿åº¦ã€‚</p>
<blockquote>
<p>In python, the unicode type stores an abstract sequence of code points. Each code point represents a grapheme. By contrast, byte str stores a sequence of bytes which can then be mapped to a sequence of code points. Each unicode encoding (UTF-8, UTF-7, UTF-16, UTF-32, etc) maps different sequences of bytes to the unicode code points.</p>
</blockquote>
<p>Pythonå¼€å‘è€…é€šå¸¸ä¼šå†™<code>#coding: utf-8</code>æˆ–è€…ç±»ä¼¼çš„encoding hintåœ¨æºæ–‡ä»¶çš„å‰ä¸¤è¡Œï¼ˆä¹Ÿåªæœ‰åœ¨å‰ä¸¤è¡Œæ‰èµ·ä½œç”¨ï¼Œå¹¶ä¸”è¯¥ç¼–ç å¿…é¡»å…¼å®¹ASCIIï¼ŒUTF-16å°±ä¸èƒ½æ­£å¸¸å·¥ä½œï¼‰ã€‚ å¾ˆå¤šäººæ˜ç™½çš„ä¸€ç‚¹å°±æ˜¯ï¼š<strong>å¦‚æœæºä»£ç æ–‡ä»¶ä¸­å‡ºç°äº†éASCIIå­—ç¬¦é›†ä¸­çš„å­—ç¬¦ï¼Œæˆ‘ä»¬éœ€è¦å†™è¿™æ ·çš„æ³¨é‡Š</strong>ã€‚ ä½†æ˜¯å¯¹äºåƒæˆ‘è¿™æ ·çš„æ–°æ‰‹æ¥è¯´ï¼Œå¸¸å¸¸ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œè¿™å¥è¯çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Œåˆå’Œæºæ–‡ä»¶æœ¬èº«çš„ç¼–ç ä»€ä¹ˆå…³ç³»ï¼Ÿ</p>
<p>åœ¨Python2.1ä¸­ï¼ŒUnicodeå­—ç¬¦ä¸²åªèƒ½é‡‡ç”¨â€unicode-escapeâ€çš„æ–¹å¼ï¼Œæ¯”å¦‚éœ€è¦å®šä¹‰â€ä¸­æ–‡â€ä¸¤ä¸ªå­—ï¼Œé¡»å¾—<code>s = u&#39;\u4e2d\u6587&#39;</code>ï¼Œè€Œä¸èƒ½ç›´æ¥å‡ºç°<code>s = u&#39;ä¸­æ–‡&#39;</code>è¿™æ ·çš„ä»£ç ï¼Œè¿™å°±å¯¹ä½¿ç”¨éæ‹‰ä¸å­—ç¬¦çš„å¼€å‘è€…éå¸¸ä¸å‹å¥½ï¼Œæ‰€ä»¥å°±æœ‰äº†<a href="https://www.python.org/dev/peps/pep-0263/" target="_blank" rel="noopener">PEP263</a>ï¼Œè¯¥ç½‘é¡µä¸­ä¹Ÿè§£é‡Šäº†è¯¥lintçš„ä½œç”¨ï¼Œå³<strong>ä½¿ç”¨æŒ‡å®šçš„ç¼–ç å°†æºä»£ç ä¸­çš„å­—ç¬¦ä¸²å­—é¢é‡è½¬æ¢æˆunicodeï¼Œè€Œè¿™ä¸æºæ–‡ä»¶ç¼–ç æœ¬èº«å¹¶æ²¡æœ‰ç›´æ¥å…³ç³»</strong>ã€‚</p>
<blockquote>
<p>This PEP proposes to introduce a syntax to declare the encoding of a Python source file. The encoding information is then used by the Python parser to interpret the file using the given encoding. <strong>Most notably this enhances the interpretation of Unicode literals in the source code and makes it possible to write Unicode literals using e.g. UTF-8 directly in an Unicode aware editor</strong>.</p>
</blockquote>
<blockquote>
<p>â€¦</p>
</blockquote>
<blockquote>
<p>In Python 2.1, Unicode literals can only be written using the Latin-1 based encoding â€œunicode-escapeâ€. This makes the programming environment rather unfriendly to Python users who live and work in non-Latin-1 locales such as many of the Asian countries. <strong>Programmers can write their 8-bit strings using the favorite encoding, but are bound to the â€œunicode-escapeâ€ encoding for <em>Unicode literals</em> </strong>.</p>
</blockquote>
<p>æœ‰çš„è¯»è€…å¯èƒ½çœ‹åˆ°äº†ï¼Œåˆšæ‰çš„å¼•ç”¨ä¸­æ˜æ˜æåˆ°äº†</p>
<blockquote>
<p>The encoding information is then used by the Python parser to interpret the file using the given encoding.</p>
</blockquote>
<p>æ€ä¹ˆèƒ½è¯´ä¸æºæ–‡ä»¶çš„ç¼–ç æ— å…³å‘¢ï¼Ÿ</p>
<p>è¿™é‡Œå°±éœ€è¦äº†è§£Pythonè§£é‡Šå™¨å·¥ä½œçš„æµç¨‹äº†ï¼Œåœ¨<a href="https://www.python.org/dev/peps/pep-0263/" target="_blank" rel="noopener">PEP263</a>ä¸­æœ‰è¯´æ˜ï¼š</p>
<blockquote>
<p>Pythonâ€™s tokenizer/compiler combo will need to be updated to work as follows:<br>A. read the file<br>B. decode it into Unicode assuming a fixed per-file encoding<br>C. convert it into a UTF-8 byte string<br>D. tokenize the UTF-8 content<br>E. compile it, creating Unicode objects from the given Unicode data and creating string objects from the Unicode literal data by first reencoding the UTF-8 data into 8-bit string data using the given file encoding</p>
</blockquote>
<p>æ³¨æ„ï¼šæ­¥éª¤Bä¸­çš„encodingæŒ‡çš„ä¸æ˜¯æˆ‘ä»¬å£°æ˜çš„<code>coding:encoding</code>ï¼Œè€Œæ˜¯æºæ–‡ä»¶ä¿å­˜åœ¨ç£ç›˜ä¸Šçš„ç¼–ç ï¼Œæˆ‘ä»¬ç”¨åˆ°çš„ç¼–ç åªåœ¨æ­¥éª¤Eä¸­ä½¿ç”¨åˆ°ï¼Œä¸‹é¢çš„å®éªŒä¸­ä¹Ÿè¯æ˜äº†è¿™ä¸€ç‚¹ã€‚</p>
<p>æœ€åéœ€è¦è¯´æ˜çš„æ˜¯open(â€˜fileâ€™).read()å¾—åˆ°çš„æŒ‰å­—èŠ‚è¯»å–çš„strç±»å‹ï¼Œå¯ä»¥å‚è€ƒ<a href="http://wklken.me/posts/2013/08/31/python-extra-coding-intro.html#str-he-unicode" target="_blank" rel="noopener">PYTHON-è¿›é˜¶-ç¼–ç å¤„ç†å°ç»“</a>ã€‚</p>
<p>ç°åœ¨æœ‰ä¸¤ä¸ªæ–‡ä»¶åŠå…¶è¿è¡Œç»“æœï¼Œå› ä¸ºæˆ‘çš„ç»ˆç«¯ç¯å¢ƒä¸ºUTF-8ï¼Œæ‰€ä»¥GB18030çš„strè¾“å‡ºå§‹ç»ˆæ˜¯ä¹±ç çš„ã€‚</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#utf8.<span class="keyword">py</span></span><br><span class="line">#codin<span class="variable">g:utf</span>-<span class="number">8</span></span><br><span class="line"><span class="keyword">if</span>  __name__ == <span class="string">'__main__'</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'UTF-8æºpyä¸­çš„strä¸­æ–‡å­—ç¬¦'</span></span><br><span class="line">    <span class="keyword">print</span> <span class="keyword">u</span><span class="string">'UTF-8æºpyä¸­çš„unicodeä¸­æ–‡å­—ç¬¦'</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">file</span> = <span class="keyword">open</span>(<span class="string">'./utf8text'</span>,<span class="string">'r'</span>)</span><br><span class="line">    <span class="keyword">print</span> <span class="keyword">file</span>.readline()</span><br><span class="line">    <span class="keyword">file</span>.<span class="keyword">close</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">file</span> = <span class="keyword">open</span>(<span class="string">'./gb18030text'</span>,<span class="string">'r'</span>)</span><br><span class="line">    <span class="keyword">print</span> <span class="keyword">file</span>.readline().decode(<span class="string">'gb18030'</span>)</span><br><span class="line">    <span class="keyword">file</span>.<span class="keyword">close</span>()</span><br><span class="line"></span><br><span class="line"># è¿è¡Œ:<span class="keyword">python</span> utf8.<span class="keyword">py</span></span><br><span class="line"></span><br><span class="line">UTF-<span class="number">8</span>æº<span class="keyword">py</span>ä¸­çš„strä¸­æ–‡å­—ç¬¦</span><br><span class="line">UTF-<span class="number">8</span>æº<span class="keyword">py</span>ä¸­çš„unicodeä¸­æ–‡å­—ç¬¦</span><br><span class="line">UTF8æ–‡ä»¶ä¸­çš„ç¼–ç </span><br><span class="line"></span><br><span class="line">GB18030ï¿½Ä¼ï¿½ï¿½ĞµÄ±ï¿½ï¿½ï¿½</span><br></pre></td></tr></table></figure>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#gb18030.<span class="keyword">py</span></span><br><span class="line">#codin<span class="variable">g:</span> GB18030</span><br><span class="line"><span class="keyword">if</span>  __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'GB18030æºpyä¸­çš„strä¸­æ–‡'</span></span><br><span class="line">    <span class="keyword">print</span> <span class="keyword">u</span><span class="string">'GB18030æºpyä¸­çš„unicodeä¸­æ–‡'</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">file</span> = <span class="keyword">open</span>(<span class="string">'./utf8text'</span>,<span class="string">'r'</span>)</span><br><span class="line">    <span class="keyword">print</span> <span class="keyword">file</span>.readline()</span><br><span class="line">    <span class="keyword">file</span>.<span class="keyword">close</span>()</span><br><span class="line">    <span class="keyword">file</span> = <span class="keyword">open</span>(<span class="string">'./gb18030text'</span>,<span class="string">'r'</span>)</span><br><span class="line">    <span class="keyword">print</span> <span class="keyword">file</span>.readline()</span><br><span class="line">    <span class="keyword">file</span>.<span class="keyword">close</span>()</span><br><span class="line"></span><br><span class="line">#python gb18030.<span class="keyword">py</span></span><br><span class="line">GB18030Ô´<span class="keyword">py</span>ï¿½Ğµï¿½strï¿½ï¿½ï¿½ï¿½</span><br><span class="line">GB18030æº<span class="keyword">py</span>ä¸­çš„unicodeä¸­æ–‡</span><br><span class="line">UTF8æ–‡ä»¶ä¸­çš„ç¼–ç </span><br><span class="line"></span><br><span class="line">GB18030ï¿½Ä¼ï¿½ï¿½ĞµÄ±ï¿½ï¿½ï¿½</span><br></pre></td></tr></table></figure>
<p>è¿˜æœ‰ä¸€ä¸ªæ–‡ä»¶utf8gb18030.pyï¼Œå®ƒçš„æºæ–‡ä»¶ç¼–ç ä¸ºUTF-8ï¼Œä½†æ˜¯æˆ‘åœ¨å¤´éƒ¨å£°æ˜äº†<code>coding:utf-8</code>ï¼Œæ¥çœ‹ä¸€ä¸‹è¿™ä¸ªæ–‡ä»¶çš„è¿è¡Œç»“æœä¸ºä»€ä¹ˆï¼š</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#codin<span class="variable">g:</span> GB18030</span><br><span class="line"><span class="keyword">if</span>  __name__ == <span class="string">'__main__'</span>:</span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> <span class="string">'str:UTF-8æºpyä¸­çš„ä¸­æ–‡å­—ç¬¦,ä½†æ˜¯codingå£°æ˜ä¸ºGB18033'</span></span><br><span class="line">    <span class="keyword">print</span> <span class="keyword">u</span><span class="string">'unicode:UTF-8æºpyä¸­çš„ä¸­æ–‡å­—ç¬¦,ä½†æ˜¯codingå£°æ˜ä¸ºGB18033'</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">file</span> = <span class="keyword">open</span>(<span class="string">'./utf8text'</span>,<span class="string">'r'</span>)</span><br><span class="line">    <span class="keyword">print</span> <span class="keyword">file</span>.readline()</span><br><span class="line">    <span class="keyword">file</span>.<span class="keyword">close</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">file</span> = <span class="keyword">open</span>(<span class="string">'./gb18030text'</span>,<span class="string">'r'</span>)</span><br><span class="line">    <span class="keyword">print</span> <span class="keyword">file</span>.readline()</span><br><span class="line">    <span class="keyword">file</span>.<span class="keyword">close</span>()</span><br><span class="line"></span><br><span class="line"># <span class="keyword">python</span> utf8gb18030.<span class="keyword">py</span></span><br><span class="line">str:UTF-<span class="number">8</span>æº<span class="keyword">py</span>ä¸­çš„ä¸­æ–‡å­—ç¬¦,ä½†æ˜¯codingå£°æ˜ä¸ºGB18033</span><br><span class="line">unicode:UTF-<span class="number">8</span>å©§æœ<span class="keyword">y</span>æ¶“î… æ®‘æ¶“î…Ÿæƒç€›æ¥ƒîƒ,æµ£å—˜æ§¸codingæ¾¹ç‰ˆæ§‘æ¶“ç¯B18033</span><br><span class="line">UTF8æ–‡ä»¶ä¸­çš„ç¼–ç </span><br><span class="line"></span><br><span class="line">GB18030ï¿½Ä¼ï¿½ï¿½ĞµÄ±ï¿½ï¿½ï¿½</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œunicodeå¯¹è±¡åœ¨printåˆ°æ—¶å€™ä¼šæ ¹æ®sys.outçš„é»˜è®¤ç¼–ç è¿›è¡Œencode()çš„ï¼Œæ‰€ä»¥ä¸åº”è¯¥å‡ºç°ä¹±ç æƒ…å†µï¼Œä½†æ˜¯åœ¨ç¬¬ä¸‰æ¬¡è¯•éªŒä¸­ï¼Œæœ¬è¯¥ä¹±ç çš„stræ²¡æœ‰é—®é¢˜ï¼Œä¸è¯¥å‡ºç°ä¹±ç çš„unicodeå´ä¹±ç äº†ï¼Œè¿™è¯´æ˜åœ¨ä¸Šè¿°è§£é‡Šå™¨è¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œæ­¥éª¤Bå’Œæ­¥éª¤Eä½¿ç”¨çš„ä¸æ˜¯åŒä¸€ç¼–ç ï¼Œå¦åˆ™è¿è¡Œç»“æœä¸­unicodeæ˜¯ä¸ä¼šä¹±ç çš„ã€‚è™½ç„¶ä¸¤è€…ä¸å¿…ç›¸ç­‰ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿçœ‹åˆ°äº†ï¼Œè¿™ä¼šå¸¦æ¥æ›´å¤§çš„å›°æ‰°ï¼Œæ›´éš¾å®šä½é—®é¢˜æ‰€åœ¨ï¼Œæ‰€ä»¥<strong>ä¸€å®šè¦ä¿è¯æºæ–‡ä»¶çš„ç¼–ç ä¸å£°æ˜çš„<code>#coding:encoding</code>ä¸€è‡´ï¼Œå¦åˆ™å¾ˆéš¾è·³å‡ºå‘çš„</strong>ã€‚</p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><ol>
<li>ä½œä¸ºä¸€ä¸ªéçº¯Latin-1å¼€å‘è€…ï¼Œä¸€å®šè¦åœ¨å¤´éƒ¨å£°æ˜encoding hintã€‚</li>
<li>ä¸ºäº†é¿å…ä¸å¿…è¦çš„éº»çƒ¦ï¼Œå£°æ˜çš„encoding hint ä¸€å®šè¦ä¸æºæ–‡ä»¶çš„ç¼–ç ä¸€è‡´ã€‚</li>
<li>åœ¨ç¨‹åºå†…éƒ¨æœ€å¥½ç»Ÿä¸€å¤„ç†ä¸ºunicodeè¿›è¡Œï¼Œåœ¨è¾“å‡ºçš„æ—¶å€™åœ¨è¿›è¡Œencodeï¼Œå¦‚file.readline().decode(â€˜ä½ çš„æ–‡ä»¶ç¼–ç â€™)å¾—åˆ°unicodeï¼Œåœ¨å†™æ–‡ä»¶çš„æ—¶å€™å¯ä»¥æŒ‡å®šunicode_str.encode(â€˜ä½ éœ€è¦çš„ç¼–ç â€™)ã€‚</li>
<li>å­—é¢é‡å­—ç¬¦ä¸²åªæ˜¯ç”¨uâ€™xxxâ€™å¾—åˆ°unicodeã€‚</li>
<li>strå¯ä»¥decodeå¾—åˆ°unicodeï¼Œunicodeå¯ä»¥encodeå¾—åˆ°strï¼Œå…¶ä»–æ–¹å‘çš„ç¼–è§£ç æ˜¯ä¸å¯è¡Œçš„ï¼</li>
</ol>
<p>éš¾å…å‡ºé”™ï¼Œè¿˜è¯·ä¸åæŒ‡æ•™ã€‚</p>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p><a href="http://www.ruanyifeng.com/blog/2007/10/ascii_unicode_and_utf-8.html" target="_blank" rel="noopener">å­—ç¬¦ç¼–ç ç¬”è®°ï¼šASCIIï¼ŒUnicodeå’ŒUTF-8</a><br><a href="http://www.cnblogs.com/skynet/archive/2011/05/03/2035105.html" target="_blank" rel="noopener">å­—ç¬¦é›†å’Œå­—ç¬¦ç¼–ç ï¼ˆCharset &amp; Encodingï¼‰</a><br><a href="cn.nytimes.com/culture/20150123/t23questions">å…³äºPythonè„šæœ¬å¼€å¤´ä¸¤è¡Œçš„ï¼š#!/usr/bin/pythonå’Œ# -<em>- coding: utf-8 -</em>-çš„ä½œç”¨ â€“ æŒ‡å®šæ–‡ä»¶ç¼–ç ç±»å‹</a><br><a href="https://www.python.org/dev/peps/pep-0263/" target="_blank" rel="noopener">PEP 263 â€“ Defining Python Source Code Encodings</a><br><a href="https://pythonhosted.org/kitchen/unicode-frustrations.html" target="_blank" rel="noopener">Overcoming frustration: Correctly using unicode in python2</a><br><a href="https://docs.python.org/2/howto/unicode.html" target="_blank" rel="noopener">Unicode HOWTO</a><br><a href="http://stormhouse.github.io/posts/2013/character-encoding-python/" target="_blank" rel="noopener">pythonä¸­çš„å­—ç¬¦ç¼–ç </a></p>
]]></content>
      
        <categories>
            
            <category> Python </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Python </tag>
            
            <tag> charset </tag>
            
            <tag> encode </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[d3-example-of-different-data-structures]]></title>
      <url>http://dequn.github.io/2017/03/31/d3-example-of-different-data-structures/</url>
      <content type="html"><![CDATA[<style>
img{height:200px;}
</style>


<p>A simple list of chart types and data structure.</p>
<h1 id="Single-property"><a href="#Single-property" class="headerlink" title="Single property"></a>Single property</h1><h2 id="Box-Plots"><a href="#Box-Plots" class="headerlink" title="Box Plots"></a>Box Plots</h2><ul>
<li>Description: Use for Statistics: the smallest value, lower quartile, median, upper quartile,<br>and largest value.</li>
<li>Example:None.</li>
</ul>
<h2 id="Bubble-Chart"><a href="#Bubble-Chart" class="headerlink" title="Bubble Chart"></a>Bubble Chart</h2><ul>
<li>Description: Statistics, the area of circel stands for the count of a value, proper<br>to large amount of values than <strong>Bar Chart</strong>.</li>
<li>Example: <img src="https://camo.githubusercontent.com/dbaf877e0e81e571ae42fa1f6e1115bf052f72ca/687474703a2f2f64336a732e6f72672f65782f627562626c652e706e67" alt=""></li>
</ul>
<h2 id="Bullet-Chart"><a href="#Bullet-Chart" class="headerlink" title="Bullet Chart"></a>Bullet Chart</h2><ul>
<li>Description: A variation on a bar chart, compare a quantitative measure anainst<br>qualiative ranges and related markders.</li>
<li>Example: <img src="https://camo.githubusercontent.com/490b4c309e5ecb769b3969bed04b3b49bf516065/687474703a2f2f64336a732e6f72672f65782f62756c6c65742e706e67" alt=""></li>
</ul>
<h2 id="Calendar-Chart"><a href="#Calendar-Chart" class="headerlink" title="Calendar Chart"></a>Calendar Chart</h2><ul>
<li>Description: Values are visualized as colored cells per day, Use for compartion<br>between moths/years while having a day value detail.</li>
<li>Example: <img src="https://camo.githubusercontent.com/bc2b1c93d21e80d23c99da8ebd59617e94581327/687474703a2f2f64336a732e6f72672f65782f63616c656e6461722e706e67" alt=""></li>
<li>Example: <img src="https://camo.githubusercontent.com/fb70dfff84f2b442e89a6799e13343eda2387dc1/68747470733a2f2f676973742e6769746875622e636f6d2f746a6465636b652f353535383038342f7261772f7468756d626e61696c322e706e67" alt=""></li>
</ul>
<h2 id="Circular-heat-chart"><a href="#Circular-heat-chart" class="headerlink" title="Circular heat chart"></a><a href="http://prcweb.co.uk/circularheatchart/" target="_blank" rel="noopener">Circular heat chart</a></h2><ul>
<li>Description: A head map with a circular layout.</li>
<li>Example: <img src="http://prcweb.co.uk/img/rainfall-1980-2012.jpg" alt=""></li>
<li>Example: <img src="https://github.com/nicgirault/circosJS/raw/master/doc/temperatures.png" alt=""></li>
</ul>
<h2 id="A-3d-exmaple-for-one-property"><a href="#A-3d-exmaple-for-one-property" class="headerlink" title="A 3d exmaple for one property"></a>A 3d exmaple for one property</h2><p><img src="https://camo.githubusercontent.com/be49e2d5950922a2b221d6578fb2fe0f84b69384/687474703a2f2f616e696d61746564646174612e636f2e756b2f696d672f64332d67616c6c6572792f756b74656d70657261747572656c696e6573332e6a7067" alt=""></p>
<h1 id="A-and-B"><a href="#A-and-B" class="headerlink" title="A and B"></a>A and B</h1><h2 id="Chord-Diagram"><a href="#Chord-Diagram" class="headerlink" title="Chord Diagram"></a>Chord Diagram</h2><ul>
<li>Description: Show directed relationships among a group of entities.</li>
<li>Example: <img src="https://camo.githubusercontent.com/cc8ad10f5975dff97a5d6801269f8203101b20b9/687474703a2f2f64336a732e6f72672f65782f63686f72642e706e67" alt="abc"></li>
</ul>
<h2 id="Force-Directed-Graph"><a href="#Force-Directed-Graph" class="headerlink" title="Force-Directed Graph"></a>Force-Directed Graph</h2><ul>
<li>Description: Shows character co-occurence, related character in closer<br>proximity and unrelated characters are farther apart.</li>
<li>Example: <img src="https://camo.githubusercontent.com/d7b97d7c0873e949f827918763174efcca6c4a5f/687474703a2f2f64336a732e6f72672f65782f666f7263652e706e67" alt=""></li>
<li>Variants: <a href="https://bl.ocks.org/mbostock/4600693" target="_blank" rel="noopener">Curved Links</a>, <a href="http://bost.ocks.org/mike/fisheye/" target="_blank" rel="noopener">Fisheye<br>Distoration</a>, <a href="http://bost.ocks.org/mike/miserables/" target="_blank" rel="noopener">Matrix diagram</a><br>, <a href="http://mbostock.github.io/d3/talk/20111116/force-collapsible.html" target="_blank" rel="noopener">Collapse Force layout</a><br>, <a href="http://bl.ocks.org/MoritzStefaner/1377729" target="_blank" rel="noopener">Force-based label</a></li>
</ul>
<h2 id="Sector-Comparation"><a href="#Sector-Comparation" class="headerlink" title="Sector Comparation"></a><a href="http://www.brightpointinc.com/united-states-trade-deficit/" target="_blank" rel="noopener">Sector Comparation</a></h2><ul>
<li>Description: Comparation between two main properties with some sub propritis.</li>
<li>Example: <img src="https://camo.githubusercontent.com/c2826f9a0c78f2f0404b094c891348b72d38d54e/687474703a2f2f7777772e627269676874706f696e74696e632e636f6d2f696e7465726163746976652f696d616765732f446566696369745f32303270782e706e67" alt=""></li>
</ul>
<h1 id="A-B-and-C"><a href="#A-B-and-C" class="headerlink" title="A, B and C"></a>A, B and C</h1><h2 id="Circle-gram"><a href="#Circle-gram" class="headerlink" title="Circle gram"></a>Circle gram</h2><ul>
<li>Description:(X,Y)-&gt;Z, Z use circle and the area stands for Z value.</li>
<li>Example: <img src="https://camo.githubusercontent.com/d5cc8b32409a9d498d83ce13c3f13ec7ac664601/687474703a2f2f6e657572616c656e67722e636f6d2f61736966722f6a6f75726e616c732f6a6f75726e616c732e706e67" alt=""><br><img src="https://camo.githubusercontent.com/3fb6699cd8462e7a82b69c04ac5cb37b968c0f09/687474703a2f2f64336a732e6f72672f65782f66616365626f6f6b2d69706f2e706e67" alt=""></li>
</ul>
<h1 id="Tree"><a href="#Tree" class="headerlink" title="Tree"></a>Tree</h1><p>The following charts are used for showing data which has a tree data structure.</p>
<h2 id="Dendrogram"><a href="#Dendrogram" class="headerlink" title="Dendrogram"></a>Dendrogram</h2><ul>
<li>Description: Leaf nodes of the tree at the same depth, are aligned on the<br>right edge.</li>
<li>Example: <img src="https://camo.githubusercontent.com/e1a1948f0bcfa095d54793afd3ab96af97731773/687474703a2f2f64336a732e6f72672f65782f636c75737465722e706e67" alt=""></li>
</ul>
<h2 id="Hierarchical-Edge-Bundling"><a href="#Hierarchical-Edge-Bundling" class="headerlink" title="Hierarchical Edge Bundling"></a>Hierarchical Edge Bundling</h2><ul>
<li>Exampel: <img src="https://camo.githubusercontent.com/75572c7b80dabb1a0984bd8ea9d3ee16c5200fe3/687474703a2f2f64336a732e6f72672f65782f62756e646c652e706e67" alt=""></li>
</ul>
<h2 id="Treemap"><a href="#Treemap" class="headerlink" title="Treemap"></a>Treemap</h2><ul>
<li>Description: A treemap recursively subdivideds area into rectangles, the area<br>of any node in the tree corresponds to its value.</li>
<li>Example: <img src="https://camo.githubusercontent.com/e6612268ca90a8c2f6d1da62f85d7d86616c37de/687474703a2f2f64336a732e6f72672f65782f747265656d61702e706e67" alt=""></li>
</ul>
<h2 id="Partition-layout"><a href="#Partition-layout" class="headerlink" title="Partition layout"></a>Partition layout</h2><ul>
<li>Description: A treemap recursively subdivideds in horizational.</li>
<li>Example: <img src="https://camo.githubusercontent.com/48f41725f95dad3f65f65e5f47c1b70e932be48c/687474703a2f2f64336a732e6f72672f65782f706172746974696f6e2d7a6f6f6d2e706e67" alt=""></li>
</ul>
<h2 id="Circle-packing"><a href="#Circle-packing" class="headerlink" title="Circle packing"></a>Circle packing</h2><ul>
<li>Description: Use containment to represent the hierarchy, the area of circle<br>can stand for item value, it better reveals the hierarchy than treemap.</li>
<li>Example: <img src="https://camo.githubusercontent.com/428c04c95f2a18ce7178d9d6135f1eab8df10ebd/687474703a2f2f64336a732e6f72672f65782f7061636b2e706e67" alt=""></li>
<li>Variants: <a href="http://mbostock.github.com/d3/talk/20111116/pack-hierarchy.html" target="_blank" rel="noopener">Zoomable Pack layout</a></li>
</ul>
<h2 id="Sunburst"><a href="#Sunburst" class="headerlink" title="Sunburst"></a>Sunburst</h2><ul>
<li>Description: A treemap has a radial layout, all the root nodes are at the<br>center.</li>
<li>Exampel: <img src="https://camo.githubusercontent.com/1415e2af369262e466534480edbc7baa883e5b58/687474703a2f2f64336a732e6f72672f65782f73756e62757273742e706e67" alt=""></li>
<li>Variants: <a href="http://www.jasondavies.com/coffee-wheel/" target="_blank" rel="noopener">Zoomable Sunburst</a>, <a href="http://bl.ocks.org/kerryrodden/7090426" target="_blank" rel="noopener">Sequences sunburst</a></li>
</ul>
<h2 id="Node-Link-Tree"><a href="#Node-Link-Tree" class="headerlink" title="Node-Link Tree"></a>Node-Link Tree</h2><ul>
<li>Description: The depth of nodes is computed by distance from the root, leading<br>to a ragged appearance.</li>
<li>Example: <img src="https://camo.githubusercontent.com/e646acd936244a6db8a140fb0e1e421d95b97d8e/687474703a2f2f64336a732e6f72672f65782f747265652e706e67" alt=""></li>
</ul>
<h1 id="A-B-C-â€¦-gt-D-E-F-â€¦-with-intermediate-nodes"><a href="#A-B-C-â€¦-gt-D-E-F-â€¦-with-intermediate-nodes" class="headerlink" title="A, B , C, â€¦ -&gt; D, E, F, â€¦ with intermediate nodes."></a>A, B , C, â€¦ -&gt; D, E, F, â€¦ with intermediate nodes.</h1><h2 id="Sankey-Diagrams"><a href="#Sankey-Diagrams" class="headerlink" title="Sankey Diagrams"></a><a href="https://bost.ocks.org/mike/sankey/" target="_blank" rel="noopener">Sankey Diagrams</a></h2><ul>
<li>Description: Sankey diagrams visualize the magnitude of flow between nodes in<br>a network. This intricate diagram shows a possible scenario for UK energy<br>production and consumption in 2050: energy supplies are on the left, and<br>demands are on the right. Intermediate nodes group related forms of production<br>and show how energy is converted and transmitted before it is consumed (or<br>lost!). The thickness of each link encodes the amount of flow from source to<br>target.</li>
<li>Example: <img src="https://camo.githubusercontent.com/d9abb5b2b474c0e37728abedb9ba722f8b6e4f24/687474703a2f2f64336a732e6f72672f65782f73616e6b65792e706e67" alt=""></li>
</ul>
<h1 id="Compare-n-properties"><a href="#Compare-n-properties" class="headerlink" title="Compare n properties"></a>Compare n properties</h1><h2 id="Time-Series-Comparation"><a href="#Time-Series-Comparation" class="headerlink" title="Time Series Comparation"></a>Time Series Comparation</h2><ul>
<li>Description: None.</li>
<li>Example: <img src="https://camo.githubusercontent.com/aa4653694ba96e7991206963a698584169d54204/68747470733a2f2f676973742e6769746875622e636f6d2f6d6172756662642f373139313334302f7261772f616230353765656639323237653534393834333163303330633661643530343863623332366133612f7468756d626e61696c2e706e67" alt=""></li>
</ul>
<h2 id="Streamgraph"><a href="#Streamgraph" class="headerlink" title="Streamgraph"></a>Streamgraph</h2><ul>
<li>Description: None.</li>
<li>Example: <img src="https://camo.githubusercontent.com/3cbc8c7898d1336e83e499cb66274c15e63f65bf/687474703a2f2f64336a732e6f72672f65782f73747265616d2e706e67" alt=""></li>
</ul>
<h2 id="Bar-Line-Scatter-Stacked-bar-etc"><a href="#Bar-Line-Scatter-Stacked-bar-etc" class="headerlink" title="Bar, Line, Scatter, Stacked bar, etc."></a>Bar, Line, Scatter, Stacked bar, etc.</h2><h2 id="Radial-plot"><a href="#Radial-plot" class="headerlink" title="Radial plot"></a>Radial plot</h2><ul>
<li>Description: Boxplot for continuous data.</li>
<li>Example: <img src="https://camo.githubusercontent.com/f17a69dcf4d6cf3020fc77016844d6c46ae5419a/687474703a2f2f626c2e6f636b732e6f72672f646176696477636c696e2f7261772f61643564313364623236306361656666653962332f7468756d626e61696c2e706e67" alt=""></li>
</ul>
<h2 id="Radar-Chart"><a href="#Radar-Chart" class="headerlink" title="Radar Chart"></a>Radar Chart</h2><ul>
<li>Description: Comparation between n properties, all of them have the save<br>sacle.</li>
<li>Example: <img src="https://raw.githubusercontent.com/nbremer/thumbnails/master/D3%20Radar%20Chart%20Redesign.png" alt=""></li>
</ul>
<h1 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h1><h2 id="Choropleth"><a href="#Choropleth" class="headerlink" title="Choropleth"></a><a href="https://bl.ocks.org/mbostock/4060606" target="_blank" rel="noopener">Choropleth</a></h2><ul>
<li>Description: Color stands for value and showd in a geo-map.</li>
<li>Example: <img src="https://camo.githubusercontent.com/0afefbc191693b8ecaea58cda0b587a908fc0174/687474703a2f2f64336a732e6f72672f65782f63686f726f706c6574682e706e67" alt=""></li>
</ul>
<p>Not all, visit <a href="https://github.com/d3/d3/wiki/Gallery" target="_blank" rel="noopener">https://github.com/d3/d3/wiki/Gallery</a> for more examples.</p>
]]></content>
      
        <categories>
            
            <category> Others </category>
            
        </categories>
        
        
        <tags>
            
            <tag> d3 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[å°±æŠ˜è…¾åˆ°è¿™å„¿å§]]></title>
      <url>http://dequn.github.io/2016/12/27/jiu-zhe-teng-dao-zhe-er-ba/</url>
      <content type="html"><![CDATA[<p>ä¸Šä¸Šå‘¨ä»ç™¾åº¦æœç´¢éƒ¨Rankç»„é¢è¯•å›æ¥ä¹‹åï¼Œå°±æœ‰ç‚¹ä¸å®‰ï¼Œä¸‰é¢çš„é¢è¯•å®˜ç›´æ¥å‘Šè¯‰æˆ‘è¿™é¢çš„è¡¨ç°ä¸å¥½ï¼Œè®©å¥¹å¾ˆæ‹…å¿ƒã€‚è¯´è¿™å¥è¯åˆ†æ˜æ˜¯è®©æˆ‘å¾ˆæ‹…å¿ƒï¼Œæ ¸å¿ƒéƒ¨é—¨è¿˜æ˜¯å¾ˆå€¼å¾—æœŸå¾…çš„ã€‚ä¸€å‘¨éƒ½æ²¡æœ‰éŸ³ä¿¡ï¼Œæƒ³å¿…æ˜¯æŒ‚æ‰äº†ï¼Œä¸æ›¾æƒ³ä»Šå¤©æ¥åˆ°HRç”µè¯è”ç³»offeräº‹å®œï¼Œç»ˆäºå¯ä»¥æŠŠå¿ƒæ”¾è‚šå­é‡Œäº†ã€‚</p>
<p>ä»Šå¹´å››æœˆä»½çš„æ—¶å€™é¢äº†ä¸€æ¬¡è…¾è®¯å®ä¹ ï¼Œä¸æ„å¤–åœ°ç»ˆæ­¢åœ¨ä¸€é¢ã€‚å›æ¥ä¹‹åé‚£ä¸ªæƒ¶æå•Šï¼Œçªç„¶é—´å‘ç°ä»¥è‡ªèº«çš„èƒ½åŠ›ä»€ä¹ˆå·¥ä½œéƒ½æ‰¾ä¸åˆ°ï¼Œä½†åŒæ—¶è¿˜æ¬ ç€å°è®ºæ–‡æ²¡å†™ï¼Œåˆšæ¢äº†é¢˜ç›®è¿˜æ²¡æœ‰çœ‹æ–‡çŒ®ï¼Œä¸€ä¸‹å­éƒ½ä¸çŸ¥é“è¯¥åšä»€ä¹ˆäº†ã€‚æ¥ä¸‹æ¥çš„å‡ ä¸ªæœˆä¹Ÿæ˜¯æœ€ç—›è‹¦çš„ï¼Œä¸œä¸€æ£’æ§Œè¥¿ä¸€æ¦”å¤´ï¼Œå‹æ ¹æ²¡æœ‰ä¸»å¿ƒéª¨ã€‚</p>
<p>å¥½åœ¨æš‘æœŸçš„æ—¶å€™ç»ˆäºæŠŠå°è®ºæ–‡å‡‘å®Œäº†ï¼Œèµ¶ç´§åˆ·ç®—æ³•ï¼Œé¢è¯•ä¹Ÿéƒ½é™†é™†ç»­ç»­çš„å¼€å§‹äº†ï¼Œå‡†å¤‡äº†ä¸åˆ°ä¸€ä¸ªæœˆï¼Œå°±è¿›å…¥ç§‹æ‹›é«˜å³°æœŸï¼Œä¹Ÿå°±æ²¡æœ‰å†é™å¿ƒå‡†å¤‡äº†ã€‚ç¬”è¯•ä¸€ä¸ªæ¥ç€ä¸€ä¸ªï¼Œé¢è¯•ä»è¿˜æ˜¯å€’åœ¨ä¸€é¢ã€‚è…¾è®¯åœ°å›¾éƒ¨é—¨æå‰æ‰¹æ„Ÿè§‰è¿˜ä¸é”™ï¼Œç»“æœä¸è¡Œï¼Œå¾®åº—ä¸€é¢æ„Ÿè§‰ä¸å¥½ï¼ŒæŒ‚æ‰â€¦ä»æ¥ä¸çŸ¥é“äºŒé¢æ˜¯ä»€ä¹ˆæ ·å­ï¼Œæ›´æ‹…å¿ƒâ€”â€”å¦ˆçš„è¿™å¾—åˆ°ä»€ä¹ˆæ—¶å€™æ‰èƒ½æ‰¾åˆ°å·¥ä½œã€‚</p>
<p>é¢äº¬ä¸œçš„æ—¶å€™æ¯”è¾ƒé¡ºåˆ©ï¼Œè™½ç„¶åœ¨ä¸€äºŒé¢ä¸­å·²ç»çŸ¥é“å²—ä½ä¸æ˜¯æˆ‘æƒ³åšçš„ï¼Œä½†ä¸ºäº†ä¿åº•ä¹Ÿè¦é¢ä¸‹å»ï¼Œæ»‘ç¨½çš„æ˜¯HRé¢æŒ‚äº†â€¦çœŸæ˜¯è§é¬¼äº†ï¼ŒçŸ­çŸ­5åˆ†é’Ÿçš„ç”µé¢ï¼Œæˆ‘æƒ³çŠ¯é”™éƒ½éš¾å•Šã€‚åæ¥åä¸ºä¹Ÿæ˜¯ï¼Œä¸¤é¢è§‰å¾—éå¸¸é¡ºåˆ©ï¼Œä¸æ–™ä»ç„¶æ˜¯failedï¼Œè«éçœŸå¦‚å¸ˆå…„æ‰€è¯´çš„ï¼šæˆ‘çŠ¯äº†ä½çº§é”™è¯¯ï¼Ÿä½†å·²ç„¶ä¸è®°å¾—äº†â€¦</p>
<p>ç™¾åº¦æ˜¯ç¬¬ä¸€ä¸ªç»™offerçš„å…¬å¸ï¼Œä¹Ÿæ˜¯å”¯ä¸€ä¸€ä¸ªç»™äº†ä¸¤æ¬¡offerçš„ã€‚9æœˆä»½æ ¡æ‹›é¢è¯•æœºå™¨å­¦ä¹ ï¼Œä¸€é¢å°±æŒ‚äº†ï¼Œé¢è¯•å®˜è§‰å¾—codingè¿˜ä¸é”™ï¼Œæ¨èæˆ‘å»é¢å¼€å‘æµ‹è¯•ï¼Œå¹¶ç»™äº†ä¸€ç‚¹èŒä¸šè§„åˆ’çš„å»ºè®®ï¼ˆçœŸæ˜¯å¥½äººå•Šï¼Œå“ˆå“ˆï¼‰ï¼Œåæ¥é¡ºåˆ©é€šè¿‡å¼€å‘æµ‹è¯•çš„ä¸‰è½®é¢è¯•ï¼Œæ‰€ä»¥è¯´å¤šæ•°äººå½“å¤©éƒ½æ˜¯ä¸‰è½®é¢è¯•ï¼Œæˆ‘å´é¢äº†å››è½®ï¼Œä¹Ÿæ˜¯å¤Ÿæœ‰è¶£çš„ã€‚ä¹‹åè§‰å¾—å²—ä½ä¸å¤ªåˆé€‚å°±æ‹’ç»æ‰äº†ï¼Œéœ€è¦è¯´æ˜çš„æ˜¯æˆ‘ä¸€ç›´æ˜¯ä»¥å²—ä½ä¸ºç›®æ ‡çš„ï¼Œå¯¹å…¬å¸æ²¡æœ‰ä»€ä¹ˆè¦æ±‚ï¼Œæ‰€ä»¥åé¢ä¸€ä¸ªå°å…¬å¸ç»™äº†æ•°æ®æŒ–æ˜çš„å²—ä½è§‰å¾—è¿˜ä¸é”™å°±ç­¾äº†ï¼Œæœç‹—é¢è¯•è¦æˆ‘è¿›å»åšwebå¼€å‘ï¼ŒçŠ¹è±«äº†ä¸€ä¸‹ä¹‹åå°±ä»¥â€œç›®å‰è¿˜æ²¡æœ‰åœ¨webå¼€å‘ä¸Šæœ‰è¾ƒæ¸…æ™°çš„èŒä¸šè§„åˆ’â€å©‰æ‹’äº†ï¼Œä¹Ÿå°±ä¸æ„å¤–çš„æ— æœè€Œç»ˆäº†ã€‚</p>
<p>ç°åœ¨æƒ³æ¥çœŸæ˜¯ä½œï¼Œä¸ºä»€ä¹ˆéå¾—ä¸€æ ¹ç­‹çš„éå¾—å»é¢æ•°æ®æŒ–æ˜\æœºå™¨å­¦ä¹ ï¼Œå‹æ ¹æ²¡æœ‰ä»»ä½•ç›¸å…³çš„é¡¹ç›®ç»éªŒæ€ä¹ˆå»é¢ï¼åœ¨ç­¾äº†å°å…¬å¸çš„æ•°æ®æŒ–æ˜å²—ä½åè¿›å…¥è§‚æœ›é˜¶æ®µï¼Œèµ¶ç´§çš„è¡¥è¡¥è¯¾ï¼Œäº‹å®ä¸Šå›«å›µåæ£åŠæ‡‚ä¸æ‡‚åœ°å­¦ä¹ äº†ä¸€æ®µæ—¶é—´åå°±ä¹Ÿæ²¡å†åšæŒã€‚ç›´åˆ°çœ‹åˆ°ç™¾åº¦æœç´¢éƒ¨é—¨çš„è¡¥æ‹›ä¿¡æ¯ï¼Œå¹¶æ„å¤–çš„æœ‰é¢è¯•æœºä¼šï¼ŒçœŸå¿ƒä¸å®¹æ˜“ã€‚ä¸€äºŒé¢è¿˜ä¸é”™ï¼Œä¸‰é¢é¢è¯•å®˜åœ¨è¯´äº†æˆ‘è¡¨ç°ä¸å¥½ä¹‹åè¿˜è¡¥å……ä¸€å¥ï¼šå…¶å®ä½ çš„ç®€å†åœ¨æœºå™¨ç­›é€‰çš„æ—¶å€™å°±æ²¡èƒ½é€šè¿‡ï¼Œåæ¥çœ‹ä½ é¡¹ç›®ç»å†æ¶‰åŠçš„æ–¹é¢æ¯”è¾ƒå¤šï¼Œæ‰€ä»¥æ‰åˆç»™æå‡ºæ¥çœ‹çœ‹ä½ çš„ç»¼åˆèƒ½åŠ›â€¦</p>
<p>ç®€å†å¹³å¹³ï¼Œå› ä¸ºèƒ½åŠ›ã€ç»å†å®åœ¨æ˜¯å¤ªä¸€èˆ¬ï¼Œä¹Ÿéš¾æ€ªå¾ˆå¤šå…¬å¸å§‹ç»ˆæ²¡ç»™æˆ‘é¢è¯•çš„æœºä¼šã€‚å¤§å¸ˆå…„æ²¡å°‘ç»™åŠ æ²¹æ‰“æ°”ï¼Œå¯¼è‡´æˆ‘è‡ªå·±éƒ½å¿«ç›¸ä¿¡ä»–è¯´çš„äº†ï¼ˆè‚¯å®šæ²¡é—®é¢˜ï¼ï¼‰ï¼Œæ€è€ƒåæ‰æ˜ç™½:é¼“åŠ±ä¸æ˜¯ä½ å·²ç»åšåˆ°äº†ï¼Œè€Œæ˜¯éœ€è¦åšåˆ°çš„ï¼Œæˆ‘ä»¬å¤ªå®¹æ˜“è®¤ä¸ºé‚£äº›é¼“åŠ±çš„è¯éƒ½å·²æ˜¯äº‹å®äº†ã€‚</p>
<p>è¿™å·²ç»æ˜¯æˆ‘èƒ½æŠ˜è…¾åˆ°çš„æœ€å¥½ç»“æœäº†ï¼Œçº¯ç²¹æ˜¯æ’è¿æ°”çš„ç»“æœï¼Œè®ºçœŸå®åŠ›æ€ä¹ˆä¹Ÿä¸å¯èƒ½èƒœä»»çš„ã€‚è™½ç„¶æˆ‘ä¹Ÿæ˜¯ä¸ªç™¾åº¦é»‘ï¼Œå¾ˆå¤šäººä¹Ÿéª‚å®ƒï¼Œä½†èƒ½â€œå§”èº«â€äºè¿™æ ·çš„ç°å®ä¹Ÿå¾ˆæ»¡è¶³äº†ã€‚æ¥ä¸‹æ¥å°±æ˜¯æœ‰ä¸ªæ˜ç¡®çš„è§„åˆ’å’Œè®¡åˆ’ï¼Œæ€»ä¸èƒ½è·³ç¦»çš„æ—¶å€™è¿˜æ˜¯å¹³å¹³å§ï¼Ÿ</p>
<p>æ„Ÿè°¢ç»™æˆ‘å†…æ¨çš„å¸ˆå…„ã€å¸ˆå§å’Œä¸€äº›ä¸ªæ‹›è˜å¹³å°ï¼Œæ„Ÿè°¢è€æ¿ç»™æˆ‘å¼€æ”¾ã€è‡ªç”±çš„æ—¶é—´å’Œç©ºé—´ï¼Œæ„Ÿè°¢å‘¨å›´çš„å°ä¼™ä¼´å„¿ï¼Œæœ€åæ„Ÿè°¢ä¸€ä¸‹é¢è¯•å®˜å§ã€‚</p>
]]></content>
      
        <categories>
            
            <category> ä¸ªäººæ—¥è®° </category>
            
        </categories>
        
        
        <tags>
            
            <tag> é¢è¯• </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Zeppelin å®‰è£…é…ç½®çš„ä¸€äº›é—®é¢˜]]></title>
      <url>http://dequn.github.io/2016/11/20/zeppelin-installation-and-settings/</url>
      <content type="html"><![CDATA[<h1 id="1-ç‰ˆæœ¬é—®é¢˜"><a href="#1-ç‰ˆæœ¬é—®é¢˜" class="headerlink" title="1.ç‰ˆæœ¬é—®é¢˜"></a>1.ç‰ˆæœ¬é—®é¢˜</h1><p>Zeppelin ä»0.6.1ç‰ˆæœ¬å¼€å§‹ï¼Œé»˜è®¤æ˜¯åŸºäº Spark 2.x å’Œ Scala 2.11ç‰ˆæœ¬è¿›è¡Œç¼–è¯‘çš„ï¼Œäº²æµ‹ Zeppelin 0.6.2ä¸ Spark 1.6.x ç‰ˆæœ¬æ˜¯ä¸å…¼å®¹çš„ï¼Œå¯¼è‡´ Saprk Interpreters ä¸èƒ½æ­£ç¡®è¿è¡Œï¼Œå¦‚æœéœ€è¦å®‰è£…åœ¨è€ç‰ˆæœ¬ä¸Šçš„ï¼Œéœ€è¦è‡ªå·±ä»æºç ç¼–è¯‘ï¼Œå¯ä»¥æŒ‡å®š Sparkã€Hadoopç­‰ç‰ˆæœ¬å‚æ•°ï¼Œå¯ä»¥å‚è€ƒ <a href="http://zeppelin.apache.org/docs/snapshot/install/build.html" target="_blank" rel="noopener">http://zeppelin.apache.org/docs/snapshot/install/build.html</a> ï¼Œå¦‚æœæ˜¯0.6.0ç‰ˆæœ¬ï¼Œå¯ä¸ Spark 1.6.x ä¹‹å‰çš„å…¼å®¹è¿è¡Œã€‚</p>
<h1 id="2-Phoenix-thin-è¿æ¥é—®é¢˜"><a href="#2-Phoenix-thin-è¿æ¥é—®é¢˜" class="headerlink" title="2.Phoenix-thin è¿æ¥é—®é¢˜"></a>2.Phoenix-thin è¿æ¥é—®é¢˜</h1><p><strong><em>2017å¹´1æœˆ3å·æ›´æ–°</em></strong>ï¼š</p>
<p>Phoenix for Spark 2.x Integrationçš„è¡¥ä¸å·²ç»å‡ºæ¥äº†ï¼Œå¯ä»¥ç›´æ¥åŠ è½½ä¸ºDataFrameè€Œä¸ç”¨é€šè¿‡JDBCçš„æ–¹å¼è¿æ¥æ•°æ®åº“äº†ï¼Œä¼šè·å¾—æ›´é«˜çš„æ•ˆç‡ã€‚Pheonix for Spark 2.x ç‰ˆæœ¬çš„é—®é¢˜å¯ä»¥å‚è§<a href="https://issues.apache.org/jira/browse/PHOENIX-3333" target="_blank" rel="noopener">https://issues.apache.org/jira/browse/PHOENIX-3333</a>ï¼Œå¦‚ä½•ä½¿ç”¨å¯ä»¥å‚è§æ–‡ç« <a href="http://dequn.github.io/2016/11/08/phoenix-spark-setting/">Spark è¿æ¥ Phoenix é…ç½®</a>ã€‚</p>
<hr>
<p>Zeppelin ä»0.6.0ç‰ˆæœ¬å¼€å§‹æ”¯æŒ Phoenix è¿æ¥ï¼Œ<a href="http://www.phoenix.apache.org" target="_blank" rel="noopener">Phoenix</a>é»˜è®¤æ˜¯åœ¨jdbc interpreter ä¸­é…ç½®çš„ï¼Œé…ç½®è¿‡ç¨‹å¯ä»¥å‚è€ƒ <a href="https://zeppelin.apache.org/docs/0.6.2/interpreter/jdbc.html#phoenix" target="_blank" rel="noopener">https://zeppelin.apache.org/docs/0.6.2/interpreter/jdbc.html#phoenix</a> ï¼Œ<strong>æ³¨æ„ä¸€å®šè¦åœ¨Dependenciesä¸­æ·»åŠ artifact ä¾èµ–ï¼Œå¦‚æœä» mavenè¿œç¨‹åº“ä¸‹è½½å¤ªæ…¢ï¼Œå¯ä»¥ç›´æ¥å¡«å†™æœ¬åœ°<code>phoenix-&lt;version&gt;-thin-client.jar</code>æ–‡ä»¶è·¯å¾„ï¼Œæˆ–è€…æŠŠ jar æ–‡ä»¶å¤åˆ¶åˆ°è·¯å¾„<code>ZEPPELIN_HOME/interpreter/jdbc</code>ä¸‹ã€‚</strong></p>
<p>ä½†æ˜¯å¦‚æœä½¿ç”¨çš„æ˜¯phoenix-thin è¿æ¥ï¼Œä¼šæŠ¥é”™è¯¯</p>
<blockquote>
<p>No suitable driver found for <a href="http://localhost:8765" target="_blank" rel="noopener">http://localhost:8765</a></p>
</blockquote>
<p>åŸå› å¯ä»¥å‚è§ <a href="https://github.com/apache/zeppelin/pull/1442" target="_blank" rel="noopener">https://github.com/apache/zeppelin/pull/1442</a> ï¼Œæä¾›æˆ‘å·²ç»ç¼–è¯‘å¥½çš„ <a href="http://obqjd695a.bkt.clouddn.com/zeppelin-jdbc-0.6.2.jar" target="_blank" rel="noopener">zeppelin-jdbc-0.6.2.jar</a>ï¼Œæ›¿æ¢æ‰ <strong><code>ZEPPELIN_HOME/interpreter/jdbc</code></strong> ä¸‹è¾¹å¯¹åº”çš„åŒåæ–‡ä»¶å³å¯ã€‚</p>
<h3 id="æ–‡ä»¶ä¸‹è½½-zeppelin-jdbc-0-6-2-jar"><a href="#æ–‡ä»¶ä¸‹è½½-zeppelin-jdbc-0-6-2-jar" class="headerlink" title="æ–‡ä»¶ä¸‹è½½:zeppelin-jdbc-0.6.2.jar"></a>æ–‡ä»¶ä¸‹è½½:<a href="http://obqjd695a.bkt.clouddn.com/zeppelin-jdbc-0.6.2.jar" target="_blank" rel="noopener">zeppelin-jdbc-0.6.2.jar</a></h3><h1 id="3-zeppelinä¸­ç”¨-scala-åŠ è½½-jdbc-æ•°æ®é—®é¢˜"><a href="#3-zeppelinä¸­ç”¨-scala-åŠ è½½-jdbc-æ•°æ®é—®é¢˜" class="headerlink" title="3.zeppelinä¸­ç”¨ scala åŠ è½½ jdbc æ•°æ®é—®é¢˜"></a>3.zeppelinä¸­ç”¨ scala åŠ è½½ jdbc æ•°æ®é—®é¢˜</h1><p><strong><em>2017å¹´1æœˆ3å·æ›´æ–°</em></strong>ï¼š</p>
<p>å¥½ä¹…æ²¡æœ‰ä½¿ç”¨ï¼Œé‡æ–°æŠ˜è…¾äº†ä¸€ä¸‹ï¼Œå‘ç°<strong>org.apache.hadoop.tracing.SpanReceiverHost.get(xxx)æŠ¥é”™</strong>æ˜¯ç”±äºZeppelinæä¾›çš„Hadoopç‰ˆæœ¬å’ŒSparkç¼–è¯‘æ—¶æŒ‡å®šçš„ç‰ˆæœ¬ä¸ä¸€è‡´å¼•èµ·ï¼Œåªéœ€è¦ä½¿ç”¨$SPARK_HOME/jars/hadoop-annotations-2.7.3.jarã€hadoop-auth-2.7.3.jarã€hadoop-common-2.7.3.jaræ›¿æ¢æ‰$ZEPPELIN_HOME/libä¸‹çš„å¯¹åº”æ–‡ä»¶å³å¯ã€‚å…·ä½“å¯ä»¥å‚è€ƒ<a href="http://blog.csdn.net/lsshlsw/article/details/53768756" target="_blank" rel="noopener">Zeppelin 0.6.2 ä½¿ç”¨spark2.x çš„ä¸€äº›é”™è¯¯å¤„ç†</a>ã€‚</p>
<hr>
<p>åˆšå¼€å§‹ä½¿ç”¨çš„æ˜¯Spark 2.0.1ï¼Œä½¿ç”¨ä¸‹é¢çš„ä»£ç ç”¨ jdbc è¯»å–æ•°æ®åº“ä¸­çš„æ•°æ®ï¼Œå‘ç°æ€»æ˜¯æŠ¥é”™ï¼Œç¬¬ä¸€ä¸ªå…³äº xxx.hive.ql.xxx çš„é”™è¯¯ï¼Œåœ¨ interpreter çš„é…ç½®ä¸­å°†<code>zeppelin.spark.useHiveContext</code>é¡¹è®¾ç½®ä¸º<code>false</code>å³å¯ï¼Œ<del>å¦‚æœåé¢org.apache.hadoop.tracing.SpanReceiverHost.get(xxx)è¿˜ç»§ç»­æŠ¥é”™ï¼Œå¯ä»¥ <strong>å‡çº§ Spark2.0.2è¯•è¯•</strong> ï¼Œæˆ‘æ˜¯æ— æ„åœ¨ç¬”è®°æœ¬ä¸Šä½¿ç”¨ Spark2.0.2 å‘ç°çš„ ã€‚</del></p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">val <span class="keyword">jdbcDf </span>= spark.read</span><br><span class="line">.format(<span class="string">"jdbc"</span>)</span><br><span class="line">.option(<span class="string">"driver"</span>,<span class="string">"org.apache.phoenix.queryserver.client.Driver"</span>)</span><br><span class="line">.option(<span class="string">"url"</span>,<span class="string">"jdbc:phoenix:thin:url=http://localhost:8765;serialization=PROTOBUF"</span>)</span><br><span class="line">.option(<span class="string">"dbtable"</span>,<span class="string">"bigjoy.imos"</span>)</span><br><span class="line">.load()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">java.lang.RuntimeException: </span><span class="keyword">java.lang.RuntimeException: </span>Unable to <span class="keyword">instantiate </span><span class="keyword">org.apache.hadoop.hive.ql.metadata.SessionHiveMetaStoreClient</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.hadoop.hive.ql.session.SessionState.start(SessionState.java:522)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.spark.sql.hive.client.HiveClientImpl.&lt;init&gt;(HiveClientImpl.scala:189)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)</span><br><span class="line">  <span class="built_in">at</span> sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.<span class="keyword">java:62)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.<span class="keyword">java:45)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">java.lang.reflect.Constructor.newInstance(Constructor.java:423)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.spark.sql.hive.client.IsolatedClientLoader.createClient(IsolatedClientLoader.scala:258)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.spark.sql.hive.HiveUtils$.newClientForMetadata(HiveUtils.scala:359)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.spark.sql.hive.HiveUtils$.newClientForMetadata(HiveUtils.scala:263)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.spark.sql.hive.HiveSharedState.metadataHive$lzycompute(HiveSharedState.scala:39)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.spark.sql.hive.HiveSharedState.metadataHive(HiveSharedState.scala:38)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.spark.sql.hive.HiveSharedState.externalCatalog$lzycompute(HiveSharedState.scala:46)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.spark.sql.hive.HiveSharedState.externalCatalog(HiveSharedState.scala:45)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.spark.sql.hive.HiveSessionState.catalog$lzycompute(HiveSessionState.scala:50)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.spark.sql.hive.HiveSessionState.catalog(HiveSessionState.scala:48)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.spark.sql.hive.HiveSessionState$$anon$1.&lt;init&gt;(HiveSessionState.scala:63)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.spark.sql.hive.HiveSessionState.analyzer$lzycompute(HiveSessionState.scala:63)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.spark.sql.hive.HiveSessionState.analyzer(HiveSessionState.scala:62)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.spark.sql.execution.QueryExecution.assertAnalyzed(QueryExecution.scala:49)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.spark.sql.Dataset$.ofRows(Dataset.scala:64)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.spark.sql.SparkSession.baseRelationToDataFrame(SparkSession.scala:382)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.spark.sql.DataFrameReader.load(DataFrameReader.scala:143)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.spark.sql.DataFrameReader.load(DataFrameReader.scala:122)</span></span><br><span class="line"><span class="keyword"> </span> ... <span class="number">47</span> elided</span><br><span class="line">Caused <span class="keyword">by: </span><span class="keyword">java.lang.RuntimeException: </span>Unable to <span class="keyword">instantiate </span><span class="keyword">org.apache.hadoop.hive.ql.metadata.SessionHiveMetaStoreClient</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.hadoop.hive.metastore.MetaStoreUtils.newInstance(MetaStoreUtils.java:1523)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.hadoop.hive.metastore.RetryingMetaStoreClient.&lt;init&gt;(RetryingMetaStoreClient.java:86)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.hadoop.hive.metastore.RetryingMetaStoreClient.getProxy(RetryingMetaStoreClient.java:132)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.hadoop.hive.metastore.RetryingMetaStoreClient.getProxy(RetryingMetaStoreClient.java:104)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.hadoop.hive.ql.metadata.Hive.createMetaStoreClient(Hive.java:3005)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.hadoop.hive.ql.metadata.Hive.getMSC(Hive.java:3024)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.hadoop.hive.ql.session.SessionState.start(SessionState.java:503)</span></span><br><span class="line"><span class="keyword"> </span> ... <span class="number">69</span> more</span><br><span class="line">Caused <span class="keyword">by: </span><span class="keyword">java.lang.reflect.InvocationTargetException: </span><span class="keyword">java.lang.NoSuchMethodError: </span><span class="keyword">org.apache.hadoop.tracing.SpanReceiverHost.get(Lorg/apache/hadoop/conf/Configuration;Ljava/lang/String;)Lorg/apache/hadoop/tracing/SpanReceiverHost;</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)</span><br><span class="line">  <span class="built_in">at</span> sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.<span class="keyword">java:62)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.<span class="keyword">java:45)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">java.lang.reflect.Constructor.newInstance(Constructor.java:423)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.hadoop.hive.metastore.MetaStoreUtils.newInstance(MetaStoreUtils.java:1521)</span></span><br><span class="line"><span class="keyword"> </span> ... <span class="number">75</span> more</span><br><span class="line">Caused <span class="keyword">by: </span><span class="keyword">java.lang.NoSuchMethodError: </span><span class="keyword">org.apache.hadoop.tracing.SpanReceiverHost.get(Lorg/apache/hadoop/conf/Configuration;Ljava/lang/String;)Lorg/apache/hadoop/tracing/SpanReceiverHost;</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.hadoop.hdfs.DFSClient.&lt;init&gt;(DFSClient.java:634)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.hadoop.hdfs.DFSClient.&lt;init&gt;(DFSClient.java:619)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.hadoop.hdfs.DistributedFileSystem.initialize(DistributedFileSystem.java:149)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.hadoop.fs.FileSystem.createFileSystem(FileSystem.java:2596)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.hadoop.fs.FileSystem.access$200(FileSystem.java:91)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.hadoop.fs.FileSystem$Cache.getInternal(FileSystem.java:2630)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.hadoop.fs.FileSystem$Cache.get(FileSystem.java:2612)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.hadoop.fs.FileSystem.get(FileSystem.java:370)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.hadoop.fs.FileSystem.get(FileSystem.java:169)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.hadoop.fs.FileSystem.get(FileSystem.java:354)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.hadoop.fs.Path.getFileSystem(Path.java:296)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.hadoop.hive.metastore.Warehouse.getFs(Warehouse.java:104)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.hadoop.hive.metastore.Warehouse.getDnsPath(Warehouse.java:140)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.hadoop.hive.metastore.Warehouse.getDnsPath(Warehouse.java:146)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.hadoop.hive.metastore.Warehouse.getWhRoot(Warehouse.java:159)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.hadoop.hive.metastore.Warehouse.getDefaultDatabasePath(Warehouse.java:177)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.hadoop.hive.metastore.HiveMetaStore$HMSHandler.createDefaultDB_core(HiveMetaStore.java:600)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.hadoop.hive.metastore.HiveMetaStore$HMSHandler.createDefaultDB(HiveMetaStore.java:620)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.hadoop.hive.metastore.HiveMetaStore$HMSHandler.init(HiveMetaStore.java:461)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.hadoop.hive.metastore.RetryingHMSHandler.&lt;init&gt;(RetryingHMSHandler.java:66)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.hadoop.hive.metastore.RetryingHMSHandler.getProxy(RetryingHMSHandler.java:72)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.hadoop.hive.metastore.HiveMetaStore.newRetryingHMSHandler(HiveMetaStore.java:5762)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.hadoop.hive.metastore.HiveMetaStoreClient.&lt;init&gt;(HiveMetaStoreClient.java:199)</span></span><br><span class="line"><span class="keyword"> </span> <span class="built_in">at</span> <span class="keyword">org.apache.hadoop.hive.ql.metadata.SessionHiveMetaStoreClient.&lt;init&gt;(SessionHiveMetaStoreClient.java:74)</span></span><br><span class="line"><span class="keyword"> </span> ... <span class="number">80</span> more</span><br></pre></td></tr></table></figure>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p>[1]: <a href="http://zeppelin.apache.org/docs/snapshot/install/build.html" target="_blank" rel="noopener">Zeppelin æºç ç¼–è¯‘</a><br>[2]: <a href="https://zeppelin.apache.org/docs/0.6.2/interpreter/jdbc.html#phoenix" target="_blank" rel="noopener">Zeppelin Phoenix Interpreter é…ç½®</a><br>[3]: <a href="https://github.com/apache/zeppelin/pull/1442" target="_blank" rel="noopener">ZEPPELIN-1459: Zeppelin JDBC URL properties mangled</a><br>[4]: <a href="http://blog.csdn.net/lsshlsw/article/details/53768756" target="_blank" rel="noopener">Zeppelin 0.6.2 ä½¿ç”¨spark2.x çš„ä¸€äº›é”™è¯¯å¤„ç†</a></p>
]]></content>
      
        <categories>
            
            <category> Zeppelin </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Phoenix </tag>
            
            <tag> Spark </tag>
            
            <tag> Zeppelin </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Intellij IDEA ä¸­è°ƒè¯• Spark Application]]></title>
      <url>http://dequn.github.io/2016/11/19/debug-spark-in-intellij/</url>
      <content type="html"><![CDATA[<p>Spark æ–°æ‰‹ä¸€åï¼ŒåŒæ ·ä¹Ÿæ˜¯ Scala èœé¸Ÿï¼Œç”±äºå¯¹è¿™ä¸¤ä¸ªéƒ½ä¸æ˜¯ç‰¹åˆ«ç†Ÿæ‚‰ï¼Œæ‰€ä»¥å¸Œæœ›èƒ½åœ¨ IDEä¸­ coding å’Œ debugï¼Œä½†æ˜¯è°ƒè¯• Spark ç¨‹åºå’Œå¾€å¸¸æ¥è§¦è¿‡çš„ä¸ä¸€æ ·ï¼Œå¹¶ä¸”æœ‰ä¸€äº›è§‚å¿µä¸Šçš„é”™è¯¯ï¼Œæ€»ç»“ä¸€ä¸‹ã€‚</p>
<h1 id="å‘ä¸€ï¼šç½‘ç»œä»£ç†"><a href="#å‘ä¸€ï¼šç½‘ç»œä»£ç†" class="headerlink" title="å‘ä¸€ï¼šç½‘ç»œä»£ç†"></a>å‘ä¸€ï¼šç½‘ç»œä»£ç†</h1><p>ç¨‹åºå†™å¥½ä»¥åï¼Œå¯ä»¥ç›´æ¥ debug çš„(åªé™äº spark.master= local[*]çš„åœºæ™¯)ï¼Œç”±äºä½¿ç”¨äº† ShadowSocks å…¨å±€ä»£ç†ç¿»å¢™ï¼Œæœ€åˆä¸€ç›´æŠ¥é”™ï¼ŒGoogle äº†å¥½å¤§ä¼šå„¿ä¹Ÿæ²¡æ‰¾åˆ°é—®åŸå› ï¼Œåæ¥æ‰çŒ›çš„æƒ³èµ·ä»£ç†è¿˜å¼€ç€ï¼Œè€Œ hosts æ–‡ä»¶ä¸­æ°æ°æ²¡æœ‰ localhost æ˜ å°„åˆ°127.0.0.1ä¸­ï¼Œä¿®æ”¹ hostsï¼Œè§£å†³ã€‚ç›´æ¥ debug å¯ä»¥ä½¿ç”¨è¾ƒå°çš„æ•°æ®è¿›è¡Œæµ‹è¯•ï¼Œä¸æ˜¯éå¾—ç½‘ä¸Šä¼—å¤šæ•™ç¨‹é‚£æ ·å¾— sbt package -&gt; spark-submit -&gt; Remote Debug é‚£æ ·ä¸æ–¹ä¾¿ã€‚</p>
<h1 id="å‘äºŒï¼šworksheet-è¿è¡Œï¼Ÿ"><a href="#å‘äºŒï¼šworksheet-è¿è¡Œï¼Ÿ" class="headerlink" title="å‘äºŒï¼šworksheet è¿è¡Œï¼Ÿ"></a>å‘äºŒï¼šworksheet è¿è¡Œï¼Ÿ</h1><p>è™½ç„¶ spark-shellä¹Ÿæä¾›äº†äº¤äº’å¼å‘½ä»¤è¡Œï¼Œå°è¯•ä»£ç éå¸¸æ–¹ä¾¿ï¼Œä¸ç”¨æ¯æ¬¡éƒ½ debug å¯åŠ¨ sprakï¼Œé‚£æ ·æ•ˆç‡å¤ªä½ã€‚ç„¶è€Œä¿å­˜ä»£ç å°±æ¯”è¾ƒéº»çƒ¦äº†ï¼Œå› æ­¤æƒ³ç€èƒ½ä¸èƒ½ä½¿ç”¨ scala worksheetæ¥è¿è¡Œï¼Œè¿™æ ·ç»“æœä¹Ÿå³æ—¶å¯è§ï¼Œä»£ç ä¹Ÿä¸ä¼šä¸¢å¤±ï¼Œå°è¯•äº†ä¸€ç•ªï¼Œå‘ç°ä¸è¡Œï¼Œæœ‰é«˜æ‰‹è§£é‡Šä¸ºï¼šspark çš„ REPL è§£é‡Šå™¨å’Œ Scala çš„ä¸ä¸€æ ·ï¼Œå› æ­¤é‡Œè¾¹æ˜¯è¿è¡Œä¸äº† spark ç¨‹åºçš„ã€‚éš¾é“å°±æ²¡æœ‰å…¶ä»–åŠæ³•äº†å—ï¼Ÿæœ‰çš„ï¼Œé‡‡ç”¨Scala Console ä»£æ›¿ï¼Œåœ¨æ–‡ä»¶ä¸Šå³é”®ç‚¹å‡»ï¼Œé€‰æ‹© Run Scala Console å³å¯ï¼Œå¯ä»¥ä¸æŠŠæ–‡ä»¶é‡Œçš„ä»£ç å‘é€ç»™ console è¿è¡Œï¼Œè™½ç„¶ä¸å¦‚ worksheet æ–¹ä¾¿ï¼Œä½†ä¹Ÿå¥½è¿‡ spark-sheel æˆ–è€…æ¯æ¬¡éƒ½å¯åŠ¨ debugäº†ã€‚</p>
<h1 id="å‘ä¸‰ï¼šdebug-on-spark-cluster"><a href="#å‘ä¸‰ï¼šdebug-on-spark-cluster" class="headerlink" title="å‘ä¸‰ï¼šdebug on spark cluster"></a>å‘ä¸‰ï¼šdebug on spark cluster</h1><p>è¿™ä¸ªå’Œå‘ä¸€æœ‰äº›ç±»ä¼¼ï¼Œåœ¨è€æ¿çš„ä¸‰å°æœºå™¨ä¸Šæ­å»ºäº†ä¸€ä¸ªå°é›†ç¾¤ï¼Œå¹¶ä»¥ standlone cluster æ–¹å¼è¿è¡Œï¼Œäºæ˜¯å°±ç›´æ¥åœ¨ cluster ä¸Šdebug å§ï¼Œè·å– sparkContext çš„æ–¹å¼å¦‚ä»£ç æ‰€ç¤º<br><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">val spark = SparkSession.builder().<span class="literal">master</span>(<span class="string">"spark://192.168.6.131:7077"</span>).appName(<span class="string">"bigjoy"</span>).getOrCreate()</span><br></pre></td></tr></table></figure></p>
<p>åœ¨æ§åˆ¶å°ä¸­çš„ Log å¦‚ä¸‹ï¼Œä¸æ–­åœ°åœæ‰å’Œå¼€å¯ Executorï¼Œå¿ƒæƒ³ä¹Ÿä¸è‡³äºå§ï¼Œæ•°æ®é‡æ²¡é‚£ä¹ˆå¤§å‘€ï¼</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WARN TaskSchedulerImpl: Initial job has<span class="built_in"> not </span>accepted any resources;<span class="built_in"> check </span>your cluster UI to ensure that workers are registered<span class="built_in"> and </span>have sufficient resources</span><br></pre></td></tr></table></figure>
<p>äºæ˜¯å»æ£€æŸ¥ spark UI çš„ log, çœ‹åˆ°ä¸‹é¢çš„é”™è¯¯</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">Exception <span class="keyword">in</span> thread <span class="string">"main"</span> java<span class="selector-class">.lang</span><span class="selector-class">.reflect</span><span class="selector-class">.UndeclaredThrowableException</span></span><br><span class="line">	at org<span class="selector-class">.apache</span><span class="selector-class">.hadoop</span><span class="selector-class">.security</span><span class="selector-class">.UserGroupInformation</span><span class="selector-class">.doAs</span>(UserGroupInformation<span class="selector-class">.java</span>:<span class="number">1713</span>)</span><br><span class="line">	at org<span class="selector-class">.apache</span><span class="selector-class">.spark</span><span class="selector-class">.deploy</span><span class="selector-class">.SparkHadoopUtil</span><span class="selector-class">.runAsSparkUser</span>(SparkHadoopUtil<span class="selector-class">.scala</span>:<span class="number">70</span>)</span><br><span class="line">	at org<span class="selector-class">.apache</span><span class="selector-class">.spark</span><span class="selector-class">.executor</span><span class="selector-class">.CoarseGrainedExecutorBackend</span>$.run(CoarseGrainedExecutorBackend<span class="selector-class">.scala</span>:<span class="number">174</span>)</span><br><span class="line">	at org<span class="selector-class">.apache</span><span class="selector-class">.spark</span><span class="selector-class">.executor</span><span class="selector-class">.CoarseGrainedExecutorBackend</span>$.main(CoarseGrainedExecutorBackend<span class="selector-class">.scala</span>:<span class="number">270</span>)</span><br><span class="line">	at org<span class="selector-class">.apache</span><span class="selector-class">.spark</span><span class="selector-class">.executor</span><span class="selector-class">.CoarseGrainedExecutorBackend</span><span class="selector-class">.main</span>(CoarseGrainedExecutorBackend.scala)</span><br><span class="line">Caused by: org<span class="selector-class">.apache</span><span class="selector-class">.spark</span><span class="selector-class">.SparkException</span>: Exception thrown <span class="keyword">in</span> awaitResult</span><br><span class="line">	at org<span class="selector-class">.apache</span><span class="selector-class">.spark</span><span class="selector-class">.rpc</span><span class="selector-class">.RpcTimeout</span>$<span class="variable">$anonfun</span>$<span class="number">1</span>.applyOrElse(RpcTimeout<span class="selector-class">.scala</span>:<span class="number">77</span>)</span><br><span class="line">	at org<span class="selector-class">.apache</span><span class="selector-class">.spark</span><span class="selector-class">.rpc</span><span class="selector-class">.RpcTimeout</span>$<span class="variable">$anonfun</span>$<span class="number">1</span>.applyOrElse(RpcTimeout<span class="selector-class">.scala</span>:<span class="number">75</span>)</span><br><span class="line">	at scala<span class="selector-class">.runtime</span><span class="selector-class">.AbstractPartialFunction</span><span class="selector-class">.apply</span>(AbstractPartialFunction<span class="selector-class">.scala</span>:<span class="number">36</span>)</span><br><span class="line">	at org<span class="selector-class">.apache</span><span class="selector-class">.spark</span><span class="selector-class">.rpc</span><span class="selector-class">.RpcTimeout</span>$<span class="variable">$anonfun</span><span class="variable">$addMessageIfTimeout</span>$<span class="number">1</span>.applyOrElse(RpcTimeout<span class="selector-class">.scala</span>:<span class="number">59</span>)</span><br><span class="line">	at org<span class="selector-class">.apache</span><span class="selector-class">.spark</span><span class="selector-class">.rpc</span><span class="selector-class">.RpcTimeout</span>$<span class="variable">$anonfun</span><span class="variable">$addMessageIfTimeout</span>$<span class="number">1</span>.applyOrElse(RpcTimeout<span class="selector-class">.scala</span>:<span class="number">59</span>)</span><br><span class="line">	at scala.PartialFunction<span class="variable">$OrElse</span>.apply(PartialFunction<span class="selector-class">.scala</span>:<span class="number">167</span>)</span><br><span class="line">	at org<span class="selector-class">.apache</span><span class="selector-class">.spark</span><span class="selector-class">.rpc</span><span class="selector-class">.RpcTimeout</span><span class="selector-class">.awaitResult</span>(RpcTimeout<span class="selector-class">.scala</span>:<span class="number">83</span>)</span><br><span class="line">	at org<span class="selector-class">.apache</span><span class="selector-class">.spark</span><span class="selector-class">.rpc</span><span class="selector-class">.RpcEnv</span><span class="selector-class">.setupEndpointRefByURI</span>(RpcEnv<span class="selector-class">.scala</span>:<span class="number">88</span>)</span><br><span class="line">	at org<span class="selector-class">.apache</span><span class="selector-class">.spark</span><span class="selector-class">.executor</span><span class="selector-class">.CoarseGrainedExecutorBackend</span>$<span class="variable">$anonfun</span><span class="variable">$run</span>$<span class="number">1</span>.apply<span class="variable">$mcV</span><span class="variable">$sp</span>(CoarseGrainedExecutorBackend<span class="selector-class">.scala</span>:<span class="number">188</span>)</span><br><span class="line">	at org<span class="selector-class">.apache</span><span class="selector-class">.spark</span><span class="selector-class">.deploy</span><span class="selector-class">.SparkHadoopUtil</span>$<span class="variable">$anon</span>$<span class="number">1</span>.run(SparkHadoopUtil<span class="selector-class">.scala</span>:<span class="number">71</span>)</span><br><span class="line">	at org<span class="selector-class">.apache</span><span class="selector-class">.spark</span><span class="selector-class">.deploy</span><span class="selector-class">.SparkHadoopUtil</span>$<span class="variable">$anon</span>$<span class="number">1</span>.run(SparkHadoopUtil<span class="selector-class">.scala</span>:<span class="number">70</span>)</span><br><span class="line">	at java<span class="selector-class">.security</span><span class="selector-class">.AccessController</span><span class="selector-class">.doPrivileged</span>(Native Method)</span><br><span class="line">	at javax<span class="selector-class">.security</span><span class="selector-class">.auth</span><span class="selector-class">.Subject</span><span class="selector-class">.doAs</span>(Subject<span class="selector-class">.java</span>:<span class="number">422</span>)</span><br><span class="line">	at org<span class="selector-class">.apache</span><span class="selector-class">.hadoop</span><span class="selector-class">.security</span><span class="selector-class">.UserGroupInformation</span><span class="selector-class">.doAs</span>(UserGroupInformation<span class="selector-class">.java</span>:<span class="number">1698</span>)</span><br><span class="line">	... <span class="number">4</span> more</span><br><span class="line">Caused by: java<span class="selector-class">.io</span><span class="selector-class">.IOException</span>: Failed to connect to /<span class="number">192.168</span>.<span class="number">1.105</span>:<span class="number">51340</span></span><br><span class="line">	at org<span class="selector-class">.apache</span><span class="selector-class">.spark</span><span class="selector-class">.network</span><span class="selector-class">.client</span><span class="selector-class">.TransportClientFactory</span><span class="selector-class">.createClient</span>(TransportClientFactory<span class="selector-class">.java</span>:<span class="number">228</span>)</span><br><span class="line">	at org<span class="selector-class">.apache</span><span class="selector-class">.spark</span><span class="selector-class">.network</span><span class="selector-class">.client</span><span class="selector-class">.TransportClientFactory</span><span class="selector-class">.createClient</span>(TransportClientFactory<span class="selector-class">.java</span>:<span class="number">179</span>)</span><br><span class="line">	at org<span class="selector-class">.apache</span><span class="selector-class">.spark</span><span class="selector-class">.rpc</span><span class="selector-class">.netty</span><span class="selector-class">.NettyRpcEnv</span><span class="selector-class">.createClient</span>(NettyRpcEnv<span class="selector-class">.scala</span>:<span class="number">197</span>)</span><br><span class="line">	at org<span class="selector-class">.apache</span><span class="selector-class">.spark</span><span class="selector-class">.rpc</span><span class="selector-class">.netty</span><span class="selector-class">.Outbox</span>$<span class="variable">$anon</span>$<span class="number">1</span>.call(Outbox<span class="selector-class">.scala</span>:<span class="number">191</span>)</span><br><span class="line">	at org<span class="selector-class">.apache</span><span class="selector-class">.spark</span><span class="selector-class">.rpc</span><span class="selector-class">.netty</span><span class="selector-class">.Outbox</span>$<span class="variable">$anon</span>$<span class="number">1</span>.call(Outbox<span class="selector-class">.scala</span>:<span class="number">187</span>)</span><br><span class="line">	at java<span class="selector-class">.util</span><span class="selector-class">.concurrent</span><span class="selector-class">.FutureTask</span><span class="selector-class">.run</span>(FutureTask<span class="selector-class">.java</span>:<span class="number">266</span>)</span><br><span class="line">	at java<span class="selector-class">.util</span><span class="selector-class">.concurrent</span><span class="selector-class">.ThreadPoolExecutor</span><span class="selector-class">.runWorker</span>(ThreadPoolExecutor<span class="selector-class">.java</span>:<span class="number">1142</span>)</span><br><span class="line">	at java<span class="selector-class">.util</span><span class="selector-class">.concurrent</span><span class="selector-class">.ThreadPoolExecutor</span><span class="variable">$Worker</span>.run(ThreadPoolExecutor<span class="selector-class">.java</span>:<span class="number">617</span>)</span><br><span class="line">	at java<span class="selector-class">.lang</span><span class="selector-class">.Thread</span><span class="selector-class">.run</span>(Thread<span class="selector-class">.java</span>:<span class="number">745</span>)</span><br><span class="line">Caused by: java<span class="selector-class">.net</span><span class="selector-class">.NoRouteToHostException</span>: No route to host: /<span class="number">192.168</span>.<span class="number">1.105</span>:<span class="number">51340</span></span><br><span class="line">	at sun<span class="selector-class">.nio</span><span class="selector-class">.ch</span><span class="selector-class">.SocketChannelImpl</span><span class="selector-class">.checkConnect</span>(Native Method)</span><br><span class="line">	at sun<span class="selector-class">.nio</span><span class="selector-class">.ch</span><span class="selector-class">.SocketChannelImpl</span><span class="selector-class">.finishConnect</span>(SocketChannelImpl<span class="selector-class">.java</span>:<span class="number">717</span>)</span><br><span class="line">	at io<span class="selector-class">.netty</span><span class="selector-class">.channel</span><span class="selector-class">.socket</span><span class="selector-class">.nio</span><span class="selector-class">.NioSocketChannel</span><span class="selector-class">.doFinishConnect</span>(NioSocketChannel<span class="selector-class">.java</span>:<span class="number">224</span>)</span><br><span class="line">	at io<span class="selector-class">.netty</span><span class="selector-class">.channel</span><span class="selector-class">.nio</span><span class="selector-class">.AbstractNioChannel</span><span class="variable">$AbstractNioUnsafe</span>.finishConnect(AbstractNioChannel<span class="selector-class">.java</span>:<span class="number">289</span>)</span><br><span class="line">	at io<span class="selector-class">.netty</span><span class="selector-class">.channel</span><span class="selector-class">.nio</span><span class="selector-class">.NioEventLoop</span><span class="selector-class">.processSelectedKey</span>(NioEventLoop<span class="selector-class">.java</span>:<span class="number">528</span>)</span><br><span class="line">	at io<span class="selector-class">.netty</span><span class="selector-class">.channel</span><span class="selector-class">.nio</span><span class="selector-class">.NioEventLoop</span><span class="selector-class">.processSelectedKeysOptimized</span>(NioEventLoop<span class="selector-class">.java</span>:<span class="number">468</span>)</span><br><span class="line">	at io<span class="selector-class">.netty</span><span class="selector-class">.channel</span><span class="selector-class">.nio</span><span class="selector-class">.NioEventLoop</span><span class="selector-class">.processSelectedKeys</span>(NioEventLoop<span class="selector-class">.java</span>:<span class="number">382</span>)</span><br><span class="line">	at io<span class="selector-class">.netty</span><span class="selector-class">.channel</span><span class="selector-class">.nio</span><span class="selector-class">.NioEventLoop</span><span class="selector-class">.run</span>(NioEventLoop<span class="selector-class">.java</span>:<span class="number">354</span>)</span><br><span class="line">	at io<span class="selector-class">.netty</span><span class="selector-class">.util</span><span class="selector-class">.concurrent</span><span class="selector-class">.SingleThreadEventExecutor</span>$<span class="number">2</span>.run(SingleThreadEventExecutor<span class="selector-class">.java</span>:<span class="number">111</span>)</span><br><span class="line">	... <span class="number">1</span> more</span><br></pre></td></tr></table></figure>
<p>çœ‹åˆ° IP:192.168.1.105 åçŒ›ç„¶æƒ³èµ·ï¼Œä¸ªäººä½¿ç”¨çš„ç¬”è®°æœ¬ç½‘ç»œè¿æ¥çš„æ˜¯åŠå…¬å®¤çš„è·¯ç”±å™¨ï¼Œè€ŒåŠå…¬å®¤çš„è·¯ç”±å™¨çš„ ip æ‰æ˜¯å’Œé›†ç¾¤çš„æœºå™¨ Ip åœ¨åŒä¸€å±€åŸŸç½‘ä¸­ï¼Œä¸­é—´è·¨äº†çº§ï¼åŠå…¬å®¤çš„è·¯ç”±å™¨åˆæ²¡æœ‰è®¾ç½®ç«¯å£æ˜ å°„ï¼Œéš¾æ€ªæ‰¾ä¸åˆ°ï¼æ”¹ä¸ºä½¿ç”¨å•ä½çš„æ— çº¿è·¯ç”±ï¼ˆå’Œé›†ç¾¤ä¸€ä¸ªå±€åŸŸç½‘ï¼‰åå°±æ²¡æœ‰æ­¤é”™è¯¯äº†ï¼æˆ–è€…ä¹Ÿå¯ä»¥è®¾ç½®ä¸€ä¸‹å°è·¯ç”±å™¨çš„ç«¯å£æ˜ å°„ï¼</p>
<h1 id="å‘å››ï¼šsbt-æˆ–-maven-ä¸­çš„ä¾èµ–ç‰ˆæœ¬ï¼ˆåŒ…æ‹¬å°ç‰ˆæœ¬ï¼‰ä¸€å®šè¦ä¸é›†ç¾¤ä¸€è‡´"><a href="#å‘å››ï¼šsbt-æˆ–-maven-ä¸­çš„ä¾èµ–ç‰ˆæœ¬ï¼ˆåŒ…æ‹¬å°ç‰ˆæœ¬ï¼‰ä¸€å®šè¦ä¸é›†ç¾¤ä¸€è‡´" class="headerlink" title="å‘å››ï¼šsbt æˆ– maven ä¸­çš„ä¾èµ–ç‰ˆæœ¬ï¼ˆåŒ…æ‹¬å°ç‰ˆæœ¬ï¼‰ä¸€å®šè¦ä¸é›†ç¾¤ä¸€è‡´"></a>å‘å››ï¼šsbt æˆ– maven ä¸­çš„ä¾èµ–ç‰ˆæœ¬ï¼ˆåŒ…æ‹¬å°ç‰ˆæœ¬ï¼‰ä¸€å®šè¦ä¸é›†ç¾¤ä¸€è‡´</h1><p>ä½¿ç”¨å‘ä¸‰ä¸­çš„ debug on cluster, ç”±äºå¾ˆæ—©å»ºç«‹çš„ maven å·¥ç¨‹ï¼Œé‡‡ç”¨çš„æ˜¯ org.apache.spark:spark-core_2.1:2.0.1ä¾èµ–ï¼Œåæ¥æ­å»ºé›†ç¾¤çš„æ—¶å€™2.0.2ç‰ˆæœ¬å·²ç»å‘å¸ƒï¼Œæ‰€ä»¥é‡‡ç”¨äº†æœ€æ–°çš„ï¼Œç”±äºå¤§ç‰ˆæœ¬ä¸€è‡´ï¼Œæ‰€ä»¥å°±æ²¡æœ‰åœ¨æ„ï¼Œdebug çš„æ—¶å€™æŠ¥ä»¥ä¸‹é”™è¯¯ï¼š</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.io.InvalidClassException: org.apache.spark.executor.TaskMetrics; <span class="keyword">local</span> <span class="built_in">class</span> incompatible: stream classdesc serialVersionUID = <span class="number">-6966587383730940799</span>, <span class="keyword">local</span> <span class="built_in">class</span> serialVersionUID = <span class="number">-2231953621568687904</span></span><br></pre></td></tr></table></figure>
<p>æ­¤é—®é¢˜ç”±å°ç‰ˆæœ¬ä¸ä¸€è‡´å¯¼è‡´ï¼Œè¯´æ¥ä¹Ÿæ­£å¸¸ï¼Œå‘ä¸‹å…¼å®¹å¾ˆæ­£å¸¸ï¼Œä½†å‘ä¸Šçš„ï¼Œå‘µå‘µï¼Œæ‰€ä»¥ä¿æŒä¸€è‡´å§ï¼</p>
<h1 id="å‘äº”ï¼šæ‰¾ä¸åˆ°ç±»ï¼Ÿ"><a href="#å‘äº”ï¼šæ‰¾ä¸åˆ°ç±»ï¼Ÿ" class="headerlink" title="å‘äº”ï¼šæ‰¾ä¸åˆ°ç±»ï¼Ÿ"></a>å‘äº”ï¼šæ‰¾ä¸åˆ°ç±»ï¼Ÿ</h1><p>ç”±äºå·¥ç¨‹é‡‡ç”¨ maven æ„å»ºï¼Œæˆ‘ä½¿ç”¨äº† phoenix çš„ä¾èµ–ï¼Œå½“ spark.master=local[*]çš„æ—¶å€™ï¼Œè°ƒè¯•æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œä½†æ˜¯å½“æŠŠ spark.master è®¾ç½®ä¸º spark://spark-master:7077ä¹Ÿå°±æ˜¯é‡‡ç”¨é›†ç¾¤çš„æ—¶å€™ï¼Œä¼šæç¤ºé™¤ spark è‡ªå¸¦çš„ï¼ˆcore, sql,mllib, streamï¼‰åº“ä¹‹å¤–ï¼Œå…¶ä»–çš„éƒ½æç¤ºæ‰¾ä¸åˆ°ï¼Œè§£å†³æ–¹æ¡ˆé™¤äº† <strong> 1ï¼‰å‚è€ƒç½‘ä¸Šçš„è¿œç¨‹è°ƒè¯•å¤–</strong> ï¼Œç°æä¾›å¦ä¸€ç§æ–¹å¼ï¼Œ<strong> 2)ç±»ä¼¼äº Hadoopçš„è°ƒè¯•æ–¹å¼</strong></p>
<h2 id="1-è®¾ç½®-artifact"><a href="#1-è®¾ç½®-artifact" class="headerlink" title="1.è®¾ç½® artifact"></a>1.è®¾ç½® artifact</h2><p>File -&gt; Project Structre, åœ¨ Artifacts é‡Œè¾¹æ–°å»ºä¸€ä¸ª jar åŒ…ï¼Œé€‰æ‹©ä¸»ç±»ï¼Œåœ¨ Output Layout ä¸­å¯ä»¥åˆ é™¤ spark ç›¸å…³çš„ï¼ˆå› ä¸ºé›†ç¾¤ä¸­å·²ç»æœ‰äº†ï¼Œå…¶ä»–é›†ç¾¤ä¸­CASSPATH åŒ…å«çš„éƒ½å¯ä»¥çœæ‰ï¼Œå‡å°‘ jaråŒ…ä½“ç§¯ï¼‰ï¼Œæœ€åç¡®è®¤å³å¯ã€‚</p>
<p><img src="https://i.loli.net/2019/07/25/5d39600d7e7fe40901.png" alt=""><br><img src="https://i.loli.net/2019/07/25/5d395c8d53a4819000.png" alt=""><br><img src="https://i.loli.net/2019/07/25/5d395c8d98d4e97694.png" alt=""></p>
<h2 id="2-spark-æ·»åŠ -jar-ä¾èµ–"><a href="#2-spark-æ·»åŠ -jar-ä¾èµ–" class="headerlink" title="2.spark æ·»åŠ  jar ä¾èµ–"></a>2.spark æ·»åŠ  jar ä¾èµ–</h2><p>åªéœ€è¦ä¸ª sparkContext æ·»åŠ  jaråŒ…å³å¯ï¼Œä»£ç å¦‚ä¸‹</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> val spark = SparkSession.builder().master(<span class="string">"spark://192.168.6.131:7077"</span>).appName(<span class="string">"bigjoy"</span>).getOrCreate()</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ³¨æ„è·¯å¾„æ˜¯ç¼–è¯‘åçš„è·¯å¾„</span></span><br><span class="line">    spark<span class="selector-class">.sparkContext</span><span class="selector-class">.addJar</span>(<span class="string">"/Users/dq/IdeaProjects/subject/out/artifacts/analysis_jar/analysis.jar"</span>)</span><br></pre></td></tr></table></figure>
<p>åœ¨debug å‰ï¼Œå…ˆ Build -&gt; Build Artifacts -&gt; xxx.jarï¼ŒæŠŠä»£ç ä¸­çš„è·¯å¾„æ›¿æ¢ä¸ºå®é™…çš„è·¯å¾„ï¼Œç„¶åå°±å¯ä»¥åƒå…¶ä»–æ™®é€šçš„ä»£ç ä¸€æ ·è°ƒè¯•äº†ï¼Œä¸è¿‡å‘ç°è¿è¡Œçš„æ¯”è¾ƒæ…¢ï¼Œå› ä¸ºæ²¡æœ‰ä¸è¿œç¨‹è°ƒè¯•çš„è¿›è¡Œå¯¹æ¯”ï¼Œæ‰€ä»¥å“ªä¸ªæ›´å¥½ä¸€äº›å°±æš‚ä¸èƒ½ä¸‹ç»“è®ºäº†ï¼Œä¸è¿‡è¿™ä¸ªå…å»äº†ä¸Šä¼  jar åŒ…ã€spark-submitã€remote debug ç­‰è¿‡ç¨‹ï¼Œç®€å•ä¸€äº›ã€‚</p>
<p>å°±å…ˆæ€»ç»“è¿™ä¹ˆå¤šå§ï¼</p>
]]></content>
      
        <categories>
            
            <category> Spark </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Spark </tag>
            
            <tag> Intellij IDEA </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Spark è¿æ¥ Phoenix é…ç½®]]></title>
      <url>http://dequn.github.io/2016/11/08/phoenix-spark-setting/</url>
      <content type="html"><![CDATA[<p><strong><em>2017å¹´1æœˆ3å·æ›´æ–°ï¼š</em></strong></p>
<p>åœ¨Spark 2.xç‰ˆæœ¬ä¸­æ›´æ”¹äº†DataFrameçš„å®šä¹‰ï¼Œè€ŒPhoenix4.9åŠä»¥å‰(4.10åå®˜æ–¹ç‰ˆæœ¬ä¼šä¿®å¤ï¼‰æ˜¯åœ¨Spark1.xçš„ç¯å¢ƒä¸‹å¼€å‘çš„ï¼Œå› æ­¤å¦‚æœä½¿ç”¨Spark2.xçš„ç¯å¢ƒï¼Œä¸èƒ½æ­£å¸¸ä½¿ç”¨Phoenix Spark Interprter, å…·ä½“é—®é¢˜å¯ä»¥å‚è€ƒ <a href="https://issues.apache.org/jira/browse/PHOENIX-3333" target="_blank" rel="noopener">https://issues.apache.org/jira/browse/PHOENIX-3333</a>ï¼Œè¿™é‡Œç»™å‡ºæœ¬äººåˆ©ç”¨é“¾æ¥ä¸­çš„è¡¥ä¸ç¼–è¯‘åçš„phoenixï¼Œå…¶ä»–å‚è€ƒ1.xç‰ˆæœ¬ä¸­çš„é…ç½®æ–¹å¼å³å¯ã€‚</p>
<p><a href="http://obqjd695a.bkt.clouddn.com/phoenix-4.9.0-HBase-1.2-server.jar" target="_blank" rel="noopener">phoenix-4.9.0-HBase-1.2-server.jar</a></p>
<p><a href="http://obqjd695a.bkt.clouddn.com/phoenix-4.9.0-HBase-1.2-client.jar" target="_blank" rel="noopener">phoenix-4.9.0-HBase-1.2-client.jar</a></p>
<hr>
<p>Phoenix å®˜æ–¹æ–‡æ¡£ç»™å‡ºäº†å¦‚ä½•é…ç½®Spark è¿æ¥çš„è¯´æ˜ï¼Œä½†æ˜¯ç”±äºç‰ˆæœ¬æ›´æ–°æ¯”è¾ƒå¿«ï¼Œæ•™ç¨‹å·²ç»æœ‰äº›è¿‡æ—¶äº†ã€‚</p>
<p>ç¯å¢ƒé…ç½®ï¼š</p>
<blockquote>
<p>Spark 1.5.2<br>Phoenix 4.8.0<br>HBase 1.1.2</p>
</blockquote>
<p>å¦‚æœåœ¨ HBaseä¸Šé…ç½®è¿‡ Phoenix ï¼ŒæœåŠ¡ç«¯å°±ä¸éœ€è¦åšä»»ä½•æ”¹åŠ¨äº†ã€‚</p>
<p>åœ¨<strong> Phoenix 4.8</strong> ç‰ˆæœ¬ä¸­ï¼Œå·²ç»æ²¡æœ‰å®˜æ–¹ç¤ºä¾‹ä¸­çš„<code>phoenix-&lt;version&gt;-client-spark.jar</code>çš„æ–‡ä»¶äº†ï¼Œæ‰€æœ‰çš„å®¢æˆ·ç«¯éœ€è¦çš„ jar åªæœ‰ä¸€ä¸ª<strong> <code>phoenix-&lt;version&gt;-client.jar</code></strong> ï¼</p>
<p>è¿æ¥åœ¨ Spark ä¸­è¿æ¥Phoenix ä¹Ÿæœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<h2 id="æ–¹æ³•1"><a href="#æ–¹æ³•1" class="headerlink" title="æ–¹æ³•1"></a>æ–¹æ³•1</h2><p>spark-shell å¯åŠ¨æ—¶æ·»åŠ  phoenix jar.</p>
<p>å¯åŠ¨spark-shell æ˜¯æ·»åŠ å‚æ•°â€“jars å³å¯<br><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">spark-shell --jars /usr/local/phoenix/phoenix<span class="number">-4.8</span><span class="number">.0</span>-HBase<span class="number">-1.1</span>-client.jar</span><br><span class="line"># ....</span><br><span class="line"># ....</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.phoenix.spark._</span><br><span class="line"></span><br><span class="line"># è¿™ä¸€å¥ä¸æŠ¥é”™çš„è¯å°±è¯´æ˜æå®šäº†</span><br></pre></td></tr></table></figure></p>
<h2 id="æ–¹æ³•2"><a href="#æ–¹æ³•2" class="headerlink" title="æ–¹æ³•2"></a>æ–¹æ³•2</h2><p>é…ç½® spark-defaults.conf</p>
<p>å¦‚æœä¸æƒ³æ¯æ¬¡å¯åŠ¨éƒ½æ·»åŠ  â€“jars å‚æ•°ï¼Œå¯ä»¥é…ç½®$SPARK_HOME/conf ä¸‹è¾¹çš„spark-defaults.confæ–‡ä»¶ï¼Œæ·»åŠ ä¸‹é¢ä¸¤ä¸ªé…ç½®é¡¹ï¼Œæ³¨æ„ jar æ–‡ä»¶è·¯å¾„ä¸åç§°çš„æ­£ç¡®æ€§ã€‚<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spark<span class="selector-class">.executor</span><span class="selector-class">.extraClassPath</span>      /usr/local/phoenix/phoenix-<span class="number">4.8</span>.<span class="number">0</span>-HBase-<span class="number">1.1</span>-client.jar</span><br><span class="line">spark<span class="selector-class">.driver</span><span class="selector-class">.extraClassPath</span>      /usr/local/phoenix/phoenix-<span class="number">4.8</span>.<span class="number">0</span>-HBase-<span class="number">1.1</span>-client.jar</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ ·å†å¯åŠ¨spark-shellï¼Œå°±å¯ä»¥ç›´æ¥å¯¼å…¥éœ€è¦çš„åŒ…äº†ï¼Œæ³¨æ„ SparkContext sc å’Œ SQLContext sqlContext éƒ½å·²ç»æ˜¯è®¾ç½®å¥½äº†çš„ï¼Œå¯ä»¥ç›´æ¥ç”¨ã€‚å…¶ä»–å¯ä»¥å‚è€ƒå®˜æ–¹ç»™å‡ºçš„ç¤ºä¾‹ã€‚</p>
]]></content>
      
        <categories>
            
            <category> Phoenix </category>
            
        </categories>
        
        
        <tags>
            
            <tag> spark </tag>
            
            <tag> Phoenix </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[pyenvå®‰è£…å¤šç‰ˆæœ¬ Python è¿‡ç¨‹ä¸­æç¤ºè­¦å‘Š]]></title>
      <url>http://dequn.github.io/2016/11/02/pyenv-install-with-warnings/</url>
      <content type="html"><![CDATA[<p>åœ¨ä½¿ç”¨ pyenv å®‰è£…å¤šç‰ˆæœ¬ Python æ—¶ï¼Œæœ‰æ—¶å€™ä¼šé‡åˆ°è­¦å‘Š<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">WARNING:</span> The Python bz2 extension was not compiled. Missing the bzip2 <span class="class"><span class="keyword">lib</span>?</span></span><br><span class="line"><span class="symbol">WARNING:</span> The Python readline extension was not compiled. Missing the GNU readline <span class="class"><span class="keyword">lib</span>?</span></span><br><span class="line"><span class="symbol">WARNING:</span> The Python sqlite3 extension was not compiled. Missing the SQLite3 <span class="class"><span class="keyword">lib</span>?</span></span><br></pre></td></tr></table></figure></p>
<p>åªéœ€è¦æ ¹æ®æç¤ºå®‰è£…å°±è¡Œäº†ï¼ˆCentOS7ç¯å¢ƒä¸‹):<br><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum <span class="keyword">install </span>readline readline-devel readline-static -y</span><br><span class="line">yum <span class="keyword">install </span>openssl openssl-devel openssl-static -y</span><br><span class="line">yum <span class="keyword">install </span>sqlite-devel -y</span><br><span class="line">yum <span class="keyword">install </span><span class="keyword">bzip2-devel </span><span class="keyword">bzip2-libs </span>-y</span><br></pre></td></tr></table></figure></p>
]]></content>
      
        <categories>
            
            <category> Python </category>
            
        </categories>
        
        
        <tags>
            
            <tag> pyenv </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[MacVimè‡ªåŠ¨åˆ‡æ¢ä¸­è‹±æ–‡è¾“å…¥æ³•]]></title>
      <url>http://dequn.github.io/2016/10/28/macvim-auto-im/</url>
      <content type="html"><![CDATA[<p>ä¸­æ–‡ç”¨æˆ·çš„ä½¿ç”¨ VIM æœ€ç—›è‹¦çš„å°±æ˜¯æ¥å›åˆ‡æ¢è¾“å…¥æ³•äº†ï¼Œè¿˜å¥½ï¼Œåœ¨ OS ç³»ç»Ÿä¸‹ä½¿ç”¨ MacVim å¯ä»¥è®¾ç½®åœ¨å‘½ä»¤æ¨¡å¼ä¸‹ç¦ç”¨è¾“å…¥æ³•ï¼Œè¿™æ ·æœ‰äº†è‡ªåŠ¨åˆ‡æ¢çš„æ•ˆæœï¼Œè®¾ç½®å¦‚ä¸‹ï¼š</p>
<p><strong>ç¬¬ä¸€æ­¥</strong>.åœ¨.vimrc ä¸­è®¾ç½®<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">set</span> noimd</span><br><span class="line"><span class="builtin-name">set</span> <span class="attribute">imi</span>=2</span><br><span class="line"><span class="builtin-name">set</span> <span class="attribute">ims</span>=2</span><br></pre></td></tr></table></figure></p>
<p><strong>ç¬¬äºŒæ­¥</strong>.åœ¨ MacVim çš„ Preferences ä¸­çš„ Advanced æ ‡ç­¾ä¸­ï¼Œ<strong>å–æ¶ˆå‹¾é€‰ Draw marked text line</strong>ã€‚</p>
<p>è¿™æ ·å°±å¯ä»¥è¾¾åˆ°ä¸€ä¸ªè‡ªåŠ¨åˆ‡æ¢çš„æ•ˆæœï¼ˆåªæ˜¯åœ¨å‘½ä»¤è¡Œæ¨¡å¼ä¸‹ç»™ç¦ç”¨æ‰äº†è€Œå·²ï¼‰ï¼Œè¿™ä¸ªè¦æ¯”è®¾ç½® vimim å¥½ç”¨å¤šäº†ï¼Œvimim å»¶è¿Ÿå¤ªå¤§ï¼Œä½¿ç”¨éå¸¸ä¸æ–¹ä¾¿ã€‚</p>
<p>å‚è€ƒï¼š<br>[1].<a href="https://www.v2ex.com/t/45772" target="_blank" rel="noopener">https://www.v2ex.com/t/45772</a></p>
]]></content>
      
        <categories>
            
            <category> Others </category>
            
        </categories>
        
        
        <tags>
            
            <tag> VIM </tag>
            
            <tag> MacVim </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[MapReduce åœ¨ Map é˜¶æ®µå†™æ•°æ®åº“ï¼Œæ²¡æœ‰ Reducer]]></title>
      <url>http://dequn.github.io/2016/10/27/mapreduce-output-to-hbase-at-mapper-phase-without-reducer/</url>
      <content type="html"><![CDATA[<p>æ‰‹é‡Œæœ‰ä¸€å¼ txtæ•°æ®è¡¨ï¼Œç°åœ¨è¦å…¥åº“(Phoenix + HBase)ï¼Œå› ä¸ºéœ€è¦å¯¹æ•°æ®åšä¸€å®šçš„å¤„ç†åå†å†™å…¥æ•°æ®åº“ï¼ŒåŠ ä¸Šæ•°æ®é‡ä¸å°ï¼Œæ‰€ä»¥å°±æƒ³ç€ç”¨ MapReduce æ¥åŠ é€Ÿä¸€ä¸‹å…¥åº“è¿‡ç¨‹ã€‚</p>
<p>æ‹¿åˆ°ä¸€æ¡æ•°æ®å¤„ç†åå°±å¯ä»¥ç›´æ¥å…¥åº“äº†ï¼Œé‚£å°±æ²¡æœ‰å¿…è¦å†™ Reducer äº†ï¼Œç›´æ¥å…¨éƒ¨åœ¨ Mapper é‡Œè¾¹å®Œæˆï¼Œæ‰€ä»¥å¾ˆè‡ªç„¶åœ°å®šä¹‰ DBWritable ç±»ï¼Œä½œä¸º Mapper çš„ OutputKeyClass å°±è¡Œï¼Œå¦‚ä¸‹è¿™æ ·ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Writable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.db.DBWritable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.DataInput;</span><br><span class="line"><span class="keyword">import</span> java.io.DataOutput;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Created by dq on 10/27/16.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestDBWritable</span> <span class="keyword">implements</span> <span class="title">Writable</span>, <span class="title">DBWritable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> id;</span><br><span class="line">String name;</span><br><span class="line"></span><br><span class="line"><span class="comment">//getter and setter ...</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(DataOutput dataOutput)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">readFields</span><span class="params">(DataInput dataInput)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(PreparedStatement preparedStatement)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line"></span><br><span class="line">preparedStatement.setInt(<span class="number">1</span>, id);</span><br><span class="line">preparedStatement.setString(<span class="number">2</span>, name);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">readFields</span><span class="params">(ResultSet resultSet)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>å‘åœ¨è¿™é‡Œ</strong>:å…¶ä¸­ï¼Œ<code>write(DataOutput dataOutput), readFields(DataInput dataInput)</code> æ˜¯ Writable æ¥å£é‡Œè¾¹çš„å‡½æ•°ï¼Œç”±äºæˆ‘æ˜¯å†™æ•°æ®åº“çš„ï¼Œå°±ç®€å•çš„æƒ³ç€æ²¡æœ‰å¿…è¦å®ç°äº†ï¼Œç•™ç©ºä¸å¤„ç†ï¼Œæˆ‘ä¹Ÿä¸è¯»æ•°æ®åº“ï¼ŒreadFields(Result resultSet)å°±ä¹Ÿä¸å†™å•¦ã€‚</p>
<p>Mapper ç±»æ˜¯è¿™æ ·å†™çš„ï¼š<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public static <span class="class"><span class="keyword">class</span> <span class="title">TestMapper</span> <span class="keyword">extends</span> <span class="title">Mapper&lt;LongWritable</span>, <span class="title">Text</span>,<span class="title">NullWritable</span>, <span class="title">TestDBWritable&gt;</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> void map(<span class="type">LongWritable</span> key, <span class="type">Text</span> value, <span class="type">Context</span> context) <span class="keyword">throws</span> <span class="type">IOException</span>, <span class="type">InterruptedException</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="type">TestDBWritable</span> t = <span class="keyword">new</span> <span class="type">TestWritable</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//....</span></span><br><span class="line"></span><br><span class="line">context.write(<span class="type">NullWritable</span>.get(), t);</span><br><span class="line"></span><br><span class="line"><span class="comment">//....</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ç„¶åæ˜¯å®šä¹‰ Job<br><figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//....</span></span><br><span class="line"><span class="keyword">job</span>.setMapOutputKeyClass(NullWritable.<span class="keyword">class</span>)<span class="comment">;</span></span><br><span class="line"><span class="keyword">job</span>.setMapOutputValueClass(TestDBWritable.<span class="keyword">class</span>)<span class="comment">;</span></span><br><span class="line"><span class="comment">//....</span></span><br></pre></td></tr></table></figure></p>
<p>æ»¡å¿ƒæ¬¢å–œåœ°èµ¶ç´§è¿è¡Œï¼Œè¿˜å¥½æ²¡é”™ï¼Œå¥½æœ‰æˆå°±æ„Ÿåœ°å»æŸ¥ä¸€ä¸‹æ•°æ®åº“ï¼Œå‘ç°é‡Œè¾¹åªæ˜¯å¤šäº†ä¸€ä¸ª id ä¸º0ï¼Œname ä¸º NULL çš„è®°å½•ç½¢äº†ï¼Œ æ“¦ï¼Œå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿè¿˜å¥½ä¹‹å‰æ­å»ºçš„æ˜¯å¯ä»¥æœ¬åœ°è°ƒè¯•çš„ç¯å¢ƒï¼Œæ‰“ä¸ªæ–­ç‚¹ï¼Œçœ‹ä¸€ä¸‹TestDBWritable ç±»çš„ write() å‡½æ•°æ‰§è¡Œè¿‡ç¨‹ï¼Œå‘ç° id åªæ˜¯åˆå§‹å€¼ï¼Œname å…¨éƒ¨ä¸ºNULLï¼ é¡ºç€<code>context.write()</code>ä¸€è·¯æŸ¥ä¸‹å»ï¼Œä¹Ÿæ²¡æœ‰å‘ç° map è¾“å‡ºçš„æ—¶å€™æŠŠå€¼ç»™ä¸¢äº†å‘€ï¼Œä½†è¿›å» write å°±å˜ç©ºå€¼ï¼Œè¿™æ˜¯è‚¿ä¹ˆå›äº‹ï¼Ÿ</p>
<p>åæ¥æƒ³äº†ä¸€ä¸‹æ˜¯ä¸æ˜¯å› ä¸º Writable çš„ä¸¤ä¸ªå‡½æ•°æ²¡æœ‰å®ç°çš„åŸå› ï¼Œå¸¦ç€ä¾¥å¹¸å¿ƒç†å®ç°è¿™ä¸¤ä¸ªå‡½æ•°<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">write</span><span class="params">(DataOutput dataOutput)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        dataOutput.writeInt(id);</span><br><span class="line">        dataOutput.writeUTF(name);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">readFields</span><span class="params">(DataInput dataInput)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = dataInput.readInt();</span><br><span class="line">        <span class="keyword">this</span>.name = dataInput.readUTF();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä¸ºäº†éªŒè¯ä¸€ä¸‹æ˜¯ä¸æ˜¯æ‰§è¡Œäº†è¿™ä¸¤ä¸ªå‡½æ•°ï¼Œæ‰“ä¸Šäº†æ–­ç‚¹è°ƒè¯•ä¸€ä¸‹ï¼Œå‘ç°æœç„¶ï¼Œåœ¨æ‰§è¡Œ context.write()åï¼Œæ‰§è¡Œçš„å€¼ Writable çš„ write å‡½æ•°ï¼Œç„¶è€Œå¹¶æ²¡æœ‰æ¥ç€æ‰§è¡Œ DBWritable çš„ write å‡½æ•°ï¼Œè€Œæ˜¯ç›´åˆ°æ‰€æœ‰çš„è¾“å…¥æ•°æ®éƒ½æ‰§è¡Œå®Œæ¯•åï¼Œé¦–å…ˆæ‰§è¡Œ readFields å‡½æ•°ï¼Œç„¶ååˆ writeã€‚å•çœ‹æ­¤æ‰§è¡Œè·¯å¾„ï¼Œ<strong>è™½ç„¶æ²¡æœ‰å®šä¹‰ reducerï¼Œä½† Hadoop è¿˜æ˜¯ç»™æˆ‘ä»¬æ‰§è¡Œäº†ä¸€ä¸ªé»˜è®¤çš„,æ‰€ä»¥åœ¨ map è¾“å‡ºçš„æ—¶å€™ä¼šæ‰§è¡Œå†™å…¥ç¼“å†²åŒºçš„ write()å‡½æ•°ï¼Œåœ¨ reducer é‡Œè¾¹ä¼šæ‰§è¡Œ read()</strong> ã€‚æ‰€ä»¥å¦‚æœä¸å®ç°é‚£ä¸¤ä¸ªå‡½æ•°ï¼ŒReducer å–åˆ°çš„å°±æ˜¯ç©ºå€¼ã€‚</p>
<p>åœ¨ç½‘ä¸Šæœç´¢äº†ä¸€å†™å…¶ä»–èµ„æ–™ï¼Œå‘ç°æƒ…å†µç¡®å®å¦‚æ­¤ï¼Œå¯ä»¥å‚çœ‹[<a href="http://blog.csdn.net/yongjian_luo/article/details/9962047" title="Mapreduceä¸è®¾ç½®reduceï¼Œåªæ‰§è¡Œmapçš„è¾“å‡ºç»“æœ" target="_blank" rel="noopener">1</a>]ã€‚</p>
<p>å› ä¸º Mapper çš„ outkey æ˜¯ NullWritable,æ‰€æœ‰çš„æ•°æ®éƒ½ä¼šå‘é€åˆ°åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šè¿›è¡Œ Reduce[<a href="https://www.quora.com/Whats-the-key-value-output-of-map-function-if-I-use-context-write-NullWritable-get-new-Text-1" title="What&#39;s the &lt;key, value&gt; output of map function if I use context.write (NullWritable.get(),new Text(1))?" target="_blank" rel="noopener">2</a>]ï¼Œé€Ÿåº¦éå¸¸æ…¢ï¼Œè¿™æ— ç–‘æ˜¯ä¸åˆè¡·ç›¸èƒŒçš„ï¼Œæ›´å¥½çš„è§£å†³åŠæ³•æ˜¯å‚ç…§[<a href="http://blog.csdn.net/yongjian_luo/article/details/9962047" title="Mapreduceä¸è®¾ç½®reduceï¼Œåªæ‰§è¡Œmapçš„è¾“å‡ºç»“æœ" target="_blank" rel="noopener">1</a>]ä¸­çš„ç¬¬å››æ¡ï¼Œå°† reduce çš„æ•°é‡è®¾ç½®ä¸º0ï¼Œè¿™æ · mapper å°±ä¸å†æ‰§è¡Œ Writable çš„ä¸¤ä¸ªå‡½æ•°ï¼Œä¼šç›´æ¥å†™å…¥æ•°æ®åº“ã€‚</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">job.setNumReduceTasks(<span class="number">0</span>)<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p><strong>æ€»ç»“:</strong><br>1.å¦‚æœä¸è®¾ç½® Reducerï¼ŒHadoop è¿˜æ˜¯ä¼šé»˜è®¤æ‰§è¡Œä¸€ä¸ªçš„ï¼Œæ‰€ä»¥æœ€å¥½æ˜ç¡®è®¾ç½® Reducer çš„æ•°é‡ä¸º0ï¼Œè¿™æ ·å¯ä»¥åœ¨ Map é˜¶æ®µå°±æ‰§è¡Œè¾“å‡ºã€‚<br>2.Map çš„ OutputKeyClass ä¸º NullWritable çš„æ—¶å€™ï¼Œæ‰€æœ‰çš„ Reduce éƒ½ä¼šå‘é€ç»™ä¸€ä¸ªç»“ç‚¹è®¡ç®—ï¼Œæ‰€ä»¥ä¸è¦ç”¨ NullWritable ä½œä¸ºMap çš„OutputKeyClass.</p>
<p><strong>å‚è€ƒ:</strong></p>
<p>[1]:<a href="http://blog.csdn.net/yongjian_luo/article/details/9962047" title="Mapreduceä¸è®¾ç½®reduceï¼Œåªæ‰§è¡Œmapçš„è¾“å‡ºç»“æœ" target="_blank" rel="noopener">Mapreduceä¸è®¾ç½®reduceï¼Œåªæ‰§è¡Œmapçš„è¾“å‡ºç»“æœ</a><br>[2]:<a href="https://www.quora.com/Whats-the-key-value-output-of-map-function-if-I-use-context-write-NullWritable-get-new-Text-1" title="What&#39;s the &lt;key, value&gt; output of map function if I use context.write (NullWritable.get(),new Text(1))?" target="_blank" rel="noopener">Whatâ€™s the &lt;key, value&gt; output of map function if I use context.write (NullWritable.get(),new Text(1))?</a></p>
]]></content>
      
        <categories>
            
            <category> HBase </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Hadoop </tag>
            
            <tag> MapReduce </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[ç”¨ Phoenix è·‘ MapReduce ä»»åŠ¡-å®˜æ–¹ä¾‹å­]]></title>
      <url>http://dequn.github.io/2016/10/07/phoenix-mapreduce-example/</url>
      <content type="html"><![CDATA[<p>Phoenix æä¾›äº† MapReduce å·¥ä½œä»»åŠ¡çš„æ”¯æŒï¼Œå¹¶ä¸”å®˜æ–¹ç»™å‡ºäº†ä¾‹å­ï¼Œä¸€èµ·æ¥ç¼–ç è¿è¡Œä¸€ä¸‹ã€‚</p>
<h1 id="1æ–°å»º-maven-å·¥ç¨‹"><a href="#1æ–°å»º-maven-å·¥ç¨‹" class="headerlink" title="1æ–°å»º maven å·¥ç¨‹"></a>1æ–°å»º maven å·¥ç¨‹</h1><p>åœ¨ pom.xml ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.phoenix<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>phoenix-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.7.0-HBase-1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>apache<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.apache.org<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h1 id="2æ–°å»ºä¸€ä¸ª-StockWritable-çš„-Java-ç±»"><a href="#2æ–°å»ºä¸€ä¸ª-StockWritable-çš„-Java-ç±»" class="headerlink" title="2æ–°å»ºä¸€ä¸ª StockWritable çš„ Java ç±»"></a>2æ–°å»ºä¸€ä¸ª <code>StockWritable</code> çš„ Java ç±»</h1><p>ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Writable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.db.DBWritable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.DataInput;</span><br><span class="line"><span class="keyword">import</span> java.io.DataOutput;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by dq on 10/7/16.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StockWritable</span> <span class="keyword">implements</span> <span class="title">DBWritable</span>, <span class="title">Writable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String stockName;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getStockName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> stockName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStockName</span><span class="params">(String stockName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.stockName = stockName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getYear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> year;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setYear</span><span class="params">(<span class="keyword">int</span> year)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.year = year;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">double</span>[] getRecordings() &#123;</span><br><span class="line">        <span class="keyword">return</span> recordings;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRecordings</span><span class="params">(<span class="keyword">double</span>[] recordings)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.recordings = recordings;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getMaxPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> maxPrice;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMaxPrice</span><span class="params">(<span class="keyword">double</span> maxPrice)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.maxPrice = maxPrice;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> year;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span>[] recordings;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> maxPrice;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(DataOutput dataOutput)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">readFields</span><span class="params">(DataInput dataInput)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(PreparedStatement preparedStatement)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line"></span><br><span class="line">        preparedStatement.setString(<span class="number">1</span>, <span class="keyword">this</span>.stockName);</span><br><span class="line">        preparedStatement.setDouble(<span class="number">2</span>, <span class="keyword">this</span>.maxPrice);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">readFields</span><span class="params">(ResultSet resultSet)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.stockName = resultSet.getString(<span class="string">"STOCK_NAME"</span>);</span><br><span class="line">        <span class="keyword">this</span>.year = resultSet.getInt(<span class="string">"RECORDING_YEAR"</span>);</span><br><span class="line">        <span class="keyword">this</span>.recordings = (<span class="keyword">double</span>[]) resultSet.getArray(<span class="string">"RECORDINGS_QUARTER"</span>).getArray();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="3Mapper-Reducer"><a href="#3Mapper-Reducer" class="headerlink" title="3Mapper, Reducer"></a>3Mapper, Reducer</h1><p>æ–°å»ºä¸€ä¸ª PhoenixMapRed ç±»ï¼Œå®ç° map(), reduce(), å¹¶ä¸”æ·»åŠ ä¸»å‡½æ•°</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.<span class="type">Configuration</span>;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.<span class="type">HBaseConfiguration</span>;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.hbase.mapreduce.<span class="type">TableMapReduceUtil</span>;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.<span class="type">DoubleWritable</span>;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.<span class="type">NullWritable</span>;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.<span class="type">Text</span>;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.<span class="type">Job</span>;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.<span class="type">Mapper</span>;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.<span class="type">Reducer</span>;</span><br><span class="line"><span class="keyword">import</span> org.apache.phoenix.mapreduce.<span class="type">PhoenixOutputFormat</span>;</span><br><span class="line"><span class="keyword">import</span> org.apache.phoenix.mapreduce.util.<span class="type">PhoenixMapReduceUtil</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.<span class="type">IOException</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by dq on 10/7/16.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">PhoenixMapRed</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public static <span class="class"><span class="keyword">class</span> <span class="title">StockMapper</span> <span class="keyword">extends</span> <span class="title">Mapper&lt;NullWritable</span>, <span class="title">StockWritable</span>, <span class="title">Text</span>, <span class="title">DoubleWritable&gt;</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="type">Text</span> stock = <span class="keyword">new</span> <span class="type">Text</span>();</span><br><span class="line">        <span class="type">DoubleWritable</span> price = <span class="keyword">new</span> <span class="type">DoubleWritable</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">protected</span> void map(<span class="type">NullWritable</span> key, <span class="type">StockWritable</span> value, <span class="type">Context</span> context) <span class="keyword">throws</span> <span class="type">IOException</span>, <span class="type">InterruptedException</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> name = value.getStockName();</span><br><span class="line">            double[] recordings = value.getRecordings();</span><br><span class="line"></span><br><span class="line">            double maxRecording = <span class="type">Double</span>.<span class="type">MIN_VALUE</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (double d : recordings) &#123;</span><br><span class="line">                maxRecording = <span class="type">Math</span>.max(maxRecording, d);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            stock.set(name);</span><br><span class="line">            price.set(maxRecording);</span><br><span class="line"></span><br><span class="line">            context.write(stock, price);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static <span class="class"><span class="keyword">class</span> <span class="title">StockReducer</span> <span class="keyword">extends</span> <span class="title">Reducer&lt;Text</span>, <span class="title">DoubleWritable</span>, <span class="title">NullWritable</span>, <span class="title">StockWritable&gt;</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">protected</span> void reduce(<span class="type">Text</span> key, <span class="type">Iterable</span>&lt;<span class="type">DoubleWritable</span>&gt; values, <span class="type">Context</span> context) <span class="keyword">throws</span> <span class="type">IOException</span>, <span class="type">InterruptedException</span> &#123;</span><br><span class="line"></span><br><span class="line">            double maxPrice = <span class="type">Double</span>.<span class="type">MIN_VALUE</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">DoubleWritable</span> <span class="keyword">val</span> : values) &#123;</span><br><span class="line">                maxPrice = <span class="type">Math</span>.max(maxPrice, <span class="keyword">val</span>.get());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">StockWritable</span> stockWritable = <span class="keyword">new</span> <span class="type">StockWritable</span>();</span><br><span class="line">            stockWritable.setStockName(key.toString());</span><br><span class="line">            stockWritable.setMaxPrice(maxPrice);</span><br><span class="line"></span><br><span class="line">            context.write(<span class="type">NullWritable</span>.get(), stockWritable);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public static void main(<span class="type">String</span>[] args) <span class="keyword">throws</span> <span class="type">IOException</span>, <span class="type">ClassNotFoundException</span>, <span class="type">InterruptedException</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Configuration</span> conf = <span class="type">HBaseConfiguration</span>.create();</span><br><span class="line"></span><br><span class="line">        <span class="type">Job</span> job = <span class="type">Job</span>.getInstance(conf, <span class="string">"stock"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> selectQuery = <span class="string">"SELECT STOCK_NAME,RECORDING_YEAR,RECORDINGS_QUARTER FROM STOCK "</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="type">PhoenixMapReduceUtil</span>.setInput(job, <span class="type">StockWritable</span>.<span class="keyword">class</span>, <span class="string">"STOCK"</span>, selectQuery);</span><br><span class="line">        <span class="type">PhoenixMapReduceUtil</span>.setOutput(job, <span class="string">"STOCK_STATS"</span>, <span class="string">"STOCK_NAME,MAX_RECORDING"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        job.setMapperClass(<span class="type">StockMapper</span>.<span class="keyword">class</span>);</span><br><span class="line">        job.setReducerClass(<span class="type">StockReducer</span>.<span class="keyword">class</span>);</span><br><span class="line"></span><br><span class="line">        job.setOutputFormatClass(<span class="type">PhoenixOutputFormat</span>.<span class="keyword">class</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        job.setMapOutputKeyClass(<span class="type">Text</span>.<span class="keyword">class</span>);</span><br><span class="line">        job.setMapOutputValueClass(<span class="type">DoubleWritable</span>.<span class="keyword">class</span>);</span><br><span class="line"></span><br><span class="line">        job.setOutputKeyClass(<span class="type">NullWritable</span>.<span class="keyword">class</span>);</span><br><span class="line">        job.setOutputValueClass(<span class="type">StockWritable</span>.<span class="keyword">class</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="type">TableMapReduceUtil</span>.addDependencyJars(job);</span><br><span class="line">        job.waitForCompletion(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>æ³¨æ„ï¼Œä»£ç ä¸­çš„<code>PhoenixMapReduceUtil.setOutput(job, &quot;STOCK_STATS&quot;, &quot;STOCK_NAME,MAX_RECORDING&quot;);</code>ä¸€å¥ä¸å®˜æ–¹æ–‡æ¡£ä¸ä¸€æ ·ï¼Œå®˜æ–¹ä¸Šçš„åº”è¯¥æ˜¯è€ä»£ç ï¼Œè¿è¡Œæ—¶æœ‰é”™è¯¯ã€‚</strong></p>
<h1 id="4æ•°æ®è¡¨å»ºç«‹ï¼Œæ•°æ®å¯¼å…¥ï¼Œç•¥ã€‚"><a href="#4æ•°æ®è¡¨å»ºç«‹ï¼Œæ•°æ®å¯¼å…¥ï¼Œç•¥ã€‚" class="headerlink" title="4æ•°æ®è¡¨å»ºç«‹ï¼Œæ•°æ®å¯¼å…¥ï¼Œç•¥ã€‚"></a>4æ•°æ®è¡¨å»ºç«‹ï¼Œæ•°æ®å¯¼å…¥ï¼Œç•¥ã€‚</h1><h1 id="5ç¼–è¯‘"><a href="#5ç¼–è¯‘" class="headerlink" title="5ç¼–è¯‘"></a>5ç¼–è¯‘</h1><p>ç¼–è¯‘çš„è¿‡ç¨‹æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„è¿‡ç¨‹ï¼Œå®˜æ–¹çš„ä¾‹å­å¹¶æ²¡æœ‰ç»™å‡ºè¿‡ç¨‹ï¼Œåœ¨ä½¿ç”¨<code>javac</code>ç¼–è¯‘å‰ï¼Œéœ€è¦å°†<code>phoenix-4.8.0-HBase-1.1-client.jar</code>æ·»åŠ åˆ°<code>CLASSPATH</code>ä¸­,ç¼–è¯‘åä¼šç”Ÿæˆ4ä¸ªæ–‡ä»¶ï¼Œå†ä½¿ç”¨ <code>jar</code>å‘½ä»¤ç”Ÿæˆ .jar æ–‡ä»¶ã€‚</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">export CLASSPATH=/usr/local/hbase/lib/phoenix-<span class="number">4.8</span>.<span class="number">0</span>-HBase-<span class="number">1.1</span>-client<span class="selector-class">.jar</span>:<span class="variable">$CLASSPATH</span></span><br><span class="line"></span><br><span class="line">javac PhoenixMapRed.java</span><br><span class="line">#ç”Ÿæˆ<span class="number">4</span>ä¸ªæ–‡ä»¶ PhoenixMapRed<span class="selector-class">.class</span> PhoenixMapRed<span class="variable">$StockMapper</span><span class="selector-class">.class</span> PhoenixMapRed<span class="variable">$StockReducer</span><span class="selector-class">.class</span>  StockWritable.class</span><br><span class="line"></span><br><span class="line">jar -cvf PhoenixMapRed<span class="selector-class">.jar</span> PhoenixMapRed<span class="selector-class">.class</span> PhoenixMapRed<span class="variable">$StockMapper</span><span class="selector-class">.class</span> PhoenixMapRed<span class="variable">$StockReducer</span><span class="selector-class">.class</span>  StockWritable.class</span><br></pre></td></tr></table></figure>
<h1 id="6è¿è¡Œ"><a href="#6è¿è¡Œ" class="headerlink" title="6è¿è¡Œ"></a>6è¿è¡Œ</h1><p>å¦‚æœç°åœ¨ç›´æ¥æ‰§è¡Œ<code>hadoop jar PhoenixMapRed.jar PhoenixMapRed</code>çš„è¯ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ï¼š</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Exception <span class="keyword">in</span> thread <span class="string">"main"</span> java<span class="selector-class">.lang</span><span class="selector-class">.NoClassDefFoundError</span>: org/apache/hadoop/hbase/HBaseConfiguration</span><br><span class="line">	at PhoenixMapRed.main(PhoenixMapRed<span class="selector-class">.java</span>:<span class="number">73</span>)</span><br><span class="line">	at sun<span class="selector-class">.reflect</span><span class="selector-class">.NativeMethodAccessorImpl</span><span class="selector-class">.invoke0</span>(Native Method)</span><br><span class="line">	at sun<span class="selector-class">.reflect</span><span class="selector-class">.NativeMethodAccessorImpl</span><span class="selector-class">.invoke</span>(NativeMethodAccessorImpl<span class="selector-class">.java</span>:<span class="number">62</span>)</span><br><span class="line">	at sun<span class="selector-class">.reflect</span><span class="selector-class">.DelegatingMethodAccessorImpl</span><span class="selector-class">.invoke</span>(DelegatingMethodAccessorImpl<span class="selector-class">.java</span>:<span class="number">43</span>)</span><br><span class="line">	at java<span class="selector-class">.lang</span><span class="selector-class">.reflect</span><span class="selector-class">.Method</span><span class="selector-class">.invoke</span>(Method<span class="selector-class">.java</span>:<span class="number">498</span>)</span><br><span class="line">	at org<span class="selector-class">.apache</span><span class="selector-class">.hadoop</span><span class="selector-class">.util</span><span class="selector-class">.RunJar</span><span class="selector-class">.run</span>(RunJar<span class="selector-class">.java</span>:<span class="number">221</span>)</span><br><span class="line">	at org<span class="selector-class">.apache</span><span class="selector-class">.hadoop</span><span class="selector-class">.util</span><span class="selector-class">.RunJar</span><span class="selector-class">.main</span>(RunJar<span class="selector-class">.java</span>:<span class="number">136</span>)</span><br><span class="line">Caused by: java<span class="selector-class">.lang</span><span class="selector-class">.ClassNotFoundException</span>: org<span class="selector-class">.apache</span><span class="selector-class">.hadoop</span><span class="selector-class">.hbase</span><span class="selector-class">.HBaseConfiguration</span></span><br><span class="line">	at java<span class="selector-class">.net</span><span class="selector-class">.URLClassLoader</span><span class="selector-class">.findClass</span>(URLClassLoader<span class="selector-class">.java</span>:<span class="number">381</span>)</span><br><span class="line">	at java<span class="selector-class">.lang</span><span class="selector-class">.ClassLoader</span><span class="selector-class">.loadClass</span>(ClassLoader<span class="selector-class">.java</span>:<span class="number">424</span>)</span><br><span class="line">	at java<span class="selector-class">.lang</span><span class="selector-class">.ClassLoader</span><span class="selector-class">.loadClass</span>(ClassLoader<span class="selector-class">.java</span>:<span class="number">357</span>)</span><br></pre></td></tr></table></figure>
<p>è¿™æ¬¡éœ€è¦å°†<code>phoenix-4.8.0-HBase-1.1-client.jar</code>æ·»åŠ åˆ° <code>HADOOP_CLASSPATH</code>ä¸­ï¼Œç„¶åå†æ‰§è¡Œä»»åŠ¡ã€‚</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">export</span> <span class="attribute">HADOOP_CLASSPATH</span>=/usr/local/hbase/lib/phoenix-4.8.0-HBase-1.1-client.jar:$HADOOP_CLASSPATH</span><br><span class="line">hadoop jar PhoenixMapRed.jar PhoenixMapRed</span><br><span class="line"><span class="comment">#...æ‰§è¡Œæ­£å¸¸</span></span><br></pre></td></tr></table></figure>
<h1 id="7ç»“æœæŸ¥çœ‹"><a href="#7ç»“æœæŸ¥çœ‹" class="headerlink" title="7ç»“æœæŸ¥çœ‹"></a>7ç»“æœæŸ¥çœ‹</h1><p>åœ¨phoenix çš„ sqlline ç¯å¢ƒä¸­æ‰§è¡ŒæŸ¥è¯¢ï¼Œä¼šçœ‹åˆ°ç»“æœ</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:phoenix:localhost&gt; select * from stock<span class="emphasis">_stats;</span></span><br><span class="line"><span class="emphasis">+-------------+----------------+</span></span><br><span class="line"><span class="emphasis">| STOCK_</span>NAME  | MAX<span class="emphasis">_RECORDING  |</span></span><br><span class="line"><span class="emphasis">+-------------+----------------+</span></span><br><span class="line"><span class="emphasis">| AAPL        | 200.26         |</span></span><br><span class="line"><span class="emphasis">| CSCO        | 27.98          |</span></span><br><span class="line"><span class="emphasis">| GOOG        | 697.37         |</span></span><br><span class="line"><span class="emphasis">| MSFT        | 35.96          |</span></span><br><span class="line"><span class="emphasis">| YHOO        | 41.22          |</span></span><br><span class="line"><span class="emphasis">+-------------+----------------+</span></span><br><span class="line"><span class="emphasis">5 rows selected (0.298 seconds)</span></span><br></pre></td></tr></table></figure>
<p>è‡³æ­¤ï¼Œè¯¥ä¾‹å­æˆåŠŸè¿è¡Œã€‚</p>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p>1.<a href="http://phoenix.apache.org/phoenix_mr.html" target="_blank" rel="noopener">Phoenix Map Reduce</a><br>2.<a href="http://stackoverflow.com/questions/30801364/mapreduce-hadoop-2-6-0-hbase-1-0-1-1-class-not-found-exception" target="_blank" rel="noopener">MapReduce (Hadoop-2.6.0)+ HBase-1.0.1.1 class not found exception</a></p>
]]></content>
      
        <categories>
            
            <category> Phoenix </category>
            
        </categories>
        
        
        <tags>
            
            <tag> MapReduce </tag>
            
            <tag> Phoenix </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Phoenix Secondary Indexåˆæ¢ä¹‹Local Index]]></title>
      <url>http://dequn.github.io/2016/09/02/Phoenix-Secondary-Index-Exploration-Local-Index/</url>
      <content type="html"><![CDATA[<p>ä¸Šä¸€ç¯‡æ¢ç´¢äº† Phoenix çš„ Global Indexï¼Œè¿™ä¸€æ¬¡æ¥çœ‹ä¸€çœ‹ Local Index çš„å®ç°åŸç†ã€‚</p>
<p>é¦–å…ˆéœ€è¦è¯´æ˜çš„æ˜¯å®éªŒé‡‡ç”¨çš„ Phoenix ç‰ˆæœ¬å·æ˜¯4.8ï¼Œä»4.8å¼€å§‹ï¼ŒPhoenix çš„Local Index ä¸å†é‡‡ç”¨æ–°å»ºæ•°æ®è¡¨çš„æ–¹å¼ï¼Œä»å®˜æ–¹çš„æè¿°ä¸­å¯ä»¥çœ‹å‡ºè¿™ä¸€ç‚¹å˜åŒ–ï¼š</p>
<blockquote>
<p>Unlike global indexes, all local indexes of a table are stored in a single, separate shared table prior to 4.8.0 version. From 4.8.0 onwards we are storing all local index data in the separate shadow column families in the same data table. </p>
</blockquote>
<p>ä¸è¿‡ä»€ä¹ˆæ˜¯ <strong>shadow column families</strong>? è¿™ä¸€ç‚¹ç¡®å®æŠŠæˆ‘å¼„è’™äº†ï¼Œç™¾åº¦ Google éƒ½æ²¡æœ‰æœå‡ºç›¸å…³çš„æ¦‚å¿µï¼Œå…ˆä¸ç®¡é‚£ä¹ˆå¤šäº†ï¼Œå…ˆå¿ƒæ— æ—éª›çš„ç›´å¥”ç›®æ ‡å§ã€‚</p>
<p>éœ€è¦è¯´æ˜çš„å¦ä¸€ç‚¹æ˜¯ç”±äºä¸Šä¸€æ¬¡é‡‡ç”¨çš„è¡¨æ•°æ®é‡æœ‰äº›å¤§ï¼Œåœ¨å»ºç«‹ Local Indexæ€»æ˜¯å‡ºé”™ï¼Œä½¿ç”¨ <code>!tables</code> å‘½ä»¤æŸ¥çœ‹ç´¢å¼•è¡¨æ€»æ˜¯å¤„äº <strong>BUILDING</strong> çŠ¶æ€ï¼Œæ‰€ä»¥è¿™æ¬¡æ–°å»ºäº†ä¸€ä¸ªè¡¨è¿›è¡Œè¯•éªŒï¼ŒåŸç†æ˜ç™½å°±å¥½ã€‚</p>
<h1 id="1-æ–°å»ºæ•°æ®è¡¨ã€ç´¢å¼•å’Œæ’å…¥æ•°æ®"><a href="#1-æ–°å»ºæ•°æ®è¡¨ã€ç´¢å¼•å’Œæ’å…¥æ•°æ®" class="headerlink" title="1.æ–°å»ºæ•°æ®è¡¨ã€ç´¢å¼•å’Œæ’å…¥æ•°æ®"></a>1.æ–°å»ºæ•°æ®è¡¨ã€ç´¢å¼•å’Œæ’å…¥æ•°æ®</h1><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> TABLE <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> zdq.test (id BIGINT <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">PRIMARY</span> <span class="keyword">KEY</span>, X INTEGER, Y INTEGER, Z INTEGER, M DECIMAL, N SMALLINT);</span><br><span class="line">ALTER TABLE zdq.test set IMMUTABLE_ROWS = true; # can not set local <span class="keyword">index</span> <span class="keyword">if</span> IMMUTABLE_ROWS = fasle <span class="keyword">or</span> need <span class="keyword">set</span> hbse-site.xml</span><br><span class="line"><span class="keyword">CREATE</span> LOCAL <span class="keyword">INDEX</span> X_IDX <span class="keyword">ON</span> zdq.test (x);</span><br><span class="line"><span class="keyword">CREATE</span> LOCAL <span class="keyword">INDEX</span> Y_IDX <span class="keyword">ON</span> zdq.test (y);</span><br><span class="line"><span class="keyword">CREATE</span> LOCAL <span class="keyword">INDEX</span> Z_IDX <span class="keyword">ON</span> zdq.test (z);</span><br><span class="line"><span class="keyword">UPSERT</span> <span class="keyword">INTO</span> zdq.test (id, x, y, z, m, n) <span class="keyword">VALUES</span> (<span class="number">12345</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">UPSERT</span> <span class="keyword">INTO</span> zdq.test (id, x, y, z, m, n) <span class="keyword">VALUES</span> (<span class="number">123456</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">1</span>);</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨ <code>!tables</code> æŸ¥çœ‹ä¸€ä¸‹æ•°æ®è¡¨ï¼Œå‘ç°å¤šäº†<strong>å››ä¸ªè¡¨</strong>,ä¸€ä¸ªä¸»æ•°æ®è¡¨ï¼Œä¸‰ä¸ªç´¢å¼•è¡¨ã€‚</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">+------------+--------------+-------------+---------------+----------+------------+----------------------------+-----------------+--------------+-----------------+---------------+---------------+--------+</span><br><span class="line">|<span class="string"> TABLE_CAT  </span>|<span class="string"> TABLE_SCHEM  </span>|<span class="string"> TABLE_NAME  </span>|<span class="string">  TABLE_TYPE   </span>|<span class="string"> REMARKS  </span>|<span class="string"> TYPE_NAME  </span>|<span class="string"> SELF_REFERENCING_COL_NAME  </span>|<span class="string"> REF_GENERATION  </span>|<span class="string"> INDEX_STATE  </span>|<span class="string"> IMMUTABLE_ROWS  </span>|<span class="string"> SALT_BUCKETS  </span>|<span class="string"> MULTI_TENANT  </span>|<span class="string"> VIEW_S </span>|</span><br><span class="line">+------------+--------------+-------------+---------------+----------+------------+----------------------------+-----------------+--------------+-----------------+---------------+---------------+--------+</span><br><span class="line">|<span class="string">            </span>|<span class="string"> ZDQ          </span>|<span class="string"> X_IDX       </span>|<span class="string"> INDEX         </span>|<span class="string">          </span>|<span class="string">            </span>|<span class="string">                            </span>|<span class="string">                 </span>|<span class="string"> ACTIVE       </span>|<span class="string"> true            </span>|<span class="string"> null          </span>|<span class="string"> false         </span>|<span class="string">        </span>|</span><br><span class="line">|<span class="string">            </span>|<span class="string"> ZDQ          </span>|<span class="string"> Y_IDX       </span>|<span class="string"> INDEX         </span>|<span class="string">          </span>|<span class="string">            </span>|<span class="string">                            </span>|<span class="string">                 </span>|<span class="string"> ACTIVE       </span>|<span class="string"> true            </span>|<span class="string"> null          </span>|<span class="string"> false         </span>|<span class="string">        </span>|</span><br><span class="line">|<span class="string">            </span>|<span class="string"> ZDQ          </span>|<span class="string"> Z_IDX       </span>|<span class="string"> INDEX         </span>|<span class="string">          </span>|<span class="string">            </span>|<span class="string">                            </span>|<span class="string">                 </span>|<span class="string"> ACTIVE       </span>|<span class="string"> true            </span>|<span class="string"> null          </span>|<span class="string"> false         </span>|<span class="string">        </span>|</span><br><span class="line">|<span class="string">            </span>|<span class="string"> SYSTEM       </span>|<span class="string"> CATALOG     </span>|<span class="string"> SYSTEM TABLE  </span>|<span class="string">          </span>|<span class="string">            </span>|<span class="string">                            </span>|<span class="string">                 </span>|<span class="string">              </span>|<span class="string"> false           </span>|<span class="string"> null          </span>|<span class="string"> false         </span>|<span class="string">        </span>|</span><br><span class="line">|<span class="string">            </span>|<span class="string"> SYSTEM       </span>|<span class="string"> FUNCTION    </span>|<span class="string"> SYSTEM TABLE  </span>|<span class="string">          </span>|<span class="string">            </span>|<span class="string">                            </span>|<span class="string">                 </span>|<span class="string">              </span>|<span class="string"> false           </span>|<span class="string"> null          </span>|<span class="string"> false         </span>|<span class="string">        </span>|</span><br><span class="line">|<span class="string">            </span>|<span class="string"> SYSTEM       </span>|<span class="string"> SEQUENCE    </span>|<span class="string"> SYSTEM TABLE  </span>|<span class="string">          </span>|<span class="string">            </span>|<span class="string">                            </span>|<span class="string">                 </span>|<span class="string">              </span>|<span class="string"> false           </span>|<span class="string"> null          </span>|<span class="string"> false         </span>|<span class="string">        </span>|</span><br><span class="line">|<span class="string">            </span>|<span class="string"> SYSTEM       </span>|<span class="string"> STATS       </span>|<span class="string"> SYSTEM TABLE  </span>|<span class="string">          </span>|<span class="string">            </span>|<span class="string">                            </span>|<span class="string">                 </span>|<span class="string">              </span>|<span class="string"> false           </span>|<span class="string"> null          </span>|<span class="string"> false         </span>|<span class="string">        </span>|</span><br><span class="line">|<span class="string">            </span>|<span class="string"> BIGJOY       </span>|<span class="string"> IMOS        </span>|<span class="string"> TABLE         </span>|<span class="string">          </span>|<span class="string">            </span>|<span class="string">                            </span>|<span class="string">                 </span>|<span class="string">              </span>|<span class="string"> true            </span>|<span class="string"> null          </span>|<span class="string"> false         </span>|<span class="string">        </span>|</span><br><span class="line">|<span class="string">            </span>|<span class="string"> ZDQ          </span>|<span class="string"> TEST        </span>|<span class="string"> TABLE         </span>|<span class="string">          </span>|<span class="string">            </span>|<span class="string">                            </span>|<span class="string">                 </span>|<span class="string">              </span>|<span class="string"> true            </span>|<span class="string"> null          </span>|<span class="string"> false         </span>|<span class="string">        </span>|</span><br><span class="line">+------------+--------------+-------------+---------------+----------+------------+----------------------------+-----------------+--------------+-----------------+---------------+---------------+--------+</span><br></pre></td></tr></table></figure>
<p>åœ¨ HBase Shell ä¸­ä½¿ç”¨ <code>list</code> å‘½ä»¤æŸ¥çœ‹ä¸€ä¸‹ï¼Œ<strong>å’Œ Global Index ä¸ä¸€æ ·çš„æ˜¯ï¼Œåªå¤šå‡ºäº†ä¸€ä¸ªè¡¨ â€˜ZDQ.TESTâ€™</strong>ã€‚</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">hbase</span><span class="params">(main)</span></span>:<span class="number">001</span>:<span class="number">0</span>&gt; list</span><br><span class="line">TABLE</span><br><span class="line">BIGJOY.IMOS</span><br><span class="line">BIGJOY.POIS</span><br><span class="line">BIGJOY.POIS_MAC_IDX</span><br><span class="line">SYSTEM.CATALOG</span><br><span class="line">SYSTEM.FUNCTION</span><br><span class="line">SYSTEM.SEQUENCE</span><br><span class="line">SYSTEM.STATS</span><br><span class="line">ZDQ.TEST</span><br><span class="line"><span class="number">8</span> row(s) <span class="keyword">in</span> <span class="number">0.2320</span> seconds</span><br><span class="line"></span><br><span class="line">=&gt; [<span class="string">"BIGJOY.IMOS"</span>, <span class="string">"BIGJOY.POIS"</span>, <span class="string">"BIGJOY.POIS_MAC_IDX"</span>, <span class="string">"SYSTEM.CATALOG"</span>, <span class="string">"SYSTEM.FUNCTION"</span>, <span class="string">"SYSTEM.SEQUENCE"</span>, <span class="string">"SYSTEM.STATS"</span>, <span class="string">"ZDQ.TEST"</span>]</span><br><span class="line"><span class="function"><span class="title">hbase</span><span class="params">(main)</span></span>:<span class="number">002</span>:<span class="number">0</span>&gt;</span><br></pre></td></tr></table></figure>
<h1 id="2-æ•°æ®è¡¨ã€ç´¢å¼•è¡¨ç»“æ„æ¢ç©¶"><a href="#2-æ•°æ®è¡¨ã€ç´¢å¼•è¡¨ç»“æ„æ¢ç©¶" class="headerlink" title="2.æ•°æ®è¡¨ã€ç´¢å¼•è¡¨ç»“æ„æ¢ç©¶"></a>2.æ•°æ®è¡¨ã€ç´¢å¼•è¡¨ç»“æ„æ¢ç©¶</h1><p>æŸ¥çœ‹ä¸‰ä¸ªç´¢å¼•è¡¨çš„ä¸»é”®ï¼<br><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:phoenix:localhost&gt; !primarykeys zdq.z_idx</span><br><span class="line">+------------+--------------+-------------+--------------+----------+----------+--------------+------------+------------+--------------+----------+----------------+</span><br><span class="line">|<span class="string"> TABLE_CAT  </span>|<span class="string"> TABLE_SCHEM  </span>|<span class="string"> TABLE_NAME  </span>|<span class="string"> COLUMN_NAME  </span>|<span class="string"> KEY_SEQ  </span>|<span class="string"> PK_NAME  </span>|<span class="string"> ASC_OR_DESC  </span>|<span class="string"> DATA_TYPE  </span>|<span class="string"> TYPE_NAME  </span>|<span class="string"> COLUMN_SIZE  </span>|<span class="string"> TYPE_ID  </span>|<span class="string"> VIEW_CONSTANT  </span>|</span><br><span class="line">+------------+--------------+-------------+--------------+----------+----------+--------------+------------+------------+--------------+----------+----------------+</span><br><span class="line">|<span class="string">            </span>|<span class="string"> ZDQ          </span>|<span class="string"> Z_IDX       </span>|<span class="string"> 0:Z          </span>|<span class="string"> 2        </span>|<span class="string">          </span>|<span class="string"> A            </span>|<span class="string"> 3          </span>|<span class="string"> DECIMAL    </span>|<span class="string"> null         </span>|<span class="string"> 3        </span>|<span class="string">                </span>|</span><br><span class="line">|<span class="string">            </span>|<span class="string"> ZDQ          </span>|<span class="string"> Z_IDX       </span>|<span class="string"> :ID          </span>|<span class="string"> 3        </span>|<span class="string">          </span>|<span class="string"> A            </span>|<span class="string"> -5         </span>|<span class="string"> BIGINT     </span>|<span class="string"> null         </span>|<span class="string"> -5       </span>|<span class="string">                </span>|</span><br><span class="line">|<span class="string">            </span>|<span class="string"> ZDQ          </span>|<span class="string"> Z_IDX       </span>|<span class="string"> _INDEX_ID    </span>|<span class="string"> 1        </span>|<span class="string">          </span>|<span class="string"> A            </span>|<span class="string"> 5          </span>|<span class="string"> SMALLINT   </span>|<span class="string"> null         </span>|<span class="string"> 5        </span>|<span class="string">                </span>|</span><br><span class="line">+------------+--------------+-------------+--------------+----------+----------+--------------+------------+------------+--------------+----------+----------------+</span><br><span class="line">0: jdbc:phoenix:localhost&gt; !primarykeys zdq.x_idx</span><br><span class="line">+------------+--------------+-------------+--------------+----------+----------+--------------+------------+------------+--------------+----------+----------------+</span><br><span class="line">|<span class="string"> TABLE_CAT  </span>|<span class="string"> TABLE_SCHEM  </span>|<span class="string"> TABLE_NAME  </span>|<span class="string"> COLUMN_NAME  </span>|<span class="string"> KEY_SEQ  </span>|<span class="string"> PK_NAME  </span>|<span class="string"> ASC_OR_DESC  </span>|<span class="string"> DATA_TYPE  </span>|<span class="string"> TYPE_NAME  </span>|<span class="string"> COLUMN_SIZE  </span>|<span class="string"> TYPE_ID  </span>|<span class="string"> VIEW_CONSTANT  </span>|</span><br><span class="line">+------------+--------------+-------------+--------------+----------+----------+--------------+------------+------------+--------------+----------+----------------+</span><br><span class="line">|<span class="string">            </span>|<span class="string"> ZDQ          </span>|<span class="string"> X_IDX       </span>|<span class="string"> 0:X          </span>|<span class="string"> 2        </span>|<span class="string">          </span>|<span class="string"> A            </span>|<span class="string"> 3          </span>|<span class="string"> DECIMAL    </span>|<span class="string"> null         </span>|<span class="string"> 3        </span>|<span class="string">                </span>|</span><br><span class="line">|<span class="string">            </span>|<span class="string"> ZDQ          </span>|<span class="string"> X_IDX       </span>|<span class="string"> :ID          </span>|<span class="string"> 3        </span>|<span class="string">          </span>|<span class="string"> A            </span>|<span class="string"> -5         </span>|<span class="string"> BIGINT     </span>|<span class="string"> null         </span>|<span class="string"> -5       </span>|<span class="string">                </span>|</span><br><span class="line">|<span class="string">            </span>|<span class="string"> ZDQ          </span>|<span class="string"> X_IDX       </span>|<span class="string"> _INDEX_ID    </span>|<span class="string"> 1        </span>|<span class="string">          </span>|<span class="string"> A            </span>|<span class="string"> 5          </span>|<span class="string"> SMALLINT   </span>|<span class="string"> null         </span>|<span class="string"> 5        </span>|<span class="string">                </span>|</span><br><span class="line">+------------+--------------+-------------+--------------+----------+----------+--------------+------------+------------+--------------+----------+----------------+</span><br><span class="line">0: jdbc:phoenix:localhost&gt; !primarykeys zdq.y_idx</span><br><span class="line">+------------+--------------+-------------+--------------+----------+----------+--------------+------------+------------+--------------+----------+----------------+</span><br><span class="line">|<span class="string"> TABLE_CAT  </span>|<span class="string"> TABLE_SCHEM  </span>|<span class="string"> TABLE_NAME  </span>|<span class="string"> COLUMN_NAME  </span>|<span class="string"> KEY_SEQ  </span>|<span class="string"> PK_NAME  </span>|<span class="string"> ASC_OR_DESC  </span>|<span class="string"> DATA_TYPE  </span>|<span class="string"> TYPE_NAME  </span>|<span class="string"> COLUMN_SIZE  </span>|<span class="string"> TYPE_ID  </span>|<span class="string"> VIEW_CONSTANT  </span>|</span><br><span class="line">+------------+--------------+-------------+--------------+----------+----------+--------------+------------+------------+--------------+----------+----------------+</span><br><span class="line">|<span class="string">            </span>|<span class="string"> ZDQ          </span>|<span class="string"> Y_IDX       </span>|<span class="string"> 0:Y          </span>|<span class="string"> 2        </span>|<span class="string">          </span>|<span class="string"> A            </span>|<span class="string"> 3          </span>|<span class="string"> DECIMAL    </span>|<span class="string"> null         </span>|<span class="string"> 3        </span>|<span class="string">                </span>|</span><br><span class="line">|<span class="string">            </span>|<span class="string"> ZDQ          </span>|<span class="string"> Y_IDX       </span>|<span class="string"> :ID          </span>|<span class="string"> 3        </span>|<span class="string">          </span>|<span class="string"> A            </span>|<span class="string"> -5         </span>|<span class="string"> BIGINT     </span>|<span class="string"> null         </span>|<span class="string"> -5       </span>|<span class="string">                </span>|</span><br><span class="line">|<span class="string">            </span>|<span class="string"> ZDQ          </span>|<span class="string"> Y_IDX       </span>|<span class="string"> _INDEX_ID    </span>|<span class="string"> 1        </span>|<span class="string">          </span>|<span class="string"> A            </span>|<span class="string"> 5          </span>|<span class="string"> SMALLINT   </span>|<span class="string"> null         </span>|<span class="string"> 5        </span>|<span class="string">                </span>|</span><br><span class="line">+------------+--------------+-------------+--------------+----------+----------+--------------+------------+------------+--------------+----------+----------------+</span><br></pre></td></tr></table></figure></p>
<p>å‘ç°ä¸‰ä¸ªç´¢å¼•è¡¨ä¸­é™¤äº†<strong>è¢«ç´¢å¼•çš„å­—æ®µ</strong>å­—æ®µä¸åŒå¤–ï¼Œå…¶ä»–ç»„æˆå¹¶ä¸”åœ¨ä¸»é”®ä¸­çš„é¡ºåºéƒ½æ˜¯ä¸€æ ·çš„ï¼Œä¸‹é¢çœ‹ä¸€ä¸‹æ‰§è¡Œè®¡åˆ’ï¼</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:phoenix:localhost&gt; explain select * <span class="keyword">from</span> zdq.test where x = 1;</span><br><span class="line">+---------------------------------------------------------------------------+</span><br><span class="line">|                                   PLAN                                    |</span><br><span class="line">+---------------------------------------------------------------------------+</span><br><span class="line">|<span class="built_in"> CLIENT </span>1-CHUNK PARALLEL 1-WAY ROUND ROBIN RANGE SCAN OVER ZDQ.TEST [1,1]  |</span><br><span class="line">|    <span class="built_in"> SERVER FILTER </span>BY FIRST KEY ONLY                                       |</span><br><span class="line">+---------------------------------------------------------------------------+</span><br><span class="line">2 rows selected (0.064 seconds)</span><br><span class="line">0: jdbc:phoenix:localhost&gt; explain select * <span class="keyword">from</span> zdq.test where y &gt; 3;</span><br><span class="line">+-----------------------------------------------------------------------------------+</span><br><span class="line">|                                       PLAN                                        |</span><br><span class="line">+-----------------------------------------------------------------------------------+</span><br><span class="line">|<span class="built_in"> CLIENT </span>1-CHUNK PARALLEL 1-WAY ROUND ROBIN RANGE SCAN OVER ZDQ.TEST [2,3] - [2,*]  |</span><br><span class="line">|    <span class="built_in"> SERVER FILTER </span>BY FIRST KEY ONLY                                               |</span><br><span class="line">+-----------------------------------------------------------------------------------+</span><br><span class="line">2 rows selected (0.067 seconds)</span><br><span class="line">0: jdbc:phoenix:localhost&gt; explain select * <span class="keyword">from</span> zdq.test where z &lt; 2;</span><br><span class="line">+-----------------------------------------------------------------------------------+</span><br><span class="line">|                                       PLAN                                        |</span><br><span class="line">+-----------------------------------------------------------------------------------+</span><br><span class="line">|<span class="built_in"> CLIENT </span>1-CHUNK PARALLEL 1-WAY ROUND ROBIN RANGE SCAN OVER ZDQ.TEST [3,*] - [3,2]  |</span><br><span class="line">|    <span class="built_in"> SERVER FILTER </span>BY FIRST KEY ONLY                                               |</span><br><span class="line">+-----------------------------------------------------------------------------------+</span><br></pre></td></tr></table></figure>
<p>ä»ç»™å‡ºçš„æ‰§è¡Œè®¡åˆ’ä¸­å¯ä»¥çœ‹å‡ºï¼Œä¸‰æ¬¡æŸ¥è¯¢éƒ½æ˜¯è¿›è¡Œçš„<strong>RANGE SCAN</strong>,ä½†æ˜¯æ³¨æ„åˆ° <code>[1,1],[2,3] - [2,*],[3,*] - [3,2]</code>çš„ä¸åŒï¼Œè™½ç„¶å¯¹å…¶ä¸­å«ä¹‰ä¸å®Œå…¨ç¡®å®šï¼Œå¯ä»¥çŸ¥é“çš„æ˜¯ä¸­æ‹¬å·çš„ç¬¬äºŒä¸ªæ•°å’ŒæŸ¥è¯¢çº¦æŸç›¸å…³ï¼Œç¬¬ä¸€ä¸ªæ•°å—ï¼Œæ˜¯ç´¢å¼•å»ºç«‹çš„é¡ºåºï¼Ÿè¿™æ ·ä¹Ÿå¯ä»¥ä¸ç´¢å¼•è¡¨çš„ primary key ç»„æˆçš„<code>_INDEX_ID</code>çš„å­—é¢æ„ä¹‰å¯¹åº”ï¼ŒçŒœæµ‹è€Œå·²ï¼Œæ¥ä¸‹æ¥çœ‹ä¸€ä¸‹åœ¨ HBase Shell ä¸­çš„ç»“æœå§ï¼</p>
<figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):004:0&gt; scan 'ZDQ.TEST'</span><br><span class="line">ROW                                                  COLUMN+CELL</span><br><span class="line"> <span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>C1<span class="symbol">\x</span>02<span class="symbol">\x</span>00<span class="symbol">\x</span>80<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>0009      column=L#0:_0, timestamp=1472824360985, value=_0</span><br><span class="line"> <span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>C1<span class="symbol">\x</span>05<span class="symbol">\x</span>00<span class="symbol">\x</span>80<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>01<span class="symbol">\x</span>E2@   column=L#0:_0, timestamp=1472824362230, value=_0</span><br><span class="line"> <span class="symbol">\x</span>00<span class="symbol">\x</span>01<span class="symbol">\x</span>C1<span class="symbol">\x</span>03<span class="symbol">\x</span>00<span class="symbol">\x</span>80<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>0009      column=L#0:_0, timestamp=1472824360985, value=_0</span><br><span class="line"> <span class="symbol">\x</span>00<span class="symbol">\x</span>01<span class="symbol">\x</span>C1<span class="symbol">\x</span>06<span class="symbol">\x</span>00<span class="symbol">\x</span>80<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>01<span class="symbol">\x</span>E2@   column=L#0:_0, timestamp=1472824362230, value=_0</span><br><span class="line"> <span class="symbol">\x</span>00<span class="symbol">\x</span>02<span class="symbol">\x</span>C1<span class="symbol">\x</span>04<span class="symbol">\x</span>00<span class="symbol">\x</span>80<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>0009      column=L#0:_0, timestamp=1472824360985, value=_0</span><br><span class="line"> <span class="symbol">\x</span>00<span class="symbol">\x</span>02<span class="symbol">\x</span>C1<span class="symbol">\x</span>07<span class="symbol">\x</span>00<span class="symbol">\x</span>80<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>01<span class="symbol">\x</span>E2@   column=L#0:_0, timestamp=1472824362230, value=_0</span><br><span class="line"> <span class="symbol">\x</span>80<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>0009                          column=0:M, timestamp=1472824360985, value=<span class="symbol">\x</span>C1<span class="symbol">\x</span>02</span><br><span class="line"> <span class="symbol">\x</span>80<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>0009                          column=0:N, timestamp=1472824360985, value=<span class="symbol">\x</span>80<span class="symbol">\x</span>00</span><br><span class="line"> <span class="symbol">\x</span>80<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>0009                          column=0:X, timestamp=1472824360985, value=<span class="symbol">\x</span>80<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>01</span><br><span class="line"> <span class="symbol">\x</span>80<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>0009                          column=0:Y, timestamp=1472824360985, value=<span class="symbol">\x</span>80<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>02</span><br><span class="line"> <span class="symbol">\x</span>80<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>0009                          column=0:Z, timestamp=1472824360985, value=<span class="symbol">\x</span>80<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>03</span><br><span class="line"> <span class="symbol">\x</span>80<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>0009                          column=0:_0, timestamp=1472824360985, value=x</span><br><span class="line"> <span class="symbol">\x</span>80<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>01<span class="symbol">\x</span>E2@                       column=0:M, timestamp=1472824362230, value=<span class="symbol">\x</span>C1<span class="symbol">\x</span>03</span><br><span class="line"> <span class="symbol">\x</span>80<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>01<span class="symbol">\x</span>E2@                       column=0:N, timestamp=1472824362230, value=<span class="symbol">\x</span>80<span class="symbol">\x</span>01</span><br><span class="line"> <span class="symbol">\x</span>80<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>01<span class="symbol">\x</span>E2@                       column=0:X, timestamp=1472824362230, value=<span class="symbol">\x</span>80<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>04</span><br><span class="line"> <span class="symbol">\x</span>80<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>01<span class="symbol">\x</span>E2@                       column=0:Y, timestamp=1472824362230, value=<span class="symbol">\x</span>80<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>05</span><br><span class="line"> <span class="symbol">\x</span>80<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>01<span class="symbol">\x</span>E2@                       column=0:Z, timestamp=1472824362230, value=<span class="symbol">\x</span>80<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>06</span><br><span class="line"> <span class="symbol">\x</span>80<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>01<span class="symbol">\x</span>E2@                       column=0:_0, timestamp=1472824362230, value=x</span><br><span class="line">8 row(s) in 0.0570 seconds</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„åˆ°ï¼Œæˆ‘ä»¬åªæ’å…¥äº†ä¸¤è¡Œï¼Œåº”è¯¥åªæœ‰ä¸¤ä¸ªä¸»é”®æ‰å¯¹ï¼ŒHBase Shell ä¸­æˆ‘ä»¬çœ‹åˆ°äº†<strong>8ä¸ªä¸»é”®</strong>,å«æœ‰<code>0:M,0:N,0:X,0:Y,0:Z</code>çš„ä¸¤è¡Œæ— ç–‘æ˜¯æˆ‘ä»¬æ‰§è¡Œ <code>UPSERT</code> å‘½ä»¤æ’å…¥çš„ï¼Œå‰©ä¸‹çš„å…­è¡Œæ˜¯ä»€ä¹ˆé¬¼ï¼Ÿ</p>
<p>ä»¥<code>\x00\x00\xC1\x02\x00\x80\x00\x00\x00\x00\x0009</code> å’Œ <code>\x00\x00\xC1\x05\x00\x80\x00\x00\x00\x00\x01\xE2@</code> ä¸ºä¾‹ï¼Œå¾ˆå¿«æˆ‘ä»¬å°±å¯ä»¥å‘ç°è¿™ä¸¤è¡Œçš„ååŠæˆª <code>\x80\x00\x00\x00\x00\x0009</code> å°±æ˜¯åŸæ•°æ®è¡¨çš„ä¸»é”®äº†ï¼Œè¿™ä¸ <code>!primarykeys</code> ä¸­çœ‹åˆ°çš„ <code>:ID</code>çš„ <code>KEY_SEQ = 3</code> æ˜¯ä¸€è‡´çš„ã€‚</p>
<p>å‰©ä¸‹å‰è¾¹çš„ <code>\x00\x00\xC1\x02\x00</code> å’Œ <code>\x00\x00\xC1\x05\x00</code> ,ä¸è¿‡ä»£è¡¨ä»€ä¹ˆæ„æ€å°±å¾—çŒœäº†ï¼Œç´¢å¼•è¡¨ä¸»é”®æŸ¥çœ‹çš„ç»“æœä¸­ï¼Œè¢«ç´¢å¼•å­—æ®µ(å§‘ä¸”è¿˜è¿™ä¹ˆå«å§)æ˜¯è¢«æ”¾åœ¨äº†ç¬¬äºŒä½çš„ <code>KEY_SEQ = 2</code> ï¼Œå¹¶ä¸”æ˜¯ <code>Decimal</code>ç±»å‹çš„ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆåœ¨åˆ›å»ºè¡¨çš„æ—¶å€™å¤šäº†ä¸€ä¸ª Decimal ç±»å‹çš„å­—æ®µ <code>M</code>,åœ¨ HBase Shell ä¸­çš„æŸ¥è¯¢ç»“æœæœ‰è¿™ä¹ˆä¸€è¡Œ<code>\x80\x00\x00\x00\x00\x00\x04\xD2                    column=0:M, timestamp=1472822139596, value=\xC1\x02</code>,çœ‹ M çš„å€¼å¯¹æ¯”<code>\x00\x00\xC1\x02\x00</code>ï¼Œå‘ç°å‡ºåè¾¹å¤šäº†ä¸€ä¸ª <code>\x00</code>ä¹‹å¤–ï¼Œå…¶ä½™æ˜¯å»åˆçš„ï¼Œå³ X = Mï¼Œå‰ç¼€ <code>\x00\x00</code> <code>\x00\x01</code> <code>\x00\x02</code> åº”è¯¥å°±æ˜¯ä¸‰ä¸ªç´¢å¼•çš„ç¼–å·äº†ï¼Œå¦‚æœåœ¨åˆ›å»ºç¬¬å››ä¸ªç´¢å¼•ï¼Œå°±è¿˜ä¼šå¤šå‡º N è¡Œï¼ŒN ä¸ºåŸå§‹æ•°æ®çš„è¡Œæ•°ï¼Œç»è¿‡å®è·µç¡®å®å¦‚æ­¤ï¼Œåªæ˜¯ä¸­é—´çš„ä¸€ä¸ª <code>\x00</code> æ˜¯åšä»€ä¹ˆç”¨çš„è¿˜ä¸æ¸…æ¥šï¼</p>
<p>ä»è¿™é‡Œå¤§æ¦‚å¯ä»¥çŒœå‡º <strong>shadow column families</strong>çš„æ„æ€äº†ï¼Œåº”è¯¥å°±æ˜¯æŒ‡åœ¨åŒä¸€ä¸ªè¡¨ä¸­æ·»åŠ ä¸»é”®æ„æˆä¸åŒçš„è¡Œä½œä¸ºç´¢å¼•ã€‚</p>
<h1 id="3-æ€»ç»“"><a href="#3-æ€»ç»“" class="headerlink" title="3.æ€»ç»“"></a>3.æ€»ç»“</h1><p>ç»è¿‡ä»¥ä¸Šå®éªŒï¼Œæ€»ç»“ Phoenix çš„ Local Index ï¼š</p>
<ul>
<li>ä» Phoenix 4.8 ç‰ˆæœ¬å¼€å§‹ï¼ŒLocal Index å’ŒåŸå§‹æ•°æ®æ˜¯å­˜åœ¨äºä¸€ä¸ªè¡¨ä¸­çš„ï¼</li>
<li>Local Index å…ˆèŒƒå›´æ‰«æçº¦æŸï¼Œæ ¹æ®å¾—åˆ°çš„ <code>:ID</code> å†æŸ¥è¯¢åŸå§‹æ•°æ®ï¼Œæ‰€ä»¥ Local Index æ˜¯å¯ä»¥ç”¨åœ¨ä»»æ„å­—æ®µçš„æŸ¥è¯¢ä¸­éƒ½æœ‰ä½œç”¨ï¼</li>
<li>shadow column families åº”è¯¥å°±æ˜¯ä¸€ä¸ªå° trick è€Œå·²ï¼Œå¼„å¾—æ¦‚å¿µå¾ˆé«˜å¤§ä¸Šï¼Œå¦‚æœæˆ‘ç†è§£é”™äº†è¿˜æœ›æŒ‡æ­£ã€‚</li>
<li>Local Index æŸ¥è¯¢è‡³å°‘ç»è¿‡ä¸€æ¬¡ RANGE SCAN å’Œ GET ï¼Œæ‰€ä»¥æ•ˆç‡ä¸Šè‚¯å®šä¸å¦‚ Global Index é«˜ã€‚</li>
<li>ç–‘é—®1ï¼šLocal Index æ˜¯ä¿è¯äº†ç´¢å¼•è¡¨å’ŒåŸå§‹è¡¨åœ¨åŒä¸€ä¸ª RegionServer ä¸Šçš„ï¼Œå¦‚æœåœ¨ä¸€ä¸ªè¡¨ä¸­ï¼Œè¡Œå¥ç»„æˆåˆä¸åŒï¼ŒPhoenix æ˜¯å¦‚ä½•å®ç°è¿™ä¸€ç‚¹çš„ï¼Ÿ</li>
<li>å®˜æ–¹æ–‡æ¡£è¯´ï¼šå¦‚æœä¸€ä¸ª Local Index è¢«ä½¿ç”¨ï¼Œæ‰€ç”¨çš„ Region éƒ½è¦è¢«æ£€æŸ¥æ˜¯å¦æœ‰æ»¡è¶³çº¦æŸçš„æ•°æ®ï¼Œæ‰€ä»¥è¯»å–æ•ˆç‡å¾ˆä½å‘ï¼</li>
</ul>
<p>æœ€åï¼Œå‘ç° Phoenix æŠŠå„ç§ Data Type çš„éƒ½å˜æˆ Hexacdemical å­—ç¬¦ä¸²äº†ï¼Œå¾ˆä¸åˆ©äºäººæ¥æŸ¥çœ‹ï¼Œè™½ç„¶åœ¨ Phoenix çš„äº¤äº’å‘½ä»¤è¡Œä¸­æ˜¯ç±»å¦‚ RDMBS çš„å¯è¯»çš„ï¼Œä½†åœ¨è¿™æ¬¡å®éªŒä¸­ä¹Ÿå‘ç°äº†è¿™äº› Hexacdemical å¤ªä¸å‹å¥½ï¼Œå¦‚æœæœ‰å¿…è¦å¹¶ä¸”æ‰¾åˆ°æ¯”è¾ƒå¥½çš„è§£å†³æ–¹æ¡ˆçš„è¯ï¼Œå¤§å®¶ç»™æä¾›äº›å¸®åŠ©å¦‚ä½•ä½¿ hexacdemical readable?</p>
]]></content>
      
        <categories>
            
            <category> Phoenix </category>
            
        </categories>
        
        
        <tags>
            
            <tag> HBase </tag>
            
            <tag> Secondary Index </tag>
            
            <tag> Phoenix </tag>
            
            <tag> Local Index </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Phoenix Secondary Indexåˆæ¢ä¹‹Global Index]]></title>
      <url>http://dequn.github.io/2016/08/29/Phoenix-Secondary-Index-Exploration-Global-Index/</url>
      <content type="html"><![CDATA[<p>ä¸Šç¯‡æˆ‘ä»¬æåˆ°äº†HBaseå»ºç«‹äºŒçº§ç´¢å¼•çš„åŸç†ï¼Œä½†æ˜¯å½“æˆ‘ä»¬è‡ªå·±å»ºç«‹äºŒçº§ç´¢å¼•ï¼Œå°±éœ€è¦åšé¢å¤–å¾ˆå¤šå·¥ä½œï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰Coprocessorï¼Œåœ¨æ•°æ®æ›´æ–°çš„æ—¶å€™æ›´æ–°ç´¢å¼•ï¼ŒæŸ¥è¯¢æ—¶å…ˆå»æ£€ç´¢ç´¢å¼•è¡¨ç­‰ï¼Œå®šä¹‰è¿™äº›Coprocessorä¸ä»…è´¹æ—¶è´¹åŠ›ï¼Œè€Œä¸”ä¸€èˆ¬ä½¿ç”¨è€…ä¸èƒ½ä¿è¯ç¨‹åºçš„é«˜æ•ˆæ€§ã€å¥å£®æ€§ç­‰ã€‚è¿˜å¥½ï¼Œå·²ç»æœ‰ä¸å°‘æ„å»ºåœ¨HBaseä¸Šçš„æ’ä»¶â€”â€”ä¸ªäººè§‰å¾—ç§°ä¹‹ä¸ºæ’ä»¶æ›´ä¸ºåˆç†ï¼Œå·²ç»å¸®æˆ‘ä»¬åšäº†è¿™äº›å·¥ä½œï¼ŒPhoenixå°±æ˜¯å…¶ä¸­ä¸€ç§ã€‚</p>
<p>Phoenixæä¾›çš„äºŒçº§ç´¢å¼•æŒ‰ç´¢å¼•å¯¹è±¡å¯ä»¥åˆ†ä¸ºCovered Indexes å’Œ Functional Indexesï¼ŒCovered Indexedå°±æ˜¯å¯¹åŸå§‹æ•°æ®è¿›è¡Œæ‰€ä»¥ï¼ŒFunctional Indexeså°±æ˜¯å°±åŸå§‹æ•°æ®è¿›è¡Œå¤„ç†åå†ç´¢å¼•ï¼ŒåŒºåˆ«ä»<a href="https://phoenix.apache.org/secondary_indexing.html" target="_blank" rel="noopener">å®˜æ–¹ç»™å‡ºçš„ä¸¤ä¸ªä¾‹å­</a>å°±å¯ä»¥å¾ˆæ˜æ˜¾çš„çœ‹å‡ºï¼Œä¸å†è®¨è®ºã€‚</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># Covered Indexes</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">INDEX</span> my_index <span class="keyword">ON</span> my_table (v1,v2) <span class="keyword">INCLUDE</span>(v3)</span><br><span class="line"></span><br><span class="line"># Functional Indexes</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">INDEX</span> UPPER_NAME_IDX <span class="keyword">ON</span> EMP (<span class="built_in">UPPER</span>(FIRST_NAME||<span class="string">' '</span>||LAST_NAME))</span><br><span class="line"><span class="keyword">SELECT</span> EMP_ID <span class="keyword">FROM</span> EMP <span class="keyword">WHERE</span> <span class="built_in">UPPER</span>(FIRST_NAME||<span class="string">' '</span>||LAST_NAME)=<span class="string">'JOHN DOE'</span></span><br></pre></td></tr></table></figure>
<p>å¦å¤–Phoenixçš„ç´¢å¼•åˆ†ä¸º<strong>Global Indexes</strong> å’Œ <strong>Local Indexes</strong>,å®˜æ–¹æ–‡æ¡£æåˆ°ï¼ŒGlobal Indexé€‚åˆé€‚ç”¨äº<strong>è¯»å¤šå†™å°‘</strong>çš„åœºæ™¯ï¼ŒLocal Indexé€‚åˆ<strong>é¢‘ç¹å†™</strong>çš„åœºæ™¯ï¼Œé‚£ä¹ˆè¿™ä¸¤ç§ç´¢å¼•åˆ°åº•æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</p>
<h1 id="1-å»ºç«‹æ•°æ®è¡¨ï¼Œæ˜ç¡®éœ€æ±‚"><a href="#1-å»ºç«‹æ•°æ®è¡¨ï¼Œæ˜ç¡®éœ€æ±‚" class="headerlink" title="1 å»ºç«‹æ•°æ®è¡¨ï¼Œæ˜ç¡®éœ€æ±‚"></a>1 å»ºç«‹æ•°æ®è¡¨ï¼Œæ˜ç¡®éœ€æ±‚</h1><p>å› ä¸ºæ˜¯è¯¾é¢˜éœ€è¦ï¼Œå·²ç»å­˜åœ¨ä¸€å¼ æ•°æ®è¡¨<code>BIGJOY.IMOS</code>ï¼Œå¤§æ¦‚æœ‰400ä¸‡è¡Œçš„æ•°æ®ï¼Œæœ€åˆå°±æ˜¯ä½¿ç”¨Phoenixå»ºç«‹çš„ï¼Œç»™å¤§å®¶çœ‹ä¸€ä¸‹è¯¥è¡¨çš„ç»“æ„ï¼Œæ³¨æ„è¯¥cellä¸æ˜¯HBaseçš„Cellï¼Œä¸è¦æ··æ·†ã€‚</p>
<table>
<thead>
<tr>
<th>COLUMN_NAME</th>
<th>DATA_TYPE</th>
<th>TYPE_NAME</th>
</tr>
</thead>
<tbody>
<tr>
<td>ID</td>
<td>1</td>
<td>CHAR</td>
</tr>
<tr>
<td>FLOOR</td>
<td>1</td>
<td>CHAR</td>
</tr>
<tr>
<td>TIME</td>
<td>93</td>
<td>TIMESTAMP</td>
</tr>
<tr>
<td>MAC</td>
<td>1</td>
<td>CHAR</td>
</tr>
<tr>
<td>X</td>
<td>4</td>
<td>INTEGER</td>
</tr>
<tr>
<td>Y</td>
<td>4</td>
<td>INTEGER</td>
</tr>
<tr>
<td>CELL</td>
<td>1</td>
<td>CHAR</td>
</tr>
</tbody>
</table>
<p><strong>éœ€æ±‚:</strong>1.æ ¹æ®macå’Œtimeçº¦æŸæŸ¥è¯¢cell;2.æ ¹æ®cellå’Œtimeçº¦æŸæŸ¥è¯¢macã€‚ä»¥éœ€æ±‚1ä¸ºä¾‹ï¼Œæ¢ç´¢Phoenix Secondary Indexçš„å·¥ä½œåŸç†ã€‚</p>
<h1 id="2-å¯¹æ¯”æ¡ˆä¾‹"><a href="#2-å¯¹æ¯”æ¡ˆä¾‹" class="headerlink" title="2 å¯¹æ¯”æ¡ˆä¾‹"></a>2 å¯¹æ¯”æ¡ˆä¾‹</h1><p>ä¸ºäº†æ–¹ä¾¿å’Œä¸¥è°¨ï¼Œæœ¬æ–‡å»ºç«‹ç´¢å¼•å‰åè¿›è¡Œäº†ä¸‹é¢çš„å…«ä¸ªæŸ¥è¯¢ï¼Œä¹Ÿæ˜¯ä»è¿™å…«ä¸ªæŸ¥è¯¢æ¢ç©¶Phoenix Secondary Indexï¼Œä¸‹é¢å°±å…ˆåˆ—å‡ºè¿™8ä¸ªæŸ¥è¯¢è¯­å¥ã€‚</p>
<table>
<thead>
<tr>
<th>ç¼–å·</th>
<th>SQl</th>
<th>æŸ¥è¯¢ç»“æœ</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td><code>select cell from bigjoy.imos where mac = &#39;28E14CA61635&#39;;</code></td>
<td>28æ¡è®°å½•</td>
</tr>
<tr>
<td>2</td>
<td><code>select time from bigjoy.imos where mac = &#39;28E14CA61635&#39;;</code></td>
<td>28æ¡è®°å½•</td>
</tr>
<tr>
<td>3</td>
<td><code>select floor from bigjoy.imos where mac = &#39;28E14CA61635&#39;;</code></td>
<td>28æ¡è®°å½•</td>
</tr>
<tr>
<td>4</td>
<td><code>select * from bigjoy.imos where mac = &#39;28E14CA61635&#39;;</code></td>
<td>28æ¡è®°å½•</td>
</tr>
<tr>
<td>5</td>
<td><code>select mac from bigjoy.imos where time = to_date(&#39;2014-04-01 20:39:42.000&#39;);</code></td>
<td>223æ¡è®°å½•</td>
</tr>
<tr>
<td>6</td>
<td><code>select cell from bigjoy.imos where time = to_date(&#39;2014-04-01 20:39:42.000&#39;);</code></td>
<td>223æ¡è®°å½•</td>
</tr>
<tr>
<td>7</td>
<td><code>select cell from bigjoy.imos where mac = &#39;28E14CA61635&#39; and time = to_date(&#39;2014-04-01 20:39:42.000&#39;);</code></td>
<td>1æ¡è®°å½•</td>
</tr>
<tr>
<td>8</td>
<td><code>select * from bigjoy.imos where mac = &#39;28E14CA61635&#39; and time = to_date(&#39;2014-04-01 20:39:42.000&#39;);</code></td>
<td>1æ¡è®°å½•</td>
</tr>
</tbody>
</table>
<h1 id="3-å»ºç«‹mac-timeå…¨å±€ç´¢å¼•"><a href="#3-å»ºç«‹mac-timeå…¨å±€ç´¢å¼•" class="headerlink" title="3 å»ºç«‹mac-timeå…¨å±€ç´¢å¼•"></a>3 å»ºç«‹mac-timeå…¨å±€ç´¢å¼•</h1><p>ä¸‹é¢å»ºç«‹é’ˆå¯¹macçš„ç´¢å¼•</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">INDEX</span> bigjoy.mac_idx <span class="keyword">on</span> bigjoy.imos (mac,<span class="keyword">time</span>) <span class="keyword">include</span> (cell)</span><br><span class="line"># <span class="keyword">global</span> <span class="keyword">index</span> default.</span><br></pre></td></tr></table></figure>
<h1 id="4-æ•ˆç‡å¯¹æ¯”"><a href="#4-æ•ˆç‡å¯¹æ¯”" class="headerlink" title="4 æ•ˆç‡å¯¹æ¯”"></a>4 æ•ˆç‡å¯¹æ¯”</h1><p>é’ˆå¯¹2ä¸­çš„8æ¡SQLï¼Œå†æ¬¡è¿›è¡ŒæŸ¥è¯¢ï¼Œä¸å»ºç«‹ç´¢å¼•å‰çš„å¯¹æ¯”å¦‚ä¸‹è¡¨:</p>
<table>
<thead>
<tr>
<th>ç¼–å·</th>
<th>å»ºç«‹ç´¢å¼•å‰(ç§’)</th>
<th>å»ºç«‹ç´¢å¼•å(ç§’)</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>7.236</td>
<td>0.175</td>
</tr>
<tr>
<td>2</td>
<td>6.553</td>
<td>0.029</td>
</tr>
<tr>
<td>3</td>
<td>7.581</td>
<td>6.826</td>
</tr>
<tr>
<td>4</td>
<td>7.171</td>
<td>6.616</td>
</tr>
<tr>
<td>5</td>
<td>7.129</td>
<td>9.926</td>
</tr>
<tr>
<td>6</td>
<td>7.258</td>
<td>7.039</td>
</tr>
<tr>
<td>7</td>
<td>7.632</td>
<td>0.026</td>
</tr>
<tr>
<td>8</td>
<td>7.682</td>
<td>7.383</td>
</tr>
</tbody>
</table>
<p>å¯ä»¥çœ‹å‡ºï¼Œå»ºç«‹ç´¢å¼•æ˜¯é€‰æ‹©çš„æ˜¯(mac,time)å­—æ®µ,å¹¶ä¸”åŒ…å«äº†cellå­—æ®µï¼Œä»¥macä¸ºçº¦æŸæŸ¥è¯¢timeæˆ–cellå­—æ®µæ•ˆç‡æå‡å¾ˆå¤§ï¼Œä½†å½“æŸ¥è¯¢floorå­—æ®µæˆ–è€…åŒ…å«å…¶ä»–å­—æ®µçš„æ—¶å€™ï¼Œç´¢å¼•çš„å­˜åœ¨å¹¶æ²¡æœ‰æå‡æ•ˆç‡ï¼Œä»¥timeä¸ºçº¦æŸçš„æŸ¥è¯¢åœ¨ç´¢å¼•å»ºç«‹å‰åä¹Ÿæ²¡æœ‰æ•ˆç‡ä¸Šçš„æ”¹å˜ã€‚</p>
<p>ä¸‹é¢å°±æ·±å…¥åˆ†æä¸€ä¸‹åŸå› ã€‚</p>
<h2 id="4-1-æŸ¥çœ‹ä¸€ä¸‹æ•°æ®è¡¨æœ‰æœ¨æœ‰å˜åŒ–"><a href="#4-1-æŸ¥çœ‹ä¸€ä¸‹æ•°æ®è¡¨æœ‰æœ¨æœ‰å˜åŒ–" class="headerlink" title="4.1 æŸ¥çœ‹ä¸€ä¸‹æ•°æ®è¡¨æœ‰æœ¨æœ‰å˜åŒ–"></a>4.1 æŸ¥çœ‹ä¸€ä¸‹æ•°æ®è¡¨æœ‰æœ¨æœ‰å˜åŒ–</h2><p>ç´¢å¼•å»ºç«‹å¥½åï¼Œå…ˆä½¿ç”¨Phoenixçš„ <code>!tables</code> å‘½ä»¤æŸ¥çœ‹ä¸€ä¸‹æ‰€ç”¨çš„æ•°æ®è¡¨ï¼Œä»ç»“æœä¸­å¯ä»¥çœ‹å‡ºå¤šå‡ºäº†ä¸€ä¸ª<strong>BIGJOY.MAC_IDX</strong>çš„æ•°æ®è¡¨ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚</p>
<p><img src="https://i.loli.net/2019/07/25/5d39600d4da2346306.png" alt="ä½¿ç”¨Phoenixå»ºç«‹ç´¢å¼•åå¤šå‡ºä¸€ä¸ªæ•°æ®è¡¨"></p>
<h2 id="4-2-æ¢ç´¢ç´¢å¼•è¡¨çš„ç»“æ„"><a href="#4-2-æ¢ç´¢ç´¢å¼•è¡¨çš„ç»“æ„" class="headerlink" title="4.2 æ¢ç´¢ç´¢å¼•è¡¨çš„ç»“æ„"></a>4.2 æ¢ç´¢ç´¢å¼•è¡¨çš„ç»“æ„</h2><p>é¦–å…ˆçœ‹ä¸€ä¸‹è¯¥è¡¨éƒ½æœ‰å“ªäº›å­—æ®µå‘€ï¼</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:phoenix:localhost&gt; !describe bigjoy.mac_idx</span><br><span class="line">+------------+--------------+-------------+--------------+------------+------------+--------------+----------------+-----------------+-----------------+-----+</span><br><span class="line">|<span class="string"> TABLE_CAT  </span>|<span class="string"> TABLE_SCHEM  </span>|<span class="string"> TABLE_NAME  </span>|<span class="string"> COLUMN_NAME  </span>|<span class="string"> DATA_TYPE  </span>|<span class="string"> TYPE_NAME  </span>|<span class="string"> COLUMN_SIZE  </span>|<span class="string"> BUFFER_LENGTH  </span>|<span class="string"> DECIMAL_DIGITS  </span>|<span class="string"> NUM_PREC_RADIX  </span>|<span class="string"> NUL </span>|</span><br><span class="line">+------------+--------------+-------------+--------------+------------+------------+--------------+----------------+-----------------+-----------------+-----+</span><br><span class="line">|<span class="string">            </span>|<span class="string"> BIGJOY       </span>|<span class="string"> MAC_IDX     </span>|<span class="string"> 0:MAC        </span>|<span class="string"> 12         </span>|<span class="string"> VARCHAR    </span>|<span class="string"> 12           </span>|<span class="string"> null           </span>|<span class="string"> null            </span>|<span class="string"> null            </span>|<span class="string"> 1   </span>|</span><br><span class="line">|<span class="string">            </span>|<span class="string"> BIGJOY       </span>|<span class="string"> MAC_IDX     </span>|<span class="string"> 0:TIME       </span>|<span class="string"> 3          </span>|<span class="string"> DECIMAL    </span>|<span class="string"> null         </span>|<span class="string"> null           </span>|<span class="string"> null            </span>|<span class="string"> null            </span>|<span class="string"> 1   </span>|</span><br><span class="line">|<span class="string">            </span>|<span class="string"> BIGJOY       </span>|<span class="string"> MAC_IDX     </span>|<span class="string"> :ID          </span>|<span class="string"> 1          </span>|<span class="string"> CHAR       </span>|<span class="string"> 26           </span>|<span class="string"> null           </span>|<span class="string"> null            </span>|<span class="string"> null            </span>|<span class="string"> 0   </span>|</span><br><span class="line">|<span class="string">            </span>|<span class="string"> BIGJOY       </span>|<span class="string"> MAC_IDX     </span>|<span class="string"> 0:CELL       </span>|<span class="string"> 1          </span>|<span class="string"> CHAR       </span>|<span class="string"> 4            </span>|<span class="string"> null           </span>|<span class="string"> null            </span>|<span class="string"> null            </span>|<span class="string"> 1   </span>|</span><br><span class="line">+------------+--------------+-------------+--------------+------------+------------+--------------+----------------+-----------------+-----------------+-----+</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼ŒPhoenixæŠŠåŸæ¥çš„TimeStampç±»å‹çš„æ—¶é—´å˜æˆäº†Decimalï¼Œåº”è¯¥æ˜¯ç”¨æ•´æ•°çš„æ—¶é—´æˆ³æ¥è¡¨ç¤ºæ—¶é—´äº†ï¼Œè¿™æ ·è¿ç®—èµ·æ¥ç®€å•ï¼</p>
<p>æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹è¯¥è¡¨çš„ä¸»é”®æ„æˆ<code>!primarykeys bigjoy.mac_idx</code>ï¼Œç»“æœå¦‚ä¸‹ã€‚</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+------------+--------------+-------------+--------------+----------+----------+--------------+------------+------------+--------------+-+</span><br><span class="line">|<span class="string"> TABLE_CAT  </span>|<span class="string"> TABLE_SCHEM  </span>|<span class="string"> TABLE_NAME  </span>|<span class="string"> COLUMN_NAME  </span>|<span class="string"> KEY_SEQ  </span>|<span class="string"> PK_NAME  </span>|<span class="string"> ASC_OR_DESC  </span>|<span class="string"> DATA_TYPE  </span>|<span class="string"> TYPE_NAME  </span>|<span class="string"> COLUMN_SIZE  </span>|<span class="string"> </span>|</span><br><span class="line">+------------+--------------+-------------+--------------+----------+----------+--------------+------------+------------+--------------+-+</span><br><span class="line">|<span class="string">            </span>|<span class="string"> BIGJOY       </span>|<span class="string"> MAC_IDX     </span>|<span class="string"> 0:MAC        </span>|<span class="string"> 1        </span>|<span class="string">          </span>|<span class="string"> A            </span>|<span class="string"> 12         </span>|<span class="string"> VARCHAR    </span>|<span class="string"> 12           </span>|<span class="string"> </span>|</span><br><span class="line">|<span class="string">            </span>|<span class="string"> BIGJOY       </span>|<span class="string"> MAC_IDX     </span>|<span class="string"> 0:TIME       </span>|<span class="string"> 2        </span>|<span class="string">          </span>|<span class="string"> A            </span>|<span class="string"> 3          </span>|<span class="string"> DECIMAL    </span>|<span class="string"> null         </span>|<span class="string"> </span>|</span><br><span class="line">|<span class="string">            </span>|<span class="string"> BIGJOY       </span>|<span class="string"> MAC_IDX     </span>|<span class="string"> :ID          </span>|<span class="string"> 3        </span>|<span class="string">          </span>|<span class="string"> A            </span>|<span class="string"> 1          </span>|<span class="string"> CHAR       </span>|<span class="string"> 26           </span>|<span class="string"> </span>|</span><br><span class="line">+------------+--------------+-------------+--------------+----------+----------+--------------+------------+------------+--------------+-+</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹å‡ºï¼Œè¯¥è¡¨çš„ä¸»é”®æ˜¯ç”±0:MAC,0:TIME,:IDæŒ‰é¡ºåºæ„æˆçš„ï¼Œä¸è¿‡:IDæ˜¯ä»€ä¹ˆç©æ„å„¿ï¼Œæ˜¯åŸæ•°æ®è¡¨çš„ä¸»é”®ï¼Ÿä¸ºäº†éªŒè¯çŒœæƒ³ï¼Œè¯·æ¥ç€çœ‹(ï½¡ï½¥Ï‰ï½¥)</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:phoenix:localhost&gt; select * from bigjoy.mac<span class="emphasis">_idx limit 1;</span></span><br><span class="line"><span class="emphasis">+---------------+------------------+-----------------------------+---------+</span></span><br><span class="line"><span class="emphasis">|     0:MAC     |      0:TIME      |             :ID             | 0:CELL  |</span></span><br><span class="line"><span class="emphasis">+---------------+------------------+-----------------------------+---------+</span></span><br><span class="line"><span class="emphasis">| 000000000C00  | 1.396363024E+12  | 02281396334224000000000C00  | 228     |</span></span><br><span class="line"><span class="emphasis">+---------------+------------------+-----------------------------+---------+</span></span><br><span class="line"><span class="emphasis">1 row selected (0.123 seconds)</span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œä¹Ÿå¯ä»¥çœ‹å‡ºè¯¥ç´¢å¼•è¡¨ï¼ˆæ˜¯çœŸçš„èƒ½è¢«ç”¨æˆ·çœ‹åˆ°çš„è¡¨å“ˆï¼‰åŒ…å«äº†4ä¸ªå­—æ®µï¼Œå‰ä¸‰ä¸ªåˆšæ‰è®²äº†ï¼Œæ˜¯æ„æˆä¸»é”®çš„ç»„æˆéƒ¨åˆ†ï¼Œ0:CELLå¾ˆå¥½ç†è§£ï¼Œå°±æ˜¯åˆ›å»ºç´¢å¼•æ—¶include åè¾¹çš„cellå­—æ®µäº†ã€‚æœ‰:IDäº†ä¸æ˜¯ï¼Œå¥½çš„ï¼Œå»hbase shellä¸­åˆ©ç”¨:IDæŸ¥è¯¢ä¸€ä¸‹æ•°æ®ï¼</p>
<figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):038:0&gt; get 'BIGJOY.IMOS','02281396334224000000000C00'</span><br><span class="line">COLUMN                                   CELL                                                                                                                 </span><br><span class="line"> 0:CELL                                  timestamp=1470667019714, value=228        </span><br><span class="line"> 0:FLOOR                                 timestamp=1470667019714, value=20010    </span><br><span class="line"> 0:MAC                                   timestamp=1470667019714, value=000000000C00</span><br><span class="line"> 0:TIME                                  timestamp=1470667019714, value=<span class="symbol">\x</span>80<span class="symbol">\x</span>00<span class="symbol">\x</span>01E<span class="symbol">\x</span>1D<span class="symbol">\x</span>B8<span class="symbol">\x</span>D6<span class="symbol">\x</span>80<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>00<span class="symbol">\x</span>00</span><br><span class="line"> 0:X                                     timestamp=1470667019714, value=<span class="symbol">\x</span>80<span class="symbol">\x</span>01<span class="symbol">\x</span>85<span class="symbol">\x</span>1D</span><br><span class="line"> 0:Y                                     timestamp=1470667019714, value=<span class="symbol">\x</span>80<span class="symbol">\x</span>01<span class="symbol">\x</span>82<span class="symbol">\x</span>E8</span><br><span class="line"> 0:_0                                    timestamp=1470667019714, value=x                                                                                     </span><br><span class="line">7 row(s) in 0.0260 seconds</span><br></pre></td></tr></table></figure>
<p>å—¯ï¼Œæœä¸å…¶ç„¶å‘€ï¼Œ<strong> :IDåœ¨ç´¢å¼•è¡¨ä¸­å‚ä¸æ„æˆä¸»é”®ï¼Œé¦–å…ˆæ˜¯ä¿è¯äº†ç´¢å¼•è¡¨ä¸»é”®çš„å”¯ä¸€æ€§ï¼Œå› æ­¤Global Indexæ˜¯å¯†é›†ç´¢å¼•ï¼Œå¦å¤–ï¼Œå®ƒå¯¹æŸ¥è¯¢ä¹Ÿæ˜¯æœ‰å¸®åŠ©çš„</strong>ï¼ŒåŸ‹ä¸ªä¼ç¬”ï¼Œä¸‹é¢ä¼šæåˆ°ï¼</p>
<h2 id="4-3-æŸ¥è¯¢è®¡åˆ’è§£è¯»"><a href="#4-3-æŸ¥è¯¢è®¡åˆ’è§£è¯»" class="headerlink" title="4.3 æŸ¥è¯¢è®¡åˆ’è§£è¯»"></a>4.3 æŸ¥è¯¢è®¡åˆ’è§£è¯»</h2><h3 id="4-3-1-Phoenixæä¾›äº†Explainå‘½ä»¤ï¼Œè§£é‡Šæ‰§è¡Œè®¡åˆ’ï¼Œä¸‹é¢å…ˆçœ‹macçº¦æŸçš„å¯¹æ¯”å§ï¼Œå’£å½“å’£å½“çœŸæ˜¯å¤Ÿé•¿çš„-ï¿£Ë‡ï¿£"><a href="#4-3-1-Phoenixæä¾›äº†Explainå‘½ä»¤ï¼Œè§£é‡Šæ‰§è¡Œè®¡åˆ’ï¼Œä¸‹é¢å…ˆçœ‹macçº¦æŸçš„å¯¹æ¯”å§ï¼Œå’£å½“å’£å½“çœŸæ˜¯å¤Ÿé•¿çš„-ï¿£Ë‡ï¿£" class="headerlink" title="4.3.1 Phoenixæä¾›äº†Explainå‘½ä»¤ï¼Œè§£é‡Šæ‰§è¡Œè®¡åˆ’ï¼Œä¸‹é¢å…ˆçœ‹macçº¦æŸçš„å¯¹æ¯”å§ï¼Œå’£å½“å’£å½“çœŸæ˜¯å¤Ÿé•¿çš„(ï¿£Ë‡ï¿£)"></a>4.3.1 Phoenixæä¾›äº†Explainå‘½ä»¤ï¼Œè§£é‡Šæ‰§è¡Œè®¡åˆ’ï¼Œä¸‹é¢å…ˆçœ‹macçº¦æŸçš„å¯¹æ¯”å§ï¼Œå’£å½“å’£å½“çœŸæ˜¯å¤Ÿé•¿çš„(ï¿£Ë‡ï¿£)</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">0: jdbc:phoenix:localhost&gt; explain select cell from bigjoy.imos where mac = <span class="emphasis">'28E14CA61635'</span>;</span><br><span class="line"><span class="code">+-----------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">|                                                   PLAN                                                    |</span><br><span class="line"><span class="code">+-----------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">| CLIENT 1-CHUNK 0 ROWS 0 BYTES PARALLEL 1-WAY ROUND ROBIN RANGE SCAN OVER BIGJOY.MAC<span class="emphasis">_IDX ['28E14CA61635']  |</span></span><br><span class="line"><span class="emphasis">+-----------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="emphasis">1 row selected (0.584 seconds)</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">0: jdbc:phoenix:localhost&gt; explain select time from bigjoy.imos where mac = '28E14CA61635';</span></span><br><span class="line"><span class="emphasis">+-----------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="emphasis">|                                                   PLAN                                                    |</span></span><br><span class="line"><span class="emphasis">+-----------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="emphasis">| CLIENT 1-CHUNK 0 ROWS 0 BYTES PARALLEL 1-WAY ROUND ROBIN RANGE SCAN OVER BIGJOY.MAC_</span>IDX [<span class="emphasis">'28E14CA61635'</span>]  |</span><br><span class="line">|     SERVER FILTER BY FIRST KEY ONLY                                                                       |</span><br><span class="line"><span class="code">+-----------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">2 rows selected (0.038 seconds)</span><br><span class="line"></span><br><span class="line">0: jdbc:phoenix:localhost&gt; explain select * from bigjoy.imos where mac = <span class="emphasis">'28E14CA61635'</span>;</span><br><span class="line"><span class="code">+------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">|                                                 PLAN                                                 |</span><br><span class="line"><span class="code">+------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">| CLIENT 6-CHUNK 22526956 ROWS 1258291413 BYTES PARALLEL 1-WAY ROUND ROBIN FULL SCAN OVER BIGJOY.IMOS  |</span><br><span class="line">|     SERVER FILTER BY MAC = <span class="emphasis">'28E14CA61635'</span>                                                            |</span><br><span class="line"><span class="code">+------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">2 rows selected (0.038 seconds)</span><br><span class="line"></span><br><span class="line">0: jdbc:phoenix:localhost&gt; explain select * from bigjoy.imos where mac = <span class="emphasis">'28E14CA61635'</span>;</span><br><span class="line"><span class="code">+------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">|                                                 PLAN                                                 |</span><br><span class="line"><span class="code">+------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">| CLIENT 6-CHUNK 22526956 ROWS 1258291413 BYTES PARALLEL 1-WAY ROUND ROBIN FULL SCAN OVER BIGJOY.IMOS  |</span><br><span class="line">|     SERVER FILTER BY MAC = <span class="emphasis">'28E14CA61635'</span>                                                            |</span><br><span class="line"><span class="code">+------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">2 rows selected (0.036 seconds)</span><br></pre></td></tr></table></figure>
<p>çœ‹åˆ°è¿™é‡Œå°±æ˜ç™½äº†å§ï¼Œå½“æŸ¥è¯¢cellå­—æ®µçš„æ—¶å€™ï¼Œæ˜¯ç›´æ¥å»ç´¢å¼•è¡¨äº†æå–å‡ºäº†cellçš„å€¼ï¼›ä½†å½“åŒ…å«äº†åˆ›å»ºç´¢å¼•è¡¨æ—¶æ²¡æœ‰æä¾›çš„å­—æ®µçš„æ—¶å€™ï¼ŒPhoenixå°±æ˜¯å›åˆ°åŸæ•°æ®è¡¨è¿›è¡Œå…¨è¡¨æ‰«æäº†ï¼Œä¸è¿‡æ˜¯æœ€ç»ˆåœ¨æœåŠ¡å™¨ç«¯è¿›è¡Œäº†Filterè¿‡æ»¤è€Œå·²ï¼Œå…³äºä¸ºä»€ä¹ˆä½¿ç”¨äº†Filterè¿˜æ˜¯è¿›è¡Œçš„å…¨è¡¨æ‰«æå“¦ï¼Œå¯ä»¥å‚è§<a href="http://dequn.github.io/2016/08/24/right-way-to-use-hbase-rowfilter_and_accelerate_hbase_query/">HBase RowFilter çš„ä½¿ç”¨è¯¯åŒºåŠå¦‚ä½•åŠ å¿« HBase æŸ¥è¯¢é€Ÿåº¦</a>ï¼</p>
<h3 id="4-3-2-é‚£ä¹ˆæ¥ä¸‹æ¥çœ‹ä¸€ä¸‹timeçº¦æŸçš„ç´¢å¼•æŸ¥è¯¢è®¡åˆ’ï¼"><a href="#4-3-2-é‚£ä¹ˆæ¥ä¸‹æ¥çœ‹ä¸€ä¸‹timeçº¦æŸçš„ç´¢å¼•æŸ¥è¯¢è®¡åˆ’ï¼" class="headerlink" title="4.3.2 é‚£ä¹ˆæ¥ä¸‹æ¥çœ‹ä¸€ä¸‹timeçº¦æŸçš„ç´¢å¼•æŸ¥è¯¢è®¡åˆ’ï¼"></a>4.3.2 é‚£ä¹ˆæ¥ä¸‹æ¥çœ‹ä¸€ä¸‹timeçº¦æŸçš„ç´¢å¼•æŸ¥è¯¢è®¡åˆ’ï¼</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">0: jdbc:phoenix:localhost&gt; explain select cell from bigjoy.imos where time = to<span class="emphasis">_date('2014-04-01 20:39:42.000');</span></span><br><span class="line"><span class="emphasis">+-----------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="emphasis">|                                          PLAN                                           |</span></span><br><span class="line"><span class="emphasis">+-----------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="emphasis">| CLIENT 4-CHUNK 0 ROWS 0 BYTES PARALLEL 1-WAY ROUND ROBIN FULL SCAN OVER BIGJOY.MAC_</span>IDX  |</span><br><span class="line">|     SERVER FILTER BY TO<span class="emphasis">_TIMESTAMP("TIME") = TIMESTAMP '2014-04-01 20:39:42.000'         |</span></span><br><span class="line"><span class="emphasis">+-----------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="emphasis">2 rows selected (0.062 seconds)</span></span><br><span class="line"><span class="emphasis"></span></span><br><span class="line"><span class="emphasis">0: jdbc:phoenix:localhost&gt; explain select * from bigjoy.imos where time = to_</span>date(<span class="emphasis">'2014-04-01 20:39:42.000'</span>);</span><br><span class="line"><span class="code">+------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">|                                                 PLAN                                                 |</span><br><span class="line"><span class="code">+------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">| CLIENT 6-CHUNK 22526956 ROWS 1258291413 BYTES PARALLEL 1-WAY ROUND ROBIN FULL SCAN OVER BIGJOY.IMOS  |</span><br><span class="line">|     SERVER FILTER BY TIME = TIMESTAMP <span class="emphasis">'2014-04-01 20:39:42.000'</span>                                      |</span><br><span class="line"><span class="code">+------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">2 rows selected (0.039 seconds)</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹å‡ºï¼Œä»…æœ‰timeçº¦æŸçš„æ—¶å€™ï¼Œä¸ç®¡è¿›è¡Œçš„æ˜¯cellæŸ¥è¯¢è¿˜æ˜¯åŒ…å«å…¶ä»–å­—æ®µçš„æŸ¥è¯¢ï¼Œéƒ½æ˜¯è¿›è¡Œå…¨è¡¨æ‰«æï¼Œä¸è¿‡ä¸€ä¸ªæ˜¯æ‰«æç´¢å¼•è¡¨ï¼Œä¸€ä¸ªæ˜¯åŸæ•°æ®è¡¨ç½¢äº†ï¼æ‰€ä»¥æ•ˆç‡æ²¡æœ‰æå‡</p>
<h3 id="4-3-3-æœ€åï¼ŒåŒæ—¶è¿›è¡Œmacå’Œtimeçº¦æŸæŸ¥è¯¢ï¼Œä»æ—¶é—´å¯¹æ¯”ä¸Šå°±å¯ä»¥çŒœæƒ³æ˜¯è¿›è¡Œäº†ç´¢å¼•è¡¨çš„æŸ¥è¯¢ï¼Œå½“ç„¶ï¼ŒæŸ¥è¯¢ç›®æ ‡ä¸èƒ½åŒ…å«åˆ›å»ºç´¢å¼•è¡¨æ—¶æœªåŒ…å«çš„å­—æ®µ-äº‹å®ä¹Ÿæ˜¯å¦‚æ­¤ã€‚"><a href="#4-3-3-æœ€åï¼ŒåŒæ—¶è¿›è¡Œmacå’Œtimeçº¦æŸæŸ¥è¯¢ï¼Œä»æ—¶é—´å¯¹æ¯”ä¸Šå°±å¯ä»¥çŒœæƒ³æ˜¯è¿›è¡Œäº†ç´¢å¼•è¡¨çš„æŸ¥è¯¢ï¼Œå½“ç„¶ï¼ŒæŸ¥è¯¢ç›®æ ‡ä¸èƒ½åŒ…å«åˆ›å»ºç´¢å¼•è¡¨æ—¶æœªåŒ…å«çš„å­—æ®µ-äº‹å®ä¹Ÿæ˜¯å¦‚æ­¤ã€‚" class="headerlink" title="4.3.3 æœ€åï¼ŒåŒæ—¶è¿›è¡Œmacå’Œtimeçº¦æŸæŸ¥è¯¢ï¼Œä»æ—¶é—´å¯¹æ¯”ä¸Šå°±å¯ä»¥çŒœæƒ³æ˜¯è¿›è¡Œäº†ç´¢å¼•è¡¨çš„æŸ¥è¯¢ï¼Œå½“ç„¶ï¼ŒæŸ¥è¯¢ç›®æ ‡ä¸èƒ½åŒ…å«åˆ›å»ºç´¢å¼•è¡¨æ—¶æœªåŒ…å«çš„å­—æ®µ,äº‹å®ä¹Ÿæ˜¯å¦‚æ­¤ã€‚"></a>4.3.3 æœ€åï¼ŒåŒæ—¶è¿›è¡Œmacå’Œtimeçº¦æŸæŸ¥è¯¢ï¼Œä»æ—¶é—´å¯¹æ¯”ä¸Šå°±å¯ä»¥çŒœæƒ³æ˜¯è¿›è¡Œäº†ç´¢å¼•è¡¨çš„æŸ¥è¯¢ï¼Œå½“ç„¶ï¼ŒæŸ¥è¯¢ç›®æ ‡ä¸èƒ½åŒ…å«åˆ›å»ºç´¢å¼•è¡¨æ—¶æœªåŒ…å«çš„å­—æ®µ,äº‹å®ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">0: jdbc:phoenix:localhost&gt; explain select cell from bigjoy.imos where mac = <span class="emphasis">'28E14CA61635'</span> and time = to<span class="emphasis">_date('2014-04-01 20:39:42.000');</span></span><br><span class="line"><span class="emphasis">+-----------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="emphasis">|                                                            PLAN                                                             |</span></span><br><span class="line"><span class="emphasis">+-----------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="emphasis">| CLIENT 1-CHUNK 0 ROWS 0 BYTES PARALLEL 1-WAY ROUND ROBIN RANGE SCAN OVER BIGJOY.MAC_</span>IDX [<span class="emphasis">'28E14CA61635'</span>,1,396,384,782,000]  |</span><br><span class="line"><span class="code">+-----------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">1 row selected (0.049 seconds)</span><br><span class="line"></span><br><span class="line">0: jdbc:phoenix:localhost&gt; explain select * from bigjoy.imos where mac = <span class="emphasis">'28E14CA61635'</span> and time = to<span class="emphasis">_date('2014-04-01 20:39:42.000');</span></span><br><span class="line"><span class="emphasis">+------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="emphasis">|                                                 PLAN                                                 |</span></span><br><span class="line"><span class="emphasis">+------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="emphasis">| CLIENT 6-CHUNK 22526956 ROWS 1258291413 BYTES PARALLEL 1-WAY ROUND ROBIN FULL SCAN OVER BIGJOY.IMOS  |</span></span><br><span class="line"><span class="emphasis">|     SERVER FILTER BY (MAC = '28E14CA61635' AND TIME = TIMESTAMP '2014-04-01 20:39:42.000')           |</span></span><br><span class="line"><span class="emphasis">+------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="emphasis">2 rows selected (0.034 seconds)</span></span><br></pre></td></tr></table></figure>
<h3 id="4-3-4-è¿˜æœ‰ï¼Œçœ‹ä¸€ä¸‹å®˜æ–¹ç»™å‡ºçš„Index-Hintæ–¹æ³•ï¼Œå¯ä»¥çœ‹å‡ºï¼Œ-IDå‚ä¸ç´¢å¼•è¡¨çš„æ„æˆï¼Œä¹Ÿæ˜¯ä¸ºäº†å®ç°è¿™ä¸€ä¸ªç›®çš„ï¼Œå…ˆæŸ¥ç´¢å¼•è¡¨ï¼Œåœ¨æ ¹æ®IDæŸ¥åŸè¡¨ï¼"><a href="#4-3-4-è¿˜æœ‰ï¼Œçœ‹ä¸€ä¸‹å®˜æ–¹ç»™å‡ºçš„Index-Hintæ–¹æ³•ï¼Œå¯ä»¥çœ‹å‡ºï¼Œ-IDå‚ä¸ç´¢å¼•è¡¨çš„æ„æˆï¼Œä¹Ÿæ˜¯ä¸ºäº†å®ç°è¿™ä¸€ä¸ªç›®çš„ï¼Œå…ˆæŸ¥ç´¢å¼•è¡¨ï¼Œåœ¨æ ¹æ®IDæŸ¥åŸè¡¨ï¼" class="headerlink" title="4.3.4 è¿˜æœ‰ï¼Œçœ‹ä¸€ä¸‹å®˜æ–¹ç»™å‡ºçš„Index Hintæ–¹æ³•ï¼Œå¯ä»¥çœ‹å‡ºï¼Œ:IDå‚ä¸ç´¢å¼•è¡¨çš„æ„æˆï¼Œä¹Ÿæ˜¯ä¸ºäº†å®ç°è¿™ä¸€ä¸ªç›®çš„ï¼Œå…ˆæŸ¥ç´¢å¼•è¡¨ï¼Œåœ¨æ ¹æ®IDæŸ¥åŸè¡¨ï¼"></a>4.3.4 è¿˜æœ‰ï¼Œçœ‹ä¸€ä¸‹å®˜æ–¹ç»™å‡ºçš„<a href="https://phoenix.apache.org/secondary_indexing.html" target="_blank" rel="noopener">Index Hint</a>æ–¹æ³•ï¼Œå¯ä»¥çœ‹å‡ºï¼Œ:IDå‚ä¸ç´¢å¼•è¡¨çš„æ„æˆï¼Œä¹Ÿæ˜¯ä¸ºäº†å®ç°è¿™ä¸€ä¸ªç›®çš„ï¼Œå…ˆæŸ¥ç´¢å¼•è¡¨ï¼Œåœ¨æ ¹æ®IDæŸ¥åŸè¡¨ï¼</h3><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">0: jdbc:phoenix:localhost&gt; explain select /<span class="strong">*+ INDEX(bigjoy.imos mac_idx) *</span>/ * from bigjoy.imos where mac = <span class="emphasis">'28E14CA61635'</span>;</span><br><span class="line"><span class="code">+-------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">|                                                       PLAN                                                        |</span><br><span class="line"><span class="code">+-------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">| CLIENT 6-CHUNK 22526956 ROWS 1258291413 BYTES PARALLEL 1-WAY ROUND ROBIN FULL SCAN OVER BIGJOY.IMOS               |</span><br><span class="line">|     SKIP-SCAN-JOIN TABLE 0                                                                                        |</span><br><span class="line">|         CLIENT 1-CHUNK 0 ROWS 0 BYTES PARALLEL 1-WAY ROUND ROBIN RANGE SCAN OVER BIGJOY.MAC<span class="emphasis">_IDX ['28E14CA61635']  |</span></span><br><span class="line"><span class="emphasis">|             SERVER FILTER BY FIRST KEY ONLY                                                                       |</span></span><br><span class="line"><span class="emphasis">|     DYNAMIC SERVER FILTER BY "BIGJOY.IMOS.ID" IN ($25.$27)                                                        |</span></span><br><span class="line"><span class="emphasis">+-------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="emphasis">5 rows selected (0.041 seconds)</span></span><br></pre></td></tr></table></figure>
<h2 id="4-4-ä»€ä¹ˆæ—¶å€™ç´¢å¼•å‘æŒ¥ä½œç”¨ï¼Œä»€ä¹ˆæ—¶å€™ç´¢å¼•ä¸å‘æŒ¥ä½œç”¨ï¼ˆéƒ½æ˜¯æŒ‡å…¨å±€ç´¢å¼•ï¼‰ï¼Ÿ"><a href="#4-4-ä»€ä¹ˆæ—¶å€™ç´¢å¼•å‘æŒ¥ä½œç”¨ï¼Œä»€ä¹ˆæ—¶å€™ç´¢å¼•ä¸å‘æŒ¥ä½œç”¨ï¼ˆéƒ½æ˜¯æŒ‡å…¨å±€ç´¢å¼•ï¼‰ï¼Ÿ" class="headerlink" title="4.4 ä»€ä¹ˆæ—¶å€™ç´¢å¼•å‘æŒ¥ä½œç”¨ï¼Œä»€ä¹ˆæ—¶å€™ç´¢å¼•ä¸å‘æŒ¥ä½œç”¨ï¼ˆéƒ½æ˜¯æŒ‡å…¨å±€ç´¢å¼•ï¼‰ï¼Ÿ"></a>4.4 ä»€ä¹ˆæ—¶å€™ç´¢å¼•å‘æŒ¥ä½œç”¨ï¼Œä»€ä¹ˆæ—¶å€™ç´¢å¼•ä¸å‘æŒ¥ä½œç”¨ï¼ˆéƒ½æ˜¯æŒ‡å…¨å±€ç´¢å¼•ï¼‰ï¼Ÿ</h2><p>é€šè¿‡ä»¥ä¸Šå‡ ä¸ªä¾‹å­å¯¹æ¯”å’ŒæŸ¥è¯¢è®¡åˆ’åˆ†æï¼Œå¹¶ä¸”ç»“åˆç´¢å¼•è¡¨çš„ä¸»é”®æ„æˆ(è°è®©HBaseæœ‰ä¸”åªæœ‰ä¸»é”®çš„å­—å…¸åºç´¢å¼•å‘¢)ï¼ŒæŸ¥è¯¢å­—æ®µåªåŒ…æ‹¬åˆ›å»ºç´¢å¼•æ—¶çš„å­—æ®µå¹¶ä¸”çº¦æŸæ¡ä»¶ä¸­åŒ…æ‹¬<strong>æ„æˆç´¢å¼•è¡¨ä¸»é”®çš„ç¬¬ä¸€ä¸ªå­—æ®µ</strong>æ—¶ï¼Œç´¢å¼•è¡¨æ—¶å‘æŒ¥ä½œç”¨çš„ï¼Œå…¶ä»–æƒ…å†µä¸‹å…¨å±€ç´¢å¼•ä¸èƒ½åŠ å¿«æŸ¥è¯¢é€Ÿåº¦ï¼Œè¿™ä¹Ÿå’Œå®˜æ–¹æ–‡æ¡£ç»™å‡ºçš„è§£é‡Šæ˜¯ä¸€æ ·æ ·çš„ï¼</p>
<p>æ–‡ä¸­ä½¿ç”¨çš„ä¾‹å­åªåŒ…æ‹¬ä¸¤ä¸ªå­—æ®µçº¦æŸï¼Œå¦‚æœæœ‰ä¸‰ä¸ªå­—æ®µå‘¢,ç»“æœåˆå¦‚ä½•ï¼Ÿå¦‚ï¼š(field1, field2, field3)ï¼Œå¯ä»¥çŒœæƒ³ä½¿ç”¨field1, field1 + field2, field1 + field3, field1 + field2 + field3è¿›è¡Œçº¦æŸæŸ¥è¯¢ï¼Œè¯¥ç´¢å¼•è¡¨æ‰ä¼šå‘æŒ¥ä½œç”¨ï¼æ„Ÿå…´è¶£çš„å¯ä»¥å»å°è¯•ä¸€ä¸‹ï¼</p>
<p>ä¸ºä»€ä¹ˆæ˜¯è¿™æ ·ï¼Ÿè¿˜æ˜¯å› ä¸ºHBaseåªæœ‰å­—å…¸åºçš„ä¸»é”®ç´¢å¼•å•Šï¼Œå¦‚æœä¸ä½¿ç”¨field1è¿›è¡Œçº¦æŸï¼Œé‚£ä¹ˆå°†ä¸èƒ½ç¡®å®šç´¢å¼•è¡¨ä¸­è¡Œå¥çš„æ‰«æèŒƒå›´ï¼Œæ‰€ä»¥ä»ç„¶è¦è¿›è¡Œå…¨å±€æ‰«æï¼ˆç´¢å¼•è¡¨æˆ–è€…åŸæ•°æ®è¡¨ï¼‰ï¼ŒåŒç†ï¼Œå¦‚æœæŸ¥è¯¢ç»“æœä¸€ä¸‹ï¼Œä½¿ç”¨field1 + field2 çº¦æŸç†è®ºä¸Šæ˜¯è¦ä¼˜äº field1 + field3çš„ï¼Œä¸è¿‡æ—¢ç„¶æŸ¥è¯¢ç»“æœéƒ½ä¸€æ ·äº†ï¼Œé‚£ä¹ˆfield2 å’Œ field3åº”è¯¥æ˜¯æ²¡æœ‰çº¦æŸä½œç”¨çš„ï¼Œé™¤éfield3 == field3ã€‚æ„Ÿå…´è¶£çš„ä¹Ÿå¯ä»¥å°è¯•ä¸€ä¸‹ï¼</p>
<h1 id="5æ€»ç»“"><a href="#5æ€»ç»“" class="headerlink" title="5æ€»ç»“"></a>5æ€»ç»“</h1><ul>
<li>Global Index æ˜¯å¯†é›†ç´¢å¼•ï¼›</li>
<li>è¦æƒ³ç´¢å¼•å‘æŒ¥ä½œç”¨ï¼Œå¿…é¡»åŒ…å«åˆ›å»ºç´¢å¼•æ˜¯çš„ç¬¬ä¸€ä¸ªå­—æ®µè¿›è¡Œçº¦æŸï¼›</li>
<li>ç´¢å¼•å­—æ®µä»å‰åˆ°åï¼Œçº¦æŸè¶Šå¤šï¼ŒæŸ¥è¯¢æ•ˆç‡è¶Šé«˜ï¼ˆä¸­é—´ä¸èƒ½è·³è¿‡ç´¢å¼•å­—æ®µï¼‰ï¼Œè¿™æ ·å¯ä»¥å¿«é€Ÿç¼©å°æ‰«æèŒƒå›´ï¼›</li>
<li>æŸ¥è¯¢ä¸€å®šä¸èƒ½æœ‰ç´¢å¼•å­—æ®µä¹‹å¤–çš„å…¶ä»–å­—æ®µï¼Œä¸ç„¶å¾—å»æ‰«æåŸè¡¨ï¼›</li>
<li>ä¸æ»¡è¶³ä¸Šä¸€æ¡ç»“è®ºçš„è¦æ±‚æ—¶ï¼Œå®˜æ–¹æ–‡æ¡£æä¾›çš„<a href="https://phoenix.apache.org/secondary_indexing.html" target="_blank" rel="noopener">Index Hint</a>æ–¹æ³•ï¼Œæ˜¯æ ¹æ®ç´¢å¼•è¡¨å¾—åˆ°åŸè¡¨ä¸»é”®ï¼Œå†å»åŸè¡¨ä¸­æ ¹æ®ä¸»é”®æŸ¥è¯¢å…¶ä»–å­—æ®µï¼</li>
</ul>
<p>Local Index å°±ç•™ç€ä¸‹ä¸€æ¬¡å†™å§ï¼</p>
]]></content>
      
        <categories>
            
            <category> Phoenix </category>
            
        </categories>
        
        
        <tags>
            
            <tag> HBase </tag>
            
            <tag> Secondary Index </tag>
            
            <tag> Phoenix </tag>
            
            <tag> Global Index </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[HBase äºŒçº§ç´¢å¼•å®ç°åŸç†]]></title>
      <url>http://dequn.github.io/2016/08/29/HBase-Secondary-Index-Theory/</url>
      <content type="html"><![CDATA[<p>é¡¹ç›®ä¸­è¦ç”¨åˆ°HBaseçš„äºŒçº§ç´¢å¼•ï¼Œæ‰€è°“çš„äºŒçº§ç´¢å¼•ï¼Œå°±æ˜¯å¯¹é™¤äº†RowKeyä¹‹å¤–çš„å…¶ä»–åˆ—è¿›è¡Œç´¢å¼•ï¼Œå› ä¸ºHBaseæœ¬èº«åªæ”¯æŒRowkeyçš„ç´¢å¼•ï¼Œå¦‚æœè¦ä»¥å…¶ä»–åˆ—çš„æ•°æ®ä¸ºçº¦æŸè¿›è¡ŒæŸ¥è¯¢ï¼Œå°±éœ€è¦æˆ‘ä»¬åšä¸€ç‚¹ç‚¹å°å·¥ä½œäº†ï¼Œå³å»ºç«‹äºŒçº§ç´¢å¼•ã€‚</p>
<p>åœ¨HBaseä¸­å»ºç«‹äºŒçº§ç´¢å¼•çš„æ€æƒ³å°±æ˜¯ï¼š<strong> æ–°å»ºä¸€ä¸ªæ•°æ®è¡¨å³ç´¢å¼•è¡¨ï¼Œä»¥éœ€è¦å»ºç«‹ç´¢å¼•çš„åˆ—ä¸ºä¸»é”®ï¼ŒæŠŠå…¶ä»–éœ€è¦æŸ¥è¯¢çš„æ•°æ®å­˜å‚¨åœ¨è¯¥è¡¨ä¸­ï¼Œæˆ–è€…å­˜å‚¨å¯¹åº”çš„åŸæ•°æ®è¡¨ä¸»é”®ï¼Œæœ€åéœ€è¦ä½¿ç”¨æ­¤ç´¢å¼•çš„æ—¶å€™ï¼Œå°±æ¥åˆ°è¿™ä¸ªè¡¨é‡Œè¾¹è¿›è¡ŒæŸ¥è¯¢åŸæ•°æ®æˆ–è€…ä¸»é”®ï¼Œå¦‚æœæ˜¯ä¸»é”®çš„è¯å†å›åˆ°åŸè¡¨ä¸­æ ¹æ®ä¸»é”®æŸ¥è¯¢ï¼Œæœ€ç»ˆå¾—åˆ°ç»“æœ </strong>ã€‚è¯¥ç´¢å¼•è¡¨ä¹Ÿå¯ä»¥æ˜¯å¯†é›†çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯ç¨€ç–çš„ï¼Œç´¢å¼•è¡¨ä¸­å­˜å‚¨åŸå§‹æ•°æ®è¿˜æ˜¯åŸä¸»é”®å°±çœ‹ä¸ªäººéœ€æ±‚ï¼Œå¹³è¡¡ç©ºé—´å’Œæ—¶é—´ä¸Šçš„è€ƒé‡ã€‚</p>
<p>åä¸ºæ›¾ç»åœ¨2013å¹´å¼€æºäº†ä¸€ä¸ªé¡¹ç›®<a href="https://github.com/Huawei-Hadoop/hindex" target="_blank" rel="noopener">Huawei-hadoop/index</a>,ä¸è¿‡æœ€è¿‘ä¸¤å¹´éƒ½æ²¡æœ‰æ›´æ–°è¿‡äº†ï¼Œåº”è¯¥æ˜¯è¢«åœæ‰äº†ï¼Œå› ä¸ºç°åœ¨æœ‰å¾ˆå¤šä¾‹å¦‚Phoenix , Pig, Hiveç­‰å¯ä»¥åˆ©ç”¨ï¼Œæ²¡å¿…è¦è‡ªå·±èŠ±ç²¾åŠ›å»ç»´æŠ¤ï¼Œä½†æ˜¯å½“æ—¶æå‡ºè¯¥ç´¢å¼•çš„æ—¶å€™å¯æ˜¯å¼•èµ·äº†ä¸å°çš„è½°åŠ¨ï¼ŒåŒæ—¶æœ‰ä¸¤ç¯‡PPTï¼Œå¯ä»¥å¸®åŠ©ç†è§£äºŒçº§ç´¢å¼•çš„å·¥ä½œåŸç†ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥ä¸‹è½½ç ”ç©¶ï¼Œæ€»å¥½çš„è¿‡çœ‹æˆ‘å†™çš„è¿™äº›å­—ï¼</p>
<ul>
<li><a href="http://obqjd695a.bkt.clouddn.com/HBase_Secondary_Index.pdf" target="_blank" rel="noopener">HBase â€“ Secondary Index.pdf</a></li>
<li><a href="http://obqjd695a.bkt.clouddn.com/HuaWei_Secondary_Index_of_HBase.pdf" target="_blank" rel="noopener">HuaWei_Secondary_Index_of_HBase.pdf</a></li>
</ul>
<p>ä¸‹ä¸€ç¯‡å†™Phoenix çš„äºŒçº§ç´¢å¼•ï¼</p>
]]></content>
      
        <categories>
            
            <category> HBase </category>
            
        </categories>
        
        
        <tags>
            
            <tag> HBase </tag>
            
            <tag> Secondary Index </tag>
            
            <tag> hindex </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[HBase RowFilter çš„ä½¿ç”¨è¯¯åŒºåŠå¦‚ä½•åŠ å¿« HBase æŸ¥è¯¢é€Ÿåº¦]]></title>
      <url>http://dequn.github.io/2016/08/24/right-way-to-use-hbase-rowfilter_and_accelerate_hbase_query/</url>
      <content type="html"><![CDATA[<p>åœ¨åšå®éªŒçš„æ—¶å€™ï¼Œå¯¹æ¯”ä¸€ä¸‹ HBase ä¸ PostgreSQLçš„æŸ¥è¯¢é€Ÿåº¦ï¼Œå‘ç° PostgreSQL åªéœ€è¦300æ¯«ç§’å·¦åçš„æŸ¥è¯¢æ”¾åœ¨ HBase ä¸­ç«Ÿç„¶éœ€è¦5ç§’å·¦å³ï¼Œè¿™æ•ˆç‡ä¹Ÿå·®å¤ªå¤šäº†å§ï¼ä¹Ÿæ’é™¤äº†æ˜¯æ•°æ®åº“è¿æ¥ç­‰æ“ä½œçš„è€—æ—¶ï¼Œè¿™å°±éœ€è¦æ·±å…¥çš„æ‰¾ä¸€ä¸‹åŸå› äº†ã€‚åŸ HBase ä»£ç å¦‚ä¸‹,è®¾ç½®äº†ä¸¤ä¸ª PrefixFilter ç”¨æ¥è¿‡æ»¤ï¼Œç›®çš„æ˜¯æ‰¾åˆ°æŸä¸€ä¸ª mac ä» beginTime åˆ° endTime çš„æ•°æ®ï¼š</p>
<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">FilterList fl = <span class="keyword">new</span> <span class="type">FilterList</span>(FilterList.Operator.MUST_PASS_ALL);<span class="comment">// must between beginTime and endTime</span></span><br><span class="line">BinaryPrefixComparator comp = <span class="keyword">new</span> <span class="type">BinaryPrefixComparator</span>(Bytes.toBytes(<span class="keyword">String</span>.format(<span class="string">"%s%d"</span>, mac, beginTimeStamp)));</span><br><span class="line">RowFilter filter = <span class="keyword">new</span> <span class="type">RowFilter</span>(CompareFilter.CompareOp.GREATER_OR_EQUAL, comp);</span><br><span class="line">BinaryPrefixComparator comp2 = <span class="keyword">new</span> <span class="type">BinaryPrefixComparator</span>(Bytes.toBytes(<span class="keyword">String</span>.format(<span class="string">"%s%d"</span>, mac, endTimeStamp)));</span><br><span class="line">RowFilter filter2 = <span class="keyword">new</span> <span class="type">RowFilter</span>(CompareFilter.CompareOp.LESS_OR_EQUAL, comp2);</span><br><span class="line">fl.addFilter(filter);</span><br><span class="line">fl.addFilter(filter2);</span><br><span class="line">Scan scan = <span class="keyword">new</span> <span class="type">Scan</span>();</span><br><span class="line">scan.setFilter(fl);</span><br><span class="line"><span class="comment">//....other colde here</span></span><br></pre></td></tr></table></figure>
<p>owkey ä¸æ˜¯å­—å…¸æœ‰åºæœ‰ç´¢å¼•çš„å—ï¼ŒæŸ¥æ‰¾ä¸¤ä¸ªå‰ç¼€é™åˆ¶å¤¹å‡ºæ¥çš„è¡Œåº”è¯¥å¾ˆå¿«çš„å•Šï¼Œä¸ç„¶ Rowkey ç´¢å¼•æ˜¯åšä»€ä¹ˆç”¨çš„ï¼Ÿä¸€æ­¥ä¸€æ­¥æ‰¾åŸå› ï¼Œéœ€è¦ææ¸…æ¥š Filter åˆ°åº•æ˜¯åšä»€ä¹ˆç”¨çš„ï¼ç»è¿‡ä¸€ç•ªæœç´¢ï¼Œåœ¨ <a href="http://stackoverflow.com/questions/10942638/should-i-user-prefixfilter-or-rowkey-range-scan-in-hbase" title="Should I user prefixfilter or rowkey range scan in hbase" target="_blank" rel="noopener">StackOverFlow</a> [1] ä¸Šæ‰¾åˆ°ä¸€ä¸ªå›ç­”ï¼Œæ„æ€æ˜¯ Filter æ˜¯éå¸¸æ…¢çš„ï¼Œè¦è¿›è¡Œå…¨è¡¨æ‰«æçš„ï¼Œå¦‚æœæƒ³è¦å¿«é€Ÿçš„æŸ¥è¯¢æ•°æ®ï¼Œå¾—è®¾ç½® STARTROW å’Œ ENDROWï¼ŒåŸæ–‡:</p>
<blockquote>
<p>HBase filters - even row filters - are really slow, since in most cases these do a complete table scan, and then filter on those results. Have a look at this discussion: <a href="http://grokbase.com/p/hbase/user/115cg0d7jh/very-slow-scan-performance-using-filters" target="_blank" rel="noopener">http://grokbase.com/p/hbase/user/115cg0d7jh/very-slow-scan-performance-using-filters</a></p>
</blockquote>
<blockquote>
<p>Row key range scans however, are indeed much faster - they do the equivalent of a filtered table scan. This is because the row keys are stored in sorted order (this is one of the basic guarantees of HBase, which is a BigTable-like solution), so the range scans on row keys are very fast. More explanation here: <a href="http://www.quora.com/How-feasible-is-real-time-querying-on-HBase-Can-it-be-achieved-through-a-programming-language-such-as-Python-PHP-or-JSP" target="_blank" rel="noopener">http://www.quora.com/How-feasible-is-real-time-querying-on-HBase-Can-it-be-achieved-through-a-programming-language-such-as-Python-PHP-or-JSP</a></p>
</blockquote>
<blockquote>
<p>UPDATE: turns out that PrefixFilter does do a full table scan until it passes the prefix used in the filter (if it finds it). The recommendation for fast performance using a PrefixFilter seems to be to specify a start_row parameter in addition to the PrefixFilter. See related 2013 discussion on the hbase-user mailing list.</p>
</blockquote>
<p>å¦å¤–æ‰¾åˆ°ä¸€ä¸ªæ¯”è¾ƒæ˜ç¡®çš„<a href="https://www.ibm.com/support/knowledgecenter/SSPT3X_2.1.2/com.ibm.swg.im.infosphere.biginsights.analyze.doc/doc/r0057923.html" title="IBM Knowledge Center - HBase Module" target="_blank" rel="noopener">è§£é‡Šå¦‚ä¸‹</a> [2]ï¼š</p>
<blockquote>
<p>Filters push row selection criteria out to the HBase region servers for processing so that rows can be filtered remotely and in parallel (when more than one region server is involved). Using these functions helps you to avoid sending rows to the client that are not needed.</p>
</blockquote>
<p>å¥½å§ï¼ŒåŸæ¥æ˜¯è·Ÿæˆ‘ç†è§£çš„æœ‰åå·®ï¼Œè¿™é‡Œè¾¹çš„ Filter ä½œç”¨å¹¶ä¸èƒ½ç›´æ¥ç”¨æ¥ç´¢å¼•åˆ°è¦æ£€ç´¢çš„æ•°æ®ï¼Œä»æè¿°ä¸­å¯ä»¥çœ‹å‡ºï¼Œ<strong> åªä½¿ç”¨ Filter çš„è¯ï¼Œè¿˜æ˜¯è¦è¿›è¡Œå…¨è¡¨æ‰«æï¼Œåªæ˜¯ç¬¦åˆ Filter çš„æ•°æ®æ‰ä¼šè¢«å‘é€åˆ° Client </strong>ï¼Œä» <a href="https://hbase.apache.org/apidocs/org/apache/hadoop/hbase/filter/RowFilter.html" title="Class RowFilter" target="_blank" rel="noopener">HBase Java API DOC</a> [3]ä¹Ÿå¯ä»¥çœ‹å‡ºï¼š</p>
<blockquote>
<p>If an already known row range needs to be scanned, use CellScanner start and stop rows directly rather than a filter.</p>
</blockquote>
<p>åŸå› æ‰¾åˆ°äº†ï¼Œå°±æŒ‰ç…§è¯´æ˜æ·»åŠ ä¸€ä¸ªå¼€å§‹è¡Œé”®å’Œç»“æŸè¡Œå¥å§,è¡Œå¥æ ¹æ®è‡ªå·±çš„éœ€è¦è¿›è¡Œè®¾ç½®ï¼</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//....</span></span><br><span class="line">scan.setStartRow(Bytes.toBytes(<span class="keyword">String</span>.<span class="keyword">format</span>(<span class="string">"%s%d0000"</span>, mac, beginTimeStamp)));</span><br><span class="line">scan.setStopRow(Bytes.toBytes(<span class="keyword">String</span>.<span class="keyword">format</span>(<span class="string">"%s%d0300"</span>, mac, endTimeStamp)));</span><br><span class="line"><span class="comment">//...</span></span><br></pre></td></tr></table></figure>
<p>ç»è¿‡æ”¹è¿›ï¼ŒåŒæ ·çš„æŸ¥è¯¢æ—¶é—´å°±é™è‡³æ¯«ç§’çš„æ•°é‡çº§äº†ã€‚å¦å¤–è¿˜æœ‰ä¸€ä¸ª WhileMatchFilter çš„ Warpper ç±»ï¼Œä½œç”¨æ˜¯è‡ªåŠ¨ç»“æŸæ‰«æï¼Œéœ€è¦çš„æœ‹å‹å¯ä»¥ä½¿ç”¨ä¸€ä¸‹ï¼Œå¯ä»¥å‚è§<a href="https://www.safaribooksonline.com/library/view/hbase-the-definitive/9781449314682/ch04.html" title="Very slow Scan performance using Filters" target="_blank" rel="noopener">[4]</a>é‡Œè¾¹çš„ç¤ºä¾‹ï¼Œå°±çŸ¥é“å¦‚ä½•ä½¿ç”¨äº†ã€‚</p>
<p>æ€»ç»“ ï¼šæœ€å¤§çš„è¯¯åŒºæ˜¯é”™è¯¯çš„ç†è§£äº† Filter çš„ä½œç”¨ï¼Œè®¤ä¸ºè¿‡æ»¤åœ¨å‰ï¼Œæ‰«æåœ¨åï¼Œå®é™…è¿‡ç¨‹å´æ˜¯<strong>æ‰«æ -&gt; è¿‡æ»¤</strong>ï¼Œæ‰€ä»¥å¦‚æœè¦åˆ©ç”¨ Rowkey æœ¬èº«çš„ç´¢å¼•ï¼Œé™¤äº† get æŒ‡å®šè¡Œå¥ä¹‹å¤–ï¼Œscan å¿…é¡»æŒ‡å®šå¼€å§‹è¡Œå¥å’Œç»“æŸè¡Œå¥ï¼Œä¸ç„¶è¿›è¡Œçš„å…¨éƒ¨æ˜¯å…¨è¡¨æ‰«æ,æ— è®º RowFilter æ˜¯ RegexFilter è¿˜æ˜¯ PrefixFilter è¿˜æ˜¯å…¶ä»–ï¼</p>
<p>å‚è€ƒï¼š</p>
<ol>
<li><a href="http://stackoverflow.com/questions/10942638/should-i-user-prefixfilter-or-rowkey-range-scan-in-hbase" title="Should I user prefixfilter or rowkey range scan in hbase" target="_blank" rel="noopener">Should I user prefixfilter or rowkey range scan in hbase</a></li>
<li><a href="https://www.ibm.com/support/knowledgecenter/SSPT3X_2.1.2/com.ibm.swg.im.infosphere.biginsights.analyze.doc/doc/r0057923.html" title="IBM Knowledge Center - HBase Module" target="_blank" rel="noopener">IBM Knowledge Center - HBase Module</a></li>
<li><a href="https://hbase.apache.org/apidocs/org/apache/hadoop/hbase/filter/RowFilter.html" title="Class RowFilter" target="_blank" rel="noopener">Class RowFilter</a></li>
<li><a href="https://www.safaribooksonline.com/library/view/hbase-the-definitive/9781449314682/ch04.html" title="Very slow Scan performance using Filters" target="_blank" rel="noopener">Very slow Scan performance using Filters</a></li>
<li><a href="http://grokbase.com/t/hbase/user/118bft6n5v/why-rowfilter-plus-binaryprefixcomparator-solution-is-so-slow" title="[HBase-user] Why RowFilter plus BinaryPrefixComparator solution is so slow" target="_blank" rel="noopener">[HBase-user] Why RowFilter plus BinaryPrefixComparator solution is so slow</a></li>
</ol>
]]></content>
      
        <categories>
            
            <category> HBase </category>
            
        </categories>
        
        
        <tags>
            
            <tag> HBase </tag>
            
            <tag> RowFilter </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[HBase æ‰¾ä¸åˆ°æç¤ºå·²å­˜åœ¨çš„æ•°æ®è¡¨]]></title>
      <url>http://dequn.github.io/2016/07/03/hbase_cannot_find_existing_table/</url>
      <content type="html"><![CDATA[<p> ä»Šå¤©åœ¨ä½¿ç”¨ HBase åˆ›å»ºæ•°æ®è¡¨çš„æ—¶å€™ï¼Œæç¤ºæ•°æ®è¡¨å·²å­˜åœ¨ï¼Œä½†ä½¿ç”¨<code>list</code>å‘½ä»¤åˆçœ‹ä¸åˆ°è¯¥è¡¨ï¼Œä¹Ÿæ— æ³• drop æ‰ã€‚è¿‡ç¨‹å¦‚ä¸‹</p>
 <figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">hbase(main)<span class="symbol">:018</span><span class="symbol">:0</span>&gt;create 'pois','data</span><br><span class="line">Err<span class="symbol">or:</span> Table already exis<span class="symbol">ts:</span> pois!</span><br><span class="line">hbase(main)<span class="symbol">:019</span><span class="symbol">:0</span>&gt;list</span><br><span class="line">TABLE</span><br><span class="line"><span class="number">0</span> <span class="built_in">row</span>(s) in <span class="number">8.0245</span> seconds</span><br><span class="line"></span><br><span class="line">=&gt; []</span><br></pre></td></tr></table></figure>
<p> å¯ä»¥çœ‹å‡ºï¼ŒHBase é”™è¯¯åœ°åˆ¤æ–­äº†ï¼Œç»è¿‡ä¸€ç•ª Googleï¼Œæ‰¾åˆ°äº†å‡ ä¸ªæ¨èçš„è§£å†³æ–¹æ¡ˆï¼š</p>
<p> ## <a href="http://stackoverflow.com/questions/10586246/hbase-cannot-find-an-existing-table" target="_blank" rel="noopener">æ–¹æ¡ˆ1:hbase cannot find an existing table</a></p>
<blockquote>
<p>1) Delete all entries in the .META table for this table manually, and</p>
</blockquote>
<blockquote>
<p>2) Delete the directory corresponding to this table from HDFS</p>
</blockquote>
<h2 id="æ–¹æ¡ˆ2-Killing-the-HBase-zombie-table"><a href="#æ–¹æ¡ˆ2-Killing-the-HBase-zombie-table" class="headerlink" title="æ–¹æ¡ˆ2:Killing the HBase zombie table"></a><a href="http://arnon.me/2013/01/killing-hbase-zombie-table/" target="_blank" rel="noopener">æ–¹æ¡ˆ2:Killing the HBase zombie table</a></h2><blockquote>
<p>1) use ** hbase hbck ** to see health-checkk</p>
<p>2) look at .META table</p>
<p>3) clear zookeeperâ€™s  cache</p>
</blockquote>
<hr>
<h2 id="æ–¹æ¡ˆ3-æœ€ç®€å•"><a href="#æ–¹æ¡ˆ3-æœ€ç®€å•" class="headerlink" title="æ–¹æ¡ˆ3:æœ€ç®€å•"></a>æ–¹æ¡ˆ3:æœ€ç®€å•</h2><p>è¿™ä¸¤ç§æ–¹æ¡ˆå¯¹åˆå­¦è€…æ¥è¯´éƒ½æœ‰ä¸€å®šçš„éš¾åº¦ï¼Œå¹¶ä¸”å®¹æ˜“è¯¯æ“ä½œå„¿å½±å“åˆ°å…¶ä»–çš„æ•°æ®è¡¨ï¼Œæ‰¾ä¸€ä¸ªç®€å•çš„æ–¹æ³•å°±å¾ˆæœ‰å¿…è¦äº†ï¼Œé‚£ä¹ˆæ‰¾ä¸€æ‰¾ HBase è‡ªå¸¦çš„å‘½ä»¤å§ï¼Œç»è¿‡è¯•éªŒï¼Œå‘ç°æœ‰ä¸€ä¸ªå‘½ä»¤`hbase-cleanâ€™ï¼Œå°è¯•è¿è¡Œï¼Œå¦‚ä¸‹ï¼Œ</p>
<figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">hbase</span><span class="literal">-</span><span class="comment">cleanup</span><span class="string">.</span><span class="comment">sh</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">Usage:</span> <span class="comment">hbase</span><span class="literal">-</span><span class="comment">cleanup</span><span class="string">.</span><span class="comment">sh</span> <span class="comment">(</span><span class="literal">-</span><span class="literal">-</span><span class="comment">cleanZk|</span><span class="literal">-</span><span class="literal">-</span><span class="comment">cleanHdfs|</span><span class="literal">-</span><span class="literal">-</span><span class="comment">cleanAll|</span><span class="literal">-</span><span class="literal">-</span><span class="comment">cleanAcls)</span></span><br></pre></td></tr></table></figure>
<p>ä»æç¤ºå¯ä»¥çœ‹å‡ºæœ‰ä¸‰ç§æ¨¡å¼ï¼ŒåŒºåˆ«å¦‚ä¸‹</p>
<figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-<span class="ruby">-cleanZk   cleans hbase related data from zookeeper.</span></span><br><span class="line"><span class="ruby">--cleanHdfs cleans hbase related data from hdfs.</span></span><br><span class="line"><span class="ruby">--cleanAll  cleans hbase related data from both zookeeper <span class="keyword">and</span> hdfs.</span></span><br></pre></td></tr></table></figure>
<p>æƒ³å¿…æ¥ä¸‹æ¥å°±çŸ¥é“å¦‚ä½•å¤„ç†äº†å§ï¼è¿™ç§æ–¹å¼è¦ç®€å•çš„å¤šï¼Œé€‚åˆåˆå­¦ç”¨æˆ·ï¼</p>
<hr>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p>1.<a href="http://www.cloudera.com/documentation/enterprise/latest/topics/cdh_ig_hbase_tools.html#concept_wpc_nqv_hv" target="_blank" rel="noopener">Using HBase Command-Line Utilities</a></p>
<p>2.<a href="http://arnon.me/2013/01/killing-hbase-zombie-table/" target="_blank" rel="noopener">Killing the HBase zombie table</a></p>
<p>3.<a href="http://stackoverflow.com/questions/10586246/hbase-cannot-find-an-existing-table" target="_blank" rel="noopener">hbase cannot find an existing table</a></p>
]]></content>
      
        <categories>
            
            <category> HBase </category>
            
        </categories>
        
        
        <tags>
            
            <tag> HBase </tag>
            
            <tag> Zookeeper </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[HBase åå¤„ç†å™¨ä¹‹ EndPoint ç®€å•ç¤ºä¾‹]]></title>
      <url>http://dequn.github.io/2016/05/14/hbase-coprocessor-endpoint-helloworld/</url>
      <content type="html"><![CDATA[<p>å…³äº HBase åå¤„ç†å™¨ Coprocessor æ˜¯ä»€ä¹ˆï¼Œä½œç”¨æ˜¯ä»€ä¹ˆï¼Œå°±ä¸åœ¨å¤šè¯´ï¼Œå¾ˆå¤šåšã€æ–‡æ¡£éƒ½æœ‰ç›¸å…³è¯´æ˜ï¼ŒCoprocessor åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ç±»æ˜¯ Observer,å¦ä¸€ç±»æ˜¯ Endpoint,åœ¨çœ‹æ¥å¾ˆå¤šåšå®¢åï¼Œå‘ç°éƒ½æ˜¯æ¯”è¾ƒè€çš„ä¸€äº›å†…å®¹ï¼Œåœ¨å­¦ä¹ è¿‡ç¨‹ä¸­æœ‰ä¸å°‘ç–‘æƒ‘ï¼Œæ‰€ä»¥æ€»ç»“ä¸‹æ¥ã€‚æ­¤æ–‡åªæ˜¯é’ˆå¯¹ EndPoint ç»™å‡ºä¸€ä¸ªæµç¨‹ã€‚</p>
<h1 id="åŸºæœ¬ç¯å¢ƒ"><a href="#åŸºæœ¬ç¯å¢ƒ" class="headerlink" title="åŸºæœ¬ç¯å¢ƒ"></a>åŸºæœ¬ç¯å¢ƒ</h1><blockquote>
<p>Hbase: v1.1.2<br>JDK: v1.8<br>Maven: v3.3.9<br>protobuf: v2.6.1</p>
</blockquote>
<p>EndPoint çš„å®šä¹‰åœ¨ Hbase 0.96åé‡‡ç”¨çš„æ˜¯ Google çš„å¼€æºprotobuf RPC, å› æ­¤æœ¬æ–‡çš„è¯´æ˜åªé€‚ç”¨äºé«˜äº 0.96 çš„ HBase ç‰ˆæœ¬ï¼Œè€çš„ç‰ˆæœ¬è¯·çœ‹å¯¹åº”çš„æ•™ç¨‹ã€‚</p>
<h1 id="Mac-ä¸‹-Protobuf-å®‰è£…"><a href="#Mac-ä¸‹-Protobuf-å®‰è£…" class="headerlink" title="Mac ä¸‹ Protobuf å®‰è£…"></a>Mac ä¸‹ Protobuf å®‰è£…</h1><p>é‡‡ç”¨ HomeBrew å³å¯è½»æ¾å®‰è£…ï¼Œå‘½ä»¤</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">home <span class="keyword">brew </span><span class="keyword">install </span>protobuf</span><br></pre></td></tr></table></figure>
<h1 id="å®šä¹‰-RPC"><a href="#å®šä¹‰-RPC" class="headerlink" title="å®šä¹‰ RPC"></a>å®šä¹‰ RPC</h1><p>æ–°å»ºä¸€ä¸ª *.proto æ–‡ä»¶ï¼Œé”®å…¥ä»¥ä¸‹å†…å®¹,æœ¬æ–‡çš„ç›®çš„æ˜¯å®ç°ä¸€ä¸ªå»ºç«‹å…³äº Mac åˆ—çš„ç´¢å¼•ï¼Œç®€å•èµ·è§ï¼Œç›´æ¥è¿”å›å€¼ buildOk = 1 è¡¨ç¤ºå»ºç«‹æˆåŠŸã€‚å…³äº protobuf çš„æ›´å¤šå®šä¹‰å¯ä»¥å‚è§å®˜æ–¹æ–‡æ¡£<a href="https://developers.google.com/protocol-buffers/" target="_blank" rel="noopener">https://developers.google.com/protocol-buffers/</a>.</p>
<figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">option</span> java_package = <span class="string">"lreis.bigdata.indoor.index.coprocessor"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">option</span> java_outer_classname = <span class="string">"BuildMacIndex"</span>;</span><br><span class="line"><span class="keyword">option</span> java_generic_services = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">option</span> optimize_for = SPEED;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">buildMacIndexRequest</span></span>&#123;</span><br><span class="line"><span class="built_in">int64</span> onlyForPresent ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">buildMacIndexResponse</span> </span>&#123;</span><br><span class="line"> <span class="keyword">optional</span> <span class="built_in">int64</span> buildOk = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">service</span> <span class="title">BuildMacIndexService</span> </span>&#123;</span><br><span class="line"> <span class="function"><span class="keyword">rpc</span> buildMacIndex(buildMacIndexRequest)</span></span><br><span class="line"><span class="function">  <span class="keyword">returns</span>(buildMacIndexResponse)</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>å®šä»¥å¥½ä¹‹åå°±å¯ä»¥ç¼–è¯‘è¯¥æ–‡ä»¶äº†ï¼Œ è¿è¡Œæ­¤å‘½ä»¤ä¼šç”Ÿæˆä¸€ä¸ª BuildMacIndex çš„ç±»ã€‚</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protoc <span class="comment">--java_out = your_project_dest your.proto</span></span><br></pre></td></tr></table></figure>
<h1 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h1><p>ç”±äºæœ¬äººä½¿ç”¨ Maven å»ºç«‹çš„å·¥ç¨‹ï¼Œæ‰€ä»¥è¦å®ŒæˆEndPoint çš„å¼€å‘ï¼Œéœ€è¦åŠ å…¥ä»¥ä¸‹ä¸€äº›ä¾èµ–æ‰å¯ä»¥ã€‚** éœ€è¦æ³¨æ„çš„æ˜¯ç¼–è¯‘ç›®æ ‡çš„ç‰ˆæœ¬æ˜¯1.6ï¼Œå¦åˆ™Hbase ä¸èƒ½æ­£ç¡®åŠ è½½ç”Ÿæˆçš„ Endpoint. **</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">hbase.version</span>&gt;</span>1.1.2<span class="tag">&lt;/<span class="name">hbase.version</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hbase<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hbase-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$</span><span class="template-variable">&#123;hbase.version&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hbase<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hbase-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$</span><span class="template-variable">&#123;hbase.version&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="xml"> <span class="tag">&lt;<span class="name">build</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.6<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.6<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span></span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h1 id="EndPoint-å®ç°"><a href="#EndPoint-å®ç°" class="headerlink" title="EndPoint å®ç°"></a>EndPoint å®ç°</h1><p>** EndPoint å¿…é¡»è¦ç»§æ‰¿è‡ª protobuf ä¸­å®šä¹‰çš„ BuildMacIndexService ç±»ï¼Œå¹¶ä¸”å®ç° CoprocessorService å’Œ Coprocessor æ¥å£ï¼Œå®ç°å…¶ä¸­çš„å››ä¸ªæ–¹æ³•å³å¯ã€‚**</p>
<ul>
<li><p>start() æ–¹æ³•<br>åå¤„ç†å™¨åœ¨ Region æ‰“å¼€çš„æ—¶å€™è¢« RegionServer è‡ªåŠ¨åŠ è½½ï¼Œå¹¶ä¼šè°ƒç”¨å™¨ start æ¥å£ï¼Œå®Œæˆåˆå§‹åŒ–å·¥ä½œã€‚ä¸€èˆ¬çš„è¯¥æ¥å£å‡½æ•°ä¸­ä»…ä»…éœ€è¦å°†åå¤„ç†å™¨çš„è¿è¡Œä¸Šä¸‹æ–‡ç¯å¢ƒå˜é‡ CoprocessorEnviormentä¿å­˜åˆ°æœ¬åœ°å³å¯ã€‚</p>
</li>
<li><p>stop()æ–¹æ³•<br>Coprocessor æ¥å£è¿˜å®šä¹‰äº† stop() æ¥å£å‡½æ•°ã€‚è¯¥å‡½æ•°åœ¨ Region è¢«å…³é—­æ—¶è°ƒç”¨ï¼Œç”¨æ¥è¿›è¡Œåå¤„ç†å™¨çš„æ¸…ç†å·¥ä½œã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰ä»»ä½•æ¸…ç†å·¥ä½œï¼Œå› æ­¤è¯¥æ–¹æ³•ä¸€èˆ¬ä¸éœ€è¦åšä»€ä¹ˆã€‚</p>
</li>
<li><p>getService()æ–¹æ³•<br>oprocessorService æ¥å£ã€‚è¯¥æ¥å£ä»…ä»…å®šä¹‰äº†ä¸€ä¸ªæ¥å£å‡½æ•° getService()ã€‚æˆ‘ä»¬ä»…éœ€è¦å°†æœ¬å®ä¾‹è¿”å›å³å¯ã€‚HBase çš„ RegionServer åœ¨æ¥å—åˆ°å®¢æˆ·ç«¯çš„è°ƒç”¨è¯·æ±‚æ—¶ï¼Œå°†è°ƒç”¨è¯¥æ¥å£è·å–å®ç°äº† RPC Service çš„å®ä¾‹ï¼Œå› æ­¤æœ¬å‡½æ•°ä¸€èˆ¬æƒ…å†µä¸‹å°±æ˜¯è¿”å›è‡ªèº«å®ä¾‹å³å¯ã€‚</p>
</li>
<li><p>å½“ Endpoint ç±»ç»§æ‰¿è‡ª RPC Service ç±»çš„æ—¶å€™ï¼Œä¼šéœ€è¦å®ç° proto æ–‡ä»¶ä¸­å®šä¹‰buildMacIndexæ–¹æ³•,è¿™ä¹Ÿæ˜¯è¯¥ EndPoint ä½œç”¨ä»£ç å®ç°çš„æ–¹æ³•ï¼Œå¹¶ä¸”æœ€åå®Œæˆçš„Response å¿…é¡»æ»¡è¶³ proto ä¸­å®šä¹‰çš„ç±»å‹. ç®€å•èµ·è§ï¼Œåªç®€å•è¿”å›ä¸€ä¸ªå€¼ã€‚</p>
</li>
</ul>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> buildMacIndex(RpcController controller, BuildMacIndex.buildMacIndexRequest request, RpcCallback&lt;BuildMacIndex.buildMacIndexResponse&gt; <span class="keyword">done</span>) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Long l = request.getOnlyForPresent();<span class="comment">// proto ä¸­ request é‡Œè¾¹å®šä¹‰xxx,å°±ç”¨ getXxx å¾—åˆ°è°ƒç”¨æ—¶å€™ä¼ è¿‡æ¥çš„å‚æ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// .... å…¶ä»–é€»è¾‘</span></span><br><span class="line"></span><br><span class="line">    BuildMacIndex.buildMacIndexResponse.Builder resBuilder = BuildMacIndex.buildMacIndexResponse.newBuilder();</span><br><span class="line"></span><br><span class="line">    resBuilder.setBuildOK(<span class="number">100</span>L); <span class="comment">//è¿”å› xxxï¼Œå°±ç”¨ SetXxx è¿›è¡Œèµ‹å€¼</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">done</span>.run(resBuilder.build());<span class="comment">//å®Œæˆ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šå°±å®Œæˆäº†ä¸€ä¸ª EndPoint çš„å®šä¹‰åŠå®ç°ï¼Œè¿è¡Œ mvn clean compile å°±å¯ä»¥æ‰“åŒ…æˆ jar æ–‡ä»¶äº†ã€‚</p>
<h1 id="JARæ–‡ä»¶ä¸Šä¼ åŠåŠ è½½åˆ°-Table"><a href="#JARæ–‡ä»¶ä¸Šä¼ åŠåŠ è½½åˆ°-Table" class="headerlink" title="JARæ–‡ä»¶ä¸Šä¼ åŠåŠ è½½åˆ° Table"></a>JARæ–‡ä»¶ä¸Šä¼ åŠåŠ è½½åˆ° Table</h1><p><strong>å°†ç¼–è¯‘çš„ jar æ–‡ä»¶ä¸Šä¼ åˆ° $HBASE_HOME/lib ç›®å½•ï¼Œå¦‚æœæ˜¯å®Œå…¨åˆ†å¸ƒå¼ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½éœ€è¦æœ‰å“¦ã€‚</strong></p>
<h2 id="é…ç½®æ–‡ä»¶å…¨å±€åŠ è½½-æ‰€æœ‰-Table-éƒ½æœ‰æ•ˆ"><a href="#é…ç½®æ–‡ä»¶å…¨å±€åŠ è½½-æ‰€æœ‰-Table-éƒ½æœ‰æ•ˆ" class="headerlink" title="é…ç½®æ–‡ä»¶å…¨å±€åŠ è½½(æ‰€æœ‰ Table éƒ½æœ‰æ•ˆ)"></a>é…ç½®æ–‡ä»¶å…¨å±€åŠ è½½(æ‰€æœ‰ Table éƒ½æœ‰æ•ˆ)</h2><p>ç¼–è¾‘ hbase-site.xml, æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼Œå¦‚æœåŠ è½½å¤šä¸ª,ç”¨åˆ†å·éš”å¼€æ¯ä¸ªç±»å°±è¡Œäº†ï¼Œæœ€åéœ€è¦é‡å¯ HBase é›†ç¾¤ã€‚</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;property&gt; &lt;name&gt;hbase<span class="selector-class">.coprocessor</span><span class="selector-class">.region</span><span class="selector-class">.classes</span>&lt;/name&gt; &lt;value&gt;lreis<span class="selector-class">.bigdata</span><span class="selector-class">.indoor</span><span class="selector-class">.index</span><span class="selector-class">.coprocessor</span><span class="selector-class">.server</span><span class="selector-class">.BuildMacIndexEndpoint</span>&lt;/value&gt; &lt;/property&gt;</span><br></pre></td></tr></table></figure>
<h2 id="å‘½ä»¤è¡ŒåŠ è½½æ–¹å¼"><a href="#å‘½ä»¤è¡ŒåŠ è½½æ–¹å¼" class="headerlink" title="å‘½ä»¤è¡ŒåŠ è½½æ–¹å¼"></a>å‘½ä»¤è¡ŒåŠ è½½æ–¹å¼</h2><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'lreis.bigdata.indoor.index.coprocessor.server.BuildMacIndexEndpoint'</span> #è®°ä½ï¼Œæœ‰å¼•å·çš„</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæ˜¾ç¤º</p>
<figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">=&gt; Ja<span class="symbol">va:</span><span class="symbol">:Lr</span>eisBigdataIndoorIndexCoprocessorServ<span class="symbol">er:</span><span class="symbol">:Bu</span>ildMacIndexEndpoint</span><br></pre></td></tr></table></figure>
<p>åˆ™è¯´æ˜åŠ è½½æˆåŠŸï¼Œæ¥ç€è¿è¡Œä¸‹é¢çš„å‘½ä»¤</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter 'idx_mac', 'coprocessor' =&gt; '|lreis.bigdata.indoor.index.coprocessor.server.BuildMacIndexEndpoint|<span class="number">1001</span>|'</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæ˜¾ç¤ºå¦‚ä¸‹ï¼Œåˆ™è¯´æ˜ä¿®æ”¹è¡¨èŠ‚å®šä¹‰æˆåŠŸ</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Updating <span class="literal">all</span> regions <span class="keyword">with</span> the <span class="literal">new</span> schema<span class="params">...</span></span><br><span class="line"><span class="number">1</span>/<span class="number">1</span> regions updated.</span><br><span class="line">Done.</span><br><span class="line"><span class="number">0</span> row(s) <span class="keyword">in</span> <span class="number">2.3210</span> seconds</span><br></pre></td></tr></table></figure>
<ul>
<li>æœ€åå°±å¯ä»¥åœ¨å®¢æˆ·ç«¯æˆ–è€… shell çš„æ–¹å¼è°ƒç”¨ Coprocessor äº†ï¼Œ ç®€å•ç»™ä¸€ä¸ª Java API çš„è°ƒç”¨æ–¹å¼</li>
</ul>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">conn = DbcFactory.getConnection().getConnection()<span class="comment">;</span></span><br><span class="line">Admin admin = conn.getAdmin()<span class="comment">;</span></span><br><span class="line">Table table = conn.getTable(TableName.valueOf(<span class="string">"idx_mac"</span>))<span class="comment">;</span></span><br><span class="line">final <span class="keyword">BuildMacIndex.buildMacIndexRequest </span>req = <span class="keyword">BuildMacIndex.buildMacIndexRequest.newBuilder().build();</span></span><br><span class="line"><span class="keyword"></span></span><br><span class="line"><span class="keyword">Map&lt;byte[], </span>Long&gt; tmpRet = table.coprocessorService(<span class="keyword">BuildMacIndex.BuildMacIndexService.class, </span>null, null, new <span class="keyword">Batch.Call&lt;BuildMacIndex.BuildMacIndexService, </span>Long&gt;() &#123;</span><br><span class="line">@Override</span><br><span class="line">public Long call(<span class="keyword">BuildMacIndex.BuildMacIndexService </span><span class="keyword">instance) </span>throws IOException &#123;</span><br><span class="line"></span><br><span class="line">ServerRpcController controller = new ServerRpcController()<span class="comment">;</span></span><br><span class="line"><span class="keyword">BlockingRpcCallback&lt;BuildMacIndex.buildMacIndexResponse&gt; </span>rpc = new <span class="keyword">BlockingRpcCallback&lt;BuildMacIndex.buildMacIndexResponse&gt;();</span></span><br><span class="line"><span class="keyword">instance.buildMacIndex(controller, </span>req, rpc)<span class="comment">;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">BuildMacIndex.buildMacIndexResponse </span>resp = rpc.get()<span class="comment">;</span></span><br><span class="line">return resp.getRowCount()<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;)<span class="comment">;</span></span><br><span class="line">long ret = <span class="number">0</span><span class="comment">;</span></span><br><span class="line">for (long l : tmpRet.values())</span><br><span class="line">ret += l<span class="comment">;</span></span><br><span class="line">System.out.println(<span class="string">"lines: "</span> + ret)<span class="comment">;</span></span><br><span class="line">&#125; catch (IOException e) &#123;</span><br><span class="line">e.printStackTrace()<span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><ul>
<li><p><a href="http://www.ibm.com/developerworks/cn/opensource/os-cn-hbase-coprocessor1/index.html" target="_blank" rel="noopener">HBase åå¤„ç†å™¨ç¼–ç¨‹è¯¦è§£ç¬¬ä¸€éƒ¨åˆ†ï¼šServer ç«¯ä»£ç ç¼–å†™</a></p>
</li>
<li><p><a href="https://blogs.apache.org/hbase/entry/coprocessor_introduction" target="_blank" rel="noopener">Coprocessor Introduction : Apache HBase</a></p>
</li>
<li><p><a href="http://www.cockybook.com/?p=35" target="_blank" rel="noopener">hbase0.98 coprocessor Endpoint ä¹‹ HelloWorld</a></p>
</li>
</ul>
]]></content>
      
        <categories>
            
            <category> HBase </category>
            
        </categories>
        
        
        <tags>
            
            <tag> HBase </tag>
            
            <tag> Endpoint </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[javaæ“ä½œhbaseæŠ¥java.net.UnknownHostExceptioné”™è¯¯çš„è§£å†³æ–¹æ¡ˆ]]></title>
      <url>http://dequn.github.io/2016/04/26/java-hbase-java-net-UnknownHostException-jie-jue-fang-an/</url>
      <content type="html"><![CDATA[<p>ä»Šå¤©åœ¨ä½¿ç”¨ HBase API æ‰§è¡Œ Put æ“ä½œçš„æ—¶å€™ï¼Œè¿›ç¨‹ä¸€ç›´åœ¨ç­‰å¾…çŠ¶æ€ï¼Œè€Œè¿›è¡Œ createTable å’Œ dropTableçš„æ—¶å€™å‡æ­£å¸¸ï¼Œå¾ˆæ˜¯éƒé—·ï¼çœ‹äº†ä¸€ä¸‹ Console ä¸­çš„ä¿¡æ¯ï¼ŒæŠ¥é”™</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java<span class="selector-class">.net</span><span class="selector-class">.UnknownHostException</span>: unknown host: node2<span class="selector-class">.lreis2306</span> on node2<span class="selector-class">.lreis2306</span>,</span><br></pre></td></tr></table></figure>
<p>ç”±äºnode2.lreis2306çš„æœºå™¨æ˜¯æˆ‘æ–°åŠ è¿›å»çš„ï¼Œåªæ˜¯æ”¹äº† hosts ä¸­çš„é…ç½®ï¼Œç»è¿‡ä¸€ç•ªç™¾åº¦åï¼Œæ‰¾åˆ°çš„è§£å†³æ–¹æ¡ˆï¼š</p>
<ul>
<li>ä¿®æ”¹/etc/sysconfig/networkä¸­ HOSTNAME=ä¸ HOSTS ä¸­å¯¹åº”çš„æœºå™¨åä¸€è‡´å³å¯ï¼</li>
</ul>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="http://blog.csdn.net/chaijunkun/article/details/44238163" target="_blank" rel="noopener">http://blog.csdn.net/chaijunkun/article/details/44238163</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> HBase </category>
            
        </categories>
        
        
        <tags>
            
            <tag> HBase </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Angular å‘ Controller æ³¨å…¥ Controller]]></title>
      <url>http://dequn.github.io/2016/04/24/angular-inject-controller-to-controller/</url>
      <content type="html"><![CDATA[<p>å¦‚ä½•åœ¨ä¸€ä¸ªControllerä¸­å–åˆ°å¦ä¸€ä¸ªControllerï¼Ÿä¸‹è¾¹äº‹stackoverflowä¸Šçš„ä¸€ä¸ªå›ç­”ã€‚</p>
<blockquote>
<p>```<br> app.controller(â€˜TestCtrl2â€™, [â€˜$scopeâ€™, â€˜$controllerâ€™, function ($scope, $controller) {<br>    var testCtrl1ViewModel = $scope.$new(); //You need to supply a scope while instantiating.<br>    //Provide the scope, you can also do $scope.$new(true) in order to create an isolated scope.<br>    //In this case it is the child scope of this scope.<br>    $controller(â€˜TestCtrl1â€™,{$scope : testCtrl1ViewModel });<br>    testCtrl1ViewModel.myMethod(); //And call the method on the newScope.<br> }]);</p>
</blockquote>
 <figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; </span><br><span class="line">&gt; <span class="keyword">In</span> any <span class="keyword">case</span> you cannot call TestCtrl1.myMethod() because you have attached the <span class="function"><span class="keyword">method</span> <span class="title">on</span> <span class="title">the</span> $<span class="title">scope</span> <span class="title">and</span> <span class="title">not</span> <span class="title">on</span> <span class="title">the</span> <span class="title">controller</span> <span class="title">instance</span>.</span></span><br><span class="line"><span class="function">&gt; </span></span><br><span class="line"><span class="function">&gt; <span class="title">If</span> <span class="title">you</span> <span class="title">are</span> <span class="title">sharing</span> <span class="title">the</span> <span class="title">controller</span>, <span class="title">then</span> <span class="title">it</span> <span class="title">would</span> <span class="title">always</span> <span class="title">be</span> <span class="title">better</span> <span class="title">to</span> <span class="title">do</span>:</span>-</span><br></pre></td></tr></table></figure>
<p>.controller(â€˜TestCtrl1â€™, [â€˜$logâ€™, function ($log) {<br>    this.myMethod = function () {<br>             $log.debug(â€œTestCtrl1 - myMethodâ€);<br>     }<br> }]);<br> <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> and <span class="keyword">while</span> consuming <span class="keyword">do</span>:</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> </span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"></span></span><br></pre></td></tr></table></figure></p>
<p> .controller(â€˜TestCtrl2â€™, [â€˜$scopeâ€™, â€˜$controllerâ€™, function ($scope, $controller) {<br>      var testCtrl1ViewModel = $controller(â€˜TestCtrl1â€™);<br>      testCtrl1ViewModel.myMethod();<br> }]);<br> <code>`</code></p>
<blockquote>
<p>In the first case really the $scope is your view model, and in the second case it the controller instance itself.</p>
</blockquote>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul>
<li><a href="http://stackoverflow.com/questions/25417162/how-do-i-inject-a-controller-into-another-controller-in-Angularjs" target="_blank" rel="noopener">http://stackoverflow.com/questions/25417162/how-do-i-inject-a-controller-into-another-controller-in-Angularjs</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> Angular </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Angular </tag>
            
            <tag> Controller </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Angularå•å…ƒæµ‹è¯•ä¸­ç”±ui-routerå¼•èµ·çš„$httpbackend unexpected request é”™è¯¯è§£å†³åŠæ³•]]></title>
      <url>http://dequn.github.io/2016/03/31/angular-ui-router-unit-test-unexpected-request/</url>
      <content type="html"><![CDATA[<p>åœ¨ä½¿ç”¨ Karma + Jasmine è¿›è¡Œangular å•å…ƒæµ‹è¯•çš„æ—¶å€™ï¼Œä¸€ç›´æŠ¥ $httpbackend unexpected  requeest é”™è¯¯ ï¼Œæç¤ºçš„æ˜¯è¯·æ±‚çš„ä¸€ä¸ªhtmlæ–‡ä»¶ï¼Œåæ¥æ‰å‘ç°æ˜¯å› ä¸ºç”¨äº†ui-routerè¿›è¡Œè·¯ç”±ï¼Œå¹¶ä¸”å­˜åœ¨æŠ½è±¡çŠ¶æ€çš„é—®é¢˜ï¼Œè®°å½•ä¸€ä¸‹è§£å†³åŠæ³•ã€‚</p>
<p>ä¸‹è½½ <a href="https://gist.github.com/wilsonwc/8358542" target="_blank" rel="noopener">stateMock.js</a>,</p>
<p>æŠŠ stateMock.js æ·»åŠ åˆ° karma.config.js é‡Œè¾¹ã€‚</p>
<p>æµ‹è¯•æ–‡ä»¶ä¸­ï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> $state ;</span><br><span class="line"><span class="keyword">var</span> $httpbackend;</span><br><span class="line"><span class="keyword">var</span> httpHandler;</span><br><span class="line"> </span><br><span class="line">beforeEach(module(<span class="string">'stateMock'</span>));</span><br><span class="line"></span><br><span class="line">beforeEach(inject(<span class="function"><span class="keyword">function</span><span class="params">(_$state_,_$httpbackend_)</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    $state = _$state_;</span><br><span class="line">    $httpbackend = _$httpbackend_;</span><br><span class="line">    </span><br><span class="line">    httpHandler = $httpbackend.when(<span class="string">'GET'</span>, <span class="string">'/service/list'</span>).respond(<span class="comment">/*xxx*/</span>)</span><br><span class="line"></span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line">it(<span class="string">'http'</span>,<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line">      </span><br><span class="line">      $state.go(<span class="string">'user.service'</span>);</span><br><span class="line">      </span><br><span class="line">      $http.get(<span class="string">'/service/list'</span>);</span><br><span class="line">      </span><br><span class="line">      $httpBackend.expectGET(<span class="string">'/service/list'</span>);          </span><br><span class="line">      </span><br><span class="line">      <span class="comment">//.....</span></span><br><span class="line">      </span><br><span class="line">      </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å°±å¯ä»¥é¿å…è¯·æ±‚äº†htmlè€Œå¯¼è‡´æµ‹è¯•å¤±è´¥ã€‚ã€</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="http://stackoverflow.com/questions/23655307/ui-router-interfers-with-httpbackend-unit-test-angular-js/23670198#23670198" target="_blank" rel="noopener">http://stackoverflow.com/questions/23655307/ui-router-interfers-with-httpbackend-unit-test-angular-js/23670198#23670198</a></p>
<p><a href="https://github.com/meanjs/mean/issues/198" target="_blank" rel="noopener">https://github.com/meanjs/mean/issues/198</a></p>
]]></content>
      
        <categories>
            
            <category> Angular </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Angular </tag>
            
            <tag> ui-router </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[macä¸Šå®‰è£…elasticsearch-analysis-ansj-2.1.1çš„è¿‡ç¨‹]]></title>
      <url>http://dequn.github.io/2016/03/27/install-elasticsearch-analysis-ansj-2-1-1-on-mac-OS/</url>
      <content type="html"><![CDATA[<p><a href="https://github.com/NLPchina/elasticsearch-analysis-ansj" target="_blank" rel="noopener">elasticserach-analysis-ansj</a>æ˜¯ä¸€ä¸ªelasticsearchçš„ä¸­æ–‡åˆ†è¯æ’ä»¶ï¼ŒåŸºäºansjã€‚<br>åœ¨Macä¸Šä½¿ç”¨brewå®‰è£…çš„elasticsearchï¼Œå¦‚æœæ˜¯é»˜è®¤å®‰è£…çš„è¯ç‰ˆæœ¬æ˜¯2.2,ç”±äºæ’ä»¶ä¸æ”¯æŒï¼Œæ‰€ä»¥åªèƒ½å¸è½½æ‰é‡æ–°å®‰è£…ã€‚</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">brew </span>uninstall elasticsearch</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨homebrew/versionså¯ä»¥å®‰è£…elasticsearch2.1.2çš„ç‰ˆæœ¬ï¼Œä»ç„¶ä¸èƒ½ä½¿ç”¨ï¼Œä¸è¿‡è¿˜æ˜¯è¦è®°å½•ä¸€ä¸‹ï¼Œå®‰è£…å…¶ä»–ç¯å¢ƒæŒ‡å®šç‰ˆæœ¬çš„æ—¶å€™å¯ä»¥ç”¨æ­¤æ–¹æ³•ï¼Œå‚è§<a href="https://github.com/Homebrew/homebrew-versions" target="_blank" rel="noopener">homebrew-versions</a>ï¼š</p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew tap homebrew/versions</span><br><span class="line">brew install elasticsearch21 #æ³¨æ„ï¼Œè¿™é‡Œçš„<span class="number">2.1</span>ç‰ˆæœ¬æ˜¯<span class="number">2.1</span><span class="number">.2</span>,ä»ç„¶ä¸èƒ½æ»¡è¶³è¦æ±‚ï¼</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢æ˜¯çœŸæ­£elasticsearchåŠelasticsearch-analysis-ansj-2.1.1ç‰ˆæœ¬çš„å®‰è£…ï¼š</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget <span class="symbol">https:</span>/<span class="regexp">/download.elasticsearch.org/elasticsearch</span><span class="regexp">/release/org</span><span class="regexp">/elasticsearch/distribution</span><span class="regexp">/tar/elasticsearch</span><span class="regexp">/2.1.1/elasticsearch</span>-<span class="number">2.1</span>.<span class="number">1</span>.tar.gz</span><br><span class="line">tar -zxf elasticsearch-<span class="number">2.1</span>.<span class="number">1</span>.tar.gz /usr/local/Cellar/</span><br><span class="line">cd /usr/local/Cellar/elasticsearch-<span class="number">2.1</span>.<span class="number">1</span>.tar.gz/bin</span><br><span class="line">./plugin install <span class="symbol">http:</span>/<span class="regexp">/maven.nlpcn.org/org</span><span class="regexp">/ansj/elasticsearch</span>-analysis-ansj/<span class="number">2.1</span>.<span class="number">1</span>/elasticsearch-analysis-ansj-<span class="number">2.1</span>.<span class="number">1</span>-release.zip</span><br><span class="line">./ealsticsearch  <span class="comment">#è¿è¡Œå‘½ä»¤å³å¯</span></span><br></pre></td></tr></table></figure>
<p>æ³¨æ„æœ€åéœ€è¦æŠŠelasticsearchæ·»åŠ åˆ°ç¯å¢ƒå˜é‡ä¸­ã€‚</p>
<h2 id="å‚è€ƒï¼š"><a href="#å‚è€ƒï¼š" class="headerlink" title="å‚è€ƒï¼š"></a>å‚è€ƒï¼š</h2><p>[1]<a href="https://github.com/Homebrew/homebrew-versions" target="_blank" rel="noopener">https://github.com/Homebrew/homebrew-versions</a></p>
<p>[2]<a href="https://github.com/NLPchina/elasticsearch-analysis-ansj" target="_blank" rel="noopener">https://github.com/NLPchina/elasticsearch-analysis-ansj</a></p>
]]></content>
      
        <categories>
            
            <category> Others </category>
            
        </categories>
        
        
        <tags>
            
            <tag> mac </tag>
            
            <tag> elasticsearch </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[angualrä¸­interceptorsçš„æ­£ç¡®é…ç½®æ–¹å¼]]></title>
      <url>http://dequn.github.io/2016/03/26/right-way-of-use-angualr-http-interceptors/</url>
      <content type="html"><![CDATA[<p>Interceptorsæ˜¯AngularJSä¸­çš„<strong>æ‹¦æˆªå™¨</strong>ï¼Œä¸ªäººæ„Ÿè§‰æ›´åƒæ˜¯JavaEEä¸­çš„<strong>è¿‡æ»¤å™¨</strong>ï¼Œå³æ‰€æœ‰äº‹ä»¶éƒ½ä¾æ¬¡é€šè¿‡è¿‡æ»¤å™¨ï¼Œè¿‡æ»¤å™¨å¤„ç†åå‘ä¸‹ä¼ é€’ï¼Œå†åˆ°æœ€ç»ˆåˆ°å¤„ç†ç¨‹åºã€‚</p>
<p>æœ€è¿‘åœ¨ç½‘ä¸Šçœ‹çš„åšå®¢éƒ½ç®€å•ä¸¾äº†ä¾‹å­ï¼Œä½†åœ¨æœ¬äººå®ç°è¿‡ç¨‹ä¸­æ€»æ˜¯å®ç°moduerrçš„é”™è¯¯æç¤ºï¼Œä¸‹é¢æ˜¯å‡ºé”™è®°å½•ï¼š</p>
<p>Angular versionï¼š1.4.6<br>ä¸èƒ½æ­£ç¡®å®ç°çš„æ–¹å¼ï¼šæœåŠ¡å®ç°</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">angular.module(<span class="string">'app'</span>).factory(<span class="string">'httpInters'</span>,httpInters);</span><br><span class="line">httpInters.$inject = [<span class="string">'$q'</span>];</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">httpInters</span><span class="params">($q)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		responseError:<span class="function"><span class="keyword">function</span><span class="params">(response)</span></span>&#123;</span><br><span class="line">		   <span class="comment">// your code here</span></span><br><span class="line">		&#125;,</span><br><span class="line">		requestError:<span class="function"><span class="keyword">function</span><span class="params">(req)</span></span>&#123;</span><br><span class="line">		  <span class="comment">// your code here</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">angular.module(<span class="string">'app'</span>).config(<span class="function"><span class="keyword">function</span><span class="params">($http,httpInters)</span></span>&#123;</span><br><span class="line">	 $httpProvider.interceptors.push(httpInters);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨ä¸Šè¾¹åœ¨æ–¹å¼å‘ç°ä¸€ç›´ä¸èƒ½æ­£ç¡®æ³¨å…¥æœåŠ¡æ¨¡æ¿ï¼Œå› æ­¤é‡‡ç”¨åŒ¿åå‡½æ•°çš„æ–¹æ³•æ¥åšï¼š</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">angular.module(<span class="string">'app'</span>).config(<span class="function"><span class="keyword">function</span><span class="params">($httpProvider)</span></span>&#123;</span><br><span class="line">	 $httpProvider.interceptors.push(<span class="function"><span class="keyword">function</span><span class="params">($q)</span></span>&#123;</span><br><span class="line">	      <span class="keyword">return</span> &#123;</span><br><span class="line">	      responseError:<span class="function"><span class="keyword">function</span><span class="params">(response)</span></span>&#123;</span><br><span class="line">		   <span class="comment">// your code here</span></span><br><span class="line">		   <span class="keyword">return</span> $q.reject(response);</span><br><span class="line">				&#125;</span><br><span class="line">	      &#125;</span><br><span class="line">	 &#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>å…·ä½“åŸå› è¿˜æ²¡æœ‰åˆ†æï¼Œæš‚æ—¶å…ˆè®°å½•ä¸‹æ¥ã€‚</p>
]]></content>
      
        <categories>
            
            <category> Angular </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Angular </tag>
            
            <tag> Interceptor </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[æœ‰è¯å°±è¯´ä¹‹å¥³æ€§èŒä¸šé€‰æ‹©]]></title>
      <url>http://dequn.github.io/2016/03/21/you-hua-jiu-shuo-zhi-nv-xing-zhi-ye-xuan-ze/</url>
      <content type="html"><![CDATA[<p>æ˜¨å¤©è·Ÿä¸€ä½å¥³æ€§æœ‹å‹æ‰“ç”µè¯ ï¼ŒèŠç€èŠç€èŠåˆ°äº†å¥³æ€§èŒä¸šé€‰æ‹©çš„è¯é¢˜ä¸Šäº†ï¼Œç´§æ¥ç€å°±æ˜¯è„‘æ´å¤§å¼€äº†ï¼Œç®€å•è®²è¿°ä¸€ä¸‹æˆ‘çš„è§‚ç‚¹ã€‚é¦–å…ˆéœ€è¦æ¾„æ¸…çš„æ˜¯æˆ‘å¹¶æ²¡æœ‰ä»»ä½•æ­§è§†çš„æ„æ€ï¼Œä¹Ÿæ›´ä¸æ˜¯ç›´ç”·ç™Œã€‚æ‰€è¯´æ‰€æƒ³ä¹Ÿä»…ä»…åªä»£è¡¨è‡ªå·±çš„ä¸€äº›è§‚ç‚¹ï¼Œå¯ä»¥æ‹ç –ï¼Œä½†ä¸æ¥å—ä»»ä½•å¸¦æœ‰æ¼«éª‚ã€äººèº«æ”»å‡»çš„è¨€è®ºã€‚</p>
<h3 id="1-å…³äºå¥³æ€§æ­£å¸¸çš„èŒä¸šé€‰æ‹©ä¸è‡ªç„¶åˆ†å·¥"><a href="#1-å…³äºå¥³æ€§æ­£å¸¸çš„èŒä¸šé€‰æ‹©ä¸è‡ªç„¶åˆ†å·¥" class="headerlink" title="1.å…³äºå¥³æ€§æ­£å¸¸çš„èŒä¸šé€‰æ‹©ä¸è‡ªç„¶åˆ†å·¥"></a>1.å…³äºå¥³æ€§æ­£å¸¸çš„èŒä¸šé€‰æ‹©ä¸è‡ªç„¶åˆ†å·¥</h3><p>ä¹‹æ‰€ä»¥é‡æ–°ç”¨åˆ°äº†â€œè‡ªç„¶åˆ†å·¥â€è¿™ä¸ªè¯ï¼Œæ˜¯ä»è‡ªç„¶çš„è§’åº¦è¿›è¡Œè€ƒé‡çš„ã€‚ä»åŸå§‹äººç±»è¿›åŒ–ä»¥æ¥ï¼Œå¥³æ€§åœ¨èŒä¸šä¸Šçš„é€‰æ‹©å¤šæ˜¯ä»¥ç»´æŠ¤å®¶åº­å†…éƒ¨è¿è½¬ä¸ºä¸­å¿ƒçš„ï¼Œå°‘æœ‰å¼ºè€Œå¯¹å¤–è€…ã€‚è¿œå¤æ—¶å€™ï¼Œç”·çš„è‚Œè‚‰å—å„¿å¤§ï¼Œå°±å¿…é¡»æ‰¿æ‹…èµ·ç‹©çŒçš„èŒè´£ ï¼Œå¥³æ€§ç›¸å¯¹è€Œè¨€æ›´é€‚åˆé‡‡æ‘˜ç­‰è½»å·§ã€å®‰å…¨çš„å·¥ä½œï¼Œåˆ°å†œä¸šå’Œæ¸¸ç‰§æ–‡æ˜ï¼Œæ”¾ç‰§å’Œç§åœ°ç­‰åŠ›æ°”æ´»å„¿ä¹Ÿç†æ‰€å½“ç„¶çš„ç”±ç”·äººæ¥åšï¼Œå¥³æ€§åšçš„æ›´å¤šçš„åˆ™æ˜¯çººç»‡ã€ç¼–ç»‡ç­‰ï¼Œè¿™ä¹Ÿé€ æˆäº†å¥³æ€§æœ‰æ›´å¤šçš„æ—¶é—´å¾…åœ¨å®¶é‡Œï¼Œç»´ç³»å®¶åº­å†…éƒ¨çš„è¿è½¬ç­‰æ›´å¤šçš„ä»»åŠ¡ä¹Ÿå°±ç”±å¥³æ€§æ‰¿æ‹…ã€‚è¿™æ ·æ˜¯å¾ˆè‡ªç„¶çš„ä¸€ä¸ªåˆ†å·¥ï¼Œå¹¶ä¸”æ˜¯ç»“åˆäº†ç”·å¥³ç‰¹æ€§çš„ä¸åŒçš„ï¼Œä¸è¦éå¾—è·Ÿæˆ‘è®²ä¸ºä»€ä¹ˆï¼Œæ²¡æœ‰ä¸ºä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆç”·çš„æ˜¯XYå¥³çš„æ˜¯XXï¼Ÿæ‰€ä»¥ä»è¿™ä¸ªè§’åº¦æ¥çœ‹ï¼Œå¥³æ€§åº”è¯¥æ›´å®¹æ˜“åå‘äºä¸€äº›è½»ä¾¿çš„ã€èƒ½å¤Ÿä»¥å®¶åº­ä¸ºé‡å¿ƒçš„å·¥ä½œï¼Œä¸è‡ªç„¶çš„è¿›åŒ–ä¹Ÿæ˜¯ä¸€è„‰ç›¸æ‰¿çš„ã€‚</p>
<h3 id="2-å…³äºå¥³æ€§è‡ªæˆ‘ä»·å€¼çš„ä½“ç°"><a href="#2-å…³äºå¥³æ€§è‡ªæˆ‘ä»·å€¼çš„ä½“ç°" class="headerlink" title="2.å…³äºå¥³æ€§è‡ªæˆ‘ä»·å€¼çš„ä½“ç°"></a>2.å…³äºå¥³æ€§è‡ªæˆ‘ä»·å€¼çš„ä½“ç°</h3><p>çœ‹åˆ°è¿™é‡Œå¾ˆå¤šå¥³æ€§æœ‹å‹ä¼°è®¡è¦æ‰”æ¿ç –äº†ï¼Œå‡­ä»€ä¹ˆä½ ä»¬ç”·çš„èƒ½åšæˆ‘ä»¬å¥³çš„ä¸èƒ½ï¼Œæˆ‘ä»¬ä¹Ÿè¦è¿½æ±‚è‡ªå·±çš„äººç”Ÿä»·å€¼ã€‚å¥½å¥½å¥½ï¼Œä¸è¿‡æœ¬å°‘ä»æ¥æ²¡è¯´å¥³äººçš„ä»·å€¼å°±æ˜¯ä¸ºäº†ç”·äººï¼Œæˆ–æ˜¯æ´—è¡£åšé¥­ã€‚å¾·å›½çš„æ³•å¾‹æœ‰è§„å®šï¼šå¤«å¦»åŒæ–¹éƒ½å·¥ä½œï¼Œå·¥èµ„ä½çš„ä¸€æ–¹è¦äº¤é«˜é¢çš„ç¨ã€‚å¯¹ï¼Œä½ æ²¡æœ‰çœ‹é”™ ï¼Œæ˜¯å·¥èµ„ä½çš„ä¸€æ–¹ï¼å¾·å›½ä¸è‡³äºæ˜¯æŠ½ç–¯äº†è®©å·¥èµ„ä½çš„ä¸€æ–¹å›å®¶åšé¥­å§ï¼Ÿæ˜¾è€Œæ˜“è§ä»–ä»¬é‡è§†çš„æ˜¯å®¶åº­æ•™è‚²ï¼ä¸€ä¸ªæ°‘æ—çš„å®¶åº­æ•™è‚²å‡ ä¹å†³å®šäº†ä¸€ä¸ªå›½å®¶çš„æœªæ¥ ã€‚è¨€ä¼ èº«æ•™ï¼Œå¯¹ä¸€ä¸ªå­©å­å½±å“æœ€å¤§çš„ä¹Ÿè«è¿‡äºå®¶åº­æ•™è‚²äº†å§ã€‚å¦‚æœé€‰æ‹©ä»¥å®¶åº­ä¸ºä¸­å¿ƒï¼Œèƒ½å¤Ÿæºæºä¸æ–­åœ°è¾“å‡ºè‡ªå·±æ­£ç¡®çš„è§‚ç‚¹ã€æƒ³æ³• ï¼Œæˆ‘æƒ³å…¶ä¸­çš„ä»·å€¼ä¸å®¹ç½®ç–‘å§ï¼æ‰€ä»¥è¯´ï¼Œè¦ä½“ç°è‡ªæˆ‘ä»·å€¼çš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œä¸æ˜¯æ¯ä¸ªäººéƒ½è¦å‡ºå»ç´¯æ­»ç´¯æ´»çš„æŒ£é’±çš„ã€‚å½“ç„¶ä¹Ÿæœ‰äººè¯´é‚£å·¥èµ„ä½çš„ä¸€æ–¹ä¹Ÿææœ‰å¯èƒ½æ˜¯ç”·çš„ï¼Œå¯¹ï¼Œè¿™ç‚¹ä¸å¦å®šï¼Œä½†è¯·å»ç»Ÿè®¡ä¸€ä¸ªæ¯”ä¾‹ã€‚</p>
<h3 id="3-å¥³äººè¦ç‹¬ç«‹ä¸ç”·äººä¸é è°±"><a href="#3-å¥³äººè¦ç‹¬ç«‹ä¸ç”·äººä¸é è°±" class="headerlink" title="3.å¥³äººè¦ç‹¬ç«‹ä¸ç”·äººä¸é è°±"></a>3.å¥³äººè¦ç‹¬ç«‹ä¸ç”·äººä¸é è°±</h3><p>å¥³äººè¦ç‹¬ç«‹ ï¼Œä¸é”™ï¼Œæ˜¯çš„ï¼Œæ”¯æŒã€‚ç‹¬ç«‹å°±ä¸€å®šæ˜¯ç»æµä¸Šçš„ç‹¬ç«‹å—ï¼Ÿå¦‚æœæ€æƒ³ä¸ç‹¬ç«‹ã€ç²¾ç¥ä¾èµ–æ€§å¼ºï¼Œå³ä½¿ç»™ä½ å¾ˆå¤šmoneyï¼Œå°±èƒ½ç‹¬ç«‹çš„äº†å—ï¼Ÿç”·çš„ä¸é è°±ï¼Œé‚£ä»€ä¹ˆé è°±ï¼ŒåŠ¨ç‰©å›­é‡Œçš„é›„æ€§åŠ¨ç‰©æ›´é è°±äº›ï¼Ÿè®ºæ€æ ·æ‰¾ä¸€ä¸ªä¸é è°±çš„ç”·çš„ï¼š<br>1ï¼šç”·çš„æœ¬èº«ä¸é è°±ï¼Œæ°æ°è¢«æŸé€‰ä¸­ï¼Œç„¶åæ¨è€Œå¹¿ä¹‹ã€‚ä½ é€‰äº†ä¸€ä¸ªä¸é è°±çš„ï¼Œåªèƒ½è¯´æ˜ä½ çœ¼å…‰ä¸é è°±ï¼Œé‚£ä¹ˆå¤šé è°±çš„æ€ä¹ˆæ²¡é€‰ä¸Š;<br>2ï¼šç”·çš„ç”±é è°±é€€åŒ–åˆ°ä¸é è°±ã€‚è¿™ä¹ˆæ¥è®²ç”·çš„ç¡®å®æœ‰é—®é¢˜ï¼Œä¸è¿‡ä½ ä¿©æ•´å¤©åœ¨ä¸€èµ·ç”Ÿæ´»ï¼Œä»–çš„æ€æƒ³ã€è§‚ç‚¹åº”è¯¥å—ä½ çš„å½±å“æ›´å¤§å§ï¼Œä»–ä¼šå˜å¾—ä¸é è°±ï¼Œé‚£ä¹ˆä½ èƒ½é è°±å‡ åˆ†å‘¢ï¼Ÿ</p>
<h3 id="4-åƒè½¯é¥­ä¸å¥³å¼ºäººçš„ä¸å¹³ç­‰æ€§"><a href="#4-åƒè½¯é¥­ä¸å¥³å¼ºäººçš„ä¸å¹³ç­‰æ€§" class="headerlink" title="4.åƒè½¯é¥­ä¸å¥³å¼ºäººçš„ä¸å¹³ç­‰æ€§"></a>4.åƒè½¯é¥­ä¸å¥³å¼ºäººçš„ä¸å¹³ç­‰æ€§</h3><p>å¦‚æœä¸€ä¸ªç”·çš„æ²¡æœ‰å¥³çš„æŒ£é’±å¤šï¼Œåˆ™ä¼šè¢«å¤šæ•°äººæˆ³è„Šæ¢éª¨ï¼Œè¢«å¸¦ä»¥â€œåƒè½¯é¥­â€çš„å¸½å­ï¼Œåœ¨äººç¾¤ä¸­éƒ½æŠ¬ä¸èµ·å¤´æ¥ã€‚å¦‚æœä¸€ä¸ªå¥³çš„æ˜¯ä¸€ä¸ªå¥³å¼ºäººï¼Œæƒ³å¿…æ”¶åˆ°æ›´å¤šçš„æ˜¯å¤¸èµã€‚æŒ‰ç›®å‰çš„æƒ…å†µæ¥çœ‹ï¼Œä¸¤è€…éƒ½æ˜¯è½åœ¨äº†ä¸€ä¸ªè¾ƒå°æ¦‚ç‡çš„åˆ†å¸ƒåŒºåŸŸã€‚ä¸ºä»€ä¹ˆä¸€ä¸ªä¼šå—åˆ°é„™è§†è€Œå¦ä¸€ä¸ªå—åˆ°çš„æ˜¯ä»°è§†å‘¢ï¼Ÿè‡³å°‘å…¶ä¸­ä¸€ä¸ªæ˜¯ä¸åˆç†çš„å§ï¼Œä¸”ç•™ä½œä¸‹é¢è®¨è®ºã€‚</p>
<h3 id="5-å¥³æƒè¿åŠ¨ä¸â€œå†å²é¢ è¦†â€"><a href="#5-å¥³æƒè¿åŠ¨ä¸â€œå†å²é¢ è¦†â€" class="headerlink" title="5.å¥³æƒè¿åŠ¨ä¸â€œå†å²é¢ è¦†â€"></a>5.å¥³æƒè¿åŠ¨ä¸â€œå†å²é¢ è¦†â€</h3><p>è‡ªå¥³æƒè¿åŠ¨è¿›è¡Œçš„å‡ ç™¾å¹´æ¥ï¼Œå¥³æ€§çš„ç¤¾ä¼šåœ°ä½æé«˜äº†å¾ˆå¤šã€‚è¿™æ­£æ˜¯å…¶ç§¯ææ„ä¹‰çš„æ‰€åœ¨ï¼Œå¥³äººå†ä¹Ÿä¸æ˜¯ç”·äººçš„é™„å±ï¼Œä½œä¸ºä¸€ä¸ªç‹¬ç«‹è€Œè‡ªç”±çš„ä¸ªä½“è¿›å…¥åˆ°ç¤¾ä¼šçš„å‘å±•æ½®æµä¸­ã€‚å¥³æƒè¿åŠ¨çš„æ­£é¢æ„ä¹‰æœ‰å¾ˆå¤šï¼Œè¿™é‡Œå°±ä¸å†ä¸€ä¸€æ¥è®²ã€‚<br>ç°åœ¨è®²ä¸€äº›ä¸ªäººè§‰å¾—ç¨å¾®æœ‰äº›é—®é¢˜çš„åœ°æ–¹ã€‚ç”·å¥³å¹³ç­‰äº†ï¼Œå¥³æ€§æœ‰æ›´å¤šçš„è‡ªç”± ï¼Œä½†è¿™æ›´å¤š çš„è‡ªç”±å°±æ˜¯è¦æ›´å¤šäººæƒ³éƒ½ä¸æƒ³çš„è¦å»åšä¸€ä¸ªâ€œå¥³å¼ºäººâ€å—ï¼Ÿå¿…é¡»æ”¾å¼ƒè‡ªå·±çš„å¤©æ€§å»é€‰æ‹©â€œç‹¬ç«‹â€å—ï¼Ÿå¥³æ€§å–ä»£äº†ç”·æ€§çš„å·¥ä½œï¼Œé‚£ä¹ˆä½ ä»¬åŸæ¥çš„å·¥ä½œå‘¢ï¼Œèƒ½å¤ŸæŠ›å¼ƒæ‰è€Œä¸å½±å“ç¤¾ä¼šçš„æ­£å¸¸å‘å±•å—ï¼Ÿä¸”çœ‹å›½å†…çš„å®¶åº­æ•™è‚²ï¼Œçƒ‚åˆ°ä½•ç­‰ç¨‹åº¦ï¼Ÿé‚£ä¹ˆå¤šçš„ç•™å®ˆå„¿ç«¥ï¼Œå­¤å¯¡è€äººï¼Œè¿™äº›äººçš„å¤„å¢ƒæ˜¯ç”±ä»€ä¹ˆé€ æˆçš„å‘¢ï¼Ÿè¿™é‡Œæœ‰å¾ˆå¤šå…¶ä»–å› ç´ ï¼Œä½†å¦‚æ­¤ä¹‹å¤šçš„å¥³æ€§æ”¾å¼ƒäº†å…¶å¤©èŒè€Œå»é€‰æ‹©åŒç”·äººä¸€æ ·é¢å¯¹ç”Ÿå­˜æƒ³å¿…æ˜¯å…¶ç›´æ¥åŸå› ã€‚å¹¶ä¸æ˜¯è®²è¿™äº›è¾›è¾›è‹¦è‹¦å¥‹æ–—çš„å¥³æ€§ä¸å¯¹ï¼Œè€Œæ˜¯è®²ç”·äººæ²¡èƒ½æ’‘èµ·ä¸€ä¸ªå®¶ï¼Œæ›´å¤šçŸ­è§†çš„æŠ•å…¥åˆ°â€œç»æµå‘å±•â€ä¸­ã€‚å¦‚æœå¥³æ–¹å‡ºæ¥ä½œå¥³å¼ºäººï¼Œæ’‘èµ·ä¸€ä¸ªå®¶ï¼Œç”·äººä¸ºä»€ä¹ˆå°±ä¸èƒ½æ¥æ‰‹å¥³äººä¹‹å‰çš„å·¥ä½œå‘¢ï¼Œè€Œéå¾—èƒŒä¸€ä¸ªâ€œåƒè½¯é¥­â€çš„åå£°ï¼Ÿ<br>ä¹Ÿæœ‰äººè®²ï¼Œè¿™æ­£æ˜¯ç¤¾ä¼šçš„å‘å±•é€ æˆçš„è¿›æ­¥å‘€ ï¼Œå¥³æ€§ä»å®¶åº­ä¸­è§£æ”¾å‡ºæ¥ï¼Œè¿™ä¹Ÿä¸æ˜¯åŸå§‹ç¤¾ä¼šäº†ï¼Œä¸è¦æ‹¿è‡ªç„¶åˆ†å·¥æ¥è¯´äº‹ã€‚ä½†è¯·é—®ï¼Œä¸€ä¸ªè¿åŠ¨å‡ ç™¾å¹´æ¥å°±èƒ½é¢ è¦†æ•°åä¸‡å¹´çš„æ¼”åŒ–å²å—ï¼Ÿå„ä½å­¦çš„é©¬å“²æ²¡æœ‰è®²é‡å˜ç§¯ç´¯æ‰èƒ½å¼•èµ·è´¨å˜å—ï¼Ÿæœ‰äººè¯´è¯¥è¿åŠ¨çŸ­æ—¶é—´å†…é¢ è¦†äº†è¿‡å»å¥³æ€§ä½ä½çš„ç°è±¡å•Šï¼Œä¸é”™ï¼Œä½†å¥³æ€§ä½ä½æ˜¯è‡ªç„¶ç°è±¡å—ï¼Ÿææ€•ä¸æ˜¯çš„å§ï¼Œä¸è¿‡æ˜¯è¿‡å»ç»Ÿæ²»é˜¶çº§å¸¦ä»¥åŠå­¦æ´¾å­¦è¯´å¼ºå‹ç»™æ— è¾œçš„å¥³æ€§çš„å§ï¼Œè¿™äº›å¤–åŠ›æ‰èƒ½ç»´æŒçš„ç°è±¡å½“ç„¶åœ¨å†…å› ï¼ˆæœ¬èº«ç”·å¥³åœ°ä½ä¸åˆ†é«˜ä½ ï¼Œåªæ˜¯åˆ†å·¥ä¸åŒè€Œå·²ï¼‰é¢å‰æ˜¾å¾—ä¸å ªä¸€å‡»ï¼Œè½°ç„¶å€’å¡Œã€‚å•ä»æ—¶é—´é•¿åº¦æ¥çœ‹ï¼ŒçŸ­æ—¶é—´å†…è‡ªç„¶åˆ†å·¥å‘ç”Ÿå¦‚æ­¤å¤©ç¿»åœ°è¦†æ˜¯å±äºæ­£å¸¸ç°è±¡å—ï¼Ÿ</p>
<h3 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h3><p>è¯´äº†è¿™ä¹ˆå¤šï¼Œåˆ°æœ€åæˆ‘åªæƒ³è¯´ï¼šé€‰æ‹©è‡ªç”±æ˜¯å±äºæ‰€æœ‰çš„äººï¼ä½†å¹¶ä¸æ˜¯æ‰€è§åˆ°çš„å¤šæ•°é€‰æ‹©å°±æ˜¯å¥½çš„ã€æ­£ç¡®çš„ï¼Œè€Œä¸”æ­¤ç§æ‰€è§ä¹Ÿææœ‰å¯èƒ½æ˜¯ä¸€ç§å‡è±¡ã€æˆ–è€…â€œçƒ­â€ã€‚</p>
<p>æœ¬æ¥æƒ³æ‰¾äº›ç›¸å…³çš„è®ºæ–‡æ¥è¡¥å……ä¸€ä¸‹è®ºæ®çš„ï¼Œä½†ç”±äºå®åœ¨æ˜¯å¿™(lan)å¾—(de)ä¸(li)è¡Œ(hai)ï¼Œå› æ­¤åªç•™ä¸‹è®ºç‚¹ï¼Œå¾…ä»¥åæœ‰æ—¶é—´è¿›è¡Œè¡¥å……ã€‚</p>
]]></content>
      
        <categories>
            
            <category> ä¸ªäººæ—¥è®° </category>
            
        </categories>
        
        
        <tags>
            
            <tag> èŒä¸šé€‰æ‹© </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Angularè‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µé¢å¹¶è·³å›]]></title>
      <url>http://dequn.github.io/2016/03/20/angular-redirect-to-login-if-not-auth/</url>
      <content type="html"><![CDATA[<p>åœ¨ä¸€äº›é¡µé¢éœ€è¦ç™»å½•æ‰èƒ½è®¿é—®çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¦å…ˆæ£€æµ‹ç”¨æˆ·æ˜¯å¦å·²ç»ç™»å½•ï¼Œå¦‚æœå·²ç»ç™»å½•ï¼Œåˆ™æ­£å¸¸è®¿é—®ï¼Œå¦‚æœæ²¡æœ‰åˆ™è‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µé¢ï¼Œç™»å½•ä¹‹åå†è‡ªåŠ¨è·³è½¬åˆ°éœ€è¦è®¿é—®çš„é¡µé¢ã€‚ä¸‹é¢å°±ç®€å•è®²ä¸€ä¸‹åœ¨Angularä¸­å¦‚ä½•ä½¿ç”¨ui-routeræ¥å®ç°è¿™ä¸€ç›®æ ‡,ä»ç„¶ç›´æ¥çœ‹ä»£ç ã€‚</p>
<h2 id="1-è·¯ç”±é…ç½®ï¼š"><a href="#1-è·¯ç”±é…ç½®ï¼š" class="headerlink" title="1.è·¯ç”±é…ç½®ï¼š"></a>1.è·¯ç”±é…ç½®ï¼š</h2><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">angular</span><span class="selector-class">.module</span>(<span class="string">'mApp'</span>)<span class="selector-class">.config</span>(function($stateProvider)&#123;</span><br><span class="line">     $<span class="selector-tag">stateProvider</span></span><br><span class="line">     <span class="selector-class">.state</span>(<span class="string">'home'</span>,&#123;</span><br><span class="line">         <span class="comment">//home  page     </span></span><br><span class="line">      &#125;)</span><br><span class="line">     <span class="selector-class">.state</span>(<span class="string">'userpage'</span>,&#123;</span><br><span class="line">         <span class="attribute">url</span>:<span class="string">'/user'</span>,</span><br><span class="line">         <span class="attribute">authencitate</span>:true,</span><br><span class="line">         <span class="comment">//other code,such as controller </span></span><br><span class="line">     &#125;)</span><br><span class="line">     <span class="selector-class">.state</span>(<span class="string">'login'</span>,&#123;</span><br><span class="line">         <span class="attribute">url</span>:<span class="string">'/login'</span>,</span><br><span class="line">         <span class="comment">// other code</span></span><br><span class="line">     &#125;)</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="2-ç›‘å¬-stateChangeStartäº‹ä»¶"><a href="#2-ç›‘å¬-stateChangeStartäº‹ä»¶" class="headerlink" title="2.ç›‘å¬$stateChangeStartäº‹ä»¶"></a>2.ç›‘å¬<code>$stateChangeStart</code>äº‹ä»¶</h2><p>å¯ä»¥åœ¨<code>$rootScope</code>ä¸­ç›‘å¬ ï¼Œä¹Ÿå¯ä»¥å†™åœ¨ä¸€ä¸ªå•ç‹¬çš„æœåŠ¡ä¸­ï¼Œè¿™é‡Œä»¥<code>$rootScope</code>ä¸ºä¾‹<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// other code </span></span><br><span class="line">angular.module(<span class="string">'mApp'</span>).run(run);</span><br><span class="line">run.$inject = [<span class="string">'$rootScope'</span>,<span class="string">'userService'</span>];</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">run</span><span class="params">($rootScope,userService)</span></span>&#123;</span><br><span class="line">    $rootScope.$on(<span class="string">'$stateChangeStart'</span>,<span class="function"><span class="keyword">function</span><span class="params">(event,toState,toParams,fromState,fromParams)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(toState.authencitate &amp;&amp; !userService.isLogin())&#123;</span><br><span class="line"></span><br><span class="line">        event.preventDefault();<span class="comment">//must </span></span><br><span class="line">        $rootScope.returnState = fromState;</span><br><span class="line">        $rootScope.returnParams = fromParams;</span><br><span class="line">        $stete.go(<span class="string">'login'</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="3-ç™»å½•å¤„çš„é€»è¾‘"><a href="#3-ç™»å½•å¤„çš„é€»è¾‘" class="headerlink" title="3.ç™»å½•å¤„çš„é€»è¾‘"></a>3.ç™»å½•å¤„çš„é€»è¾‘</h2><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ajax ç™»å½•æˆåŠŸå</span></span><br><span class="line"><span class="keyword">if</span>(!$rootScope.returnState)&#123;</span><br><span class="line">$state.go(<span class="string">'home'</span>);</span><br><span class="line"><span class="comment">//ç”¨æˆ·ç›´æ¥è¿›çš„ç™»å½•é¡µé¢ï¼ŒreturnStateä¸ºundefined,è·³è½¬åˆ°é»˜è®¤ä¸»é¡µå°±è¡Œäº†</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">   $state.go($rootScope.returnState,$rootScope.returnParams,&#123;reload:<span class="literal">true</span>,<span class="comment">/* other settings */</span>&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œè§£é‡Šä¸€ä¸‹ä»£ç  ï¼Œåœ¨$stateChangeStartçš„ç›‘å¬ä»£ç ä¸­ï¼Œåˆ¤æ–­ä¸€ä¸‹toState,å³è¦å»çš„é¡µé¢çš„authencitateæ˜¯å¦ä¸ºtrue,æ˜¯çš„è¯æ„å‘³ç€æˆ‘ä»¬å¿…é¡»è¦ç™»å½•æ‰å‡†è®¸è®¿é—®ï¼Œå¦‚æœä¸éœ€è¦éªŒè¯å°±æ­£å¸¸è®¿é—®ï¼ˆauthencitateä¸ºè‡ªå®šä¹‰å­—æ®µï¼Œä»€ä¹ˆåå­—éƒ½å¯ä»¥çš„ï¼‰ã€‚<br>userServiceä¸ºå®šä¹‰çš„ä¸€ä¸ªæœåŠ¡ï¼ŒåŒ…æ‹¬åˆ¤æ–­æ˜¯å¦å·²ç»ç™»å½•ã€ç™»å½•ã€ç™»å‡ºé€»è¾‘ã€‚å¦‚æœç”¨æˆ·æœªç™»å½•å¹¶ä¸”æ‰€è®¿é—®çš„é¡µé¢éœ€è¦æˆæƒï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¦é˜»æ­¢è·³è½¬äº‹ä»¶çš„æ­£å¸¸è¿›è¡Œ<code>event.preventDefault();</code>ï¼Œä¹‹åæŠŠè¦å»çš„çŠ¶æ€å’Œå‚æ•°æš‚å­˜ä¸º<code>returnState</code>,<code>returnParams</code>,å†äººä¸ºè·³è½¬åˆ°loginé¡µé¢ã€‚<br>åœ¨ç™»å½•é€»è¾‘ä¸­ï¼Œå½“ç™»å½•æˆåŠŸåï¼Œåˆ¤æ–­ä¸€ä¸‹<code>returnState</code>æ˜¯å¦ä¸ºç©ºï¼Œæ˜¯çš„è¯å°±ç›´æ¥è·³åˆ°ç½‘ç«™ä¸»é¡µï¼Œä¸æ˜¯å°±<code>$state.go(returnState,returnParams)</code>å°±å¯ä»¥äº†ã€‚</p>
<p>é€šè¿‡ä»¥ä¸Šé…ç½®ï¼Œæˆ‘ä»¬å°±å¯ä»¥å®ç°éœ€æ±‚ï¼šè‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µé¢å¹¶åœ¨ç™»å½•åè‡ªåŠ¨è·‘å›éœ€è¦è®¿é—®çš„é¡µé¢ã€‚</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="http://www.jonahnisenson.com/angular-js-ui-router-redirect-after-login-to-requested-url/" target="_blank" rel="noopener">1</a>.<a href="http://www.jonahnisenson.com/angular-js-ui-router-redirect-after-login-to-requested-url/" target="_blank" rel="noopener">Angular.js UI-router redirect after login to requested url</a></p>
<p><a href="http://angular-ui.github.io/ui-router/site/#/api" target="_blank" rel="noopener">2</a>.<a href="http://angular-ui.github.io/ui-router/site/#/api" target="_blank" rel="noopener">ui-router API</a></p>
]]></content>
      
        <categories>
            
            <category> Angular </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Angular </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[ui-routeråˆ©ç”¨å¤šviewså®ç°æ¨¡æ¿å¼å¼€å‘]]></title>
      <url>http://dequn.github.io/2016/03/19/use-ui-router-multi-views-for-template-develop/</url>
      <content type="html"><![CDATA[<p>å¦‚ä½•ä½¿ç”¨ui-routerå®ç°é¡µé¢çš„åˆ†ç¦»å‘¢ï¼Ÿçœ‹ä»£ç ï¼<br>index.html<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div ui-view=&quot;header&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;div ui-view=&quot;body&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;div ui-view=&quot;footer&quot;&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure></p>
<p>Js code<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">$stateProvider</span><br><span class="line">     .state(<span class="string">'root'</span>, &#123;</span><br><span class="line">         abstrac<span class="variable">t:</span> true,</span><br><span class="line">         <span class="keyword">view</span><span class="variable">s:</span> &#123;</span><br><span class="line">             <span class="string">'header'</span>: &#123;</span><br><span class="line">                 templateUr<span class="variable">l:</span> <span class="string">'layout/header/header.tpl.html'</span>,</span><br><span class="line">                 controller: <span class="string">'HeaderController'</span>,</span><br><span class="line">                 controllerA<span class="variable">s:</span> <span class="string">'vm'</span></span><br><span class="line">             &#125;,</span><br><span class="line">             <span class="string">'footer'</span>: &#123;</span><br><span class="line">                 templateUr<span class="variable">l:</span> <span class="string">'layout/footer/footer'</span>,</span><br><span class="line">                 controller: <span class="string">'FooterController'</span>,</span><br><span class="line">                 controllerA<span class="variable">s:</span> <span class="string">'vm'</span></span><br><span class="line">             &#125;,</span><br><span class="line">             <span class="string">'body'</span>: &#123;</span><br><span class="line">                 templateUr<span class="variable">l:</span> <span class="string">'layout/body/body.tpl.html'</span></span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">     &#125;)</span><br><span class="line">     .state(<span class="string">'find'</span>,&#123;</span><br><span class="line">        paren<span class="variable">t:</span><span class="string">'root'</span>,</span><br><span class="line">     	templateUR<span class="variable">l:</span><span class="string">'find/find.tpl.html'</span>,</span><br><span class="line">     	controller:<span class="string">'FindControlller'</span>,</span><br><span class="line">     	//....other settings </span><br><span class="line">     &#125;)</span><br></pre></td></tr></table></figure></p>
<p>è®°å¾—æŠŠrootçŠ¶æ€è®¾ç½®æˆæŠ½è±¡çš„ï¼Œå³ä¸èƒ½ç›´æ¥å®ä¾‹åŒ–ï¼Œå…¶ä»–çŠ¶æ€ä¸­éœ€è¦è®¾ç½®parentå±æ€§ä¸ºâ€™rootâ€™,å³æˆ‘ä»¬çš„çŠ¶æ€çš„çˆ¶çŠ¶æ€ï¼Œè¿™æ ·åœ¨å…¶ä»–ä»£ç ä¸­å†™é“¾æ¥çš„æ—¶å€™å°±å¯ä»¥ç›´æ¥å†™æˆ<code>ui-sref=&quot;find&quot;</code>è€Œä¸ç”¨éƒ½å†™æˆ<code>ui-sref=&quot;root.find&quot;</code>äº†ã€‚</p>
<h2 id="å‚è€ƒï¼š"><a href="#å‚è€ƒï¼š" class="headerlink" title="å‚è€ƒï¼š"></a>å‚è€ƒï¼š</h2><p>[1] <a href="http://stackoverflow.com/questions/27603252/angular-ui-router-multiple-named-views-for-all-states" target="_blank" rel="noopener">http://stackoverflow.com/questions/27603252/angular-ui-router-multiple-named-views-for-all-states</a><br>[2] <a href="http://angular-ui.github.io/ui-router/site/#/api" target="_blank" rel="noopener">http://angular-ui.github.io/ui-router/site/#/api</a></p>
]]></content>
      
        <categories>
            
            <category> Angular </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Angular </tag>
            
            <tag> ui-router </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[CentOS6.4 ä¸Šå®‰è£… Oracle 12c]]></title>
      <url>http://dequn.github.io/2016/03/09/install-oracle-12c-on-cnetos6-4/</url>
      <content type="html"><![CDATA[<p>ä¸»è¦è®°å½•ä¸€ä¸‹é‡åˆ°çš„é—®é¢˜ï¼Œå…¶ä»–å‚è€ƒåˆ«çš„åšæ–‡<a href="http://www.centoscn.com/CentosServer/sql/2013/0828/1467.html" target="_blank" rel="noopener">CentOS x6.4 Oracle 12c å®‰è£…æ‰‹è®°</a>ã€‚</p>
<h2 id="é—®é¢˜1ï¼špackage-compact-libstdc-is-not-installed"><a href="#é—®é¢˜1ï¼špackage-compact-libstdc-is-not-installed" class="headerlink" title="é—®é¢˜1ï¼špackage compact-libstdc++ is not installed"></a>é—®é¢˜1ï¼špackage compact-libstdc++ is not installed</h2><p>è¿è¡Œ yum list | grep compat-libstdc++<br>å¦‚æœæœ‰ç»“æœåˆ—å‡ºï¼Œåˆ™ç›´æ¥è·³è¿‡è¿™ä¸€æ­¥å°±è¡Œäº†ã€‚<br>å¦‚æœæ²¡æœ‰åˆ°<a href="http://www.rpm-find.net/linux/rpm2html/search.php?query=compat-libstdc%2B%2B-33" target="_blank" rel="noopener">http://www.rpm-find.net/linux/rpm2html/search.php?query=compat-libstdc%2B%2B-33</a> ä¸‹è½½ä¸€ä¸ªå®‰è£…å°±è¡Œäº†<br>rpm -ivh   compat-libstdc++xxxxx.rpm</p>
<p>æŸ¥è¯¢çš„æ—¶å€™åˆ»å¸¦ä¸Šåè¾¹çš„å…¨åå°±è¡Œäº†ã€‚</p>
<h2 id="é—®é¢˜2ï¼š-runInstaller-æ—¶æŠ¥must-be-configured-to-display-at-least-256-colors-é”™è¯¯"><a href="#é—®é¢˜2ï¼š-runInstaller-æ—¶æŠ¥must-be-configured-to-display-at-least-256-colors-é”™è¯¯" class="headerlink" title="é—®é¢˜2ï¼š./runInstaller æ—¶æŠ¥must be configured to display at least 256 colors é”™è¯¯"></a>é—®é¢˜2ï¼š./runInstaller æ—¶æŠ¥must be configured to display at least 256 colors é”™è¯¯</h2><p>é€€å‡ºå½“å‰ç»ˆç«¯ ï¼Œå†å¼€ä¸€ä¸ªä¸€èˆ¬å°±è¡Œäº†ã€‚</p>
<h2 id="é—®é¢˜3ï¼š-å¼€å¯vncserverçš„æ—¶å€™æç¤ºé”™è¯¯ï¼š"><a href="#é—®é¢˜3ï¼š-å¼€å¯vncserverçš„æ—¶å€™æç¤ºé”™è¯¯ï¼š" class="headerlink" title="é—®é¢˜3ï¼š å¼€å¯vncserverçš„æ—¶å€™æç¤ºé”™è¯¯ï¼š"></a>é—®é¢˜3ï¼š å¼€å¯vncserverçš„æ—¶å€™æç¤ºé”™è¯¯ï¼š</h2><blockquote>
<p>WARNING: The first attempt to start Xvnc failed, possibly because the font<br>catalog is not properly configured.  Attempting to determine an appropriate<br>font path for this system and restart Xvnc using that font path â€¦<br>Could not start Xvnc.<br>_XSERVTransSocketUNIXCreateListener: â€¦SocketCreateListener() failed<br>_XSERVTransMakeAllCOTSServerListeners: server already running<br>â€¦.</p>
</blockquote>
<p>è§£å†³æ–¹æ¡ˆï¼šæ¢ä¸€ä¸ªç«¯å£å¼€å¯vncserverè¯•è¯•ã€‚</p>
<h2 id="é—®é¢˜4ï¼šå®‰è£…sql-developer"><a href="#é—®é¢˜4ï¼šå®‰è£…sql-developer" class="headerlink" title="é—®é¢˜4ï¼šå®‰è£…sql developer"></a>é—®é¢˜4ï¼šå®‰è£…sql developer</h2><p>ä»å®˜ç½‘ä¸Šä¸‹è½½å¯¹åº”ç‰ˆæœ¬å®‰è£…æ—¢å¯ï¼Œæ³¨æ„éœ€è¦çš„jdkç‰ˆæœ¬ï¼Œä¸æ˜¯jre,çœ‹æ¸…æ¥š ï¼Œç¬¬ä¸€æ¬¡æ‰“å¼€sql developerçš„æ—¶å€™å¦‚æœæ²¡æœ‰æ‰¾åˆ°éœ€è¦çš„jdkç¯å¢ƒå˜é‡ï¼Œä¼šæç¤ºè¾“å…¥ä¸€æ¬¡ï¼Œä»¥åå°±ä¸ç”¨å†è¾“å…¥äº†ã€‚</p>
<h2 id="å‚è€ƒï¼š"><a href="#å‚è€ƒï¼š" class="headerlink" title="å‚è€ƒï¼š"></a>å‚è€ƒï¼š</h2><p>1.<a href="https://community.oracle.com/thread/2293534?tstart=0" target="_blank" rel="noopener">Could Not execute auto Check for DISPLAY</a><br>2.<a href="http://www.centoscn.com/CentosServer/sql/2013/0828/1467.html" target="_blank" rel="noopener">CentOS x6.4 Oracle 12c å®‰è£…æ‰‹è®°</a><br>3.<a href="https://www.redhat.com/archives/rhelv6-list/2012-March/msg00067.html" target="_blank" rel="noopener">starting vncserver</a></p>
]]></content>
      
        <categories>
            
            <category> Others </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Oracle </tag>
            
            <tag> CentOS </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[ä»»æ€§]]></title>
      <url>http://dequn.github.io/2016/03/04/renxing/</url>
      <content type="html"><![CDATA[<p>ä»Šå¤©åœ¨ç¾¤é‡Œè¾¹çœ‹åˆ°å¤§å¸ˆå…„ä»é˜¿é‡Œç¦»èŒçš„æ¶ˆæ¯(åˆšåˆšå…¥èŒåŠå¹´)ï¼Œç¾¤é‡Œä¹Ÿå¥½é•¿æ—¶é—´æ²¡äººæ¥è¯ï¼Œä¼°è®¡å¤§å®¶å½“æ—¶æ‰€æƒ³åº”è¯¥å’Œæˆ‘å·®ä¸å¤šå§ã€‚ä¸”ä¸å¹å˜˜é˜¿é‡Œçš„å¾…é‡å’Œå‰é€”ï¼Œæˆ‘æƒ³å…‰æ˜¯é‚£ä¸ªæ™®é€šèŒä½ä¹Ÿæ˜¯ç›®å‰è®¸å¤šåŒå­¦å¾ˆæƒ³æ‹¿åˆ°çš„å§ï¼Œæ¢æˆ‘æœ‰è¿™ä¸ªå·¥ä½œè‚¯å®šé«˜å…´åœ°ç¡ä¸ç€è§‰ï¼ˆæˆ‘å¥½è±¡æ˜ç™½äº†ä»€ä¹ˆï¼Œä»–ä»¬æ‰¾çš„å·¥ä½œä¹Ÿæ˜¯ä¸€ä¸ªæ¯”ä¸€ä¸ªå±Œï¼Œç¾¡ç…æˆ‘ç­‰ï¼‰ã€‚ä¹Ÿè®©æˆ‘åˆæƒ³åˆ°äº†ä½•è€å¸ˆä»ä¸€ä¸ªä¸–ç•Œæ’åç¬¬ä¸€çš„å†ä¿é™©å…¬å¸ï¼ˆç™¾åº¦æŸ¥çš„ï¼Œä¸ä¿è¯å‡†ç¡®ï¼Œæ‰€ä»¥å°±ä¸æå…¬å¸åå­—äº†ï¼‰è¾èŒæåˆ›ä¸šå»äº†ã€‚å§‘ä¸”ä¸è®ºä»–ä»¬åœ¨åŸå…¬å¸çš„èŒåŠ¡å¤§å°ï¼Œè–ªæ°´é«˜ä½ï¼ˆå…¶å®æˆ‘ä¹Ÿä¸çŸ¥é“ï¼‰ï¼Œè¡£é£Ÿæ— å¿§å®‰é€¸åœ°è¿‡ä¸€è¾ˆå­è‚¯å®šæ˜¯æ²¡é—®é¢˜çš„ï¼ä¸è¿‡ä»–ä»¬éƒ½è·Ÿå…¶ä»–å¥½å¤šç‰›Xçš„äººä¸€æ ·ï¼Œä»»æ€§åœ°èµ°äº†ï¼Œèµ°äº†ï¼</p>
<p>åˆšåˆšæ¯•ä¸šï¼Œåˆšåˆšæˆå®¶ï¼Œä¸æ˜¯æƒ³ç€ä»€ä¹ˆæ—¶å€™ä¹°è½¦ã€ä»€ä¹ˆæ—¶å€™ä¹°æˆ¿ï¼Œæ”¾ç€å¥½å¥½çš„å·¥ä½œä¸è¦äº†ï¼Œä»»æ€§åœ°å…¨èŒåˆ›ä¸šå»äº† ï¼Œè¿˜æœ‰äºšå—å’Œæé”‹ï¼Œæ¯•ä¸šä¹‹åæ ¹æœ¬å°±æ²¡æœ‰å»æ‰¾å·¥ä½œï¼Œè¿˜æœ‰å¥½å¤šå¥½å¤šå…¶ä»–åªå¬è¿‡å…¶äº‹æ²¡è§è¿‡å…¶äººçš„ï¼Œä¸æ–­åœ°åˆ·æ–°æˆ‘å¯¹æ­¤äº‹çš„çœ‹æ³• ã€‚</p>
<p>ä»¥å‰æ€»è§‰å¾—è¿™äº›äº‹ç¦»æˆ‘æ¯”è¾ƒè¿œï¼Œç‰›Xçš„äººå¤šäº†ï¼Œè·Ÿæˆ‘æ²¡ä»€ä¹ˆå…³ç³»ï¼Œä¹Ÿæ²¡ä»€ä¹ˆäº¤é›†ï¼Œä½œä¸ºä¸€ä¸ªæ™®é€šå¾—ä¸èƒ½å†æ™®é€šçš„äººï¼Œæ‰¾ä¸ªç¨³å®šä½“é¢çš„å·¥ä½œï¼Œå¤«å¤ä½•æ±‚ã€‚é‡åˆ°çš„è¿™äº›äººæœ‰å¤šç‰›ï¼Ÿæ˜¯ï¼Œæ¯”èµ·å¹³å¸¸å¤§ä¼—æœ‰é‚£ä¹ˆä¸€ç‚¹ä¸ä¸€æ ·ï¼Œé‚£å°±æ˜¯ä»–ä»¬æ¯”ä¸€èˆ¬äººæ›´ä»»æ€§ã€‚æ¯”èµ·é‚£äº›é—»å…¶åå¦‚é›·è´¯è€³çš„äººï¼ŒåŒæ ·ç®€ç›´æ˜¯ä¸èƒ½å†æ™®é€šäº†ã€‚</p>
<p>ä¹‹å‰å¥½åƒå¬åˆ°è¿‡ä¸€ä¸ªâ€œå…¨æ°‘åˆ›ä¸šâ€çš„è¯å„¿ï¼Œè§‰å¾—å‘³é“æ€ä¹ˆè¿™ä¹ˆä¸å¯¹ï¼Œæ²¡å¬å‡ºæ¥å¯¹è¿™æ—¶ä»£çš„æŠŠæ¡ï¼Œä¹Ÿæ²¡å¬åˆ°æƒ³å‚ä¸å…¶ä¸­çš„å†²åŠ¨ï¼Œæ€»è§‰å¾—åƒä¸€ä¸ªå†·çœ¼çœ‹çƒ­é—¹å¹¶ä¸”åšä¿¡è¿™çƒ­é—¹è‚¯å®šä»¥æ‚²å‰§æ”¶åœºçš„çœ‹å®¢ä»å˜´é‡Œå“¼äº†ä¸€å¥ï¼šæ²¡ä»€ä¹ˆäº†ä¸å¾—çš„ï¼Œä¸å°±é‚£æ ·å˜›!è¯´åˆ°è¿™é‡Œåˆæƒ³èµ·å…¶ä»–å¸¦â€œå…¨æ°‘â€çš„è¯å„¿ï¼Œä»€ä¹ˆâ€œå…¨æ°‘å¥èº«â€ã€â€œå…¨æ°‘è¿åŠ¨â€äº†ï¼Œå¦‚æœè¿™äº›è¯æ˜¯ä»å‚ä¸è€…å£ä¸­è¯´å‡ºå€’ä¹Ÿæ— å¦¨ï¼Œå¯ä½œä¸ºè°¦è¯äº†;å¦‚æœåªæ˜¯ä¸ªæ—è§‚è€…ï¼Œæ˜¯æ²¡æœ‰èµ„æ ¼ç”¨â€œå…¨æ°‘xxâ€è¿™æ ·çš„è¯è¯­çš„ï¼Œè¿™è·Ÿé…¸è‘¡è„æ˜¯ä¸€æ ·ä¸€æ ·çš„ã€‚å€Ÿç”¨å¹¶ä¿®æ”¹æ™“æ¾å¥‡è°ˆé‡Œè¾¹çš„ä¸€å¥è¯ï¼šå¤§æ—¶ä»£ä¸æ˜¯ç­‰æ¥çš„ï¼Œä¹Ÿä¸æ˜¯çœ‹æ¥çš„ï¼Œæ˜¯å‚ä¸ã€åˆ›é€ å‡ºæ¥çš„ã€‚</p>
<p>æˆ‘ä¸æ˜¯æåŠ›é¼“å¹åˆ›ä¸šæ€ä¹ˆç€æ€ä¹ˆç€ï¼Œåªæ˜¯å¾ˆæ¬£èµå¹¶ä¸”é’¦ä½©è¿™æ ·ä¸€ç§â€œä»»æ€§â€çš„æ€åº¦ï¼Œ å–œæ¬¢å¹¶æŠ•å…¥åœ°å»åšä¸€ä»¶äº‹ï¼Œè¯¥æ˜¯å¦‚ä½•çš„æƒ¬æ„å•Š!</p>
<p>ç”Ÿæ´»ä¸æ­¢çœ¼å‰çš„è‹Ÿä¸”,è¿˜æœ‰è¯—å’Œè¿œæ–¹çš„ç”°é‡â€¦..ä¸ºæ‰¾åˆ°é‚£ç‰‡æµ·ä¸é¡¾ä¸€åˆ‡      -ã€Šç”Ÿæ´»ä¸æ­¢çœ¼å‰çš„è‹Ÿä¸”ã€‹ï¼Œè¿™å‘¨äº”å¥½åƒè¦åœ¨è™¾ç±³éŸ³ä¹é¦–å‘</p>
<p>å¥½å§ï¼Œæˆ‘çŸ«æƒ…äº†â€¦ </p>
<p>ï¼ˆ2016å¹´3æœˆ4æ—¥è¡¥å‘ï¼‰</p>
]]></content>
      
        
    </entry>
    
    <entry>
      <title><![CDATA[Angularå¼‚æ­¥æ•°æ®åœ¨Controllerä¸­ä¸æ›´æ–°çš„å‘]]></title>
      <url>http://dequn.github.io/2016/01/15/angular-async-data-binding-trap/</url>
      <content type="html"><![CDATA[<p>åœ¨ä½¿ç”¨Angularçš„è¿‡ç¨‹ä¸­ï¼Œæ¨èéƒ½æ˜¯å°†æ•°æ®åŠæ•°æ®çš„å¤„ç†é€»è¾‘å†™åœ¨Serviceé‡Œè¾¹ï¼ŒControlleré‡Œè¾¹åªè´Ÿè´£ä¸è§†å›¾äº¤äº’çš„é€»è¾‘ï¼Œæ‰€ä»¥å¾ˆå¤šåŒå­¦éƒ½å¾ˆè‡ªç„¶åœ°ä¼šè¿™æ ·å†™ï¼š<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// in service,e.g. ServiceA</span></span><br><span class="line">   <span class="comment">//... other code</span></span><br><span class="line">   <span class="keyword">this</span>.<span class="keyword">data</span> = [];</span><br><span class="line"></span><br><span class="line"><span class="comment">// in controller,e.g. ControllerA</span></span><br><span class="line">   <span class="comment">//... other code</span></span><br><span class="line">   $scope.<span class="keyword">data</span> = ServiceA.<span class="keyword">data</span>;</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ ·å†™å¥½ä»¥åï¼Œå½“ServiceAä¸­çš„dataå˜åŒ–ï¼ŒControllerAä¸­çš„æ•°æ®ä¹Ÿä¼šè·Ÿç€å˜ï¼Œå¦‚æœæ•°æ®ç»‘å®šåˆ°è§†å›¾äº†ï¼Œé‚£ä¹ˆè§†å›¾ä¸Šä¹Ÿä¼šè·Ÿç€ç›¸åº”çš„å˜åŒ–ï¼Œä½†æ˜¯ç°åœ¨æœ‰ä¸ªé—®é¢˜ï¼Œå¦‚æœService.dataæ˜¯å¼‚æ­¥è·å–è¿‡æ¥ä¹‹åå˜åŒ–çš„å‘¢ï¼Œåƒä¸‹é¢è¿™æ ·<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//code in ServiceA</span></span><br><span class="line"><span class="comment">// ... other codes</span></span><br><span class="line"><span class="keyword">var</span> <span class="keyword">self</span> = this; <span class="comment">// for get this in async</span></span><br><span class="line">$http(req).success(<span class="function"><span class="keyword">function</span><span class="params">(response,status,headers,config)</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> res= angualr.fromJson(response); <span class="comment">// e.g. repsonse is JSON</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">self</span>.data = res.data;<span class="comment">//e.g response is an object, and has a data property</span></span><br><span class="line">    <span class="comment">//here if use this is a Window Object,you should use self instead of this</span></span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line">.error(<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">// code for http error </span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>è§†å›¾ä¸Šçš„æ•°æ®ä¼šè·Ÿç€å˜åŒ–å—ï¼ŸNo!å¤ªå¤©çœŸï¼è¿™ä¸ªæ—¶å€™ä¼šå‘ç°ï¼Œè§†å›¾ä¸Šå±çš„åŠ¨é™ä¹Ÿæ²¡æœ‰ï¼Œé‚£ä¹ˆè¿™æ˜¯æ€ä¹ˆå›äº‹ï¼Œå¦‚ä½•è§£å†³å‘¢ï¼Ÿ</p>
<p>è¿™é‡Œéœ€è¦é‡è¡¥JavaScriptåŸºç¡€çŸ¥è¯†ï¼ŒJavscriptçš„å˜é‡ç±»å‹åˆ†ä¸ºä¸å¯å˜çš„åŸå§‹å€¼(undefined,null,bool,number,string)å’Œå¯å˜çš„å¼•ç”¨å¯¹è±¡(Array,Object..)ï¼ŒåŸå§‹å€¼æ˜¯ä¸å¯æ›´æ”¹çš„ï¼Œä»»ä½•æ–¹æ³•éƒ½æ— æ³•æ›´æ”¹ï¼Œå°¤å…¶å¯¹å­—ç¬¦ä¸²ï¼Œçœ‹ä¸Šå»è¿”å›äº†ä¸€ä¸ªä¿®æ”¹åçš„å­—ç¬¦ä¸²éƒ½æ˜¯è¿”å›äº†ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²å¯¹å€¼ï¼Œå¦‚ä¸‹ï¼š<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> s = <span class="string">"hello"</span>; <span class="comment">//å®šä¹‰s</span></span><br><span class="line">s.toUpperCase(); <span class="comment">//è¿”å›HELLO,ä½†sæ²¡æœ‰å˜</span></span><br><span class="line">s                <span class="comment">//è¾“å‡ºhello</span></span><br><span class="line"><span class="comment">//è¿™æ˜¯ä¸å¯å˜çš„åŸå§‹å€¼ï¼Œå¯¹äºObjectå’ŒArrayå‘¢ï¼Œä»–ä»¬éƒ½æ˜¯å¼•ç”¨å¯¹è±¡ï¼Œå°±åƒC++é‡Œè¾¹çš„æŒ‡é’ˆï¼ŒC#å’ŒJavaä¸­çš„å¼•ç”¨å¯¹è±¡æ¦‚å¿µï¼Œä»–ä»¬æ˜¯å¯å˜çš„ï¼Œå¦‚ä¸‹ï¼š</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> o = &#123;x:<span class="number">1</span>&#125;; <span class="comment">//å®šä¹‰ä¸€ä¸ªå¯¹è±¡</span></span><br><span class="line">o.x = <span class="number">2</span>;       <span class="comment">//ä¿®æ”¹å¯¹è±¡å±æ€§å€¼</span></span><br><span class="line">o.y = <span class="number">3</span>;       <span class="comment">//å†æ¬¡ç»™å¯¹è±¡å¢åŠ ä¸€ä¸ªæ–°å±æ€§</span></span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆç°åœ¨æ¥çœ‹ï¼Œæˆ‘ä»¬åœ¨serviceä¸­åˆ°åº•åšäº†ä»€ä¹ˆå§ï¼Œ<code>var res = angular.fromJson(response);</code>è¿™ä¸€å¥è¯çš„ä½œç”¨æ˜¯æ ¹æ®è¿”å›çš„response(JSONå­—ç¬¦ä¸²)åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å¯¹è±¡res,<code>self.data = res;</code>è¿™å¥çš„ä½œç”¨æ˜¯ä»€ä¹ˆå‘¢ï¼ŒæŠŠdataçš„å¼•ç”¨æŒ‡å‘äº†æ–°çš„resçš„åŸºå¯¹è±¡ï¼ŒåŸæ¥dataçš„åŸºå¯¹è±¡è¿˜åœ¨å—ï¼Œè¿™ä¸ªæ—¶å€™æ˜¯åœ¨çš„ï¼Œç”±ControllerAä¸­çš„$scope.data å¼•ç”¨ï¼Œåˆ°è¿™ä¸€æ­¥ï¼ŒcontrollerAä¸­çš„dataå’ŒserviceAä¸­çš„dataå·²ç»å®Œå…¨æ²¡æœ‰å…³ç³»äº†ï¼Œä»–ä»¬åˆ†åˆ«æŒ‡å‘äº†ä¸¤ä¸ªä¸åŒçš„å†…å­˜åœ°å€ï¼ŒcontrollerAä¸­çš„å¯¹è±¡æ ¹æœ¬æ²¡æœ‰å˜ï¼Œè§†å›¾ä¸­å½“ç„¶ä¹Ÿå°±ä¸ä¼šæœ‰å˜åŒ–ï¼å…¶å‰åå¦‚å›¾æ‰€ç¤º(åŸè°…æ‰‹å¤´æ²¡æœ‰å¥½çš„ç”»å›¾å·¥å…·ï¼Œå‡‘åˆå§)ï¼š<br><img src="https://i.loli.net/2019/07/25/5d396186ce5a737978.png" alt="å¼‚æ­¥å‰åå¼•ç”¨å¯¹è±¡çš„å˜åŒ–æƒ…å†µ"></p>
<p>è¿™æ ·å°±æ˜ç™½ä¸ºä»€ä¹ˆè§†å›¾æ²¡æœ‰æ›´æ–°äº†å§ï¼é‚£ä¹ˆå¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿæœ‰ä¸¤ç§åŠæ³•,ç¬¬ä¸€ç§copy,æ³¨æ„angualr.copyä¼šæ‰€destinationä¸­çš„æ¸…ç©ºï¼Œå†å¤åˆ¶ï¼Œå¦‚æœä¸æƒ³æ¸…ç©ºï¼Œè¯·ç”¨pushæˆ–è€…å…¶ä»–æ“ä½œ:<br><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// in async</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> res = angular.formJson(response);</span><br><span class="line">angular.<span class="built_in">copy</span>(res,slef.data);</span><br></pre></td></tr></table></figure></p>
<p>ç¬¬äºŒç§ï¼šä½¿ç”¨promise,$httpæœ¬èº«å°±æ˜¯ä¸€ä¸ªpromiseå¯¹è±¡ï¼Œå¯ä»¥è¿”å›ï¼Œåœ¨controllerä¸­è·å–pormise,ç„¶åæŠŠ$scope.data å†æŒ‡å‘service.dataå°±å¯ä»¥äº†ï¼<br><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// in service</span></span><br><span class="line"><span class="keyword">this</span>.foo()&#123;</span><br><span class="line"><span class="keyword">return</span> $http(req).success(function()&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> res= angualr.fromJson(response); </span><br><span class="line">    self.<span class="keyword">data</span> = res.<span class="keyword">data</span>;</span><br><span class="line"></span><br><span class="line">&#125;)<span class="comment">//other code</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// in controller</span></span><br><span class="line">service.foo().then(fucntion()&#123;$scope.<span class="keyword">data</span> = service.<span class="keyword">data</span>&#125;) <span class="comment">//point to service.data again</span></span><br></pre></td></tr></table></figure></p>
<p>æ³¨æ„ï¼Œè¿˜æœ‰è®²ç”¨$watch()å®ç°çš„ï¼Œç”±äºç›‘å¬æ•ˆç‡ä¼šæ¯”è¾ƒä½ï¼Œä¸æ¨èä½¿ç”¨ï¼</p>
<p>å‚è€ƒ:<br>ã€ŠJavaScriptæƒå¨æŒ‡å—ã€‹,Oâ€™REILLY,æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾<br>angularJS API,<a href="http://docs.angularjs.cn/api/ng/function/angular.copy" target="_blank" rel="noopener">http://docs.angularjs.cn/api/ng/function/angular.copy</a></p>
]]></content>
      
        <categories>
            
            <category> Angular </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Angular </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[åˆ©ç”¨Angular selectå®ç°å¤šçº§è”åŠ¨]]></title>
      <url>http://dequn.github.io/2016/01/13/angular-select-cascading/</url>
      <content type="html"><![CDATA[<p>Angularä¸­çš„selectæ ‡ç­¾æä¾›äº†å¾ˆå¥½çš„ä¸‹æ‹‰é€‰é¡¹ï¼Œåˆ©ç”¨å¤šä¸ªselectå°±å¯ä»¥å®ç°å¤šçº§è”åŠ¨äº†ï¼Œç›´æ¥çœ‹ä¾‹å­ã€‚<br>é¦–å…ˆéœ€è¦å®šä¹‰å¥½æ•°æ®ï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªJSçš„Objectå¯¹è±¡ï¼ŒpropertyNameæ˜¯çˆ¶çº§é€‰æ‹©ï¼ŒpropertyValueæ˜¯å­çº§é€‰æ‹©ï¼Œè¿™é‡Œåªæœ‰ä¸¤å±‚ï¼Œä¹Ÿå¯ä»¥å†å¾€ä¸‹åµŒå¥—åˆ°ä¸‰å±‚ç­‰ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">$scope.lineTypes = &#123;</span><br><span class="line">  <span class="string">'A è‡ªç„¶æ™¯è§‚çº¿è·¯'</span>: [</span><br><span class="line">    <span class="string">'AA å±±è·¯'</span>,</span><br><span class="line">    <span class="string">'AB æ°´è·¯'</span>,</span><br><span class="line">    <span class="string">'AC å³¡è°·'</span>,</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">'B è´­ç‰©çº¿è·¯'</span>: [</span><br><span class="line">    <span class="string">'BA åœŸç‰¹äº§'</span>,</span><br><span class="line">    <span class="string">'BB å·¥è‰ºå“'</span>,</span><br><span class="line">    <span class="string">'BC æ—¥ç”¨å“'</span>,</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">'C ç¾é£Ÿçº¿è·¯'</span>: [</span><br><span class="line">    <span class="string">'CA åœ°æ–¹å°åƒè¡—'</span>,</span><br><span class="line">    <span class="string">'CB é«˜æ¡£é¤é¥®è¡—'</span>,</span><br><span class="line">    <span class="string">'CC é…’å§è¡—'</span>,</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">'D å†å²æ–‡åŒ–çº¿è·¯'</span>: [</span><br><span class="line">    <span class="string">'DA å†å²äººç‰©'</span>,</span><br><span class="line">    <span class="string">'DB å†å²äº‹ä»¶'</span>,</span><br><span class="line">    <span class="string">'DC æ–‡å­¦è‰ºæœ¯'</span>,</span><br><span class="line">    <span class="string">'DD ç¾æœ¯'</span>,</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">'E åä¿—é£æƒ…çº¿è·¯'</span>: [</span><br><span class="line">    <span class="string">'EA åœ°æ–¹é£ä¿—ä¸æ°‘é—´ç¤¼ä»ª'</span>,</span><br><span class="line">    <span class="string">'EB æ°‘é—´èŠ‚åº†'</span>,</span><br><span class="line">    <span class="string">'EC æ°‘é—´æ¼”è‰º'</span>,</span><br><span class="line">    <span class="string">'ED æ°‘é—´å¥èº«æ´»åŠ¨ä¸èµ›äº‹'</span>,</span><br><span class="line">    <span class="string">'EE å®—æ•™æ´»åŠ¨'</span>,</span><br><span class="line">    <span class="string">'EF åº™ä¼šä¸æ°‘é—´é›†ä¼š'</span>,</span><br><span class="line">    <span class="string">'EG é¥®é£Ÿä¹ ä¿—'</span>,</span><br><span class="line">    <span class="string">'EH ç‰¹è‰²æœé¥°'</span>,</span><br><span class="line">  ],</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>å¦å¤–è¿˜éœ€è¦å®šä¹‰ä¸€ä¸ªfilter,ç”¨æ¥è¿‡æ»¤å‡ºå­çº§æ•°æ®ï¼Œå¦‚ä¸‹æ‰€ç¤º:<br><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$scope.filter(<span class="string">'toSubTypeArray'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">(input, mainType)</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">input</span>[mainType];</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>å®šä¹‰å¥½æ•°æ®å°±å¯ä»¥ç›´æ¥åœ¨ç½‘é¡µä¸Šå±•ç¤ºäº†ï¼Œselectçš„å…·ä½“ç”¨æ³•å¯ä»¥çœ‹<em><a href="http://docs.angularjs.cn/api/ng/directive/select" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a></em>,è¿™é‡Œä¸ç»†è®²äº†ï¼Œç›´æ¥çœ‹ä¾‹å­ã€‚<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">select</span> <span class="keyword">class</span>=<span class="string">"form-control"</span> style=<span class="string">"width:200px;"</span> ng-options=<span class="string">"key as key for (key,value) in activityTypes"</span> ng-model=<span class="string">"selectedActivityMainType"</span>&gt;</span><br><span class="line">  &lt;option <span class="keyword">value</span>=<span class="string">""</span>&gt;---è¯·é€‰æ‹©å¤§ç±»---&lt;/option&gt;</span><br><span class="line">&lt;/<span class="keyword">select</span>&gt;</span><br><span class="line">&lt;<span class="keyword">select</span> <span class="keyword">class</span>=<span class="string">"form-control"</span> style=<span class="string">"width:200px;"</span> ng-options=<span class="string">"type for type in  activityTypes | toSubTypeArray:selectedActivityMainType track by type"</span> ng-model=<span class="string">"selectedActivitySubType"</span>&gt;</span><br><span class="line">  &lt;option <span class="keyword">value</span>=<span class="string">""</span>&gt;---è¯·é€‰æ‹©å­ç±»---&lt;/option&gt;</span><br><span class="line">&lt;/<span class="keyword">select</span>&gt;</span><br></pre></td></tr></table></figure></p>
<p>æ³¨æ„ï¼Œè¿™é‡Œè§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆæ•°æ®å®šä¹‰æˆObjectå¯¹è±¡è€Œä¸æ˜¯Arrayå¯¹è±¡ï¼Œåœ¨ç¬¬ä¸€ä¸ªä¸‹æ‹‰ä¸­ï¼Œæˆ‘ä»¬æŠŠpropertyNameå½“ä½œå®˜æ–¹æ–‡æ¡£ä¸­ä»‹ç»selectå’Œlabelï¼Œselectå°±æ˜¯é€‰æ‹©çš„é‚£ä¸ªå€¼ï¼Œlabelå°±æ˜¯ç•Œé¢ä¸Šæ˜¾ç¤ºå‡ºæ¥çš„å€¼,è¿™ä¸¤ä¸ªå¯ä»¥ä¸æ˜¯åŒä¸€ä¸ªå€¼å“¦ï¼å®šä¹‰æˆä¸€ä¸ªObjectå¯¹è±¡åï¼Œå¯ä»¥ç›´æ¥æŒ‰ç…§PropertyNameå–å‡ºå­çº§çš„æ•°ç»„ï¼Œæ¯”è¾ƒæ–¹ä¾¿ï¼</p>
<p>æ•ˆæœå¦‚ä¸‹:<br><img src="https://i.loli.net/2019/07/25/5d396186df1a744885.png" alt="ç¬¬ä¸€çº§é€‰æ‹©"><br><img src="https://i.loli.net/2019/07/25/5d396186f18d657611.png" alt="ç¬¬äºŒçº§é€‰æ‹©"></p>
<p>è¿™æ ·å°±å®Œæˆäº†å¤šçº§è”åŠ¨çš„æ•ˆæœï¼Œç›®å‰å­˜åœ¨çš„ä¸€ä¸ªé—®é¢˜æ˜¯å¦‚æœä½¿ç”¨filterè¿‡æ»¤ï¼Œæµ‹è¯•ä¸­å‘ç°ä¼šå¤šæ¬¡è§¦å‘ï¼Œæ€§èƒ½æœ‰æ‰€ä¸‹é™ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡æ·»åŠ selectçš„ng-changeäº‹ä»¶ï¼Œåœ¨ng-changeä¸­æ›´æ–°å­åˆ—è¡¨æ¥å®ç°ï¼Œè¿™é‡Œå°±ä¸å†å®ç°äº†ï¼</p>
]]></content>
      
        <categories>
            
            <category> Angular </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Angular </tag>
            
            <tag> select-cascding </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Hadoop, HBase, Sparké›†ç¾¤å®‰è£…æ­¥éª¤]]></title>
      <url>http://dequn.github.io/2015/12/25/hadoop-hbase-spark-install/</url>
      <content type="html"><![CDATA[<p>å®‰è£… HBase, Sparkéƒ½éœ€è¦é¦–å…ˆå®‰è£…Hadoopï¼</p>
<h1 id="1-åŸºæœ¬ç¯å¢ƒå‡†å¤‡"><a href="#1-åŸºæœ¬ç¯å¢ƒå‡†å¤‡" class="headerlink" title="1 åŸºæœ¬ç¯å¢ƒå‡†å¤‡"></a>1 åŸºæœ¬ç¯å¢ƒå‡†å¤‡</h1><h2 id="1-1-hadoopç”¨æˆ·æ·»åŠ å’Œæƒé™é…ç½®"><a href="#1-1-hadoopç”¨æˆ·æ·»åŠ å’Œæƒé™é…ç½®" class="headerlink" title="1.1 hadoopç”¨æˆ·æ·»åŠ å’Œæƒé™é…ç½®"></a>1.1 hadoopç”¨æˆ·æ·»åŠ å’Œæƒé™é…ç½®</h2><p>ä¸ºäº†ç»Ÿä¸€ç®¡ç†ï¼Œä¸»ä»ç»“ç‚¹ä¸Šéƒ½ç”¨hadoopç”¨æˆ·åæ¥ç®¡ç†ï¼Œä¸æ˜¯éé™å®šç”¨hadoop!<br>è¿™å‡ æ¡å‘½ä»¤ç”¨rootç”¨æˆ·æ“ä½œï¼Œæ™®é€šç”¨æˆ·ç”¨sudo,è¿™äº›å‘½ä»¤å¿…é¡»åœ¨æ‰€æœ‰è¦é…ç½®çš„æœºå™¨ä¸Šè¿›è¡Œä¸€æ¬¡<br><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">adduser </span>hadoop</span><br><span class="line"><span class="keyword">adduser </span>hadoop sudo <span class="comment">#æ·»åŠ åˆ°sudoç”¨æˆ·ç»„é‡Œè¾¹</span></span><br></pre></td></tr></table></figure></p>
<p>CentOSéƒ¨åˆ†ç‰ˆæœ¬å¯èƒ½é»˜è®¤æ²¡æœ‰sudoç»„ï¼Œéœ€è¦æ‰§è¡Œ<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">su</span><br><span class="line"><span class="comment">#è¾“å…¥å¯†ç </span></span><br><span class="line">vim <span class="regexp">/etc/</span>sudoers</span><br></pre></td></tr></table></figure></p>
<p>æ‰¾åˆ° root ALL=(ALL) ALLè¿™ä¸€è¡Œï¼Œåœ¨å®ƒä¸‹é¢å†™å…¥<br><figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop <span class="literal">ALL</span>=(<span class="literal">ALL</span>)  <span class="literal">ALL</span> #hadoopæ˜¯ç”¨æˆ·å</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ ·hadoopç”¨æˆ·å°±å¯ä»¥ç”¨sudoå‘½ä»¤äº†ã€‚</p>
<h2 id="1-2-å®‰è£…javaï¼Œé…ç½®JAVA-HOMEç¯å¢ƒå˜é‡-å·²ç»å®‰è£…è¿‡çš„è·³è¿‡æ­¤æ­¥"><a href="#1-2-å®‰è£…javaï¼Œé…ç½®JAVA-HOMEç¯å¢ƒå˜é‡-å·²ç»å®‰è£…è¿‡çš„è·³è¿‡æ­¤æ­¥" class="headerlink" title="1.2 å®‰è£…javaï¼Œé…ç½®JAVA_HOMEç¯å¢ƒå˜é‡,å·²ç»å®‰è£…è¿‡çš„è·³è¿‡æ­¤æ­¥"></a>1.2 å®‰è£…javaï¼Œé…ç½®JAVA_HOMEç¯å¢ƒå˜é‡,å·²ç»å®‰è£…è¿‡çš„è·³è¿‡æ­¤æ­¥</h2><h3 id="1-2-1-å®‰è£…oracle-jdk"><a href="#1-2-1-å®‰è£…oracle-jdk" class="headerlink" title="1.2.1 å®‰è£…oracle-jdk"></a>1.2.1 å®‰è£…oracle-jdk</h3><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install python-software-properties</span><br><span class="line">sudo<span class="built_in"> add-apt-repository </span>ppa:webupd8team/java</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install oracle-java8-installer</span><br></pre></td></tr></table></figure>
<h3 id="1-2-2-è®¾ç½®JAVA-HOME"><a href="#1-2-2-è®¾ç½®JAVA-HOME" class="headerlink" title="1.2.2 è®¾ç½®JAVA_HOME"></a>1.2.2 è®¾ç½®JAVA_HOME</h3><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim ~<span class="regexp">/.bashrc </span></span><br><span class="line"><span class="regexp">sudo vim /etc</span><span class="regexp">/bashrc</span></span><br><span class="line"><span class="regexp">#ä½¿ç”¨ä»¥ä¸Šä¸¤ä¸ªå‘½ä»¤éƒ½å¯ä»¥ï¼Œ/etc</span><span class="regexp">/bashrcå¯¹æ‰€æœ‰ç”¨æˆ·éƒ½æœ‰æ•ˆï¼Œï½/</span>.bashrcåªå¯¹å½“å‰ç”¨æˆ·æœ‰æ•ˆã€‚ä¸‹åŒ</span><br></pre></td></tr></table></figure>
<p>å†™å…¥<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">export</span> <span class="attribute">JAVA_HOME</span>=/usr/lib/jvm/java-8-oracle</span><br></pre></td></tr></table></figure></p>
<p>è¿è¡Œ<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br><span class="line"><span class="comment">#source /etc/bashrc</span></span><br><span class="line"><span class="comment">#ä¸Šè¾¹ç¼–è¾‘çš„æ˜¯å“ªä¸ªå°±sourceå“ªä¸ªï¼Œä¸‹åŒ</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$JAVA_HOME</span> <span class="comment">#æŸ¥çœ‹ä¸€ä¸‹è®¾ç½®çš„å¯¹ä¸å¯¹ï¼Œç”Ÿæ•ˆäº†æœ¨æœ‰</span></span><br></pre></td></tr></table></figure></p>
<h2 id="1-3-hostsæ–‡ä»¶ä¿®æ”¹"><a href="#1-3-hostsæ–‡ä»¶ä¿®æ”¹" class="headerlink" title="1.3 hostsæ–‡ä»¶ä¿®æ”¹"></a>1.3 hostsæ–‡ä»¶ä¿®æ”¹</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim <span class="regexp">/etc/</span>hosts</span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸‹é…ç½®<br>192.168.6.131 hadoop-master<br>192.168.6.132 hadoop-slave1<br>å¦‚æœéœ€è¦å…¶ä»–æœºå™¨ï¼ŒåŒæ ·å†™å…¥ä¿å­˜å³å¯ï¼Œæˆ‘è¿™é‡Œåªæœ‰ä¸¤å°æœºå™¨ï¼Œä¸€ä¸ªåšä¸»ç»“ç‚¹ï¼Œä¸€ä¸ªåšä»ç»“ç‚¹,ä¹‹åpingä¸€ä¸‹çœ‹ipåœ°å€æ˜¯å¦æ­£ç¡®<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ping hadoop-master -c 3</span><br><span class="line">ping hadoop-slave1 -c 3</span><br></pre></td></tr></table></figure></p>
<h2 id="1-4-ssh-é…ç½®"><a href="#1-4-ssh-é…ç½®" class="headerlink" title="1.4 ssh é…ç½®"></a>1.4 ssh é…ç½®</h2><h3 id="1-4-1-openssh-serverå®‰è£…"><a href="#1-4-1-openssh-serverå®‰è£…" class="headerlink" title="1.4.1 openssh-serverå®‰è£…"></a>1.4.1 openssh-serverå®‰è£…</h3><p>é¦–å…ˆéœ€è¦æ‰€æœ‰çš„æœºå™¨éƒ½èƒ½å¤Ÿè¿›è¡Œsshè¿æ¥ï¼Œä¸€èˆ¬è´­ä¹°çš„æœåŠ¡å™¨é»˜è®¤éƒ½æ˜¯å®‰è£…äº†çš„(å¦‚æœtrueç›´æ¥è¿›å…¥ç¬¬äºŒæ­¥ï¼Œæ— å¯†ç è¿æ¥)ï¼Œå¦‚æœæ˜¯è‡ªå·±çš„ç³»ç»Ÿä¸ç”µè„‘åˆ™éœ€è¦å®‰è£…openssh-server,å®‰è£…æ–¹æ³•å¦‚ä¸‹<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-<span class="builtin-name">get</span> install openssh-server</span><br></pre></td></tr></table></figure></p>
<p>å®‰è£…å®Œæˆåå³å¯æµ‹è¯•<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ssh localhost</span></span><br></pre></td></tr></table></figure></p>
<p>æç¤ºè¾“å…¥å¯†ç ï¼Œè¾“å…¥å³å¯ï¼Œæˆ‘ä»¬éœ€è¦ä¸ç”¨å¯†ç ç™»å½•ï¼Œè¿™æ ·hadoopæ‰èƒ½è¿æ¥å…¶ä»–æœºå™¨.æ¥ç€è¿›è¡Œä¸‹ä¸€æ­¥æ— å¯†ç è¿æ¥é…ç½®</p>
<h2 id="æ— å¯†ç è¿æ¥"><a href="#æ— å¯†ç è¿æ¥" class="headerlink" title="æ— å¯†ç è¿æ¥"></a>æ— å¯†ç è¿æ¥</h2><p>è¿™é‡Œè®²ä¸€ä¸‹åŸç†ï¼Œå¦‚æœæœºå™¨Aéœ€è¦æ— å¯†ç sshæœºå™¨Bï¼Œæˆ‘ä»¬éœ€è¦åœ¨æœºå™¨Aä¸Šç”Ÿæˆå…¬é’¥ï¼Œç„¶åæŠŠå…¬é’¥åˆ†å‘ç»™æœºå™¨Bï¼Œåœ¨æœºå™¨Bä¸Šæˆ‘ä»¬æŠŠå…¬é’¥æ·»åŠ åˆ°authorized_keysé‡Œè¾¹ï¼Œå½“æœºå™¨Aéœ€è¦è¿æ¥æœºå™¨Bçš„æ—¶å€™ï¼Œæœºå™¨Bç”Ÿæˆéšæœºä¸²ç”¨æœºå™¨Açš„å…¬é’¥åŠ å¯†å¹¶ä¼ å›ç»™Aï¼ŒAç”¨ç§é’¥å¯¹åŠ å¯†çš„ä¸²è§£å¯†å†è¿”å›ç»™Bï¼ŒBéªŒè¯è§£å¯†ç»“æœï¼Œæ­£ç¡®çš„è¯å°±è®©AæˆåŠŸè¿æ¥ï¼Œè¿™æ ·å°±å…å»äº†è¾“å…¥ç”¨æˆ·å’Œå¯†ç çš„æ­¥éª¤å•¦ï¼<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa #æŒ‰æç¤ºå®Œæˆåè¿è¡Œä¸‹è¾¹å‘½ä»¤,å…¶å®ä¸€è·¯å›è½¦ä¸‹å»å°±è¡Œäº†,å¦‚æœå…¶ä»–æœºå™¨ä¸Šçš„ç”¨æˆ·åä¸ä¸€æ ·ï¼Œåˆ™éœ€è¦æŒ‰æç¤ºè¿›è¡Œ</span><br><span class="line">cat ~/.ssh/id_rsa<span class="selector-class">.pub</span> &gt;&gt; ~/.ssh/<span class="selector-class">.authorized_keys</span> <span class="selector-id">#id_rsa</span><span class="selector-class">.pub</span> æ˜¯åˆšç”Ÿæˆçš„é‚£ä¸ªæ–‡ä»¶,è¿™é‡Œåšçš„æ˜¯æˆ‘ä»¬æ— å¯†ç è¿æ¥è‡ªå·±ï¼</span><br></pre></td></tr></table></figure></p>
<p>å†æµ‹è¯•åº”è¯¥å°±æ˜¯ä¸è¦å¯†ç å³å¯ç™»å½•çš„äº†ã€‚å¦‚æœè¿˜æç¤ºè¦å¯†ç ï¼Œè¿è¡Œ<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod og-wx ~<span class="regexp">/.ssh/</span>authorized_keys</span><br></pre></td></tr></table></figure></p>
<p>æŠŠmasterä¸Šçš„å…¬é’¥ä¼ è¾“ç»™æ‰€æœ‰çš„slaveæœºå™¨ï¼Œåœ¨æ‰€æœ‰slaveä¸ŠæŠŠmasterçš„å…¬é’¥éƒ½catè¿›authorized_keys,è¿™æ ·masteræœºå™¨è®¿é—®æ‰€æœ‰çš„slaveéƒ½ä¸å†éœ€è¦å¯†ç äº†ï¼Œå¦‚æœæœ‰ç±»ä¼¼å…¶ä»–éœ€æ±‚ï¼ŒæŒ‰åŒæ ·æ–¹æ³•ã€‚</p>
<p>ç»è¿‡ä»¥ä¸Šæ­¥éª¤å¹¶éªŒè¯æ²¡æœ‰é—®é¢˜ï¼Œè¯´æ˜æˆ‘ä»¬çš„åŸºç¡€å‡†å¤‡å·²ç»å®Œæˆï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥è¿›è¡ŒHadoop,hbase,scala,sparkçš„å®‰è£…äº†ï¼Œæ³¨æ„ä»¥ä¸‹æ“ä½œéƒ½æ˜¯åœ¨ä¸€å°æœºå™¨ä¸Šè¿›è¡Œçš„ï¼Œå½“æ“ä½œå®Œæˆåéœ€è¦æŠŠé…ç½®å¥½çš„æ–‡ä»¶éƒ½æ‰“åŒ…å‘é€åˆ°æ‰€æœ‰æœºå™¨ä¸Šå¹¶è§£å‹ï¼Œé‚£æ ·æ‰ç®—é…ç½®å®Œæˆï¼</p>
<h1 id="2-Hadoopä¸‹è½½å®‰è£…"><a href="#2-Hadoopä¸‹è½½å®‰è£…" class="headerlink" title="2 Hadoopä¸‹è½½å®‰è£…"></a>2 Hadoopä¸‹è½½å®‰è£…</h1><p>åœ¨å®˜ç½‘ä¸Šä¸‹è½½Hadoopå‹ç¼©åŒ…,æ¯”å¦‚ä¸‹è½½çš„æ–‡ä»¶åhadoop-2.7.1.tar.gz,ä¹‹åå°†å…¶è§£å‹åˆ°/usr/localä¸‹è¾¹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tar -zxf hadoop-2.7.1.tar.gz -C /usr/<span class="built_in">local</span></span><br><span class="line"><span class="built_in">cd</span> usr/<span class="built_in">local</span></span><br><span class="line">sudo mv hadoop-2.7.1 hadoop <span class="comment">#ä¸ºäº†æ–¹ä¾¿ç‰ˆæœ¬å‡çº§åä¸éœ€è¦å†ä¿®æ”¹~/.bashrcï¼Œæ‰€ä»¥è¿™é‡Œå°†å…¶é‡å‘½åä¸ºhadoop</span></span><br><span class="line">sudo chown hadoop:hadoop ./hadoop </span><br><span class="line"><span class="comment">#ä¸ºäº†é¿å…æƒé™ä¸å¤Ÿçš„é—®é¢˜ï¼Œè¿™é‡Œå°†hadoopæ–‡ä»¶å¤¹çš„æƒé™èµ‹äºhadoopç”¨æˆ·å’Œç”¨æˆ·ç»„ï¼Œå¦‚æœæ˜¯åœ¨å¦‚ä¸ªäººHomeä¸‹è¾¹ç­‰ä¸éœ€è¦éªŒè¯æƒé™çš„ä½ç½®ï¼Œçœç•¥æ­¤æ­¥</span></span><br></pre></td></tr></table></figure>
<h2 id="2-1-PATHé…ç½®"><a href="#2-1-PATHé…ç½®" class="headerlink" title="2.1 PATHé…ç½®"></a>2.1 PATHé…ç½®</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bashrc </span><br><span class="line"><span class="meta">#</span><span class="bash">sudo vim /etc/bashrc</span></span><br><span class="line"><span class="meta">#</span><span class="bash">ä½¿ç”¨ä»¥ä¸Šä¸¤ä¸ªå‘½ä»¤éƒ½å¯ä»¥ï¼Œ/etc/bashrcå¯¹æ‰€æœ‰ç”¨æˆ·éƒ½æœ‰æ•ˆï¼Œï½/.bashrcåªå¯¹å½“å‰ç”¨æˆ·æœ‰æ•ˆã€‚ä¸‹åŒ</span></span><br></pre></td></tr></table></figure>
<p>å†™å…¥<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export PATH=<span class="variable">$PATH</span><span class="symbol">:/usr/local/hadoop/bin</span><span class="symbol">:/usr/locao/hadoop/sbin</span> <span class="comment">#è¿™é‡Œçš„è·¯å¾„æ˜¯ä¸Šä¸€æ­¥è§£å‹å®‰è£…Hadoopçš„è·¯å¾„</span></span><br></pre></td></tr></table></figure></p>
<h2 id="2-2-hadoopæ–‡ä»¶é…ç½®"><a href="#2-2-hadoopæ–‡ä»¶é…ç½®" class="headerlink" title="2.2 hadoopæ–‡ä»¶é…ç½®"></a>2.2 hadoopæ–‡ä»¶é…ç½®</h2><p>æ–°çš„é…ç½®æ–‡ä»¶åœ¨hadoop/etc/hadoop/è·¯å¾„ä¸‹é¢ï¼Œç½‘ä¸Šè®¸å¤šæ•™ç¨‹éƒ½å†™çš„æ˜¯åœ¨confä¸‹ï¼Œæ³¨æ„å¯èƒ½ä¼šæ‰¾ä¸åˆ°</p>
<h3 id="2-2-1-hadoop-etc-hadoop-core-site-xml"><a href="#2-2-1-hadoop-etc-hadoop-core-site-xml" class="headerlink" title="2.2.1 hadoop/etc/hadoop/core-site.xml"></a>2.2.1 hadoop/etc/hadoop/core-site.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>fs.defaultFS<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://hadoop-master:9000<span class="tag">&lt;/<span class="name">value</span>&gt;</span> <span class="comment">&lt;!--æ³¨æ„ç«¯å£å·ï¼Œè¿›è¡Œhadoop fs -xxxå‘½ä»¤æ˜¯éœ€è¦è¿™ä¸ªç«¯å£å·çš„ï¼Œhbaseé…ç½®ä¹Ÿæ˜¯éœ€è¦è¿™ä¸ªç«¯å£å·çš„ --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>hadoop.tmp.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>file:/usr/local/hadoop/tmp<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æ³¨æ„hadoop.tmp.dirçš„é…ç½®è·¯å¾„ï¼Œé»˜è®¤çš„æ˜¯ç³»ç»Ÿtmpè·¯å¾„ï¼Œé‡å¯åæ˜¯ä¼šè¢«æ¸…ç†æ‰çš„ã€‚</p>
<h3 id="2-2-2-hadoop-etc-hadoop-hdfs-site-xml"><a href="#2-2-2-hadoop-etc-hadoop-hdfs-site-xml" class="headerlink" title="2.2.2 hadoop/etc/hadoop/hdfs-site.xml"></a>2.2.2 hadoop/etc/hadoop/hdfs-site.xml</h3><p>æ³¨æ„dfs.replicationå€¼ï¼Œç”±äºåªæœ‰ä¸¤å°æœºå™¨ï¼Œæ‰€ä»¥ä¸€å°åšNameNode,å¦ä¸€å°ä½œä¸ºDataNode,å€¼ä¸º1,å¦‚æœæœ‰å¤šå°æœºå™¨ï¼Œéœ€è¦é…ç½®ä¸ºå®é™…æ•°ã€‚<br>dfs.namenode.name.dirå­˜æ”¾çš„æ˜¯namenodeéœ€è¦çš„ç›¸å…³æ•°æ®ï¼Œéœ€è¦æŒ‰å®é™…éœ€è¦æ›´æ¢ä½ç½®ï¼Œç”Ÿäº§ç¯å¢ƒå¹¶ä¸å»ºè®®è®¾ç½®åœ¨tmpç›®å½•ä¸‹è¾¹ã€‚<br>dfs.dtatnode.dtat.dirå°±æ˜¯åˆ†å¸ƒå¼æ–‡ä»¶åœ¨datanodeä¸Šçš„å­˜æ”¾ä½ç½®ï¼Œç”Ÿäº§ç¯å¢ƒä¸­å½“ç„¶ä¸èƒ½åœ¨tmpä¸‹è¾¹å•¦ï¼</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="params">&lt;configuration&gt;</span></span><br><span class="line"><span class="params">&lt;property&gt;</span></span><br><span class="line"><span class="params">&lt;name&gt;</span>dfs.replication<span class="params">&lt;/name&gt;</span></span><br><span class="line"><span class="params">&lt;value&gt;</span><span class="number">1</span><span class="params">&lt;/value&gt;</span></span><br><span class="line"><span class="params">&lt;/property&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="params">&lt;property&gt;</span></span><br><span class="line"><span class="params">&lt;name&gt;</span>dfs.namenode.name.dir<span class="params">&lt;/name&gt;</span></span><br><span class="line"><span class="params">&lt;value&gt;</span>file:<span class="meta-keyword">/usr/</span>local<span class="meta-keyword">/hadoop/</span>tmp<span class="meta-keyword">/dfs/</span>name<span class="params">&lt;/value&gt;</span></span><br><span class="line"><span class="params">&lt;/property&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="params">&lt;property&gt;</span></span><br><span class="line"><span class="params">&lt;name&gt;</span>dfs.datanode.data.dir<span class="params">&lt;/name&gt;</span></span><br><span class="line"><span class="params">&lt;value&gt;</span>file:<span class="meta-keyword">/usr/</span>local<span class="meta-keyword">/hadoop/</span>tmp<span class="meta-keyword">/dfs/</span>name<span class="params">&lt;/value&gt;</span></span><br><span class="line"><span class="params">&lt;/property&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="params">&lt;/configuration&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-2-3-mapred-site-xml"><a href="#2-2-3-mapred-site-xml" class="headerlink" title="2.2.3 mapred-site.xml"></a>2.2.3 mapred-site.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.framework.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>yarn<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.jobhistroy.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop-master:10020<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.jobhistroy.webapp.address<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop-master:19888<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-2-4-yarn-site-xml"><a href="#2-2-4-yarn-site-xml" class="headerlink" title="2.2.4 yarn-site.xml"></a>2.2.4 yarn-site.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.resourcemanager.hostname<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>hadoop-master<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>mapreduce_shuffle<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="2-2-5-slavesæ–‡ä»¶é…ç½®"><a href="#2-2-5-slavesæ–‡ä»¶é…ç½®" class="headerlink" title="2.2.5 slavesæ–‡ä»¶é…ç½®"></a>2.2.5 slavesæ–‡ä»¶é…ç½®</h3><p>å°†æ‰€æœ‰çš„DataNodeç»“ç‚¹æœºå™¨åå†™åœ¨æ–‡ä»¶ä¸­ï¼Œä¸€è¡Œä¸€ä¸ªæœºå™¨åå¦‚ä¸‹</p>
<p>hadoop-slave1<br>hadoop-salve2<br>â€¦</p>
<h3 id="2-2-6-hadoop-env-sh"><a href="#2-2-6-hadoop-env-sh" class="headerlink" title="2.2.6 hadoop-env.sh"></a>2.2.6 hadoop-env.sh</h3><p>ä¸»è¦é…ç½®JAVA_HOME,è®¾ç½®ä¸ºå®é™…çš„è·¯å¾„å³å¯ï¼</p>
<p>ç»è¿‡ä¸Šé¢çš„é…ç½®ï¼Œå°†hadoopæ–‡ä»¶å‹ç¼©å‘é€ä¸€å…¶ä»–é›†ç¾¤æœºå™¨ä¸Šå¹¶è§£å‹åˆ°ä¸€è‡´çš„è·¯å¾„ä¸‹å³å¯</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo tar -zcf ~/hadoop<span class="selector-class">.lreis</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span> /usr/local/hadoop/</span><br><span class="line">scp ~/hadoop<span class="selector-class">.lreis</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span> hadoop-slave1:~/</span><br><span class="line">ssh hadoop-slave1</span><br><span class="line">sudo tar -zxf ~/hadoop<span class="selector-class">.lreis</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span> -C /usr/local/</span><br><span class="line">sudo chown -R hadoop:hadoop /usr/local/hadoop/</span><br></pre></td></tr></table></figure>
<p>æœ€åéœ€è¦åœ¨hadoop-masteræœºå™¨ä¸Šè¿›è¡Œnamenodeçš„åˆå§‹åŒ–<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>loacl<span class="regexp">/hadoop/</span>bin<span class="regexp">/hadoop namenode -format</span></span><br></pre></td></tr></table></figure></p>
<p>æœ€åæ‰§è¡Œstart-dfs.sh,start-yarn.shåï¼Œè¿è¡Œjpså‘½ä»¤æŸ¥çœ‹å½“å‰çš„javaè¿›è¡Œï¼Œåœ¨masterä¸Šåº”è¯¥åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªè¿›ç¨‹æ‰å±æ­£å¸¸<br>NameNode<br>ResourceManager<br>åœ¨savleæœºå™¨ä¸Šçš„è¿›ç¨‹åº”è¯¥æœ‰å¦‚ä¸‹è¿›ç¨‹<br>NodeManager<br>DataNode</p>
<p>å¦‚æœè¿›ç¨‹æ­£å¸¸ï¼Œæµè§ˆå™¨æŸ¥çœ‹hadooop-master:50070çœ‹åˆ°Live Nodes ä¸ä¸ºé›¶æ‰å¯ä»¥ï¼Œå¦‚æœä¸ºé›¶çš„è¯å»æŸ¥çœ‹æ—¥å¿—åˆ†æåŸå› ï¼</p>
<h1 id="3-hbase-å®‰è£…"><a href="#3-hbase-å®‰è£…" class="headerlink" title="3 hbase å®‰è£…"></a>3 hbase å®‰è£…</h1><p>ä¸‹è½½hbase ï¼Œå¦‚ä¸‹è½½ä¸‹æ¥çš„æ–‡ä»¶åå«åšhbase-1.1.2-bin.tar.gz,åŒæ ·è§£å‹åˆ°/usr/local/ä¸‹è¾¹ï¼Œé‡å‘½åï¼Œæ›´æ”¹æƒé™ï¼Œé…ç½®ç¯å¢ƒå˜é‡ç­‰ æ“ä½œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tar -zxf hbase-1.1.2-bin.tar.gz -C /usr/<span class="built_in">local</span></span><br><span class="line"><span class="built_in">cd</span> usr/<span class="built_in">local</span></span><br><span class="line">sudo mv hbase-1.1.2-bin hbase <span class="comment">#ä¸ºäº†æ–¹ä¾¿ç‰ˆæœ¬å‡çº§åä¸éœ€è¦å†ä¿®æ”¹~/.bashrcï¼Œæ‰€ä»¥è¿™é‡Œå°†å…¶é‡å‘½åä¸ºhbase</span></span><br><span class="line">sudo chown hadoop:hadoop ./hbase</span><br></pre></td></tr></table></figure>
<h2 id="3-1-é…ç½®ç¯å¢ƒå˜é‡"><a href="#3-1-é…ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="3.1 é…ç½®ç¯å¢ƒå˜é‡"></a>3.1 é…ç½®ç¯å¢ƒå˜é‡</h2><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~<span class="string">/.bashrc</span></span><br></pre></td></tr></table></figure>
<p>å†™å…¥<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">HBASE_HOME</span>=/usr/local/hbase</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">PATH</span>=<span class="variable">$PATH</span>:$HBASE_HOME/bin #è¿™é‡Œçš„è·¯å¾„æ˜¯ä¸Šä¸€æ­¥è§£å‹å®‰è£…Hbaseçš„è·¯å¾„</span><br></pre></td></tr></table></figure></p>
<h2 id="3-2-hbaseé…ç½®"><a href="#3-2-hbaseé…ç½®" class="headerlink" title="3.2 hbaseé…ç½®"></a>3.2 hbaseé…ç½®</h2><p>hbaseçš„é…ç½®æ–‡ä»¶åœ¨hbase/confç›®å½•ä¸‹,éœ€è¦ä¿®æ”¹hbase-site.xml,hbase-env.sh,regionserversä¸‰ä¸ªæ–‡ä»¶</p>
<h3 id="3-2-1-hbase-site-xml"><a href="#3-2-1-hbase-site-xml" class="headerlink" title="3.2.1 hbase-site.xml"></a>3.2.1 hbase-site.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.cluster.distributed<span class="tag">&lt;/<span class="name">name</span>&gt;</span> <span class="comment">&lt;!-- è¯´æ˜æ˜¯é›†ç¾¤ç¯å¢ƒï¼Œä¸æ˜¯ä¼ªåˆ†å¸ƒå¼ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>hbase.rootdir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>hdfs://hadoop-master:9000/hbase<span class="tag">&lt;/<span class="name">value</span>&gt;</span> <span class="comment">&lt;!-- è¿™é‡Œçš„hadoop-master:9000è¦ä¸hadoopçš„core-site.xmlé…ç½®æ–‡ä»¶ä½ç½®ä¸€æ ·ï¼Œ/hbaseç›®å½•åˆ™æ˜¯è‡ªå·±è®¾ç½®çš„å€¼ï¼Œä¹Ÿå¯ä»¥ä¸ºå…¶ä»–è·¯å¾„/hbase2ç­‰ç­‰ </span></span><br><span class="line"><span class="comment">&lt;/property&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&lt;/configuration&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="3-2-2-regionservers"><a href="#3-2-2-regionservers" class="headerlink" title="3.2.2 regionservers"></a>3.2.2 regionservers</h3><p>ä¸€è¡Œä¸€ä¸ªæœºå™¨ï¼Œå¦‚<br>hadoop-master<br>hadoop-slave1<br>â€¦.</p>
<h3 id="3-2-3-hbase-env-sh"><a href="#3-2-3-hbase-env-sh" class="headerlink" title="3.2.3 hbase-env.sh"></a>3.2.3 hbase-env.sh</h3><p>é…ç½®JAVA_HOMEå³å¯</p>
<p>é…ç½®å®Œæˆåæ‰“åŒ…åˆ†å‘åˆ°å…¶ä»–æœºå™¨ä¸Šï¼Œæ“ä½œå¦‚åŒhadoopä¸­çš„æ­¥éª¤ï¼Œä¸å†èµ˜è¿°ï¼<br>è¿è¡Œstart-hbase.shï¼ŒæŸ¥çœ‹jps,masteræœºå™¨ä¸Šåº”è¯¥å¤šå‡ºä»¥ä¸‹å‡ ä¸ªè¿›ç¨‹<br>HMster<br>HRegionServer<br>HQuorumPeer<br>slaveæœºå™¨ä¸Šå¤šå‡ºè¿›ç¨‹<br>HRegionServer</p>
<h1 id="4-scala-sparkå®‰è£…"><a href="#4-scala-sparkå®‰è£…" class="headerlink" title="4 scala,sparkå®‰è£…"></a>4 scala,sparkå®‰è£…</h1><p>sparkè¿è¡Œéœ€è¦scalaç¯å¢ƒï¼Œæ‰€ä»¥scalaè¦å®‰è£…åœ¨sparkå‰é¢ï¼Œä¸”æ˜¯å¿…é¡»æ»´ï¼<br>ä¸‹è½½scalaå¹¶è§£å‹åˆ°/usr/localä¸‹è¾¹ï¼Œé…ç½®~/.bashrcå³å¯<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">export</span> <span class="attribute">SCALA_HOME</span>=/usr/local/scala</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">PATH</span>=<span class="variable">$PAHT</span>:$SCALA_HOME/bin</span><br></pre></td></tr></table></figure></p>
<p>ä¸‹è½½sparkï¼Œå¹¶è§£å‹åˆ°/usr/localè·¯å¾„ï¼Œé…ç½®~/.bashrc<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">export</span> <span class="attribute">SPARK_HOME</span>=/usr/local/spark</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">PAHT</span>=<span class="variable">$PATH</span>:$SPARK_HOME/bin</span><br></pre></td></tr></table></figure></p>
<p>è¿è¡Œsource ~/.bashrcä½¿é…ç½®ç”Ÿæ•ˆ</p>
<h2 id="4-1-spark-é…ç½®"><a href="#4-1-spark-é…ç½®" class="headerlink" title="4.1 spark é…ç½®"></a>4.1 spark é…ç½®</h2><h3 id="4-1-1-slaves-æ–‡ä»¶"><a href="#4-1-1-slaves-æ–‡ä»¶" class="headerlink" title="4.1.1 slaves æ–‡ä»¶"></a>4.1.1 slaves æ–‡ä»¶</h3><p>æ²¡æœ‰æ­¤æ­¤æ–‡ä»¶å°±åˆ›å»ºä¸€ä¸ªï¼Œå†…å®¹ä¸€è¡Œä¸€ä¸ªæœºå™¨ï¼Œä¸å†èµ˜è¿°</p>
<h3 id="spark-env-sh"><a href="#spark-env-sh" class="headerlink" title="spark-env.sh"></a>spark-env.sh</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">export</span> <span class="attribute">JAVA_HOME</span>=/usr/java/jdk1.7.0_79</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">SCALA_HOME</span>=/usr/local/scala</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">SPARK_MASTER_IP</span>=hadoop-master #ä¸»ç»“ç‚¹å</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">SPARK_WORKER_MEMORY</span>=1g  #åˆ†é…å†…å­˜å¤§å°</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">HADOOP_CONF_DIR</span>=/usr/local/hadoop/etc/hadoop #hadoopé…ç½®æ–‡ä»¶çš„è·¯å¾„</span><br></pre></td></tr></table></figure>
<p>è®°å¾—æŠŠscala,sparkåœ¨æ‰€æœ‰æœºå™¨ä¸Šéƒ½é…ç½®ä¸€ä¸‹ï¼Œæ–¹æ³•ä¸å†èµ˜è¿°ã€‚è¿è¡Œ/usr/local/spark/start-all.shå¯åŠ¨sparké›†ç¾¤ã€‚<br>æ³¨æ„ç”±äºhadoop/sbinä¸‹ä¹Ÿæœ‰ä¸€ä¸ªstart-all.shï¼Œç”±äºè¿™ä¸¤ä¸ªæ–‡ä»¶éƒ½é…ç½®åœ¨PATHé‡Œè¾¹äº†ï¼Œè¿è¡Œhadoop/sbin/start-all.shçš„æ—¶å€™å¯ä»¥çœ‹åˆ°æç¤ºè¯¥æ–¹æ³•å·²ç»ä¸æ¨èä½¿ç”¨äº†ï¼Œå¯ä»¥æŠŠè¯¥æ–‡ä»¶é‡å‘½åä¸€ä¸‹ï¼Œè¿™æ ·ç›´æ¥è¿è½½start-all.shå°±è‚¯å®šæ˜¯sparkçš„äº†ï¼Œä¸ä¼šå‘ç”Ÿæ­§ä¹‰ã€‚</p>
<p>è‡³æ­¤ï¼Œhadoop,hbase,scala,sparkçš„å®‰è£…é…ç½®å°±å®Œæˆäº†ï¼Œæ³¨æ„è¿™é‡Œåªæ˜¯è®©é›†ç¾¤ç¯å¢ƒè·‘äº†èµ·æ¥ï¼ŒçœŸå®çš„ç”Ÿäº§ç¯å¢ƒè¿˜æœ‰è®¸å¤šå…¶ä»–å‚æ•°éœ€è¦é…ç½®ï¼Œå‚è§å®˜æ–¹æ–‡æ¡£ï¼</p>
]]></content>
      
        <categories>
            
            <category> Hadoop </category>
            
        </categories>
        
        
        <tags>
            
            <tag> HBase </tag>
            
            <tag> Hadoop </tag>
            
            <tag> Spark </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[å…³äºé‡å†™å¼€é¢˜]]></title>
      <url>http://dequn.github.io/2015/12/21/guan-yu-chong-xie-kai-ti/</url>
      <content type="html"><![CDATA[<p>ä»Šå¤©åº”è¯¥æ˜¯ç»§ä¸¤æ¬¡é«˜è€ƒå¤±åˆ©ä»¥æ¥æœ€å—æ‰“å‡»çš„äº‹æƒ…äº†ï¼Œå¼€é¢˜ç­”è¾©çš„ç»“æœæ˜¯â€”â€”é‡å†™å¼€é¢˜æŠ¥å‘Šï¼é¢˜ç›®è¦æ¢ï¼Œæ–¹å‘è¦æ¢ã€‚è€Œç¦»å­¦æ ¡è§„å®šçš„deadlineåªæœ‰8å¤©çš„æ—¶é—´äº†ï¼ˆä»ç°åœ¨è®¡ï¼‰ã€‚ä¸€åˆ‡éƒ½è¦ä»æ–°å‡†å¤‡ï¼Œè®ºæ–‡é‡æ–°æ‰¾ï¼Œpaperé‡æ–°çœ‹ï¼Œåœ¨è¿™ä¹ˆçŸ­çš„æ—¶é—´å†…è¦æŒ‰è´¨é‡å®Œæˆå¼€é¢˜ï¼Œæ˜¯ä¸å¯èƒ½å®Œæˆçš„äº‹æƒ…äº†ã€‚æœ¬ä»¥ä¸ºå¼€é¢˜ç»“æŸå¯ä»¥æ˜¯é˜¶æ®µæ€§çš„ç»“æŸï¼Œç¨å¾®æ”¾æ¾ä¸¤å¤©ï¼Œæ²¡æƒ³åˆ°å´çœŸçœŸçš„åªæ˜¯è‹¦éš¾çš„å¼€å§‹ï¼<br>å…¶å®å…³äºä»Šå¤©çš„å¼€é¢˜ç»“æœï¼Œå¿ƒé‡Œä¼¼ä¹éšéšçº¦çº¦çš„æ„Ÿè§‰åˆ°äº†ï¼Œå†¥å†¥ä¹‹ä¸­ä¼¼ä¹ä¹Ÿæœ‰ä¸€ç§åŠ›é‡å¼•ç€æˆ‘å‘è¿™è¾¹èµ°æ¥ã€‚æˆ‘å¹¶ä¸æ˜¯è¦ä¸ºè‡ªå·±å¼€è„±ï¼Œåœ¨å°±ä»Šå¤©è¢«å¦å†³çš„è¿™ä¸ªæ–¹å‘ä¸Šï¼Œæˆ‘ä¹Ÿä¸€ç›´ä¸æ–­æ€€ç–‘å…¶å¯è¡Œæ€§å’Œæ„ä¹‰ï¼Œåœ¨æœ€åˆçš„æ—¶å€™ä¹Ÿè·Ÿè€æ¿æ²Ÿé€šè¿‡ï¼Œä½†è¢«è€æ¿çš„â€œè¿™æ˜¯æ²¡æœ‰ç§‘ç ”æ€åº¦â€é©³å›ï¼Œä¹Ÿæ²¡æœ‰å†åšæŒè‡ªå·±çš„æƒ³æ³•ï¼Œä¸äº†äº†ä¹‹ï¼Œè¿™ä¹Ÿæ˜¯å‰äº‹ä¹‹å› ï¼Œåäº‹ä¹‹æœå§ã€‚å½“ç„¶è¿™ä¹Ÿèµ–ä¸å¾—è€æ¿ï¼Œå°±è¿™ä¸ªæ–¹å‘æˆ‘æ²¡æœ‰è¿›è¡Œæ›´å¤šçš„æ€è€ƒæˆ‘è®ºè¯ï¼Œä¹Ÿæ²¡æœ‰è¿›è¡Œæ›´å¤šçš„æ²Ÿé€šäº¤æµï¼Œç»™ä»Šå¤©çš„å¼€é¢˜å¤±è´¥åŸ‹ä¸‹äº†ç§å­ã€‚<br>å¦å¤–å…³äºé€‰é¢˜çš„æ€åº¦ä¸Šï¼Œä¹Ÿä¸å¤Ÿè®¤çœŸå‹¤å‹‰ï¼Œæ€»æ„Ÿè§‰æ˜¯å¼€äº†é¢˜å°±å¯ä»¥äº†ï¼Œæ²¡æœ‰å¾ˆè®¤çœŸçš„å»çœ‹è®ºæ–‡ä»¥åŠç›¸å…³çš„ç ”ç©¶å·¥ä½œï¼Œè¿™ä¹Ÿé€ æˆäº†è§†é‡ç‹­å°ï¼Œä¸èƒ½ç«™åœ¨ä¸€ä¸ªå¾ˆé«˜çš„è§†è§’æ¥çœ‹å¾…è¦åšçš„é—®é¢˜ã€‚ç§‘ç ”æ€åº¦ä¹Ÿçš„ç¡®éœ€è¦æ”¹è¿›ï¼Œä¸èƒ½åšæ’é’Ÿå’Œå°šã€‚<br>ä»å¦å¤–çš„ä¸€æ–¹é¢è€ƒè™‘ï¼Œæˆ‘ä¹Ÿå¾ˆåº†å¹¸ä»Šå¤©èƒ½å¤Ÿè¢«å½“åœºé©³å›ï¼Œé¦–å…ˆåœ¨å……åˆ†è®¨è®ºäº†å…¶ä¸å¯è¡Œä¹‹åï¼Œè™½ç„¶åœ¨çŸ­æ—¶é—´å†…é‡æ–°æ¢å¦ä¸€ä¸ªç ”ç©¶æ–¹å‘éœ€è¦èŠ±è´¹ä¸å°‘åŠŸå¤«ï¼Œä½†é¿å…äº†åœ¨å‡ ä¸ªæœˆä¹‹åè¯¾é¢˜ç ”ç©¶è¿›è¡Œä¸ä¸‹å»çš„ä»£ä»·è¦å°å¾—å¤šï¼ä»ç†è®ºä¸Šè®²ï¼Œæœ¬æ¬¡å¼€é¢˜çš„ä½œç”¨ç”šä¸ºé‡å¤§ï¼å¦å¤–ä¸€ç‚¹ï¼Œä¹Ÿè®©æˆ‘æ›´åŠ æ„è¯†åˆ°è‡ªå·±çš„æ€åº¦é—®é¢˜ï¼Œè¢«è¯„å§”è€å¸ˆæ¯«ä¸ç•™æƒ…åœ°æ‰¹è¯„ä¹‹åï¼Œæ‰æ›´æ¸…æ¥šè‡ªå·±çš„æ‰€ä½œæ‰€ä¸ºç¦»ä¸€ä¸ªåˆæ ¼çš„ç ”ç©¶ç”Ÿæœ‰å¤šè¿œï¼å†æœ‰çš„ä¸€ç‚¹å¯å‘å°±æ˜¯é˜²å¾®æœæ¸ï¼Œåœ¨ç–‘é—®é—®é¢˜æ²¡æœ‰çœŸæ­£è¢«è§£å†³çš„æ—¶å€™åƒä¸‡ä¸è¦å¦¥åï¼Œä¸äº†äº†ä¹‹ï¼Œä¸€å®šè¦åŠæ—¶ä¸ç›¸å…³äººï¼ˆè¿™é‡Œæ˜¯è€æ¿ï¼‰æ²Ÿé€šï¼Œä¸èƒ½å› å…¶ä»–åŸå› è€Œè€½è¯¯ï¼Œäº‹å®è¯æ˜ï¼Œä¸€ä¸ªå°çš„é—®é¢˜è¢«æ—¶é—´æ”¾å¤§ä»¥åï¼Œå…¶ä»£ä»·æ˜¯å‡ ä½•çº§æ•°å¢é•¿çš„ï¼Œè¦åœ¨è¿™ä¹ˆçŸ­çš„æ—¶é—´å†…é‡æ–°å¼€é¢˜å·²ç»æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­äº†ï¼<br>æˆ‘ä»¬åšä»»ä½•ä¸€ä»¶äº‹éƒ½è¦ä»˜å‡ºä»£ä»·ï¼Œä¹Ÿä½†æ„¿æˆ‘ä»¬ä»˜å‡ºçš„ä»£ä»·èƒ½å¤Ÿæ¢å›æ›´å¤šçš„æ”¶ç›Šï¼</p>
<p>Accept, control, change, digest, four keys to deal with an accidet.    â€“ by dequn, 2015-12-21</p>
]]></content>
      
        <categories>
            
            <category> ä¸ªäººæ—¥è®° </category>
            
        </categories>
        
        
    </entry>
    
    <entry>
      <title><![CDATA[Angularä¹‹è¿‡æ»¤å™¨filter]]></title>
      <url>http://dequn.github.io/2015/12/04/angular-filter/</url>
      <content type="html"><![CDATA[<p>Angular çš„ filter å¯ä»¥è¯´æ˜¯ä¸€å¤§åˆ©å™¨ï¼Œé‚£äº›éœ€è¦å¤„ç†ä½†å¤„ç†é€»è¾‘ä¸å¤æ‚ä¸”å¤ç”¨æ¬¡æ•°æ¯”è¾ƒå¤šçš„å‡½æ•°éƒ½å¯ä»¥å°é—­æˆfilterï¼ŒAngular çš„ filter å¯ä»¥é€šè¿‡ç±»ä¼¼ç®¡é“å‘½ä»¤çš„è°ƒç”¨æ–¹å¼è¿›è¡Œï¼Œå¯¹äºå¤§å¤šæ•°äººæ¥è¯´å¹¶ä¸é™Œç”Ÿï¼Œå°±ä¸å†èµ˜è¿°ã€‚Angularæä¾›çš„åŸç”Ÿfilteræœ‰ä»¥ä¸‹å‡ ç§ï¼š</p>
<ul>
<li>currency:å¯¹è´§å¸è¿›è¡Œæ ¼å¼åŒ–ï¼Œéœ€è¦ä¼ å…¥è´§å¸æ ¼å¼ï¼Œé»˜è®¤é‡‡ç”¨æœ¬åœ°è´§å¸æ ¼å¼ã€‚</li>
<li>date:å¯¹æ—¥æœŸæ ¼å¼åŒ–ï¼Œéœ€è¦ä¼ å…¥æ—¥æœŸ</li>
<li>number:æŠŠæ•°å­—è½¬æ¢æˆæ–‡æœ¬</li>
<li>json:æŠŠObjectå¯¹è±¡åºåˆ—åŒ–æˆJSONå­—ç¬¦ä¸²</li>
<li>lowercase</li>
<li>uppercase è¿™ä¸¤ä¸ªéƒ½ä¸è¯´äº†å§</li>
<li>limitTo:æˆªå–å­—ç¬¦ä¸²æˆ–è€…æ•°ç»„ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œè®°ä½ï¼Œæ–°çš„å¯¹è±¡ï¼Œæ–°çš„å¯¹è±¡ï¼Œé‡è¦çš„äº‹ä»¶è¯´ä¸‰éã€‚</li>
<li>orderBy:çœ‹åå­—ï¼Œå¯¹æ•°ç»„æ’åºï¼Œéœ€è¦ä¼ å…¥è§„åˆ™ï¼Œå¯¹å­—ç¬¦ä¸²é»˜è®¤å­—æ¯æ’åºï¼Œæ•°å­—æ•°ç»„é»˜è®¤è‡ªç„¶æ’åˆ—ï¼Œè®°ä½ï¼Œå¦‚æœæ•°å­—æ•°å­—æ’åºç»“æœä¸å¯¹ï¼Œå…ˆçœ‹ä¼ çš„æ•°å­—æœ‰æ²¡æœ‰æ˜¯å­—ç¬¦ä¸²å•Šï¼</li>
<li>filterï¼šfilterçš„filter,å¯¹è¿›è¡Œç­›é€‰ï¼Œä¹Ÿæ˜¯è¿”å›æ–°çš„å¯¹è±¡å“¦ï¼</li>
</ul>
<h1 id="filterä¹‹filter"><a href="#filterä¹‹filter" class="headerlink" title="filterä¹‹filter"></a>filterä¹‹filter</h1><p>å…ˆè¯´è¿™ä¸ªç­›é€‰æ•°ç»„çš„ï¼Œæ¯”è¾ƒçµæ´»ï¼Œè°ƒç”¨æ–¹æ³•:<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; input |<span class="built_in"> filter </span>: express : comparator &#125;&#125;</span><br></pre></td></tr></table></figure></p>
]]></content>
      
        <categories>
            
            <category> Angular </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Angular </tag>
            
            <tag> filter </tag>
            
        </tags>
        
    </entry>
    
  
  
</search>
